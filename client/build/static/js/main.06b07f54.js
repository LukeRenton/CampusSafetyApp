/*! For license information please see main.06b07f54.js.LICENSE.txt */
(()=>{var __webpack_modules__={750:function(e,t,i){!function(e,t,i){"use strict";function r(e){return e&&"object"===typeof e&&"default"in e?e:{default:e}}var n=r(t),a=r(i);function o(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,a,o,s=[],l=!0,c=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=a.call(i)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(h){c=!0,n=h}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw n}}return s}}function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return(t=y(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){if(null==e)return{};var i,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)i=a[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}function u(e,t){if(null==e)return{};var i,r,n=h(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)i=a[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}function d(e,t){return p(e)||o(e,t)||f(e,t)||g()}function p(e){if(Array.isArray(e))return e}function f(e,t){if(e){if("string"===typeof e)return m(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function y(e){var t=_(e,"string");return"symbol"===typeof t?t:String(t)}var x=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],v=function(e,t){var r=e.animationData,o=e.loop,s=e.autoplay,c=e.initialSegment,h=e.onComplete,p=e.onLoopComplete,f=e.onEnterFrame,m=e.onSegmentStart,g=e.onConfigReady,_=e.onDataReady,y=e.onDataFailed,v=e.onLoadedImages,b=e.onDOMLoaded,w=e.onDestroy;e.lottieRef,e.renderer,e.name,e.assetsPath,e.rendererSettings;var S=u(e,x),E=d(i.useState(!1),2),T=E[0],C=E[1],k=i.useRef(),M=i.useRef(null),A=function(){var e;null===(e=k.current)||void 0===e||e.play()},P=function(){var e;null===(e=k.current)||void 0===e||e.stop()},I=function(){var e;null===(e=k.current)||void 0===e||e.pause()},D=function(e){var t;null===(t=k.current)||void 0===t||t.setSpeed(e)},R=function(e,t){var i;null===(i=k.current)||void 0===i||i.goToAndPlay(e,t)},z=function(e,t){var i;null===(i=k.current)||void 0===i||i.goToAndStop(e,t)},L=function(e){var t;null===(t=k.current)||void 0===t||t.setDirection(e)},F=function(e,t){var i;null===(i=k.current)||void 0===i||i.playSegments(e,t)},B=function(e){var t;null===(t=k.current)||void 0===t||t.setSubframe(e)},O=function(e){var t;return null===(t=k.current)||void 0===t?void 0:t.getDuration(e)},N=function(){var e;null===(e=k.current)||void 0===e||e.destroy(),k.current=void 0},V=function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(M.current){null===(t=k.current)||void 0===t||t.destroy();var r=l(l(l({},e),i),{},{container:M.current});return k.current=n.default.loadAnimation(r),C(!!k.current),function(){var e;null===(e=k.current)||void 0===e||e.destroy(),k.current=void 0}}};return i.useEffect((function(){var e=V();return function(){return null===e||void 0===e?void 0:e()}}),[r,o]),i.useEffect((function(){k.current&&(k.current.autoplay=!!s)}),[s]),i.useEffect((function(){k.current&&(c?Array.isArray(c)&&c.length&&((k.current.currentRawFrame<c[0]||k.current.currentRawFrame>c[1])&&(k.current.currentRawFrame=c[0]),k.current.setSegment(c[0],c[1])):k.current.resetSegments(!0))}),[c]),i.useEffect((function(){var e=[{name:"complete",handler:h},{name:"loopComplete",handler:p},{name:"enterFrame",handler:f},{name:"segmentStart",handler:m},{name:"config_ready",handler:g},{name:"data_ready",handler:_},{name:"data_failed",handler:y},{name:"loaded_images",handler:v},{name:"DOMLoaded",handler:b},{name:"destroy",handler:w}].filter((function(e){return null!=e.handler}));if(e.length){var t=e.map((function(e){var t;return null===(t=k.current)||void 0===t||t.addEventListener(e.name,e.handler),function(){var t;null===(t=k.current)||void 0===t||t.removeEventListener(e.name,e.handler)}}));return function(){t.forEach((function(e){return e()}))}}}),[h,p,f,m,g,_,y,v,b,w]),{View:a.default.createElement("div",l({style:t,ref:M},S)),play:A,stop:P,pause:I,setSpeed:D,goToAndStop:z,goToAndPlay:R,setDirection:L,playSegments:F,setSubframe:B,getDuration:O,destroy:N,animationContainerRef:M,animationLoaded:T,animationItem:k.current}};function b(e){var t=e.getBoundingClientRect(),i=t.top,r=t.height;return(window.innerHeight-i)/(window.innerHeight+r)}function w(e,t,i){var r=e.getBoundingClientRect(),n=r.top;return{x:(t-r.left)/r.width,y:(i-n)/r.height}}var S=function(e){var t=e.wrapperRef,r=e.animationItem,n=e.mode,a=e.actions;i.useEffect((function(){var e=t.current;if(e&&r&&a.length){r.stop();var i=function(){var t=null,i=function(){var i=b(e),n=a.find((function(e){var t=e.visibility;return t&&i>=t[0]&&i<=t[1]}));if(n){if("seek"===n.type&&n.visibility&&2===n.frames.length){var o=n.frames[0]+Math.ceil((i-n.visibility[0])/(n.visibility[1]-n.visibility[0])*n.frames[1]);r.goToAndStop(o-r.firstFrame-1,!0)}"loop"===n.type&&(null===t||t!==n.frames||r.isPaused)&&(r.playSegments(n.frames,!0),t=n.frames),"play"===n.type&&r.isPaused&&(r.resetSegments(!0),r.play()),"stop"===n.type&&r.goToAndStop(n.frames[0]-r.firstFrame-1,!0)}};return document.addEventListener("scroll",i),function(){document.removeEventListener("scroll",i)}},o=function(){var t=function(t,i){var n=t,o=i;if(-1!==n&&-1!==o){var s=w(e,n,o);n=s.x,o=s.y}var l=a.find((function(e){var t=e.position;return t&&Array.isArray(t.x)&&Array.isArray(t.y)?n>=t.x[0]&&n<=t.x[1]&&o>=t.y[0]&&o<=t.y[1]:!(!t||Number.isNaN(t.x)||Number.isNaN(t.y))&&n===t.x&&o===t.y}));if(l){if("seek"===l.type&&l.position&&Array.isArray(l.position.x)&&Array.isArray(l.position.y)&&2===l.frames.length){var c=(n-l.position.x[0])/(l.position.x[1]-l.position.x[0]),h=(o-l.position.y[0])/(l.position.y[1]-l.position.y[0]);r.playSegments(l.frames,!0),r.goToAndStop(Math.ceil((c+h)/2*(l.frames[1]-l.frames[0])),!0)}"loop"===l.type&&r.playSegments(l.frames,!0),"play"===l.type&&(r.isPaused&&r.resetSegments(!1),r.playSegments(l.frames)),"stop"===l.type&&r.goToAndStop(l.frames[0],!0)}},i=function(e){t(e.clientX,e.clientY)},n=function(){t(-1,-1)};return e.addEventListener("mousemove",i),e.addEventListener("mouseout",n),function(){e.removeEventListener("mousemove",i),e.removeEventListener("mouseout",n)}};switch(n){case"scroll":return i();case"cursor":return o()}}}),[n,r])},E=function(e){var t=e.actions,i=e.mode,r=e.lottieObj,n=r.animationItem,a=r.View,o=r.animationContainerRef;return S({actions:t,animationItem:n,mode:i,wrapperRef:o}),a},T=["style","interactivity"],C=function(e){var t,r,n,a=e.style,o=e.interactivity,s=u(e,T),l=v(s,a),c=l.View,h=l.play,d=l.stop,p=l.pause,f=l.setSpeed,m=l.goToAndStop,g=l.goToAndPlay,_=l.setDirection,y=l.playSegments,x=l.setSubframe,b=l.getDuration,w=l.destroy,S=l.animationContainerRef,C=l.animationLoaded,k=l.animationItem;return i.useEffect((function(){e.lottieRef&&(e.lottieRef.current={play:h,stop:d,pause:p,setSpeed:f,goToAndPlay:g,goToAndStop:m,setDirection:_,playSegments:y,setSubframe:x,getDuration:b,destroy:w,animationContainerRef:S,animationLoaded:C,animationItem:k})}),[null===(t=e.lottieRef)||void 0===t?void 0:t.current]),E({lottieObj:{View:c,play:h,stop:d,pause:p,setSpeed:f,goToAndStop:m,goToAndPlay:g,setDirection:_,playSegments:y,setSubframe:x,getDuration:b,destroy:w,animationContainerRef:S,animationLoaded:C,animationItem:k},actions:null!==(r=null===o||void 0===o?void 0:o.actions)&&void 0!==r?r:[],mode:null!==(n=null===o||void 0===o?void 0:o.mode)&&void 0!==n?n:"scroll"})};Object.defineProperty(e,"LottiePlayer",{enumerable:!0,get:function(){return n.default}}),e.default=C,e.useLottie=v,e.useLottieInteractivity=E,Object.defineProperty(e,"__esModule",{value:!0})}(t,i(302),i(43))},302:function(module,exports,__webpack_require__){var factory;"undefined"!==typeof navigator&&(factory=function(){"use strict";var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,t){var i,r,n=e.length;for(i=0;i<n;i+=1)for(var a in r=e[i].prototype)Object.prototype.hasOwnProperty.call(r,a)&&(t.prototype[a]=r[a])}function getDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)}function createProxyFunction(e){function t(){}return t.prototype=e,t}var audioControllerFactory=function(){function e(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(e){this.audios.push(e)},pause:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].pause()},resume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].resume()},setRate:function(e){var t,i=this.audios.length;for(t=0;t<i;t+=1)this.audios[t].setRate(e)},createAudio:function(e){return this.audioFactory?this.audioFactory(e):window.Howl?new window.Howl({src:[e]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(e){this.audioFactory=e},setVolume:function(e){this._volume=e,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(e,t){var i,r=0,n=[];switch(e){case"int16":case"uint8c":i=1;break;default:i=1.1}for(r=0;r<t;r+=1)n.push(i);return n}return"function"===typeof Uint8ClampedArray&&"function"===typeof Float32Array?function(t,i){return"float32"===t?new Float32Array(i):"int16"===t?new Int16Array(i):"uint8c"===t?new Uint8ClampedArray(i):e(t,i)}:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){return _typeof$6="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),_shouldRoundValues=!1,bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};function ProjectInterface$1(){return{}}!function(){var e,t=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i=t.length;for(e=0;e<i;e+=1)BMMath[t[e]]=Math[t[e]]}(),BMMath.random=Math.random,BMMath.abs=function(e){if("object"===_typeof$6(e)&&e.length){var t,i=createSizedArray(e.length),r=e.length;for(t=0;t<r;t+=1)i[t]=Math.abs(e[t]);return i}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function roundValues(e){_shouldRoundValues=!!e}function bmRnd(e){return _shouldRoundValues?Math.round(e):e}function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,t,i,r){this.type=e,this.currentTime=t,this.totalTime=i,this.direction=r<0?-1:1}function BMCompleteEvent(e,t){this.type=e,this.direction=t<0?-1:1}function BMCompleteLoopEvent(e,t,i,r){this.type=e,this.currentLoop=i,this.totalLoops=t,this.direction=r<0?-1:1}function BMSegmentStartEvent(e,t,i){this.type=e,this.firstFrame=t,this.totalFrames=i}function BMDestroyEvent(e,t){this.type=e,this.target=t}function BMRenderFrameErrorEvent(e,t){this.type="renderFrameError",this.nativeError=e,this.currentTime=t}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}function BMAnimationConfigErrorEvent(e,t){this.type=e,this.nativeError=t}var createElementID=function(){var e=0;return function(){return idPrefix$1+"__lottie_element_"+(e+=1)}}();function HSVtoRGB(e,t,i){var r,n,a,o,s,l,c,h;switch(l=i*(1-t),c=i*(1-(s=6*e-(o=Math.floor(6*e)))*t),h=i*(1-(1-s)*t),o%6){case 0:r=i,n=h,a=l;break;case 1:r=c,n=i,a=l;break;case 2:r=l,n=i,a=h;break;case 3:r=l,n=c,a=i;break;case 4:r=h,n=l,a=i;break;case 5:r=i,n=l,a=c}return[r,n,a]}function RGBtoHSV(e,t,i){var r,n=Math.max(e,t,i),a=Math.min(e,t,i),o=n-a,s=0===n?0:o/n,l=n/255;switch(n){case a:r=0;break;case e:r=t-i+o*(t<i?6:0),r/=6*o;break;case t:r=i-e+2*o,r/=6*o;break;case i:r=e-t+4*o,r/=6*o}return[r,s,l]}function addSaturationToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[1]+=t,i[1]>1?i[1]=1:i[1]<=0&&(i[1]=0),HSVtoRGB(i[0],i[1],i[2])}function addBrightnessToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[2]+=t,i[2]>1?i[2]=1:i[2]<0&&(i[2]=0),HSVtoRGB(i[0],i[1],i[2])}function addHueToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[0]+=t/360,i[0]>1?i[0]-=1:i[0]<0&&(i[0]+=1),HSVtoRGB(i[0],i[1],i[2])}var rgbToHex=function(){var e,t,i=[];for(e=0;e<256;e+=1)t=e.toString(16),i[e]=1===t.length?"0"+t:t;return function(e,t,r){return e<0&&(e=0),t<0&&(t=0),r<0&&(r=0),"#"+i[e]+i[t]+i[r]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e},getIdPrefix=function(){return idPrefix$1};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){return _typeof$5="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$5(e)}var dataManager=function(){var e,t,i=1,r=[],n={onmessage:function(){},postMessage:function(t){e({data:t})}},a={postMessage:function(e){n.onmessage({data:e})}};function o(){t||(t=function(t){if(window.Worker&&window.Blob&&getWebWorker()){var i=new Blob(["var _workerSelf = self; self.onmessage = ",t.toString()],{type:"text/javascript"}),r=URL.createObjectURL(i);return new Worker(r)}return e=t,n}((function(e){if(a.dataManager||(a.dataManager=function(){function e(n,a){var o,s,l,c,u,d,p=n.length;for(s=0;s<p;s+=1)if("ks"in(o=n[s])&&!o.completed){if(o.completed=!0,o.hasMask){var f=o.masksProperties;for(c=f.length,l=0;l<c;l+=1)if(f[l].pt.k.i)r(f[l].pt.k);else for(d=f[l].pt.k.length,u=0;u<d;u+=1)f[l].pt.k[u].s&&r(f[l].pt.k[u].s[0]),f[l].pt.k[u].e&&r(f[l].pt.k[u].e[0])}0===o.ty?(o.layers=t(o.refId,a),e(o.layers,a)):4===o.ty?i(o.shapes):5===o.ty&&h(o)}}function t(e,t){var i=function(e,t){for(var i=0,r=t.length;i<r;){if(t[i].id===e)return t[i];i+=1}return null}(e,t);return i?i.layers.__used?JSON.parse(JSON.stringify(i.layers)):(i.layers.__used=!0,i.layers):null}function i(e){var t,n,a;for(t=e.length-1;t>=0;t-=1)if("sh"===e[t].ty)if(e[t].ks.k.i)r(e[t].ks.k);else for(a=e[t].ks.k.length,n=0;n<a;n+=1)e[t].ks.k[n].s&&r(e[t].ks.k[n].s[0]),e[t].ks.k[n].e&&r(e[t].ks.k[n].e[0]);else"gr"===e[t].ty&&i(e[t].it)}function r(e){var t,i=e.i.length;for(t=0;t<i;t+=1)e.i[t][0]+=e.v[t][0],e.i[t][1]+=e.v[t][1],e.o[t][0]+=e.v[t][0],e.o[t][1]+=e.v[t][1]}function n(e,t){var i=t?t.split("."):[100,100,100];return e[0]>i[0]||!(i[0]>e[0])&&(e[1]>i[1]||!(i[1]>e[1])&&(e[2]>i[2]||!(i[2]>e[2])&&null))}var a=function(){var e=[4,4,14];function t(e){var t=e.t.d;e.t.d={k:[{s:t,t:0}]}}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)5===e[i].ty&&t(e[i])}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),o=function(){var e=[4,7,99];return function(t){if(t.chars&&!n(e,t.v)){var r,a=t.chars.length;for(r=0;r<a;r+=1){var o=t.chars[r];o.data&&o.data.shapes&&(i(o.data.shapes),o.data.ip=0,o.data.op=99999,o.data.st=0,o.data.sr=1,o.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},t.chars[r].t||(o.data.shapes.push({ty:"no"}),o.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),s=function(){var e=[5,7,15];function t(e){var t=e.t.p;"number"===typeof t.a&&(t.a={a:0,k:t.a}),"number"===typeof t.p&&(t.p={a:0,k:t.p}),"number"===typeof t.r&&(t.r={a:0,k:t.r})}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)5===e[i].ty&&t(e[i])}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),l=function(){var e=[4,1,9];function t(e){var i,r,n,a=e.length;for(i=0;i<a;i+=1)if("gr"===e[i].ty)t(e[i].it);else if("fl"===e[i].ty||"st"===e[i].ty)if(e[i].c.k&&e[i].c.k[0].i)for(n=e[i].c.k.length,r=0;r<n;r+=1)e[i].c.k[r].s&&(e[i].c.k[r].s[0]/=255,e[i].c.k[r].s[1]/=255,e[i].c.k[r].s[2]/=255,e[i].c.k[r].s[3]/=255),e[i].c.k[r].e&&(e[i].c.k[r].e[0]/=255,e[i].c.k[r].e[1]/=255,e[i].c.k[r].e[2]/=255,e[i].c.k[r].e[3]/=255);else e[i].c.k[0]/=255,e[i].c.k[1]/=255,e[i].c.k[2]/=255,e[i].c.k[3]/=255}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)4===e[i].ty&&t(e[i].shapes)}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),c=function(){var e=[4,4,18];function t(e){var i,r,n;for(i=e.length-1;i>=0;i-=1)if("sh"===e[i].ty)if(e[i].ks.k.i)e[i].ks.k.c=e[i].closed;else for(n=e[i].ks.k.length,r=0;r<n;r+=1)e[i].ks.k[r].s&&(e[i].ks.k[r].s[0].c=e[i].closed),e[i].ks.k[r].e&&(e[i].ks.k[r].e[0].c=e[i].closed);else"gr"===e[i].ty&&t(e[i].it)}function i(e){var i,r,n,a,o,s,l=e.length;for(r=0;r<l;r+=1){if((i=e[r]).hasMask){var c=i.masksProperties;for(a=c.length,n=0;n<a;n+=1)if(c[n].pt.k.i)c[n].pt.k.c=c[n].cl;else for(s=c[n].pt.k.length,o=0;o<s;o+=1)c[n].pt.k[o].s&&(c[n].pt.k[o].s[0].c=c[n].cl),c[n].pt.k[o].e&&(c[n].pt.k[o].e[0].c=c[n].cl)}4===i.ty&&t(i.shapes)}}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}();function h(e){0===e.t.a.length&&e.t.p}var u={completeData:function(i){i.__complete||(l(i),a(i),o(i),s(i),c(i),e(i.layers,i.assets),function(i,r){if(i){var n=0,a=i.length;for(n=0;n<a;n+=1)1===i[n].t&&(i[n].data.layers=t(i[n].data.refId,r),e(i[n].data.layers,r))}}(i.chars,i.assets),i.__complete=!0)}};return u.checkColors=l,u.checkChars=o,u.checkPathProperties=s,u.checkShapes=c,u.completeLayers=e,u}()),a.assetLoader||(a.assetLoader=function(){function e(e){var t=e.getResponseHeader("content-type");return t&&"json"===e.responseType&&-1!==t.indexOf("json")||e.response&&"object"===_typeof$5(e.response)?e.response:e.response&&"string"===typeof e.response?JSON.parse(e.response):e.responseText?JSON.parse(e.responseText):null}return{load:function(t,i,r,n){var a,o=new XMLHttpRequest;try{o.responseType="json"}catch(s){}o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)a=e(o),r(a);else try{a=e(o),r(a)}catch(s){n&&n(s)}};try{o.open(["G","E","T"].join(""),t,!0)}catch(l){o.open(["G","E","T"].join(""),i+"/"+t,!0)}o.send()}}}()),"loadAnimation"===e.data.type)a.assetLoader.load(e.data.path,e.data.fullPath,(function(t){a.dataManager.completeData(t),a.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){a.postMessage({id:e.data.id,status:"error"})}));else if("complete"===e.data.type){var t=e.data.animation;a.dataManager.completeData(t),a.postMessage({id:e.data.id,payload:t,status:"success"})}else"loadData"===e.data.type&&a.assetLoader.load(e.data.path,e.data.fullPath,(function(t){a.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){a.postMessage({id:e.data.id,status:"error"})}))})),t.onmessage=function(e){var t=e.data,i=t.id,n=r[i];r[i]=null,"success"===t.status?n.onComplete(t.payload):n.onError&&n.onError()})}function s(e,t){var n="processId_"+(i+=1);return r[n]={onComplete:e,onError:t},n}return{loadAnimation:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"loadAnimation",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},loadData:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"loadData",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},completeAnimation:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"complete",animation:e,id:n})}}}(),ImagePreloader=function(){var e=function(){var e=createTag("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),e}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function i(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function r(e,t,i){var r="";if(e.e)r=e.p;else if(t){var n=e.p;-1!==n.indexOf("images/")&&(n=n.split("/")[1]),r=t+n}else r=i,r+=e.u?e.u:"",r+=e.p;return r}function n(e){var t=0,i=setInterval(function(){(e.getBBox().width||t>500)&&(this._imageLoaded(),clearInterval(i)),t+=1}.bind(this),50)}function a(e){var t={assetData:e},i=r(e,this.assetsPath,this.path);return dataManager.loadData(i,function(e){t.img=e,this._footageLoaded()}.bind(this),function(){t.img={},this._footageLoaded()}.bind(this)),t}function o(){this._imageLoaded=t.bind(this),this._footageLoaded=i.bind(this),this.testImageLoaded=n.bind(this),this.createFootageData=a.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return o.prototype={loadAssets:function(e,t){var i;this.imagesLoadedCb=t;var r=e.length;for(i=0;i<r;i+=1)e[i].layers||(e[i].t&&"seq"!==e[i].t?3===e[i].t&&(this.totalFootages+=1,this.images.push(this.createFootageData(e[i]))):(this.totalImages+=1,this.images.push(this._createImageData(e[i]))))},setAssetsPath:function(e){this.assetsPath=e||""},setPath:function(e){this.path=e||""},loadedImages:function(){return this.totalImages===this.loadedAssets},loadedFootages:function(){return this.totalFootages===this.loadedFootagesCount},destroy:function(){this.imagesLoadedCb=null,this.images.length=0},getAsset:function(e){for(var t=0,i=this.images.length;t<i;){if(this.images[t].assetData===e)return this.images[t].img;t+=1}return null},createImgData:function(t){var i=r(t,this.assetsPath,this.path),n=createTag("img");n.crossOrigin="anonymous",n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){a.img=e,this._imageLoaded()}.bind(this),!1),n.src=i;var a={img:n,assetData:t};return a},createImageData:function(t){var i=r(t,this.assetsPath,this.path),n=createNS("image");isSafari?this.testImageLoaded(n):n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){a.img=e,this._imageLoaded()}.bind(this),!1),n.setAttributeNS("http://www.w3.org/1999/xlink","href",i),this._elementHelper.append?this._elementHelper.append(n):this._elementHelper.appendChild(n);var a={img:n,assetData:t};return a},imageLoaded:t,footageLoaded:i,setCacheType:function(e,t){"svg"===e?(this._elementHelper=t,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}},o}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var i=this._cbs[e],r=0;r<i.length;r+=1)i[r](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),function(){this.removeEventListener(e,t)}.bind(this)},removeEventListener:function(e,t){if(t){if(this._cbs[e]){for(var i=0,r=this._cbs[e].length;i<r;)this._cbs[e][i]===t&&(this._cbs[e].splice(i,1),i-=1,r-=1),i+=1;this._cbs[e].length||(this._cbs[e]=null)}}else this._cbs[e]=null}};var markerParser=function(){function e(e){for(var t,i=e.split("\r\n"),r={},n=0,a=0;a<i.length;a+=1)2===(t=i[a].split(":")).length&&(r[t[0]]=t[1].trim(),n+=1);if(0===n)throw new Error;return r}return function(t){for(var i=[],r=0;r<t.length;r+=1){var n=t[r],a={time:n.tm,duration:n.dr};try{a.payload=JSON.parse(t[r].cm)}catch(o){try{a.payload=e(t[r].cm)}catch(s){a.payload={name:t[r].cm}}}i.push(a)}return i}}(),ProjectInterface=function(){function e(e){this.compositions.push(e)}return function(){function t(e){for(var t=0,i=this.compositions.length;t<i;){if(this.compositions[t].data&&this.compositions[t].data.nm===e)return this.compositions[t].prepareFrame&&this.compositions[t].data.xt&&this.compositions[t].prepareFrame(this.currentFrame),this.compositions[t].compInterface;t+=1}return null}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){return _typeof$4="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var t="svg";e.animType?t=e.animType:e.renderer&&(t=e.renderer);var i=getRenderer(t);this.renderer=new i(this,e.rendererSettings),this.imagePreloader.setCacheType(t,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=t,""===e.loop||null===e.loop||void 0===e.loop||!0===e.loop?this.loop=!0:!1===e.loop?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay=!("autoplay"in e)||e.autoplay,this.name=e.name?e.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(e,"autoloadSegments")||e.autoloadSegments,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(-1!==e.path.lastIndexOf("\\")?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,t){t&&"object"!==_typeof$4(t)&&(t=JSON.parse(t));var i={wrapper:e,animationData:t},r=e.attributes;i.path=r.getNamedItem("data-animation-path")?r.getNamedItem("data-animation-path").value:r.getNamedItem("data-bm-path")?r.getNamedItem("data-bm-path").value:r.getNamedItem("bm-path")?r.getNamedItem("bm-path").value:"",i.animType=r.getNamedItem("data-anim-type")?r.getNamedItem("data-anim-type").value:r.getNamedItem("data-bm-type")?r.getNamedItem("data-bm-type").value:r.getNamedItem("bm-type")?r.getNamedItem("bm-type").value:r.getNamedItem("data-bm-renderer")?r.getNamedItem("data-bm-renderer").value:r.getNamedItem("bm-renderer")?r.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var n=r.getNamedItem("data-anim-loop")?r.getNamedItem("data-anim-loop").value:r.getNamedItem("data-bm-loop")?r.getNamedItem("data-bm-loop").value:r.getNamedItem("bm-loop")?r.getNamedItem("bm-loop").value:"";"false"===n?i.loop=!1:"true"===n?i.loop=!0:""!==n&&(i.loop=parseInt(n,10));var a=r.getNamedItem("data-anim-autoplay")?r.getNamedItem("data-anim-autoplay").value:r.getNamedItem("data-bm-autoplay")?r.getNamedItem("data-bm-autoplay").value:!r.getNamedItem("bm-autoplay")||r.getNamedItem("bm-autoplay").value;i.autoplay="false"!==a,i.name=r.getNamedItem("data-name")?r.getNamedItem("data-name").value:r.getNamedItem("data-bm-name")?r.getNamedItem("data-bm-name").value:r.getNamedItem("bm-name")?r.getNamedItem("bm-name").value:"","false"===(r.getNamedItem("data-anim-prerender")?r.getNamedItem("data-anim-prerender").value:r.getNamedItem("data-bm-prerender")?r.getNamedItem("data-bm-prerender").value:r.getNamedItem("bm-prerender")?r.getNamedItem("bm-prerender").value:"")&&(i.prerender=!1),i.path?this.setParams(i):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var t,i,r=this.animationData.layers,n=r.length,a=e.layers,o=a.length;for(i=0;i<o;i+=1)for(t=0;t<n;){if(r[t].id===a[i].id){r[t]=a[i];break}t+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(n=e.assets.length,t=0;t<n;t+=1)this.animationData.assets.push(e.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||0===e.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var t=e.shift();this.timeCompleted=t.time*this.frameRate;var i=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(i,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||"canvas"!==this.renderer.rendererType)&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,t){var i="number"===typeof e?e:void 0,r="number"===typeof t?t:void 0;this.renderer.updateContainerSize(i,r)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||!0===this.isPaused&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||!1===this.isPaused&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var t,i=0;i<this.markers.length;i+=1)if((t=this.markers[i]).payload&&t.payload.name===e)return t;return null},AnimationItem.prototype.goToAndStop=function(e,t,i){if(!i||this.name===i){var r=Number(e);if(isNaN(r)){var n=this.getMarkerData(e);n&&this.goToAndStop(n.time,!0)}else t?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,t,i){if(!i||this.name===i){var r=Number(e);if(isNaN(r)){var n=this.getMarkerData(e);n&&(n.duration?this.playSegments([n.time,n.time+n.duration],!0):this.goToAndStop(n.time,!0))}else this.goToAndStop(r,t,i);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!0!==this.isPaused&&!1!==this.isLoaded){var t=this.currentRawFrame+e*this.frameModifier,i=!1;t>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?t>=this.totalFrames?(this.playCount+=1,this.checkSegments(t%this.totalFrames)||(this.setCurrentRawFrameValue(t%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(t):this.checkSegments(t>this.totalFrames?t%this.totalFrames:0)||(i=!0,t=this.totalFrames-1):t<0?this.checkSegments(t%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(i=!0,t=0):(this.setCurrentRawFrameValue(this.totalFrames+t%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(t),i&&(this.setCurrentRawFrameValue(t),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,t){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-t)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+t)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,t){var i=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?i=e:this.currentRawFrame+this.firstFrame>t&&(i=t-e)),this.firstFrame=e,this.totalFrames=t-e,this.timeCompleted=this.totalFrames,-1!==i&&this.goToAndStop(i,!0)},AnimationItem.prototype.playSegments=function(e,t){if(t&&(this.segments.length=0),"object"===_typeof$4(e[0])){var i,r=e.length;for(i=0;i<r;i+=1)this.segments.push(e[i])}else this.segments.push(e);this.segments.length&&t&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),e),!0)},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,t){t&&this.name!==t||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var t="";if(e.e)t=e.p;else if(this.assetsPath){var i=e.p;-1!==i.indexOf("images/")&&(i=i.split("/")[1]),t=this.assetsPath+i}else t=this.path,t+=e.u?e.u:"",t+=e.p;return t},AnimationItem.prototype.getAssetData=function(e){for(var t=0,i=this.assets.length;t<i;){if(e===this.assets[t].id)return this.assets[t];t+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,t,i){try{this.renderer.getElementByPath(e).updateDocumentData(t,i)}catch(r){}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}"enterFrame"===e&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===e&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),"complete"===e&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),"segmentStart"===e&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),"destroy"===e&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var t=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)},AnimationItem.prototype.triggerConfigError=function(e){var t=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)};var animationManager=function(){var e={},t=[],i=0,r=0,n=0,a=!0,o=!1;function s(e){for(var i=0,n=e.target;i<r;)t[i].animation===n&&(t.splice(i,1),i-=1,r-=1,n.isPaused||h()),i+=1}function l(e,i){if(!e)return null;for(var n=0;n<r;){if(t[n].elem===e&&null!==t[n].elem)return t[n].animation;n+=1}var a=new AnimationItem;return u(a,e),a.setData(e,i),a}function c(){n+=1,f()}function h(){n-=1}function u(e,i){e.addEventListener("destroy",s),e.addEventListener("_active",c),e.addEventListener("_idle",h),t.push({elem:i,animation:e}),r+=1}function d(e){var s,l=e-i;for(s=0;s<r;s+=1)t[s].animation.advanceTime(l);i=e,n&&!o?window.requestAnimationFrame(d):a=!0}function p(e){i=e,window.requestAnimationFrame(d)}function f(){!o&&n&&a&&(window.requestAnimationFrame(p),a=!1)}return e.registerAnimation=l,e.loadAnimation=function(e){var t=new AnimationItem;return u(t,null),t.setParams(e),t},e.setSpeed=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setSpeed(e,i)},e.setDirection=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setDirection(e,i)},e.play=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.play(e)},e.pause=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.pause(e)},e.stop=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.stop(e)},e.togglePause=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.togglePause(e)},e.searchAnimations=function(e,t,i){var r,n=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),a=n.length;for(r=0;r<a;r+=1)i&&n[r].setAttribute("data-bm-type",i),l(n[r],e);if(t&&0===a){i||(i="svg");var o=document.getElementsByTagName("body")[0];o.innerText="";var s=createTag("div");s.style.width="100%",s.style.height="100%",s.setAttribute("data-bm-type",i),o.appendChild(s),l(s,e)}},e.resize=function(){var e;for(e=0;e<r;e+=1)t[e].animation.resize()},e.goToAndStop=function(e,i,n){var a;for(a=0;a<r;a+=1)t[a].animation.goToAndStop(e,i,n)},e.destroy=function(e){var i;for(i=r-1;i>=0;i-=1)t[i].animation.destroy(e)},e.freeze=function(){o=!0},e.unfreeze=function(){o=!1,f()},e.setVolume=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setVolume(e,i)},e.mute=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.mute(e)},e.unmute=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.unmute(e)},e.getRegisteredAnimations=function(){var e,i=t.length,r=[];for(e=0;e<i;e+=1)r.push(t[e].animation);return r},e}(),BezierFactory=function(){var e={getBezierEasing:function(e,i,r,n,a){var o=a||("bez_"+e+"_"+i+"_"+r+"_"+n).replace(/\./g,"p");if(t[o])return t[o];var s=new h([e,i,r,n]);return t[o]=s,s}},t={},i=11,r=1/(i-1),n="function"===typeof Float32Array;function a(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function s(e){return 3*e}function l(e,t,i){return((a(t,i)*e+o(t,i))*e+s(t))*e}function c(e,t,i){return 3*a(t,i)*e*e+2*o(t,i)*e+s(t)}function h(e){this._p=e,this._mSampleValues=n?new Float32Array(i):new Array(i),this._precomputed=!1,this.get=this.get.bind(this)}return h.prototype={get:function(e){var t=this._p[0],i=this._p[1],r=this._p[2],n=this._p[3];return this._precomputed||this._precompute(),t===i&&r===n?e:0===e?0:1===e?1:l(this._getTForX(e),i,n)},_precompute:function(){var e=this._p[0],t=this._p[1],i=this._p[2],r=this._p[3];this._precomputed=!0,e===t&&i===r||this._calcSampleValues()},_calcSampleValues:function(){for(var e=this._p[0],t=this._p[2],n=0;n<i;++n)this._mSampleValues[n]=l(n*r,e,t)},_getTForX:function(e){for(var t=this._p[0],n=this._p[2],a=this._mSampleValues,o=0,s=1,h=i-1;s!==h&&a[s]<=e;++s)o+=r;var u=o+(e-a[--s])/(a[s+1]-a[s])*r,d=c(u,t,n);return d>=.001?function(e,t,i,r){for(var n=0;n<4;++n){var a=c(t,i,r);if(0===a)return t;t-=(l(t,i,r)-e)/a}return t}(e,u,t,n):0===d?u:function(e,t,i,r,n){var a,o,s=0;do{(a=l(o=t+(i-t)/2,r,n)-e)>0?i=o:t=o}while(Math.abs(a)>1e-7&&++s<10);return o}(e,o,o+r,t,n)}},e}(),pooling={double:function(e){return e.concat(createSizedArray(e.length))}},poolFactory=function(e,t,i){var r=0,n=e,a=createSizedArray(n);return{newElement:function(){return r?a[r-=1]:t()},release:function(e){r===n&&(a=pooling.double(a),n*=2),i&&i(e),a[r]=e,r+=1}}},bezierLengthPool=poolFactory(8,(function(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}})),segmentsLengthPool=poolFactory(8,(function(){return{lengths:[],totalLength:0}}),(function(e){var t,i=e.lengths.length;for(t=0;t<i;t+=1)bezierLengthPool.release(e.lengths[t]);e.lengths.length=0}));function bezFunction(){var e=Math;function t(e,t,i,r,n,a){var o=e*r+t*n+i*a-n*r-a*e-i*t;return o>-.001&&o<.001}var i=function(e,t,i,r){var n,a,o,s,l,c,h=getDefaultCurveSegments(),u=0,d=[],p=[],f=bezierLengthPool.newElement();for(o=i.length,n=0;n<h;n+=1){for(l=n/(h-1),c=0,a=0;a<o;a+=1)s=bmPow(1-l,3)*e[a]+3*bmPow(1-l,2)*l*i[a]+3*(1-l)*bmPow(l,2)*r[a]+bmPow(l,3)*t[a],d[a]=s,null!==p[a]&&(c+=bmPow(d[a]-p[a],2)),p[a]=d[a];c&&(u+=c=bmSqrt(c)),f.percents[n]=l,f.lengths[n]=u}return f.addedLength=u,f};function r(e){this.segmentLength=0,this.points=new Array(e)}function n(e,t){this.partialLength=e,this.point=t}var a=function(){var e={};return function(i,a,o,s){var l=(i[0]+"_"+i[1]+"_"+a[0]+"_"+a[1]+"_"+o[0]+"_"+o[1]+"_"+s[0]+"_"+s[1]).replace(/\./g,"p");if(!e[l]){var c,h,u,d,p,f,m,g=getDefaultCurveSegments(),_=0,y=null;2===i.length&&(i[0]!==a[0]||i[1]!==a[1])&&t(i[0],i[1],a[0],a[1],i[0]+o[0],i[1]+o[1])&&t(i[0],i[1],a[0],a[1],a[0]+s[0],a[1]+s[1])&&(g=2);var x=new r(g);for(u=o.length,c=0;c<g;c+=1){for(m=createSizedArray(u),p=c/(g-1),f=0,h=0;h<u;h+=1)d=bmPow(1-p,3)*i[h]+3*bmPow(1-p,2)*p*(i[h]+o[h])+3*(1-p)*bmPow(p,2)*(a[h]+s[h])+bmPow(p,3)*a[h],m[h]=d,null!==y&&(f+=bmPow(m[h]-y[h],2));_+=f=bmSqrt(f),x.points[c]=new n(f,m),y=m}x.segmentLength=_,e[l]=x}return e[l]}}();function o(e,t){var i=t.percents,r=t.lengths,n=i.length,a=bmFloor((n-1)*e),o=e*t.addedLength,s=0;if(a===n-1||0===a||o===r[a])return i[a];for(var l=r[a]>o?-1:1,c=!0;c;)if(r[a]<=o&&r[a+1]>o?(s=(o-r[a])/(r[a+1]-r[a]),c=!1):a+=l,a<0||a>=n-1){if(a===n-1)return i[a];c=!1}return i[a]+(i[a+1]-i[a])*s}var s=createTypedArray("float32",8);return{getSegmentsLength:function(e){var t,r=segmentsLengthPool.newElement(),n=e.c,a=e.v,o=e.o,s=e.i,l=e._length,c=r.lengths,h=0;for(t=0;t<l-1;t+=1)c[t]=i(a[t],a[t+1],o[t],s[t+1]),h+=c[t].addedLength;return n&&l&&(c[t]=i(a[t],a[0],o[t],s[0]),h+=c[t].addedLength),r.totalLength=h,r},getNewSegment:function(t,i,r,n,a,l,c){a<0?a=0:a>1&&(a=1);var h,u=o(a,c),d=o(l=l>1?1:l,c),p=t.length,f=1-u,m=1-d,g=f*f*f,_=u*f*f*3,y=u*u*f*3,x=u*u*u,v=f*f*m,b=u*f*m+f*u*m+f*f*d,w=u*u*m+f*u*d+u*f*d,S=u*u*d,E=f*m*m,T=u*m*m+f*d*m+f*m*d,C=u*d*m+f*d*d+u*m*d,k=u*d*d,M=m*m*m,A=d*m*m+m*d*m+m*m*d,P=d*d*m+m*d*d+d*m*d,I=d*d*d;for(h=0;h<p;h+=1)s[4*h]=e.round(1e3*(g*t[h]+_*r[h]+y*n[h]+x*i[h]))/1e3,s[4*h+1]=e.round(1e3*(v*t[h]+b*r[h]+w*n[h]+S*i[h]))/1e3,s[4*h+2]=e.round(1e3*(E*t[h]+T*r[h]+C*n[h]+k*i[h]))/1e3,s[4*h+3]=e.round(1e3*(M*t[h]+A*r[h]+P*n[h]+I*i[h]))/1e3;return s},getPointInSegment:function(t,i,r,n,a,s){var l=o(a,s),c=1-l;return[e.round(1e3*(c*c*c*t[0]+(l*c*c+c*l*c+c*c*l)*r[0]+(l*l*c+c*l*l+l*c*l)*n[0]+l*l*l*i[0]))/1e3,e.round(1e3*(c*c*c*t[1]+(l*c*c+c*l*c+c*c*l)*r[1]+(l*l*c+c*l*l+l*c*l)*n[1]+l*l*l*i[1]))/1e3]},buildBezierData:a,pointOnLine2D:t,pointOnLine3D:function(i,r,n,a,o,s,l,c,h){if(0===n&&0===s&&0===h)return t(i,r,a,o,l,c);var u,d=e.sqrt(e.pow(a-i,2)+e.pow(o-r,2)+e.pow(s-n,2)),p=e.sqrt(e.pow(l-i,2)+e.pow(c-r,2)+e.pow(h-n,2)),f=e.sqrt(e.pow(l-a,2)+e.pow(c-o,2)+e.pow(h-s,2));return(u=d>p?d>f?d-p-f:f-p-d:f>p?f-p-d:p-d-f)>-1e-4&&u<1e-4}}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,t){var i,r=this.offsetTime;"multidimensional"===this.propType&&(i=createTypedArray("float32",this.pv.length));for(var n,a,o,s,l,c,h,u,d,p=t.lastIndex,f=p,m=this.keyframes.length-1,g=!0;g;){if(n=this.keyframes[f],a=this.keyframes[f+1],f===m-1&&e>=a.t-r){n.h&&(n=a),p=0;break}if(a.t-r>e){p=f;break}f<m-1?f+=1:(p=0,g=!1)}o=this.keyframesMetadata[f]||{};var _,y=a.t-r,x=n.t-r;if(n.to){o.bezierData||(o.bezierData=bez.buildBezierData(n.s,a.s||n.e,n.to,n.ti));var v=o.bezierData;if(e>=y||e<x){var b=e>=y?v.points.length-1:0;for(l=v.points[b].point.length,s=0;s<l;s+=1)i[s]=v.points[b].point[s]}else{o.__fnct?d=o.__fnct:(d=BezierFactory.getBezierEasing(n.o.x,n.o.y,n.i.x,n.i.y,n.n).get,o.__fnct=d),c=d((e-x)/(y-x));var w,S=v.segmentLength*c,E=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastAddedLength:0;for(u=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastPoint:0,g=!0,h=v.points.length;g;){if(E+=v.points[u].partialLength,0===S||0===c||u===v.points.length-1){for(l=v.points[u].point.length,s=0;s<l;s+=1)i[s]=v.points[u].point[s];break}if(S>=E&&S<E+v.points[u+1].partialLength){for(w=(S-E)/v.points[u+1].partialLength,l=v.points[u].point.length,s=0;s<l;s+=1)i[s]=v.points[u].point[s]+(v.points[u+1].point[s]-v.points[u].point[s])*w;break}u<h-1?u+=1:g=!1}t._lastPoint=u,t._lastAddedLength=E-v.points[u].partialLength,t._lastKeyframeIndex=f}}else{var T,C,k,M,A;if(m=n.s.length,_=a.s||n.e,this.sh&&1!==n.h)e>=y?(i[0]=_[0],i[1]=_[1],i[2]=_[2]):e<=x?(i[0]=n.s[0],i[1]=n.s[1],i[2]=n.s[2]):quaternionToEuler(i,slerp(createQuaternion(n.s),createQuaternion(_),(e-x)/(y-x)));else for(f=0;f<m;f+=1)1!==n.h&&(e>=y?c=1:e<x?c=0:(n.o.x.constructor===Array?(o.__fnct||(o.__fnct=[]),o.__fnct[f]?d=o.__fnct[f]:(T=void 0===n.o.x[f]?n.o.x[0]:n.o.x[f],C=void 0===n.o.y[f]?n.o.y[0]:n.o.y[f],k=void 0===n.i.x[f]?n.i.x[0]:n.i.x[f],M=void 0===n.i.y[f]?n.i.y[0]:n.i.y[f],d=BezierFactory.getBezierEasing(T,C,k,M).get,o.__fnct[f]=d)):o.__fnct?d=o.__fnct:(T=n.o.x,C=n.o.y,k=n.i.x,M=n.i.y,d=BezierFactory.getBezierEasing(T,C,k,M).get,n.keyframeMetadata=d),c=d((e-x)/(y-x)))),_=a.s||n.e,A=1===n.h?n.s[f]:n.s[f]+(_[f]-n.s[f])*c,"multidimensional"===this.propType?i[f]=A:i=A}return t.lastIndex=p,i}function slerp(e,t,i){var r,n,a,o,s,l=[],c=e[0],h=e[1],u=e[2],d=e[3],p=t[0],f=t[1],m=t[2],g=t[3];return(n=c*p+h*f+u*m+d*g)<0&&(n=-n,p=-p,f=-f,m=-m,g=-g),1-n>1e-6?(r=Math.acos(n),a=Math.sin(r),o=Math.sin((1-i)*r)/a,s=Math.sin(i*r)/a):(o=1-i,s=i),l[0]=o*c+s*p,l[1]=o*h+s*f,l[2]=o*u+s*m,l[3]=o*d+s*g,l}function quaternionToEuler(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.atan2(2*r*a-2*i*n,1-2*r*r-2*n*n),s=Math.asin(2*i*r+2*n*a),l=Math.atan2(2*i*a-2*r*n,1-2*i*i-2*n*n);e[0]=o/degToRads,e[1]=s/degToRads,e[2]=l/degToRads}function createQuaternion(e){var t=e[0]*degToRads,i=e[1]*degToRads,r=e[2]*degToRads,n=Math.cos(t/2),a=Math.cos(i/2),o=Math.cos(r/2),s=Math.sin(t/2),l=Math.sin(i/2),c=Math.sin(r/2);return[s*l*o+n*a*c,s*a*o+n*l*c,n*l*o-s*a*c,n*a*o-s*l*c]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,t=this.keyframes[0].t-this.offsetTime,i=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=i&&e>=i||this._caching.lastFrame<t&&e<t))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var r=this.interpolateValue(e,this._caching);this.pv=r}return this._caching.lastFrame=e,this.pv}function setVValue(e){var t;if("unidimensional"===this.propType)t=e*this.mult,mathAbs(this.v-t)>1e-5&&(this.v=t,this._mdf=!0);else for(var i=0,r=this.v.length;i<r;)t=e[i]*this.mult,mathAbs(this.v[i]-t)>1e-5&&(this.v[i]=t,this._mdf=!0),i+=1}function processEffectsSequence(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e;this.lock=!0,this._mdf=this._isFirstFrame;var t=this.effectsSequence.length,i=this.kf?this.pv:this.data.k;for(e=0;e<t;e+=1)i=this.effectsSequence[e](i);this.setVValue(i),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,t,i,r){this.propType="unidimensional",this.mult=i||1,this.data=t,this.v=i?t.k*i:t.k,this.pv=t.k,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,t,i,r){var n;this.propType="multidimensional",this.mult=i||1,this.data=t,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var a=t.k.length;for(this.v=createTypedArray("float32",a),this.pv=createTypedArray("float32",a),this.vel=createTypedArray("float32",a),n=0;n<a;n+=1)this.v[n]=t.k[n]*this.mult,this.pv[n]=t.k[n];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,t,i,r){this.propType="unidimensional",this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=t,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,t,i,r){var n;this.propType="multidimensional";var a,o,s,l,c=t.k.length;for(n=0;n<c-1;n+=1)t.k[n].to&&t.k[n].s&&t.k[n+1]&&t.k[n+1].s&&(a=t.k[n].s,o=t.k[n+1].s,s=t.k[n].to,l=t.k[n].ti,(2===a.length&&(a[0]!==o[0]||a[1]!==o[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],a[0]+s[0],a[1]+s[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],o[0]+l[0],o[1]+l[1])||3===a.length&&(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],a[0]+s[0],a[1]+s[1],a[2]+s[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],o[0]+l[0],o[1]+l[1],o[2]+l[2]))&&(t.k[n].to=null,t.k[n].ti=null),a[0]===o[0]&&a[1]===o[1]&&0===s[0]&&0===s[1]&&0===l[0]&&0===l[1]&&(2===a.length||a[2]===o[2]&&0===s[2]&&0===l[2])&&(t.k[n].to=null,t.k[n].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=t,this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var h=t.k[0].s.length;for(this.v=createTypedArray("float32",h),this.pv=createTypedArray("float32",h),n=0;n<h;n+=1)this.v[n]=initFrame,this.pv[n]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",h)},this.addEffect=addEffect}var PropertyFactory={getProp:function(e,t,i,r,n){var a;if(t.sid&&(t=e.globalData.slotManager.getProp(t)),t.k.length)if("number"===typeof t.k[0])a=new MultiDimensionalProperty(e,t,r,n);else switch(i){case 0:a=new KeyframedValueProperty(e,t,r,n);break;case 1:a=new KeyframedMultidimensionalProperty(e,t,r,n)}else a=new ValueProperty(e,t,r,n);return a.effectsSequence.length&&n.addDynamicProperty(a),a}};function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var e;this._mdf=!1;var t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=poolFactory(8,(function(){return createTypedArray("float32",2)}));function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,t){this.c=e,this.setLength(t);for(var i=0;i<t;)this.v[i]=pointPool.newElement(),this.o[i]=pointPool.newElement(),this.i[i]=pointPool.newElement(),i+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,t,i,r,n){var a;switch(this._length=Math.max(this._length,r+1),this._length>=this._maxLength&&this.doubleArrayLength(),i){case"v":a=this.v;break;case"i":a=this.i;break;case"o":a=this.o;break;default:a=[]}(!a[r]||a[r]&&!n)&&(a[r]=pointPool.newElement()),a[r][0]=e,a[r][1]=t},ShapePath.prototype.setTripleAt=function(e,t,i,r,n,a,o,s){this.setXYAt(e,t,"v",o,s),this.setXYAt(i,r,"o",o,s),this.setXYAt(n,a,"i",o,s)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var t=this.v,i=this.o,r=this.i,n=0;this.c&&(e.setTripleAt(t[0][0],t[0][1],r[0][0],r[0][1],i[0][0],i[0][1],0,!1),n=1);var a,o=this._length-1,s=this._length;for(a=n;a<s;a+=1)e.setTripleAt(t[o][0],t[o][1],r[o][0],r[o][1],i[o][0],i[o][1],a,!1),o-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){var e=poolFactory(4,(function(){return new ShapePath}),(function(e){var t,i=e._length;for(t=0;t<i;t+=1)pointPool.release(e.v[t]),pointPool.release(e.i[t]),pointPool.release(e.o[t]),e.v[t]=null,e.i[t]=null,e.o[t]=null;e._length=0,e.c=!1}));return e.clone=function(t){var i,r=e.newElement(),n=void 0===t._length?t.v.length:t._length;for(r.setLength(n),r.c=t.c,i=0;i<n;i+=1)r.setTripleAt(t.v[i][0],t.v[i][1],t.o[i][0],t.o[i][1],t.i[i][0],t.i[i][1],i);return r},e}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:function(){return t?r[t-=1]:new ShapeCollection},release:function(e){var n,a=e._length;for(n=0;n<a;n+=1)shapePool.release(e.shapes[n]);e._length=0,t===i&&(r=pooling.double(r),i*=2),r[t]=e,t+=1}},t=0,i=4,r=createSizedArray(i);return e}(),ShapePropertyFactory=function(){var e=-999999;function t(e,t,i){var r,n,a,o,s,l,c,h,u,d=i.lastIndex,p=this.keyframes;if(e<p[0].t-this.offsetTime)r=p[0].s[0],a=!0,d=0;else if(e>=p[p.length-1].t-this.offsetTime)r=p[p.length-1].s?p[p.length-1].s[0]:p[p.length-2].e[0],a=!0;else{for(var f,m,g,_=d,y=p.length-1,x=!0;x&&(f=p[_],!((m=p[_+1]).t-this.offsetTime>e));)_<y-1?_+=1:x=!1;if(g=this.keyframesMetadata[_]||{},d=_,!(a=1===f.h)){if(e>=m.t-this.offsetTime)h=1;else if(e<f.t-this.offsetTime)h=0;else{var v;g.__fnct?v=g.__fnct:(v=BezierFactory.getBezierEasing(f.o.x,f.o.y,f.i.x,f.i.y).get,g.__fnct=v),h=v((e-(f.t-this.offsetTime))/(m.t-this.offsetTime-(f.t-this.offsetTime)))}n=m.s?m.s[0]:f.e[0]}r=f.s[0]}for(l=t._length,c=r.i[0].length,i.lastIndex=d,o=0;o<l;o+=1)for(s=0;s<c;s+=1)u=a?r.i[o][s]:r.i[o][s]+(n.i[o][s]-r.i[o][s])*h,t.i[o][s]=u,u=a?r.o[o][s]:r.o[o][s]+(n.o[o][s]-r.o[o][s])*h,t.o[o][s]=u,u=a?r.v[o][s]:r.v[o][s]+(n.v[o][s]-r.v[o][s])*h,t.v[o][s]=u}function i(){var t=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime,n=this._caching.lastFrame;return n!==e&&(n<i&&t<i||n>r&&t>r)||(this._caching.lastIndex=n<t?this._caching.lastIndex:0,this.interpolateShape(t,this.pv,this._caching)),this._caching.lastFrame=t,this.pv}function r(){this.paths=this.localShapeCollection}function n(e){(function(e,t){if(e._length!==t._length||e.c!==t.c)return!1;var i,r=e._length;for(i=0;i<r;i+=1)if(e.v[i][0]!==t.v[i][0]||e.v[i][1]!==t.v[i][1]||e.o[i][0]!==t.o[i][0]||e.o[i][1]!==t.o[i][1]||e.i[i][0]!==t.i[i][0]||e.i[i][1]!==t.i[i][1])return!1;return!0})(this.v,e)||(this.v=shapePool.clone(e),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function a(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e,t;this.lock=!0,this._mdf=!1,e=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var i=this.effectsSequence.length;for(t=0;t<i;t+=1)e=this.effectsSequence[t](e);this.setVValue(e),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function o(e,t,i){this.propType="shape",this.comp=e.comp,this.container=e,this.elem=e,this.data=t,this.k=!1,this.kf=!1,this._mdf=!1;var n=3===i?t.pt.k:t.ks.k;this.v=shapePool.clone(n),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=r,this.effectsSequence=[]}function s(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function l(t,n,a){this.propType="shape",this.comp=t.comp,this.elem=t,this.container=t,this.offsetTime=t.data.st,this.keyframes=3===a?n.pt.k:n.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var o=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,o),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=r,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[i.bind(this)]}o.prototype.interpolateShape=t,o.prototype.getValue=a,o.prototype.setVValue=n,o.prototype.addEffect=s,l.prototype.getValue=a,l.prototype.interpolateShape=t,l.prototype.setVValue=n,l.prototype.addEffect=s;var c=function(){var e=roundCorner;function t(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=t.d,this.elem=e,this.comp=e.comp,this.frameId=-1,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return t.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var t=this.p.v[0],i=this.p.v[1],r=this.s.v[0]/2,n=this.s.v[1]/2,a=3!==this.d,o=this.v;o.v[0][0]=t,o.v[0][1]=i-n,o.v[1][0]=a?t+r:t-r,o.v[1][1]=i,o.v[2][0]=t,o.v[2][1]=i+n,o.v[3][0]=a?t-r:t+r,o.v[3][1]=i,o.i[0][0]=a?t-r*e:t+r*e,o.i[0][1]=i-n,o.i[1][0]=a?t+r:t-r,o.i[1][1]=i-n*e,o.i[2][0]=a?t+r*e:t-r*e,o.i[2][1]=i+n,o.i[3][0]=a?t-r:t+r,o.i[3][1]=i+n*e,o.o[0][0]=a?t+r*e:t-r*e,o.o[0][1]=i-n,o.o[1][0]=a?t+r:t-r,o.o[1][1]=i+n*e,o.o[2][0]=a?t-r*e:t+r*e,o.o[2][1]=i+n,o.o[3][0]=a?t-r:t+r,o.o[3][1]=i-n*e}},extendPrototype([DynamicPropertyContainer],t),t}(),h=function(){function e(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=e,this.comp=e.comp,this.data=t,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),1===t.sy?(this.ir=PropertyFactory.getProp(e,t.ir,0,0,this),this.is=PropertyFactory.getProp(e,t.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(e,t.pt,0,0,this),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,degToRads,this),this.or=PropertyFactory.getProp(e,t.or,0,0,this),this.os=PropertyFactory.getProp(e,t.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return e.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var e,t,i,r,n=2*Math.floor(this.pt.v),a=2*Math.PI/n,o=!0,s=this.or.v,l=this.ir.v,c=this.os.v,h=this.is.v,u=2*Math.PI*s/(2*n),d=2*Math.PI*l/(2*n),p=-Math.PI/2;p+=this.r.v;var f=3===this.data.d?-1:1;for(this.v._length=0,e=0;e<n;e+=1){i=o?c:h,r=o?u:d;var m=(t=o?s:l)*Math.cos(p),g=t*Math.sin(p),_=0===m&&0===g?0:g/Math.sqrt(m*m+g*g),y=0===m&&0===g?0:-m/Math.sqrt(m*m+g*g);m+=+this.p.v[0],g+=+this.p.v[1],this.v.setTripleAt(m,g,m-_*r*i*f,g-y*r*i*f,m+_*r*i*f,g+y*r*i*f,e,!0),o=!o,p+=a*f}},convertPolygonToPath:function(){var e,t=Math.floor(this.pt.v),i=2*Math.PI/t,r=this.or.v,n=this.os.v,a=2*Math.PI*r/(4*t),o=.5*-Math.PI,s=3===this.data.d?-1:1;for(o+=this.r.v,this.v._length=0,e=0;e<t;e+=1){var l=r*Math.cos(o),c=r*Math.sin(o),h=0===l&&0===c?0:c/Math.sqrt(l*l+c*c),u=0===l&&0===c?0:-l/Math.sqrt(l*l+c*c);l+=+this.p.v[0],c+=+this.p.v[1],this.v.setTripleAt(l,c,l-h*a*n*s,c-u*a*n*s,l+h*a*n*s,c+u*a*n*s,e,!0),o+=i*s}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],e),e}(),u=function(){function e(e,t){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=e,this.comp=e.comp,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return e.prototype={convertRectToPath:function(){var e=this.p.v[0],t=this.p.v[1],i=this.s.v[0]/2,r=this.s.v[1]/2,n=bmMin(i,r,this.r.v),a=n*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(e+i,t-r+n,e+i,t-r+n,e+i,t-r+a,0,!0),this.v.setTripleAt(e+i,t+r-n,e+i,t+r-a,e+i,t+r-n,1,!0),0!==n?(this.v.setTripleAt(e+i-n,t+r,e+i-n,t+r,e+i-a,t+r,2,!0),this.v.setTripleAt(e-i+n,t+r,e-i+a,t+r,e-i+n,t+r,3,!0),this.v.setTripleAt(e-i,t+r-n,e-i,t+r-n,e-i,t+r-a,4,!0),this.v.setTripleAt(e-i,t-r+n,e-i,t-r+a,e-i,t-r+n,5,!0),this.v.setTripleAt(e-i+n,t-r,e-i+n,t-r,e-i+a,t-r,6,!0),this.v.setTripleAt(e+i-n,t-r,e+i-a,t-r,e+i-n,t-r,7,!0)):(this.v.setTripleAt(e-i,t+r,e-i+a,t+r,e-i,t+r,2),this.v.setTripleAt(e-i,t-r,e-i,t-r+a,e-i,t-r,3))):(this.v.setTripleAt(e+i,t-r+n,e+i,t-r+a,e+i,t-r+n,0,!0),0!==n?(this.v.setTripleAt(e+i-n,t-r,e+i-n,t-r,e+i-a,t-r,1,!0),this.v.setTripleAt(e-i+n,t-r,e-i+a,t-r,e-i+n,t-r,2,!0),this.v.setTripleAt(e-i,t-r+n,e-i,t-r+n,e-i,t-r+a,3,!0),this.v.setTripleAt(e-i,t+r-n,e-i,t+r-a,e-i,t+r-n,4,!0),this.v.setTripleAt(e-i+n,t+r,e-i+n,t+r,e-i+a,t+r,5,!0),this.v.setTripleAt(e+i-n,t+r,e+i-a,t+r,e+i-n,t+r,6,!0),this.v.setTripleAt(e+i,t+r-n,e+i,t+r-n,e+i,t+r-a,7,!0)):(this.v.setTripleAt(e-i,t-r,e-i+a,t-r,e-i,t-r,1,!0),this.v.setTripleAt(e-i,t+r,e-i,t+r-a,e-i,t+r,2,!0),this.v.setTripleAt(e+i,t+r,e+i-a,t+r,e+i,t+r,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:r},extendPrototype([DynamicPropertyContainer],e),e}(),d={getShapeProp:function(e,t,i){var r;return 3===i||4===i?r=(3===i?t.pt:t.ks).k.length?new l(e,t,i):new o(e,t,i):5===i?r=new u(e,t):6===i?r=new c(e,t):7===i&&(r=new h(e,t)),r.k&&e.addDynamicProperty(r),r},getConstructorFunction:function(){return o},getKeyframedConstructorFunction:function(){return l}};return d}(),Matrix=function(){var e=Math.cos,t=Math.sin,i=Math.tan,r=Math.round;function n(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function a(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1)}function o(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(1,0,0,0,0,r,-n,0,0,n,r,0,0,0,0,1)}function s(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,0,n,0,0,1,0,0,-n,0,r,0,0,0,0,1)}function l(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1)}function c(e,t){return this._t(1,t,e,1,0,0)}function h(e,t){return this.shear(i(e),i(t))}function u(r,n){var a=e(n),o=t(n);return this._t(a,o,0,0,-o,a,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,i(r),1,0,0,0,0,1,0,0,0,0,1)._t(a,-o,0,0,o,a,0,0,0,0,1,0,0,0,0,1)}function d(e,t,i){return i||0===i||(i=1),1===e&&1===t&&1===i?this:this._t(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1)}function p(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){return this.props[0]=e,this.props[1]=t,this.props[2]=i,this.props[3]=r,this.props[4]=n,this.props[5]=a,this.props[6]=o,this.props[7]=s,this.props[8]=l,this.props[9]=c,this.props[10]=h,this.props[11]=u,this.props[12]=d,this.props[13]=p,this.props[14]=f,this.props[15]=m,this}function f(e,t,i){return i=i||0,0!==e||0!==t||0!==i?this._t(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1):this}function m(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){var g=this.props;if(1===e&&0===t&&0===i&&0===r&&0===n&&1===a&&0===o&&0===s&&0===l&&0===c&&1===h&&0===u)return g[12]=g[12]*e+g[15]*d,g[13]=g[13]*a+g[15]*p,g[14]=g[14]*h+g[15]*f,g[15]*=m,this._identityCalculated=!1,this;var _=g[0],y=g[1],x=g[2],v=g[3],b=g[4],w=g[5],S=g[6],E=g[7],T=g[8],C=g[9],k=g[10],M=g[11],A=g[12],P=g[13],I=g[14],D=g[15];return g[0]=_*e+y*n+x*l+v*d,g[1]=_*t+y*a+x*c+v*p,g[2]=_*i+y*o+x*h+v*f,g[3]=_*r+y*s+x*u+v*m,g[4]=b*e+w*n+S*l+E*d,g[5]=b*t+w*a+S*c+E*p,g[6]=b*i+w*o+S*h+E*f,g[7]=b*r+w*s+S*u+E*m,g[8]=T*e+C*n+k*l+M*d,g[9]=T*t+C*a+k*c+M*p,g[10]=T*i+C*o+k*h+M*f,g[11]=T*r+C*s+k*u+M*m,g[12]=A*e+P*n+I*l+D*d,g[13]=A*t+P*a+I*c+D*p,g[14]=A*i+P*o+I*h+D*f,g[15]=A*r+P*s+I*u+D*m,this._identityCalculated=!1,this}function g(e){var t=e.props;return this.transform(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function _(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function y(e){for(var t=0;t<16;){if(e.props[t]!==this.props[t])return!1;t+=1}return!0}function x(e){var t;for(t=0;t<16;t+=1)e.props[t]=this.props[t];return e}function v(e){var t;for(t=0;t<16;t+=1)this.props[t]=e[t]}function b(e,t,i){return{x:e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12],y:e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13],z:e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]}}function w(e,t,i){return e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12]}function S(e,t,i){return e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13]}function E(e,t,i){return e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]}function T(){var e=this.props[0]*this.props[5]-this.props[1]*this.props[4],t=this.props[5]/e,i=-this.props[1]/e,r=-this.props[4]/e,n=this.props[0]/e,a=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/e,o=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/e,s=new Matrix;return s.props[0]=t,s.props[1]=i,s.props[4]=r,s.props[5]=n,s.props[12]=a,s.props[13]=o,s}function C(e){return this.getInverseMatrix().applyToPointArray(e[0],e[1],e[2]||0)}function k(e){var t,i=e.length,r=[];for(t=0;t<i;t+=1)r[t]=C(e[t]);return r}function M(e,t,i){var r=createTypedArray("float32",6);if(this.isIdentity())r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],r[4]=i[0],r[5]=i[1];else{var n=this.props[0],a=this.props[1],o=this.props[4],s=this.props[5],l=this.props[12],c=this.props[13];r[0]=e[0]*n+e[1]*o+l,r[1]=e[0]*a+e[1]*s+c,r[2]=t[0]*n+t[1]*o+l,r[3]=t[0]*a+t[1]*s+c,r[4]=i[0]*n+i[1]*o+l,r[5]=i[0]*a+i[1]*s+c}return r}function A(e,t,i){return this.isIdentity()?[e,t,i]:[e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12],e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13],e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]]}function P(e,t){if(this.isIdentity())return e+","+t;var i=this.props;return Math.round(100*(e*i[0]+t*i[4]+i[12]))/100+","+Math.round(100*(e*i[1]+t*i[5]+i[13]))/100}function I(){for(var e=0,t=this.props,i="matrix3d(";e<16;)i+=r(1e4*t[e])/1e4,i+=15===e?")":",",e+=1;return i}function D(e){return e<1e-6&&e>0||e>-1e-6&&e<0?r(1e4*e)/1e4:e}function R(){var e=this.props;return"matrix("+D(e[0])+","+D(e[1])+","+D(e[4])+","+D(e[5])+","+D(e[12])+","+D(e[13])+")"}return function(){this.reset=n,this.rotate=a,this.rotateX=o,this.rotateY=s,this.rotateZ=l,this.skew=h,this.skewFromAxis=u,this.shear=c,this.scale=d,this.setTransform=p,this.translate=f,this.transform=m,this.multiply=g,this.applyToPoint=b,this.applyToX=w,this.applyToY=S,this.applyToZ=E,this.applyToPointArray=A,this.applyToTriplePoints=M,this.applyToPointStringified=P,this.toCSS=I,this.to2dCSS=R,this.clone=x,this.cloneFromProps=v,this.equals=y,this.inversePoints=k,this.inversePoint=C,this.getInverseMatrix=T,this._t=this.transform,this.isIdentity=_,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){return _typeof$3="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$3(e)}var lottie={},standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer="";function setLocation(e){setLocationHref(e)}function searchAnimations(){!0===standalone?animationManager.searchAnimations(animationData,standalone,renderer):animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return!0===standalone&&(e.animationData=JSON.parse(animationData)),animationManager.loadAnimation(e)}function setQuality(e){if("string"===typeof e)switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10)}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e);getDefaultCurveSegments()>=50?roundValues(!1):roundValues(!0)}function inBrowser(){return"undefined"!==typeof navigator}function installPlugin(e,t){"expressions"===e&&setExpressionsPlugin(t)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var t=queryString.split("&"),i=0;i<t.length;i+=1){var r=t[i].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1])}return null}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";var queryString="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",renderer=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{"object"!==_typeof$3(exports)&&__webpack_require__.amdO}catch(err){}var ShapeModifiers=function(){var e={},t={};return e.registerModifier=function(e,i){t[e]||(t[e]=i)},e.getModifier=function(e,i,r){return new t[e](i,r)},e}();function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var t={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(t),this.addShapeToModifier(t),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,t){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,t){this.s=PropertyFactory.getProp(e,t.s,0,.01,this),this.e=PropertyFactory.getProp(e,t.e,0,.01,this),this.o=PropertyFactory.getProp(e,t.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=t.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,t,i,r,n){var a=[];t<=1?a.push({s:e,e:t}):e>=1?a.push({s:e-1,e:t-1}):(a.push({s:e,e:1}),a.push({s:0,e:t-1}));var o,s,l=[],c=a.length;for(o=0;o<c;o+=1){var h,u;(s=a[o]).e*n<r||s.s*n>r+i||(h=s.s*n<=r?0:(s.s*n-r)/i,u=s.e*n>=r+i?1:(s.e*n-r)/i,l.push([h,u]))}return l.length||l.push([0,0]),l},TrimModifier.prototype.releasePathsData=function(e){var t,i=e.length;for(t=0;t<i;t+=1)segmentsLengthPool.release(e[t]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var t,i,r,n;if(this._mdf||e){var a=this.o.v%360/360;if(a<0&&(a+=1),(t=this.s.v>1?1+a:this.s.v<0?0+a:this.s.v+a)>(i=this.e.v>1?1+a:this.e.v<0?0+a:this.e.v+a)){var o=t;t=i,i=o}t=1e-4*Math.round(1e4*t),i=1e-4*Math.round(1e4*i),this.sValue=t,this.eValue=i}else t=this.sValue,i=this.eValue;var s,l,c,h,u,d=this.shapes.length,p=0;if(i===t)for(n=0;n<d;n+=1)this.shapes[n].localShapeCollection.releaseShapes(),this.shapes[n].shape._mdf=!0,this.shapes[n].shape.paths=this.shapes[n].localShapeCollection,this._mdf&&(this.shapes[n].pathsData.length=0);else if(1===i&&0===t||0===i&&1===t){if(this._mdf)for(n=0;n<d;n+=1)this.shapes[n].pathsData.length=0,this.shapes[n].shape._mdf=!0}else{var f,m,g=[];for(n=0;n<d;n+=1)if((f=this.shapes[n]).shape._mdf||this._mdf||e||2===this.m){if(l=(r=f.shape.paths)._length,u=0,!f.shape._mdf&&f.pathsData.length)u=f.totalShapeLength;else{for(c=this.releasePathsData(f.pathsData),s=0;s<l;s+=1)h=bez.getSegmentsLength(r.shapes[s]),c.push(h),u+=h.totalLength;f.totalShapeLength=u,f.pathsData=c}p+=u,f.shape._mdf=!0}else f.shape.paths=f.localShapeCollection;var _,y=t,x=i,v=0;for(n=d-1;n>=0;n-=1)if((f=this.shapes[n]).shape._mdf){for((m=f.localShapeCollection).releaseShapes(),2===this.m&&d>1?(_=this.calculateShapeEdges(t,i,f.totalShapeLength,v,p),v+=f.totalShapeLength):_=[[y,x]],l=_.length,s=0;s<l;s+=1){y=_[s][0],x=_[s][1],g.length=0,x<=1?g.push({s:f.totalShapeLength*y,e:f.totalShapeLength*x}):y>=1?g.push({s:f.totalShapeLength*(y-1),e:f.totalShapeLength*(x-1)}):(g.push({s:f.totalShapeLength*y,e:f.totalShapeLength}),g.push({s:0,e:f.totalShapeLength*(x-1)}));var b=this.addShapes(f,g[0]);if(g[0].s!==g[0].e){if(g.length>1)if(f.shape.paths.shapes[f.shape.paths._length-1].c){var w=b.pop();this.addPaths(b,m),b=this.addShapes(f,g[1],w)}else this.addPaths(b,m),b=this.addShapes(f,g[1]);this.addPaths(b,m)}}f.shape.paths=m}}},TrimModifier.prototype.addPaths=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t.addShape(e[i])},TrimModifier.prototype.addSegment=function(e,t,i,r,n,a,o){n.setXYAt(t[0],t[1],"o",a),n.setXYAt(i[0],i[1],"i",a+1),o&&n.setXYAt(e[0],e[1],"v",a),n.setXYAt(r[0],r[1],"v",a+1)},TrimModifier.prototype.addSegmentFromArray=function(e,t,i,r){t.setXYAt(e[1],e[5],"o",i),t.setXYAt(e[2],e[6],"i",i+1),r&&t.setXYAt(e[0],e[4],"v",i),t.setXYAt(e[3],e[7],"v",i+1)},TrimModifier.prototype.addShapes=function(e,t,i){var r,n,a,o,s,l,c,h,u=e.pathsData,d=e.shape.paths.shapes,p=e.shape.paths._length,f=0,m=[],g=!0;for(i?(s=i._length,h=i._length):(i=shapePool.newElement(),s=0,h=0),m.push(i),r=0;r<p;r+=1){for(l=u[r].lengths,i.c=d[r].c,a=d[r].c?l.length:l.length+1,n=1;n<a;n+=1)if(f+(o=l[n-1]).addedLength<t.s)f+=o.addedLength,i.c=!1;else{if(f>t.e){i.c=!1;break}t.s<=f&&t.e>=f+o.addedLength?(this.addSegment(d[r].v[n-1],d[r].o[n-1],d[r].i[n],d[r].v[n],i,s,g),g=!1):(c=bez.getNewSegment(d[r].v[n-1],d[r].v[n],d[r].o[n-1],d[r].i[n],(t.s-f)/o.addedLength,(t.e-f)/o.addedLength,l[n-1]),this.addSegmentFromArray(c,i,s,g),g=!1,i.c=!1),f+=o.addedLength,s+=1}if(d[r].c&&l.length){if(o=l[n-1],f<=t.e){var _=l[n-1].addedLength;t.s<=f&&t.e>=f+_?(this.addSegment(d[r].v[n-1],d[r].o[n-1],d[r].i[0],d[r].v[0],i,s,g),g=!1):(c=bez.getNewSegment(d[r].v[n-1],d[r].v[0],d[r].o[n-1],d[r].i[0],(t.s-f)/_,(t.e-f)/_,l[n-1]),this.addSegmentFromArray(c,i,s,g),g=!1,i.c=!1)}else i.c=!1;f+=o.addedLength,s+=1}if(i._length&&(i.setXYAt(i.v[h][0],i.v[h][1],"i",h),i.setXYAt(i.v[i._length-1][0],i.v[i._length-1][1],"o",i._length-1)),f>t.e)break;r<p-1&&(i=shapePool.newElement(),g=!0,m.push(i),s=0)}return m},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,t){var i=t/100,r=[0,0],n=e._length,a=0;for(a=0;a<n;a+=1)r[0]+=e.v[a][0],r[1]+=e.v[a][1];r[0]/=n,r[1]/=n;var o,s,l,c,h,u,d=shapePool.newElement();for(d.c=e.c,a=0;a<n;a+=1)o=e.v[a][0]+(r[0]-e.v[a][0])*i,s=e.v[a][1]+(r[1]-e.v[a][1])*i,l=e.o[a][0]+(r[0]-e.o[a][0])*-i,c=e.o[a][1]+(r[1]-e.o[a][1])*-i,h=e.i[a][0]+(r[0]-e.i[a][0])*-i,u=e.i[a][1]+(r[1]-e.i[a][1])*-i,d.setTripleAt(o,s,l,c,h,u,a);return d},PuckerAndBloatModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amount.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function t(e,t,i){if(this.elem=e,this.frameId=-1,this.propType="transform",this.data=t,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(i||e),t.p&&t.p.s?(this.px=PropertyFactory.getProp(e,t.p.x,0,0,this),this.py=PropertyFactory.getProp(e,t.p.y,0,0,this),t.p.z&&(this.pz=PropertyFactory.getProp(e,t.p.z,0,0,this))):this.p=PropertyFactory.getProp(e,t.p||{k:[0,0,0]},1,0,this),t.rx){if(this.rx=PropertyFactory.getProp(e,t.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(e,t.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(e,t.rz,0,degToRads,this),t.or.k[0].ti){var r,n=t.or.k.length;for(r=0;r<n;r+=1)t.or.k[r].to=null,t.or.k[r].ti=null}this.or=PropertyFactory.getProp(e,t.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(e,t.r||{k:0},0,degToRads,this);t.sk&&(this.sk=PropertyFactory.getProp(e,t.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(e,t.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(e,t.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(e,t.s||{k:[100,100,100]},1,.01,this),t.o?this.o=PropertyFactory.getProp(e,t.o,0,.01,e):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return t.prototype={applyToMatrix:function(e){var t=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||t,this.a&&e.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&e.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&e.skewFromAxis(-this.sk.v,this.sa.v),this.r?e.rotate(-this.r.v):e.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?e.translate(this.px.v,this.py.v,-this.pz.v):e.translate(this.px.v,this.py.v,0):e.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(t){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||t){var i;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var r,n;if(i=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(r=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/i,0),n=this.p.getValueAtTime(this.p.keyframes[0].t/i,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(r=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/i,0),n=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/i,0)):(r=this.p.pv,n=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/i,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){r=[],n=[];var a=this.px,o=this.py;a._caching.lastFrame+a.offsetTime<=a.keyframes[0].t?(r[0]=a.getValueAtTime((a.keyframes[0].t+.01)/i,0),r[1]=o.getValueAtTime((o.keyframes[0].t+.01)/i,0),n[0]=a.getValueAtTime(a.keyframes[0].t/i,0),n[1]=o.getValueAtTime(o.keyframes[0].t/i,0)):a._caching.lastFrame+a.offsetTime>=a.keyframes[a.keyframes.length-1].t?(r[0]=a.getValueAtTime(a.keyframes[a.keyframes.length-1].t/i,0),r[1]=o.getValueAtTime(o.keyframes[o.keyframes.length-1].t/i,0),n[0]=a.getValueAtTime((a.keyframes[a.keyframes.length-1].t-.01)/i,0),n[1]=o.getValueAtTime((o.keyframes[o.keyframes.length-1].t-.01)/i,0)):(r=[a.pv,o.pv],n[0]=a.getValueAtTime((a._caching.lastFrame+a.offsetTime-.01)/i,a.offsetTime),n[1]=o.getValueAtTime((o._caching.lastFrame+o.offsetTime-.01)/i,o.offsetTime))}else r=n=e;this.v.rotate(-Math.atan2(r[1]-n[1],r[0]-n[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],t),t.prototype.addDynamicProperty=function(e){this._addDynamicProperty(e),this.elem.addDynamicProperty(e),this._isDirty=!0},t.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(e,i,r){return new t(e,i,r)}}}();function RepeaterModifier(){}function RoundCornersModifier(){}function floatEqual(e,t){return 1e5*Math.abs(e-t)<=Math.min(Math.abs(e),Math.abs(t))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,t,i){return e*(1-i)+t*i}function lerpPoint(e,t,i){return[lerp(e[0],t[0],i),lerp(e[1],t[1],i)]}function quadRoots(e,t,i){if(0===e)return[];var r=t*t-4*e*i;if(r<0)return[];var n=-t/(2*e);if(0===r)return[n];var a=Math.sqrt(r)/(2*e);return[n-a,n+a]}function polynomialCoefficients(e,t,i,r){return[3*t-e-3*i+r,3*e-6*t+3*i,-3*e+3*t,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,t,i,r,n){n&&pointEqual(e,t)&&(t=lerpPoint(e,r,1/3)),n&&pointEqual(i,r)&&(i=lerpPoint(e,r,2/3));var a=polynomialCoefficients(e[0],t[0],i[0],r[0]),o=polynomialCoefficients(e[1],t[1],i[1],r[1]);this.a=[a[0],o[0]],this.b=[a[1],o[1]],this.c=[a[2],o[2]],this.d=[a[3],o[3]],this.points=[e,t,i,r]}function extrema(e,t){var i=e.points[0][t],r=e.points[e.points.length-1][t];if(i>r){var n=r;r=i,i=n}for(var a=quadRoots(3*e.a[t],2*e.b[t],e.c[t]),o=0;o<a.length;o+=1)if(a[o]>0&&a[o]<1){var s=e.point(a[o])[t];s<i?i=s:s>r&&(r=s)}return{min:i,max:r}}function intersectData(e,t,i){var r=e.boundingBox();return{cx:r.cx,cy:r.cy,width:r.width,height:r.height,bez:e,t:(t+i)/2,t1:t,t2:i}}function splitData(e){var t=e.bez.split(.5);return[intersectData(t[0],e.t1,e.t),intersectData(t[1],e.t,e.t2)]}function boxIntersect(e,t){return 2*Math.abs(e.cx-t.cx)<e.width+t.width&&2*Math.abs(e.cy-t.cy)<e.height+t.height}function intersectsImpl(e,t,i,r,n,a){if(boxIntersect(e,t))if(i>=a||e.width<=r&&e.height<=r&&t.width<=r&&t.height<=r)n.push([e.t,t.t]);else{var o=splitData(e),s=splitData(t);intersectsImpl(o[0],s[0],i+1,r,n,a),intersectsImpl(o[0],s[1],i+1,r,n,a),intersectsImpl(o[1],s[0],i+1,r,n,a),intersectsImpl(o[1],s[1],i+1,r,n,a)}}function crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function lineIntersection(e,t,i,r){var n=[e[0],e[1],1],a=[t[0],t[1],1],o=[i[0],i[1],1],s=[r[0],r[1],1],l=crossProduct(crossProduct(n,a),crossProduct(o,s));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(e,t,i){return[e[0]+Math.cos(t)*i,e[1]-Math.sin(t)*i]}function pointDistance(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function pointEqual(e,t){return floatEqual(e[0],t[0])&&floatEqual(e[1],t[1])}function ZigZagModifier(){}function setPoint(e,t,i,r,n,a,o){var s=i-Math.PI/2,l=i+Math.PI/2,c=t[0]+Math.cos(i)*r*n,h=t[1]-Math.sin(i)*r*n;e.setTripleAt(c,h,c+Math.cos(s)*a,h-Math.sin(s)*a,c+Math.cos(l)*o,h-Math.sin(l)*o,e.length())}function getPerpendicularVector(e,t){var i=[t[0]-e[0],t[1]-e[1]],r=.5*-Math.PI;return[Math.cos(r)*i[0]-Math.sin(r)*i[1],Math.sin(r)*i[0]+Math.cos(r)*i[1]]}function getProjectingAngle(e,t){var i=0===t?e.length()-1:t-1,r=(t+1)%e.length(),n=getPerpendicularVector(e.v[i],e.v[r]);return Math.atan2(0,1)-Math.atan2(n[1],n[0])}function zigZagCorner(e,t,i,r,n,a,o){var s=getProjectingAngle(t,i),l=t.v[i%t._length],c=t.v[0===i?t._length-1:i-1],h=t.v[(i+1)%t._length],u=2===a?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0,d=2===a?Math.sqrt(Math.pow(l[0]-h[0],2)+Math.pow(l[1]-h[1],2)):0;setPoint(e,t.v[i%t._length],s,o,r,d/(2*(n+1)),u/(2*(n+1)),a)}function zigZagSegment(e,t,i,r,n,a){for(var o=0;o<r;o+=1){var s=(o+1)/(r+1),l=2===n?Math.sqrt(Math.pow(t.points[3][0]-t.points[0][0],2)+Math.pow(t.points[3][1]-t.points[0][1],2)):0,c=t.normalAngle(s);setPoint(e,t.point(s),c,a,i,l/(2*(r+1)),l/(2*(r+1)),n),a=-a}return a}function linearOffset(e,t,i){var r=Math.atan2(t[0]-e[0],t[1]-e[1]);return[polarOffset(e,r,i),polarOffset(t,r,i)]}function offsetSegment(e,t){var i,r,n,a,o,s,l;i=(l=linearOffset(e.points[0],e.points[1],t))[0],r=l[1],n=(l=linearOffset(e.points[1],e.points[2],t))[0],a=l[1],o=(l=linearOffset(e.points[2],e.points[3],t))[0],s=l[1];var c=lineIntersection(i,r,n,a);null===c&&(c=r);var h=lineIntersection(o,s,n,a);return null===h&&(h=o),new PolynomialBezier(i,c,h,s)}function joinLines(e,t,i,r,n){var a=t.points[3],o=i.points[0];if(3===r)return a;if(pointEqual(a,o))return a;if(2===r){var s=-t.tangentAngle(1),l=-i.tangentAngle(0)+Math.PI,c=lineIntersection(a,polarOffset(a,s+Math.PI/2,100),o,polarOffset(o,s+Math.PI/2,100)),h=c?pointDistance(c,a):pointDistance(a,o)/2,u=polarOffset(a,s,2*h*roundCorner);return e.setXYAt(u[0],u[1],"o",e.length()-1),u=polarOffset(o,l,2*h*roundCorner),e.setTripleAt(o[0],o[1],o[0],o[1],u[0],u[1],e.length()),o}var d=lineIntersection(pointEqual(a,t.points[2])?t.points[0]:t.points[2],a,o,pointEqual(o,i.points[1])?i.points[3]:i.points[1]);return d&&pointDistance(d,a)<n?(e.setTripleAt(d[0],d[1],d[0],d[1],d[0],d[1],e.length()),d):a}function getIntersection(e,t){var i=e.intersections(t);return i.length&&floatEqual(i[0][0],1)&&i.shift(),i.length?i[0]:null}function pruneSegmentIntersection(e,t){var i=e.slice(),r=t.slice(),n=getIntersection(e[e.length-1],t[0]);return n&&(i[e.length-1]=e[e.length-1].split(n[0])[0],r[0]=t[0].split(n[1])[1]),e.length>1&&t.length>1&&(n=getIntersection(e[0],t[t.length-1]))?[[e[0].split(n[0])[0]],[t[t.length-1].split(n[1])[1]]]:[i,r]}function pruneIntersections(e){for(var t,i=1;i<e.length;i+=1)t=pruneSegmentIntersection(e[i-1],e[i]),e[i-1]=t[0],e[i]=t[1];return e.length>1&&(t=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=t[0],e[0]=t[1]),e}function offsetSegmentSplit(e,t){var i,r,n,a,o=e.inflectionPoints();if(0===o.length)return[offsetSegment(e,t)];if(1===o.length||floatEqual(o[1],1))return i=(n=e.split(o[0]))[0],r=n[1],[offsetSegment(i,t),offsetSegment(r,t)];i=(n=e.split(o[0]))[0];var s=(o[1]-o[0])/(1-o[0]);return a=(n=n[1].split(s))[0],r=n[1],[offsetSegment(i,t),offsetSegment(a,t),offsetSegment(r,t)]}function OffsetPathModifier(){}function getFontProperties(e){for(var t=e.fStyle?e.fStyle.split(" "):[],i="normal",r="normal",n=t.length,a=0;a<n;a+=1)switch(t[a].toLowerCase()){case"italic":r="italic";break;case"bold":i="700";break;case"black":i="900";break;case"medium":i="500";break;case"regular":case"normal":i="400";break;case"light":case"thin":i="200"}return{style:r,weight:e.fWeight||i}}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,t.c,0,null,this),this.o=PropertyFactory.getProp(e,t.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,t.tr,this),this.so=PropertyFactory.getProp(e,t.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,t.tr.eo,0,.01,this),this.data=t,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,t,i,r,n,a){var o=a?-1:1,s=r.s.v[0]+(1-r.s.v[0])*(1-n),l=r.s.v[1]+(1-r.s.v[1])*(1-n);e.translate(r.p.v[0]*o*n,r.p.v[1]*o*n,r.p.v[2]),t.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),t.rotate(-r.r.v*o*n),t.translate(r.a.v[0],r.a.v[1],r.a.v[2]),i.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),i.scale(a?1/s:s,a?1/l:l),i.translate(r.a.v[0],r.a.v[1],r.a.v[2])},RepeaterModifier.prototype.init=function(e,t,i,r){for(this.elem=e,this.arr=t,this.pos=i,this.elemsData=r,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t[i]);i>0;)i-=1,this._elements.unshift(t[i]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t]._processed=!1,"gr"===e[t].ty&&this.resetElements(e[t].it)},RepeaterModifier.prototype.cloneElements=function(e){var t=JSON.parse(JSON.stringify(e));return this.resetElements(t),t},RepeaterModifier.prototype.changeGroupRender=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]._render=t,"gr"===e[i].ty&&this.changeGroupRender(e[i].it,t)},RepeaterModifier.prototype.processShapes=function(e){var t,i,r,n,a,o=!1;if(this._mdf||e){var s,l=Math.ceil(this.c.v);if(this._groups.length<l){for(;this._groups.length<l;){var c={it:this.cloneElements(this._elements),ty:"gr"};c.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,c),this._groups.splice(0,0,c),this._currentCopies+=1}this.elem.reloadShapes(),o=!0}for(a=0,r=0;r<=this._groups.length-1;r+=1){if(s=a<l,this._groups[r]._render=s,this.changeGroupRender(this._groups[r].it,s),!s){var h=this.elemsData[r].it,u=h[h.length-1];0!==u.transform.op.v?(u.transform.op._mdf=!0,u.transform.op.v=0):u.transform.op._mdf=!1}a+=1}this._currentCopies=l;var d=this.o.v,p=d%1,f=d>0?Math.floor(d):Math.ceil(d),m=this.pMatrix.props,g=this.rMatrix.props,_=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var y,x,v=0;if(d>0){for(;v<f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),v+=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,p,!1),v+=p)}else if(d<0){for(;v>f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),v-=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-p,!0),v-=p)}for(r=1===this.data.m?0:this._currentCopies-1,n=1===this.data.m?1:-1,a=this._currentCopies;a;){if(x=(i=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props).length,t[t.length-1].transform.mProps._mdf=!0,t[t.length-1].transform.op._mdf=!0,t[t.length-1].transform.op.v=1===this._currentCopies?this.so.v:this.so.v+(this.eo.v-this.so.v)*(r/(this._currentCopies-1)),0!==v){for((0!==r&&1===n||r!==this._currentCopies-1&&-1===n)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),y=0;y<x;y+=1)i[y]=this.matrix.props[y];this.matrix.reset()}else for(this.matrix.reset(),y=0;y<x;y+=1)i[y]=this.matrix.props[y];v+=1,a-=1,r+=n}}else for(a=this._currentCopies,r=0,n=1;a;)i=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props,t[t.length-1].transform.mProps._mdf=!1,t[t.length-1].transform.op._mdf=!1,a-=1,r+=n;return o},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,t.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,t){var i,r=shapePool.newElement();r.c=e.c;var n,a,o,s,l,c,h,u,d,p,f,m,g=e._length,_=0;for(i=0;i<g;i+=1)n=e.v[i],o=e.o[i],a=e.i[i],n[0]===o[0]&&n[1]===o[1]&&n[0]===a[0]&&n[1]===a[1]?0!==i&&i!==g-1||e.c?(s=0===i?e.v[g-1]:e.v[i-1],c=(l=Math.sqrt(Math.pow(n[0]-s[0],2)+Math.pow(n[1]-s[1],2)))?Math.min(l/2,t)/l:0,h=f=n[0]+(s[0]-n[0])*c,u=m=n[1]-(n[1]-s[1])*c,d=h-(h-n[0])*roundCorner,p=u-(u-n[1])*roundCorner,r.setTripleAt(h,u,d,p,f,m,_),_+=1,s=i===g-1?e.v[0]:e.v[i+1],c=(l=Math.sqrt(Math.pow(n[0]-s[0],2)+Math.pow(n[1]-s[1],2)))?Math.min(l/2,t)/l:0,h=d=n[0]+(s[0]-n[0])*c,u=p=n[1]+(s[1]-n[1])*c,f=h-(h-n[0])*roundCorner,m=u-(u-n[1])*roundCorner,r.setTripleAt(h,u,d,p,f,m,_),_+=1):(r.setTripleAt(n[0],n[1],o[0],o[1],a[0],a[1],_),_+=1):(r.setTripleAt(e.v[i][0],e.v[i][1],e.o[i][0],e.o[i][1],e.i[i][0],e.i[i][1],_),_+=1);return r},RoundCornersModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.rd.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var t=this.derivative(e);return Math.atan2(t[1],t[0])},PolynomialBezier.prototype.normalAngle=function(e){var t=this.derivative(e);return Math.atan2(t[0],t[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var t=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,i=t*t-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(i<0)return[];var r=Math.sqrt(i);return floatZero(r)?r>0&&r<1?[t]:[]:[t-r,t+r].filter((function(e){return e>0&&e<1}))},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var t=lerpPoint(this.points[0],this.points[1],e),i=lerpPoint(this.points[1],this.points[2],e),r=lerpPoint(this.points[2],this.points[3],e),n=lerpPoint(t,i,e),a=lerpPoint(i,r,e),o=lerpPoint(n,a,e);return[new PolynomialBezier(this.points[0],t,n,o,!0),new PolynomialBezier(o,a,r,this.points[3],!0)]},PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}},PolynomialBezier.prototype.intersections=function(e,t,i){void 0===t&&(t=2),void 0===i&&(i=7);var r=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,t,r,i),r},PolynomialBezier.shapeSegment=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[t],e.o[t],e.i[i],e.v[i],!0)},PolynomialBezier.shapeSegmentInverted=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[i],e.i[i],e.o[t],e.v[t],!0)},extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,t.s,0,null,this),this.frequency=PropertyFactory.getProp(e,t.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,t.pt,0,null,this),this._isAnimated=0!==this.amplitude.effectsSequence.length||0!==this.frequency.effectsSequence.length||0!==this.pointsType.effectsSequence.length},ZigZagModifier.prototype.processPath=function(e,t,i,r){var n=e._length,a=shapePool.newElement();if(a.c=e.c,e.c||(n-=1),0===n)return a;var o=-1,s=PolynomialBezier.shapeSegment(e,0);zigZagCorner(a,e,0,t,i,r,o);for(var l=0;l<n;l+=1)o=zigZagSegment(a,s,t,i,r,-o),s=l!==n-1||e.c?PolynomialBezier.shapeSegment(e,(l+1)%n):null,zigZagCorner(a,e,l+1,t,i,r,o);return a},ZigZagModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),h=this.pointsType.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l,c,h));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,t.ml,0,null,this),this.lineJoin=t.lj,this._isAnimated=0!==this.amount.effectsSequence.length},OffsetPathModifier.prototype.processPath=function(e,t,i,r){var n=shapePool.newElement();n.c=e.c;var a,o,s,l=e.length();e.c||(l-=1);var c=[];for(a=0;a<l;a+=1)s=PolynomialBezier.shapeSegment(e,a),c.push(offsetSegmentSplit(s,t));if(!e.c)for(a=l-1;a>=0;a-=1)s=PolynomialBezier.shapeSegmentInverted(e,a),c.push(offsetSegmentSplit(s,t));c=pruneIntersections(c);var h=null,u=null;for(a=0;a<c.length;a+=1){var d=c[a];for(u&&(h=joinLines(n,u,d[0],i,r)),u=d[d.length-1],o=0;o<d.length;o+=1)s=d[o],h&&pointEqual(s.points[0],h)?n.setXYAt(s.points[1][0],s.points[1][1],"o",n.length()-1):n.setTripleAt(s.points[0][0],s.points[0][1],s.points[1][0],s.points[1][1],s.points[0][0],s.points[0][1],n.length()),n.setTripleAt(s.points[3][0],s.points[3][1],s.points[3][0],s.points[3][1],s.points[2][0],s.points[2][1],n.length()),h=s.points[3]}return c.length&&joinLines(n,u,c[0][0],i,r),n},OffsetPathModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amount.v,c=this.miterLimit.v,h=this.lineJoin;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l,h,c));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var FontManager=function(){var e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var i=127988,r=127462,n=127487,a=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function o(e,t){var i=createTag("span");i.setAttribute("aria-hidden",!0),i.style.fontFamily=t;var r=createTag("span");r.innerText="giItT1WQy@!-/#",i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize="300px",i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",i.appendChild(r),document.body.appendChild(i);var n=r.offsetWidth;return r.style.fontFamily=function(e){var t,i=e.split(","),r=i.length,n=[];for(t=0;t<r;t+=1)"sans-serif"!==i[t]&&"monospace"!==i[t]&&n.push(i[t]);return n.join(",")}(e)+", "+t,{node:r,w:n,parent:i}}function s(e,t){var i,r=document.body&&t?"svg":"canvas",n=getFontProperties(e);if("svg"===r){var a=createNS("text");a.style.fontSize="100px",a.setAttribute("font-family",e.fFamily),a.setAttribute("font-style",n.style),a.setAttribute("font-weight",n.weight),a.textContent="1",e.fClass?(a.style.fontFamily="inherit",a.setAttribute("class",e.fClass)):a.style.fontFamily=e.fFamily,t.appendChild(a),i=a}else{var o=new OffscreenCanvas(500,500).getContext("2d");o.font=n.style+" "+n.weight+" 100px "+e.fFamily,i=o}return{measureText:function(e){return"svg"===r?(i.textContent=e,i.getComputedTextLength()):i.measureText(e).width}}}function l(e){var t=0,i=e.charCodeAt(0);if(i>=55296&&i<=56319){var r=e.charCodeAt(1);r>=56320&&r<=57343&&(t=1024*(i-55296)+r-56320+65536)}return t}function c(e){var t=l(e);return t>=r&&t<=n}var h=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};h.isModifier=function(e,t){var i=e.toString(16)+t.toString(16);return-1!==a.indexOf(i)},h.isZeroWidthJoiner=function(e){return 8205===e},h.isFlagEmoji=function(e){return c(e.substr(0,2))&&c(e.substr(2,2))},h.isRegionalCode=c,h.isCombinedCharacter=function(e){return-1!==t.indexOf(e)},h.isRegionalFlag=function(e,t){var r=l(e.substr(t,2));if(r!==i)return!1;var n=0;for(t+=2;n<5;){if((r=l(e.substr(t,2)))<917601||r>917626)return!1;n+=1,t+=2}return 917631===l(e.substr(t,2))},h.isVariationSelector=function(e){return 65039===e},h.BLACK_FLAG_CODE_POINT=i;var u={addChars:function(e){if(e){var t;this.chars||(this.chars=[]);var i,r,n=e.length,a=this.chars.length;for(t=0;t<n;t+=1){for(i=0,r=!1;i<a;)this.chars[i].style===e[t].style&&this.chars[i].fFamily===e[t].fFamily&&this.chars[i].ch===e[t].ch&&(r=!0),i+=1;r||(this.chars.push(e[t]),a+=1)}}},addFonts:function(e,t){if(e){if(this.chars)return this.isLoaded=!0,void(this.fonts=e.list);if(!document.body)return this.isLoaded=!0,e.list.forEach((function(e){e.helper=s(e),e.cache={}})),void(this.fonts=e.list);var i,r=e.list,n=r.length,a=n;for(i=0;i<n;i+=1){var l,c,h=!0;if(r[i].loaded=!1,r[i].monoCase=o(r[i].fFamily,"monospace"),r[i].sansCase=o(r[i].fFamily,"sans-serif"),r[i].fPath){if("p"===r[i].fOrigin||3===r[i].origin){if((l=document.querySelectorAll('style[f-forigin="p"][f-family="'+r[i].fFamily+'"], style[f-origin="3"][f-family="'+r[i].fFamily+'"]')).length>0&&(h=!1),h){var u=createTag("style");u.setAttribute("f-forigin",r[i].fOrigin),u.setAttribute("f-origin",r[i].origin),u.setAttribute("f-family",r[i].fFamily),u.type="text/css",u.innerText="@font-face {font-family: "+r[i].fFamily+"; font-style: normal; src: url('"+r[i].fPath+"');}",t.appendChild(u)}}else if("g"===r[i].fOrigin||1===r[i].origin){for(l=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),c=0;c<l.length;c+=1)-1!==l[c].href.indexOf(r[i].fPath)&&(h=!1);if(h){var d=createTag("link");d.setAttribute("f-forigin",r[i].fOrigin),d.setAttribute("f-origin",r[i].origin),d.type="text/css",d.rel="stylesheet",d.href=r[i].fPath,document.body.appendChild(d)}}else if("t"===r[i].fOrigin||2===r[i].origin){for(l=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),c=0;c<l.length;c+=1)r[i].fPath===l[c].src&&(h=!1);if(h){var p=createTag("link");p.setAttribute("f-forigin",r[i].fOrigin),p.setAttribute("f-origin",r[i].origin),p.setAttribute("rel","stylesheet"),p.setAttribute("href",r[i].fPath),t.appendChild(p)}}}else r[i].loaded=!0,a-=1;r[i].helper=s(r[i],t),r[i].cache={},this.fonts.push(r[i])}0===a?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},getCharData:function(t,i,r){for(var n=0,a=this.chars.length;n<a;){if(this.chars[n].ch===t&&this.chars[n].style===i&&this.chars[n].fFamily===r)return this.chars[n];n+=1}return("string"===typeof t&&13!==t.charCodeAt(0)||!t)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",t,i,r)),e},getFontByName:function(e){for(var t=0,i=this.fonts.length;t<i;){if(this.fonts[t].fName===e)return this.fonts[t];t+=1}return this.fonts[0]},measureText:function(e,t,i){var r=this.getFontByName(t),n=e;if(!r.cache[n]){var a=r.helper;if(" "===e){var o=a.measureText("|"+e+"|"),s=a.measureText("||");r.cache[n]=(o-s)/100}else r.cache[n]=a.measureText(e)/100}return r.cache[n]*i},checkLoadedFonts:function(){var e,t,i,r=this.fonts.length,n=r;for(e=0;e<r;e+=1)this.fonts[e].loaded?n-=1:"n"===this.fonts[e].fOrigin||0===this.fonts[e].origin?this.fonts[e].loaded=!0:(t=this.fonts[e].monoCase.node,i=this.fonts[e].monoCase.w,t.offsetWidth!==i?(n-=1,this.fonts[e].loaded=!0):(t=this.fonts[e].sansCase.node,i=this.fonts[e].sansCase.w,t.offsetWidth!==i&&(n-=1,this.fonts[e].loaded=!0)),this.fonts[e].loaded&&(this.fonts[e].sansCase.parent.parentNode.removeChild(this.fonts[e].sansCase.parent),this.fonts[e].monoCase.parent.parentNode.removeChild(this.fonts[e].monoCase.parent)));0!==n&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)},setIsLoaded:function(){this.isLoaded=!0}};return h.prototype=u,h}();function SlotManager(e){this.animationData=e}function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){-1===this.renderableComponents.indexOf(e)&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){-1!==this.renderableComponents.indexOf(e)&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(t){return e[t]||""}}();function SliderEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function AngleEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function ColorEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function PointEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function LayerIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function MaskIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function CheckboxEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function NoValueEffect(){this.p={}}function EffectsManager(e,t){var i,r=e.ef||[];this.effectElements=[];var n,a=r.length;for(i=0;i<a;i+=1)n=new GroupEffect(r[i],t),this.effectElements.push(n)}function GroupEffect(e,t){this.init(e,t)}function BaseElement(){}function FrameElement(){}function FootageElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.footageData=t.imageLoader.getAsset(this.assetData),this.initBaseData(e,t,i)}function AudioElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.initBaseData(e,t,i),this._isPlaying=!1,this._canPlay=!1;var r=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(r),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,t){var i;this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(t);var r,n=this.data.ef.length,a=this.data.ef;for(i=0;i<n;i+=1){switch(r=null,a[i].ty){case 0:r=new SliderEffect(a[i],t,this);break;case 1:r=new AngleEffect(a[i],t,this);break;case 2:r=new ColorEffect(a[i],t,this);break;case 3:r=new PointEffect(a[i],t,this);break;case 4:case 7:r=new CheckboxEffect(a[i],t,this);break;case 10:r=new LayerIndexEffect(a[i],t,this);break;case 11:r=new MaskIndexEffect(a[i],t,this);break;case 5:r=new EffectsManager(a[i],t,this);break;default:r=new NoValueEffect(a[i],t,this)}r&&this.effectElements.push(r)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if("n"!==this.data.masksProperties[e].mode&&!1!==this.data.masksProperties[e].cl)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(e){var t=e("layer"),i=e("effects"),r=e("shape"),n=e("text"),a=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var o=i.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(o),0===this.data.ty||this.data.xt?this.compInterface=a(this):4===this.data.ty?(this.layerInterface.shapeInterface=r(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=n(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=e},initBaseData:function(e,t,i){this.globalData=t,this.comp=i,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var i,r=this.dynamicProperties.length;for(i=0;i<r;i+=1)(t||this._isParent&&"transform"===this.dynamicProperties[i].propType)&&(this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&this.dynamicProperties.push(e)}},FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var t=e("footage");this.layerInterface=t(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var t=this.tm.v;this._currentTime=t}this._volume=this.lv.v[0];var i=this._volume*this._volumeMultiplier;this._previousVolume!==i&&(this._previousVolume=i,this.audio.volume(i))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(e){var t,i,r=this.layers.length;for(this.completeLayers=!0,t=r-1;t>=0;t-=1)this.elements[t]||(i=this.layers[t]).ip-i.st<=e-this.layers[t].st&&i.op-i.st>e-this.layers[t].st&&this.buildItem(t),this.completeLayers=!!this.elements[t]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:default:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){var t;this.completeLayers=!1;var i,r=e.length,n=this.layers.length;for(t=0;t<r;t+=1)for(i=0;i<n;){if(this.layers[i].id===e[t].id){this.layers[i]=e[t];break}i+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,t,i){for(var r=this.elements,n=this.layers,a=0,o=n.length;a<o;)n[a].ind==t&&(r[a]&&!0!==r[a]?(i.push(r[a]),r[a].setAsParent(),void 0!==n[a].parent?this.buildElementParenting(e,n[a].parent,i):e.setHierarchy(i)):(this.buildItem(a),this.addPendingElement(e))),a+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var t,i=e.length;for(t=0;t<i;t+=1)if(e[t].xt){var r=this.createComp(e[t]);r.initExpressions(),this.globalData.projectInterface.registerComposition(r)}},BaseRenderer.prototype.getElementById=function(e){var t,i=this.elements.length;for(t=0;t<i;t+=1)if(this.elements[t].data.ind===e)return this.elements[t];return null},BaseRenderer.prototype.getElementByPath=function(e){var t,i=e.shift();if("number"===typeof i)t=this.elements[i];else{var r,n=this.elements.length;for(r=0;r<n;r+=1)if(this.elements[r].data.nm===i){t=this.elements[r];break}}return 0===e.length?t:t.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,t){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,t),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}function MaskElement(e,t,i){this.data=e,this.element=t,this.globalData=i,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var r,n,a=this.globalData.defs,o=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(o),this.solidPath="";var s,l,c,h,u,d,p=this.masksProperties,f=0,m=[],g=createElementID(),_="clipPath",y="clip-path";for(r=0;r<o;r+=1)if(("a"!==p[r].mode&&"n"!==p[r].mode||p[r].inv||100!==p[r].o.k||p[r].o.x)&&(_="mask",y="mask"),"s"!==p[r].mode&&"i"!==p[r].mode||0!==f?c=null:((c=createNS("rect")).setAttribute("fill","#ffffff"),c.setAttribute("width",this.element.comp.data.w||0),c.setAttribute("height",this.element.comp.data.h||0),m.push(c)),n=createNS("path"),"n"===p[r].mode)this.viewData[r]={op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),elem:n,lastPath:""},a.appendChild(n);else{var x;if(f+=1,n.setAttribute("fill","s"===p[r].mode?"#000000":"#ffffff"),n.setAttribute("clip-rule","nonzero"),0!==p[r].x.k?(_="mask",y="mask",d=PropertyFactory.getProp(this.element,p[r].x,0,null,this.element),x=createElementID(),(h=createNS("filter")).setAttribute("id",x),(u=createNS("feMorphology")).setAttribute("operator","erode"),u.setAttribute("in","SourceGraphic"),u.setAttribute("radius","0"),h.appendChild(u),a.appendChild(h),n.setAttribute("stroke","s"===p[r].mode?"#000000":"#ffffff")):(u=null,d=null),this.storedData[r]={elem:n,x:d,expan:u,lastPath:"",lastOperator:"",filterId:x,lastRadius:0},"i"===p[r].mode){l=m.length;var v=createNS("g");for(s=0;s<l;s+=1)v.appendChild(m[s]);var b=createNS("mask");b.setAttribute("mask-type","alpha"),b.setAttribute("id",g+"_"+f),b.appendChild(n),a.appendChild(b),v.setAttribute("mask","url("+getLocationHref()+"#"+g+"_"+f+")"),m.length=0,m.push(v)}else m.push(n);p[r].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[r]={elem:n,lastPath:"",op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),invRect:c},this.viewData[r].prop.k||this.drawPath(p[r],this.viewData[r].prop.v,this.viewData[r])}for(this.maskElement=createNS(_),o=m.length,r=0;r<o;r+=1)this.maskElement.appendChild(m[r]);f>0&&(this.maskElement.setAttribute("id",g),this.element.maskedElement.setAttribute(y,"url("+getLocationHref()+"#"+g+")"),a.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,i=0,r=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;i<r;){if(this.hierarchy[i].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}i+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),i=0;i<r;i+=1)t.multiply(this.hierarchy[i].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var i=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(i),e=1;e<t;e+=1){var r=this.localTransforms[e].matrix;i.multiply(r)}i.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var n=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)n*=.01*this.localTransforms[e].opacity;this.finalTransform.localOpacity=n}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,i=e.length;for(t=0;t<i;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var i,r=!0,n=this.comp;r;)n.finalTransform?(n.data.hasMask&&t.splice(0,0,n.finalTransform),n=n.comp):r=!1;var a,o=t.length;for(i=0;i<o;i+=1)a=t[i].mat.applyToPointArray(0,0,0),e=[e[0]-a[0],e[1]-a[1],0];return e},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var t,i=this.element.finalTransform.mat,r=this.masksProperties.length;for(t=0;t<r;t+=1)if((this.viewData[t].prop._mdf||e)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||e)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),"n"!==this.masksProperties[t].mode&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[t].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||e))){var n=this.storedData[t].expan;this.storedData[t].x.v<0?("erode"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),n.setAttribute("radius",-this.storedData[t].x.v)):("dilate"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",2*this.storedData[t].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(e,t,i){var r,n,a=" M"+t.v[0][0]+","+t.v[0][1];for(n=t._length,r=1;r<n;r+=1)a+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[r][0]+","+t.i[r][1]+" "+t.v[r][0]+","+t.v[r][1];if(t.c&&n>1&&(a+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[0][0]+","+t.i[0][1]+" "+t.v[0][0]+","+t.v[0][1]),i.lastPath!==a){var o="";i.elem&&(t.c&&(o=e.inv?this.solidPath+a:a),i.elem.setAttribute("d",o)),i.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={createFilter:function(e,t){var i=createNS("filter");return i.setAttribute("id",e),!0!==t&&(i.setAttribute("filterUnits","objectBoundingBox"),i.setAttribute("x","0%"),i.setAttribute("y","0%"),i.setAttribute("width","100%"),i.setAttribute("height","100%")),i},createAlphaToLuminanceFilter:function(){var e=createNS("feColorMatrix");return e.setAttribute("type","matrix"),e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),e}};return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:"undefined"!==typeof OffscreenCanvas};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var t,i,r="SourceGraphic",n=e.data.ef?e.data.ef.length:0,a=createElementID(),o=filtersFactory.createFilter(a,!0),s=0;for(this.filters=[],t=0;t<n;t+=1){i=null;var l=e.data.ef[t].ty;registeredEffects$1[l]&&(i=new(0,registeredEffects$1[l].effect)(o,e.effectsManager.effectElements[t],e,idPrefix+s,r),r=idPrefix+s,registeredEffects$1[l].countsAsEffect&&(s+=1)),i&&this.filters.push(i)}s&&(e.globalData.defs.appendChild(o),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+a+")")),this.filters.length&&e.addRenderableComponent(this)}function registerEffect$1(e,t,i){registeredEffects$1[e]={effect:t,countsAsEffect:i}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=t.slotManager.getProp(this.assetData)),this.initElement(e,t,i),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(e,t){this.elem=e,this.pos=t}function IShapeElement(){}SVGEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var i=createNS("clipPath"),r=createNS("path");r.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var n=createElementID();if(i.setAttribute("id",n),i.appendChild(r),this.globalData.defs.appendChild(i),this.checkMasks()){var a=createNS("g");a.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),a.appendChild(this.layerElement),this.transformedElement=a,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t,i,r,n,a=this.layerId+"_"+e;if(1===e||3===e){var o=createNS("mask");o.setAttribute("id",a),o.setAttribute("mask-type",3===e?"luminance":"alpha"),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),o.appendChild(r),this.globalData.defs.appendChild(o),featureSupport.maskType||1!==e||(o.setAttribute("mask-type","luminance"),t=createElementID(),i=filtersFactory.createFilter(t),this.globalData.defs.appendChild(i),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(n=createNS("g")).appendChild(r),o.appendChild(n),n.setAttribute("filter","url("+getLocationHref()+"#"+t+")"))}else if(2===e){var s=createNS("mask");s.setAttribute("id",a),s.setAttribute("mask-type","alpha");var l=createNS("g");s.appendChild(l),t=createElementID(),i=filtersFactory.createFilter(t);var c=createNS("feComponentTransfer");c.setAttribute("in","SourceGraphic"),i.appendChild(c);var h=createNS("feFuncA");h.setAttribute("type","table"),h.setAttribute("tableValues","1.0 0.0"),c.appendChild(h),this.globalData.defs.appendChild(i);var u=createNS("rect");u.setAttribute("width",this.comp.data.w),u.setAttribute("height",this.comp.data.h),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("fill","#ffffff"),u.setAttribute("opacity","0"),l.setAttribute("filter","url("+getLocationHref()+"#"+t+")"),l.appendChild(u),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),l.appendChild(r),featureSupport.maskType||(s.setAttribute("mask-type","luminance"),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),n=createNS("g"),l.appendChild(u),n.appendChild(this.layerElement),l.appendChild(n)),this.globalData.defs.appendChild(s)}this.matteMasks[e]=a}return this.matteMasks[e]},setMatte:function(e){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initTransform(e,t,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(e){var t,i=this.shapeModifiers.length;for(t=0;t<i;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=this.shapeModifiers.length;0<t;)if(this.shapeModifiers[0].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();for(e=(t=this.shapeModifiers.length)-1;e>=0&&!this.shapeModifiers[e].processShapes(this._isFirstFrame);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,i=0,r=t.length;i<r;){if(t[i].elem===e)return t[i].pos;i+=1}return 0},addProcessedElement:function(e,t){for(var i=this.processedElements,r=i.length;r;)if(i[r-=1].elem===e)return void(i[r].pos=t);i.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,t,i){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=i,this.lvl=t,this._isAnimated=!!i.k;for(var r=0,n=e.length;r<n;){if(e[r].mProps.dynamicProperties.length){this._isAnimated=!0;break}r+=1}}function SVGStyleData(e,t){this.data=e,this.type=e.ty,this.d="",this.lvl=t,this._mdf=!1,this.closed=!0===e.hd,this.pElem=createNS("path"),this.msElem=null}function DashProperty(e,t,i,r){var n;this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(t.length),this.renderer=i,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",t.length?t.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(r);var a,o=t.length||0;for(n=0;n<o;n+=1)a=PropertyFactory.getProp(e,t[n].v,0,0,this),this.k=a.k||this.k,this.dataProps[n]={n:t[n].n,p:a};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i}function SVGNoStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=i}function GradientProperty(e,t,i){this.data=t,this.c=createTypedArray("uint8c",4*t.p);var r=t.k.k[0].s?t.k.k[0].s.length-4*t.p:t.k.k.length-4*t.p;this.o=createTypedArray("float32",r),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=r,this.initDynamicPropertyContainer(i),this.prop=PropertyFactory.getProp(e,t.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,t,i)}function SVGGradientStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.initGradientData(e,t,i),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,t,i){this.transform={mProps:e,op:t,container:i},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(e){if((this.elem.globalData.frameId!==this.frameId||e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var t=0,i=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),t=0;t<i;t+=1)"o"!==this.dataProps[t].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[t].p.v:this.dashArray[t]=this.dataProps[t].p.v:this.dashoffset[0]=this.dataProps[t].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(e,t){for(var i=0,r=this.o.length/2;i<r;){if(Math.abs(e[4*i]-e[4*t+2*i])>.01)return!1;i+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,t=this.data.k.k.length;e<t;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var t,i,r,n=4*this.data.p;for(t=0;t<n;t+=1)i=t%4===0?100:255,r=Math.round(this.prop.v[t]*i),this.c[t]!==r&&(this.c[t]=r,this._cmdf=!e);if(this.o.length)for(n=this.prop.v.length,t=4*this.data.p;t<n;t+=1)i=t%2===0?100:1,r=t%2===0?Math.round(100*this.prop.v[t]):this.prop.v[t],this.o[t-4*this.data.p]!==r&&(this.o[t-4*this.data.p]=r,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(e,t,i){this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.s=PropertyFactory.getProp(e,t.s,1,null,this),this.e=PropertyFactory.getProp(e,t.e,1,null,this),this.h=PropertyFactory.getProp(e,t.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,t.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,t.g,this),this.style=i,this.stops=[],this.setGradientData(i.pElem,t),this.setGradientOpacity(t,i),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,t){var i=createElementID(),r=createNS(1===t.t?"linearGradient":"radialGradient");r.setAttribute("id",i),r.setAttribute("spreadMethod","pad"),r.setAttribute("gradientUnits","userSpaceOnUse");var n,a,o,s=[];for(o=4*t.g.p,a=0;a<o;a+=4)n=createNS("stop"),r.appendChild(n),s.push(n);e.setAttribute("gf"===t.ty?"fill":"stroke","url("+getLocationHref()+"#"+i+")"),this.gf=r,this.cst=s},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,t){if(this.g._hasOpacity&&!this.g._collapsable){var i,r,n,a=createNS("mask"),o=createNS("path");a.appendChild(o);var s=createElementID(),l=createElementID();a.setAttribute("id",l);var c=createNS(1===e.t?"linearGradient":"radialGradient");c.setAttribute("id",s),c.setAttribute("spreadMethod","pad"),c.setAttribute("gradientUnits","userSpaceOnUse"),n=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var h=this.stops;for(r=4*e.g.p;r<n;r+=2)(i=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),c.appendChild(i),h.push(i);o.setAttribute("gf"===e.ty?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),"gs"===e.ty&&(o.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),o.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),1===e.lj&&o.setAttribute("stroke-miterlimit",e.ml)),this.of=c,this.ms=a,this.ost=h,this.maskId=l,t.msElem=o}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var buildShapeString=function(e,t,i,r){if(0===t)return"";var n,a=e.o,o=e.i,s=e.v,l=" M"+r.applyToPointStringified(s[0][0],s[0][1]);for(n=1;n<t;n+=1)l+=" C"+r.applyToPointStringified(a[n-1][0],a[n-1][1])+" "+r.applyToPointStringified(o[n][0],o[n][1])+" "+r.applyToPointStringified(s[n][0],s[n][1]);return i&&t&&(l+=" C"+r.applyToPointStringified(a[n-1][0],a[n-1][1])+" "+r.applyToPointStringified(o[0][0],o[0][1])+" "+r.applyToPointStringified(s[0][0],s[0][1]),l+="z"),l},SVGElementsRenderer=function(){var e=new Matrix,t=new Matrix;function i(e,t,i){(i||t.transform.op._mdf)&&t.transform.container.setAttribute("opacity",t.transform.op.v),(i||t.transform.mProps._mdf)&&t.transform.container.setAttribute("transform",t.transform.mProps.v.to2dCSS())}function r(){}function n(i,r,n){var a,o,s,l,c,h,u,d,p,f,m=r.styles.length,g=r.lvl;for(h=0;h<m;h+=1){if(l=r.sh._mdf||n,r.styles[h].lvl<g){for(d=t.reset(),p=g-r.styles[h].lvl,f=r.transformers.length-1;!l&&p>0;)l=r.transformers[f].mProps._mdf||l,p-=1,f-=1;if(l)for(p=g-r.styles[h].lvl,f=r.transformers.length-1;p>0;)d.multiply(r.transformers[f].mProps.v),p-=1,f-=1}else d=e;if(o=(u=r.sh.paths)._length,l){for(s="",a=0;a<o;a+=1)(c=u.shapes[a])&&c._length&&(s+=buildShapeString(c,c._length,c.c,d));r.caches[h]=s}else s=r.caches[h];r.styles[h].d+=!0===i.hd?"":s,r.styles[h]._mdf=l||r.styles[h]._mdf}}function a(e,t,i){var r=t.style;(t.c._mdf||i)&&r.pElem.setAttribute("fill","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i)&&r.pElem.setAttribute("fill-opacity",t.o.v)}function o(e,t,i){s(e,t,i),l(0,t,i)}function s(e,t,i){var r,n,a,o,s,l=t.gf,c=t.g._hasOpacity,h=t.s.v,u=t.e.v;if(t.o._mdf||i){var d="gf"===e.ty?"fill-opacity":"stroke-opacity";t.style.pElem.setAttribute(d,t.o.v)}if(t.s._mdf||i){var p=1===e.t?"x1":"cx",f="x1"===p?"y1":"cy";l.setAttribute(p,h[0]),l.setAttribute(f,h[1]),c&&!t.g._collapsable&&(t.of.setAttribute(p,h[0]),t.of.setAttribute(f,h[1]))}if(t.g._cmdf||i){r=t.cst;var m=t.g.c;for(a=r.length,n=0;n<a;n+=1)(o=r[n]).setAttribute("offset",m[4*n]+"%"),o.setAttribute("stop-color","rgb("+m[4*n+1]+","+m[4*n+2]+","+m[4*n+3]+")")}if(c&&(t.g._omdf||i)){var g=t.g.o;for(a=(r=t.g._collapsable?t.cst:t.ost).length,n=0;n<a;n+=1)o=r[n],t.g._collapsable||o.setAttribute("offset",g[2*n]+"%"),o.setAttribute("stop-opacity",g[2*n+1])}if(1===e.t)(t.e._mdf||i)&&(l.setAttribute("x2",u[0]),l.setAttribute("y2",u[1]),c&&!t.g._collapsable&&(t.of.setAttribute("x2",u[0]),t.of.setAttribute("y2",u[1])));else if((t.s._mdf||t.e._mdf||i)&&(s=Math.sqrt(Math.pow(h[0]-u[0],2)+Math.pow(h[1]-u[1],2)),l.setAttribute("r",s),c&&!t.g._collapsable&&t.of.setAttribute("r",s)),t.e._mdf||t.h._mdf||t.a._mdf||i){s||(s=Math.sqrt(Math.pow(h[0]-u[0],2)+Math.pow(h[1]-u[1],2)));var _=Math.atan2(u[1]-h[1],u[0]-h[0]),y=t.h.v;y>=1?y=.99:y<=-1&&(y=-.99);var x=s*y,v=Math.cos(_+t.a.v)*x+h[0],b=Math.sin(_+t.a.v)*x+h[1];l.setAttribute("fx",v),l.setAttribute("fy",b),c&&!t.g._collapsable&&(t.of.setAttribute("fx",v),t.of.setAttribute("fy",b))}}function l(e,t,i){var r=t.style,n=t.d;n&&(n._mdf||i)&&n.dashStr&&(r.pElem.setAttribute("stroke-dasharray",n.dashStr),r.pElem.setAttribute("stroke-dashoffset",n.dashoffset[0])),t.c&&(t.c._mdf||i)&&r.pElem.setAttribute("stroke","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i)&&r.pElem.setAttribute("stroke-opacity",t.o.v),(t.w._mdf||i)&&(r.pElem.setAttribute("stroke-width",t.w.v),r.msElem&&r.msElem.setAttribute("stroke-width",t.w.v))}return{createRenderFunction:function(e){switch(e.ty){case"fl":return a;case"gf":return s;case"gs":return o;case"st":return l;case"sh":case"el":case"rc":case"sr":return n;case"tr":return i;case"no":return r;default:return null}}}}();function SVGShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,t,i),this.prevViewData=[]}function LetterProps(e,t,i,r,n,a){this.o=e,this.sw=t,this.sc=i,this.fc=r,this.m=n,this.p=a,this._mdf={o:!0,sw:!!t,sc:!!i,fc:!!r,m:!0,p:!0}}function TextProperty(e,t){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,t.d&&t.d.sid&&(t.d=e.globalData.slotManager.getProp(t.d)),this.data=t,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,t,i,r,n=this.shapes.length,a=this.stylesList.length,o=[],s=!1;for(i=0;i<a;i+=1){for(r=this.stylesList[i],s=!1,o.length=0,e=0;e<n;e+=1)-1!==(t=this.shapes[e]).styles.indexOf(r)&&(o.push(t),s=t._isAnimated||s);o.length>1&&s&&this.setShapesAsAnimated(o)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,t){var i,r=new SVGStyleData(e,t),n=r.pElem;return"st"===e.ty?i=new SVGStrokeStyleData(this,e,r):"fl"===e.ty?i=new SVGFillStyleData(this,e,r):"gf"===e.ty||"gs"===e.ty?(i=new("gf"===e.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,e,r),this.globalData.defs.appendChild(i.gf),i.maskId&&(this.globalData.defs.appendChild(i.ms),this.globalData.defs.appendChild(i.of),n.setAttribute("mask","url("+getLocationHref()+"#"+i.maskId+")"))):"no"===e.ty&&(i=new SVGNoStyleData(this,e,r)),"st"!==e.ty&&"gs"!==e.ty||(n.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),n.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),n.setAttribute("fill-opacity","0"),1===e.lj&&n.setAttribute("stroke-miterlimit",e.ml)),2===e.r&&n.setAttribute("fill-rule","evenodd"),e.ln&&n.setAttribute("id",e.ln),e.cl&&n.setAttribute("class",e.cl),e.bm&&(n.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(r),this.addToAnimatedContents(e,i),i},SVGShapeElement.prototype.createGroupElement=function(e){var t=new ShapeGroupData;return e.ln&&t.gr.setAttribute("id",e.ln),e.cl&&t.gr.setAttribute("class",e.cl),e.bm&&(t.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),t},SVGShapeElement.prototype.createTransformElement=function(e,t){var i=TransformPropertyFactory.getTransformProperty(this,e,this),r=new SVGTransformData(i,i.o,t);return this.addToAnimatedContents(e,r),r},SVGShapeElement.prototype.createShapeElement=function(e,t,i){var r=4;"rc"===e.ty?r=5:"el"===e.ty?r=6:"sr"===e.ty&&(r=7);var n=new SVGShapeData(t,i,ShapePropertyFactory.getShapeProp(this,e,r,this));return this.shapes.push(n),this.addShapeToModifiers(n),this.addToAnimatedContents(e,n),n},SVGShapeElement.prototype.addToAnimatedContents=function(e,t){for(var i=0,r=this.animatedContents.length;i<r;){if(this.animatedContents[i].element===t)return;i+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:t,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var t,i=e.styles,r=this.stylesList.length;for(t=0;t<r;t+=1)this.stylesList[t].closed||i.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,t,i,r,n,a,o){var s,l,c,h,u,d,p=[].concat(a),f=e.length-1,m=[],g=[];for(s=f;s>=0;s-=1){if((d=this.searchProcessedElement(e[s]))?t[s]=i[d-1]:e[s]._render=o,"fl"===e[s].ty||"st"===e[s].ty||"gf"===e[s].ty||"gs"===e[s].ty||"no"===e[s].ty)d?t[s].style.closed=!1:t[s]=this.createStyleElement(e[s],n),e[s]._render&&t[s].style.pElem.parentNode!==r&&r.appendChild(t[s].style.pElem),m.push(t[s].style);else if("gr"===e[s].ty){if(d)for(c=t[s].it.length,l=0;l<c;l+=1)t[s].prevViewData[l]=t[s].it[l];else t[s]=this.createGroupElement(e[s]);this.searchShapes(e[s].it,t[s].it,t[s].prevViewData,t[s].gr,n+1,p,o),e[s]._render&&t[s].gr.parentNode!==r&&r.appendChild(t[s].gr)}else"tr"===e[s].ty?(d||(t[s]=this.createTransformElement(e[s],r)),h=t[s].transform,p.push(h)):"sh"===e[s].ty||"rc"===e[s].ty||"el"===e[s].ty||"sr"===e[s].ty?(d||(t[s]=this.createShapeElement(e[s],p,n)),this.setElementStyles(t[s])):"tm"===e[s].ty||"rd"===e[s].ty||"ms"===e[s].ty||"pb"===e[s].ty||"zz"===e[s].ty||"op"===e[s].ty?(d?(u=t[s]).closed=!1:((u=ShapeModifiers.getModifier(e[s].ty)).init(this,e[s]),t[s]=u,this.shapeModifiers.push(u)),g.push(u)):"rp"===e[s].ty&&(d?(u=t[s]).closed=!0:(u=ShapeModifiers.getModifier(e[s].ty),t[s]=u,u.init(this,e,s,t),this.shapeModifiers.push(u),o=!1),g.push(u));this.addProcessedElement(e[s],s+1)}for(f=m.length,s=0;s<f;s+=1)m[s].closed=!0;for(f=g.length,s=0;s<f;s+=1)g[s].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){var e;this.renderModifiers();var t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<t;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,t,i=this.animatedContents.length;for(e=0;e<i;e+=1)t=this.animatedContents[e],(this._isFirstFrame||t.element._isAnimated)&&!0!==t.data&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(e,t,i,r,n,a){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var o=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,o=!0),this.sw!==t&&(this.sw=t,this._mdf.sw=!0,o=!0),this.sc!==i&&(this.sc=i,this._mdf.sc=!0,o=!0),this.fc!==r&&(this.fc=r,this._mdf.fc=!0,o=!0),this.m!==n&&(this.m=n,this._mdf.m=!0,o=!0),!a.length||this.p[0]===a[0]&&this.p[1]===a[1]&&this.p[4]===a[4]&&this.p[5]===a[5]&&this.p[12]===a[12]&&this.p[13]===a[13]||(this.p=a,this._mdf.p=!0,o=!0),o},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||e){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var t=this.currentData,i=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var r;this.lock=!0,this._mdf=!1;var n=this.effectsSequence.length,a=e||this.data.d.k[this.keysIndex].s;for(r=0;r<n;r+=1)a=i!==this.keysIndex?this.effectsSequence[r](a,a.t):this.effectsSequence[r](this.currentData,a.t);t!==a&&this.setCurrentData(a),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,t=this.elem.comp.renderedFrame,i=0,r=e.length;i<=r-1&&!(i===r-1||e[i+1].t>t);)i+=1;return this.keysIndex!==i&&(this.keysIndex=i),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var t,i,r=[],n=0,a=e.length,o=!1,s=!1,l="";n<a;)o=s,s=!1,t=e.charCodeAt(n),l=e.charAt(n),FontManager.isCombinedCharacter(t)?o=!0:t>=55296&&t<=56319?FontManager.isRegionalFlag(e,n)?l=e.substr(n,14):(i=e.charCodeAt(n+1))>=56320&&i<=57343&&(FontManager.isModifier(t,i)?(l=e.substr(n,2),o=!0):l=FontManager.isFlagEmoji(e.substr(n,4))?e.substr(n,4):e.substr(n,2)):t>56319?(i=e.charCodeAt(n+1),FontManager.isVariationSelector(t)&&(o=!0)):FontManager.isZeroWidthJoiner(t)&&(o=!0,s=!0),o?(r[r.length-1]+=l,o=!1):r.push(l),n+=l.length;return r},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var t,i,r,n,a,o,s,l=this.elem.globalData.fontManager,c=this.data,h=[],u=0,d=c.m.g,p=0,f=0,m=0,g=[],_=0,y=0,x=l.getFontByName(e.f),v=0,b=getFontProperties(x);e.fWeight=b.weight,e.fStyle=b.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),i=e.finalText.length,e.finalLineHeight=e.lh;var w,S=e.tr/1e3*e.finalSize;if(e.sz)for(var E,T,C=!0,k=e.sz[0],M=e.sz[1];C;){E=0,_=0,i=(T=this.buildFinalText(e.t)).length,S=e.tr/1e3*e.finalSize;var A=-1;for(t=0;t<i;t+=1)w=T[t].charCodeAt(0),r=!1," "===T[t]?A=t:13!==w&&3!==w||(_=0,r=!0,E+=e.finalLineHeight||1.2*e.finalSize),l.chars?(s=l.getCharData(T[t],x.fStyle,x.fFamily),v=r?0:s.w*e.finalSize/100):v=l.measureText(T[t],e.f,e.finalSize),_+v>k&&" "!==T[t]?(-1===A?i+=1:t=A,E+=e.finalLineHeight||1.2*e.finalSize,T.splice(t,A===t?1:0,"\r"),A=-1,_=0):(_+=v,_+=S);E+=x.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&M<E?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=T,i=e.finalText.length,C=!1)}_=-S,v=0;var P,I=0;for(t=0;t<i;t+=1)if(r=!1,13===(w=(P=e.finalText[t]).charCodeAt(0))||3===w?(I=0,g.push(_),y=_>y?_:y,_=-2*S,n="",r=!0,m+=1):n=P,l.chars?(s=l.getCharData(P,x.fStyle,l.getFontByName(e.f).fFamily),v=r?0:s.w*e.finalSize/100):v=l.measureText(n,e.f,e.finalSize)," "===P?I+=v+S:(_+=v+S+I,I=0),h.push({l:v,an:v,add:p,n:r,anIndexes:[],val:n,line:m,animatorJustifyOffset:0}),2==d){if(p+=v,""===n||" "===n||t===i-1){for(""!==n&&" "!==n||(p-=v);f<=t;)h[f].an=p,h[f].ind=u,h[f].extra=v,f+=1;u+=1,p=0}}else if(3==d){if(p+=v,""===n||t===i-1){for(""===n&&(p-=v);f<=t;)h[f].an=p,h[f].ind=u,h[f].extra=v,f+=1;p=0,u+=1}}else h[u].ind=u,h[u].extra=0,u+=1;if(e.l=h,y=_>y?_:y,g.push(_),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=y,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=g;var D,R,z,L,F=c.a;o=F.length;var B=[];for(a=0;a<o;a+=1){for((D=F[a]).a.sc&&(e.strokeColorAnim=!0),D.a.sw&&(e.strokeWidthAnim=!0),(D.a.fc||D.a.fh||D.a.fs||D.a.fb)&&(e.fillColorAnim=!0),L=0,z=D.s.b,t=0;t<i;t+=1)(R=h[t]).anIndexes[a]=L,(1==z&&""!==R.val||2==z&&""!==R.val&&" "!==R.val||3==z&&(R.n||" "==R.val||t==i-1)||4==z&&(R.n||t==i-1))&&(1===D.s.rn&&B.push(L),L+=1);c.a[a].s.totalChars=L;var O,N=-1;if(1===D.s.rn)for(t=0;t<i;t+=1)N!=(R=h[t]).anIndexes[a]&&(N=R.anIndexes[a],O=B.splice(Math.floor(Math.random()*B.length),1)[0]),R.anIndexes[a]=O}e.yOffset=e.finalLineHeight||1.2*e.finalSize,e.ls=e.ls||0,e.ascent=x.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,t){t=void 0===t?this.keysIndex:t;var i=this.copyData({},this.data.d.k[t].s);i=this.copyData(i,e),this.data.d.k[t].s=i,this.recalculate(t),this.setCurrentData(i),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var t=this.data.d.k[e].s;t.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(t)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,t=Math.min,i=Math.floor;function r(e,t){this._currentTextLength=-1,this.k=!1,this.data=t,this.elem=e,this.comp=e.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(e),this.s=PropertyFactory.getProp(e,t.s||{k:0},0,0,this),this.e="e"in t?PropertyFactory.getProp(e,t.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(e,t.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(e,t.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(e,t.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(e,t.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(e,t.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return r.prototype={getMult:function(r){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var n=0,a=0,o=1,s=1;this.ne.v>0?n=this.ne.v/100:a=-this.ne.v/100,this.xe.v>0?o=1-this.xe.v/100:s=1+this.xe.v/100;var l=BezierFactory.getBezierEasing(n,a,o,s).get,c=0,h=this.finalS,u=this.finalE,d=this.data.sh;if(2===d)c=l(c=u===h?r>=u?1:0:e(0,t(.5/(u-h)+(r-h)/(u-h),1)));else if(3===d)c=l(c=u===h?r>=u?0:1:1-e(0,t(.5/(u-h)+(r-h)/(u-h),1)));else if(4===d)u===h?c=0:(c=e(0,t(.5/(u-h)+(r-h)/(u-h),1)))<.5?c*=2:c=1-2*(c-.5),c=l(c);else if(5===d){if(u===h)c=0;else{var p=u-h,f=-p/2+(r=t(e(0,r+.5-h),u-h)),m=p/2;c=Math.sqrt(1-f*f/(m*m))}c=l(c)}else 6===d?(u===h?c=0:(r=t(e(0,r+.5-h),u-h),c=(1+Math.cos(Math.PI+2*Math.PI*r/(u-h)))/2),c=l(c)):(r>=i(h)&&(c=e(0,t(r-h<0?t(u,1)-(h-r):u-r,1))),c=l(c));if(100!==this.sm.v){var g=.01*this.sm.v;0===g&&(g=1e-8);var _=.5-.5*g;c<_?c=0:(c=(c-_)/g)>1&&(c=1)}return c*this.a.v},getValue:function(e){this.iterateDynamicProperties(),this._mdf=e||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,e&&2===this.data.r&&(this.e.v=this._currentTextLength);var t=2===this.data.r?1:100/this.data.totalChars,i=this.o.v/t,r=this.s.v/t+i,n=this.e.v/t+i;if(r>n){var a=r;r=n,n=a}this.finalS=r,this.finalE=n}},extendPrototype([DynamicPropertyContainer],r),{getTextSelectorProp:function(e,t,i){return new r(e,t,i)}}}();function TextAnimatorDataProperty(e,t,i){var r={propType:!1},n=PropertyFactory.getProp,a=t.a;this.a={r:a.r?n(e,a.r,0,degToRads,i):r,rx:a.rx?n(e,a.rx,0,degToRads,i):r,ry:a.ry?n(e,a.ry,0,degToRads,i):r,sk:a.sk?n(e,a.sk,0,degToRads,i):r,sa:a.sa?n(e,a.sa,0,degToRads,i):r,s:a.s?n(e,a.s,1,.01,i):r,a:a.a?n(e,a.a,1,0,i):r,o:a.o?n(e,a.o,0,.01,i):r,p:a.p?n(e,a.p,1,0,i):r,sw:a.sw?n(e,a.sw,0,0,i):r,sc:a.sc?n(e,a.sc,1,0,i):r,fc:a.fc?n(e,a.fc,1,0,i):r,fh:a.fh?n(e,a.fh,0,0,i):r,fs:a.fs?n(e,a.fs,0,.01,i):r,fb:a.fb?n(e,a.fb,0,.01,i):r,t:a.t?n(e,a.t,0,0,i):r},this.s=TextSelectorProp.getTextSelectorProp(e,t.s,i),this.s.t=t.s.t}function TextAnimatorProperty(e,t,i){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=t,this._elem=i,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(i)}function ITextElement(){}TextAnimatorProperty.prototype.searchProperties=function(){var e,t,i=this._textData.a.length,r=PropertyFactory.getProp;for(e=0;e<i;e+=1)t=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:r(this._elem,this._textData.p.a,0,0,this),f:r(this._elem,this._textData.p.f,0,0,this),l:r(this._elem,this._textData.p.l,0,0,this),r:r(this._elem,this._textData.p.r,0,0,this),p:r(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=r(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,t){if(this.lettersChangedFlag=t,this._mdf||this._isFirstFrame||t||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b=this._moreOptions.alignment.v,w=this._animatorsData,S=this._textData,E=this.mHelper,T=this._renderType,C=this.renderedLetters.length,k=e.l;if(this._hasMaskedPath){if(v=this._pathData.m,!this._pathData.n||this._pathData._mdf){var M,A=v.v;for(this._pathData.r.v&&(A=A.reverse()),o={tLength:0,segments:[]},a=A._length-1,_=0,n=0;n<a;n+=1)M=bez.buildBezierData(A.v[n],A.v[n+1],[A.o[n][0]-A.v[n][0],A.o[n][1]-A.v[n][1]],[A.i[n+1][0]-A.v[n+1][0],A.i[n+1][1]-A.v[n+1][1]]),o.tLength+=M.segmentLength,o.segments.push(M),_+=M.segmentLength;n=a,v.v.c&&(M=bez.buildBezierData(A.v[n],A.v[0],[A.o[n][0]-A.v[n][0],A.o[n][1]-A.v[n][1]],[A.i[0][0]-A.v[0][0],A.i[0][1]-A.v[0][1]]),o.tLength+=M.segmentLength,o.segments.push(M),_+=M.segmentLength),this._pathData.pi=o}if(o=this._pathData.pi,s=this._pathData.f.v,d=0,u=1,c=0,h=!0,m=o.segments,s<0&&v.v.c)for(o.tLength<Math.abs(s)&&(s=-Math.abs(s)%o.tLength),u=(f=m[d=m.length-1].points).length-1;s<0;)s+=f[u].partialLength,(u-=1)<0&&(u=(f=m[d-=1].points).length-1);p=(f=m[d].points)[u-1],g=(l=f[u]).partialLength}a=k.length,i=0,r=0;var P,I,D,R,z,L=1.2*e.finalSize*.714,F=!0;D=w.length;var B,O,N,V,j,U,G,$,q,H,W,Z,X=-1,Y=s,J=d,Q=u,K=-1,ee="",te=this.defaultPropsArray;if(2===e.j||1===e.j){var ie=0,re=0,ne=2===e.j?-.5:-1,ae=0,oe=!0;for(n=0;n<a;n+=1)if(k[n].n){for(ie&&(ie+=re);ae<n;)k[ae].animatorJustifyOffset=ie,ae+=1;ie=0,oe=!0}else{for(I=0;I<D;I+=1)(P=w[I].a).t.propType&&(oe&&2===e.j&&(re+=P.t.v*ne),(z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars)).length?ie+=P.t.v*z[0]*ne:ie+=P.t.v*z*ne);oe=!1}for(ie&&(ie+=re);ae<n;)k[ae].animatorJustifyOffset=ie,ae+=1}for(n=0;n<a;n+=1){if(E.reset(),V=1,k[n].n)i=0,r+=e.yOffset,r+=F?1:0,s=Y,F=!1,this._hasMaskedPath&&(u=Q,p=(f=m[d=J].points)[u-1],g=(l=f[u]).partialLength,c=0),ee="",W="",q="",Z="",te=this.defaultPropsArray;else{if(this._hasMaskedPath){if(K!==k[n].line){switch(e.j){case 1:s+=_-e.lineWidths[k[n].line];break;case 2:s+=(_-e.lineWidths[k[n].line])/2}K=k[n].line}X!==k[n].ind&&(k[X]&&(s+=k[X].extra),s+=k[n].an/2,X=k[n].ind),s+=b[0]*k[n].an*.005;var se=0;for(I=0;I<D;I+=1)(P=w[I].a).p.propType&&((z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars)).length?se+=P.p.v[0]*z[0]:se+=P.p.v[0]*z),P.a.propType&&((z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars)).length?se+=P.a.v[0]*z[0]:se+=P.a.v[0]*z);for(h=!0,this._pathData.a.v&&(s=.5*k[0].an+(_-this._pathData.f.v-.5*k[0].an-.5*k[k.length-1].an)*X/(a-1),s+=this._pathData.f.v);h;)c+g>=s+se||!f?(y=(s+se-c)/l.partialLength,O=p.point[0]+(l.point[0]-p.point[0])*y,N=p.point[1]+(l.point[1]-p.point[1])*y,E.translate(-b[0]*k[n].an*.005,-b[1]*L*.01),h=!1):f&&(c+=l.partialLength,(u+=1)>=f.length&&(u=0,m[d+=1]?f=m[d].points:v.v.c?(u=0,f=m[d=0].points):(c-=l.partialLength,f=null)),f&&(p=l,g=(l=f[u]).partialLength));B=k[n].an/2-k[n].add,E.translate(-B,0,0)}else B=k[n].an/2-k[n].add,E.translate(-B,0,0),E.translate(-b[0]*k[n].an*.005,-b[1]*L*.01,0);for(I=0;I<D;I+=1)(P=w[I].a).t.propType&&(z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars),0===i&&0===e.j||(this._hasMaskedPath?z.length?s+=P.t.v*z[0]:s+=P.t.v*z:z.length?i+=P.t.v*z[0]:i+=P.t.v*z));for(e.strokeWidthAnim&&(U=e.sw||0),e.strokeColorAnim&&(j=e.sc?[e.sc[0],e.sc[1],e.sc[2]]:[0,0,0]),e.fillColorAnim&&e.fc&&(G=[e.fc[0],e.fc[1],e.fc[2]]),I=0;I<D;I+=1)(P=w[I].a).a.propType&&((z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars)).length?E.translate(-P.a.v[0]*z[0],-P.a.v[1]*z[1],P.a.v[2]*z[2]):E.translate(-P.a.v[0]*z,-P.a.v[1]*z,P.a.v[2]*z));for(I=0;I<D;I+=1)(P=w[I].a).s.propType&&((z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars)).length?E.scale(1+(P.s.v[0]-1)*z[0],1+(P.s.v[1]-1)*z[1],1):E.scale(1+(P.s.v[0]-1)*z,1+(P.s.v[1]-1)*z,1));for(I=0;I<D;I+=1){if(P=w[I].a,z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars),P.sk.propType&&(z.length?E.skewFromAxis(-P.sk.v*z[0],P.sa.v*z[1]):E.skewFromAxis(-P.sk.v*z,P.sa.v*z)),P.r.propType&&(z.length?E.rotateZ(-P.r.v*z[2]):E.rotateZ(-P.r.v*z)),P.ry.propType&&(z.length?E.rotateY(P.ry.v*z[1]):E.rotateY(P.ry.v*z)),P.rx.propType&&(z.length?E.rotateX(P.rx.v*z[0]):E.rotateX(P.rx.v*z)),P.o.propType&&(z.length?V+=(P.o.v*z[0]-V)*z[0]:V+=(P.o.v*z-V)*z),e.strokeWidthAnim&&P.sw.propType&&(z.length?U+=P.sw.v*z[0]:U+=P.sw.v*z),e.strokeColorAnim&&P.sc.propType)for($=0;$<3;$+=1)z.length?j[$]+=(P.sc.v[$]-j[$])*z[0]:j[$]+=(P.sc.v[$]-j[$])*z;if(e.fillColorAnim&&e.fc){if(P.fc.propType)for($=0;$<3;$+=1)z.length?G[$]+=(P.fc.v[$]-G[$])*z[0]:G[$]+=(P.fc.v[$]-G[$])*z;P.fh.propType&&(G=z.length?addHueToRGB(G,P.fh.v*z[0]):addHueToRGB(G,P.fh.v*z)),P.fs.propType&&(G=z.length?addSaturationToRGB(G,P.fs.v*z[0]):addSaturationToRGB(G,P.fs.v*z)),P.fb.propType&&(G=z.length?addBrightnessToRGB(G,P.fb.v*z[0]):addBrightnessToRGB(G,P.fb.v*z))}}for(I=0;I<D;I+=1)(P=w[I].a).p.propType&&(z=w[I].s.getMult(k[n].anIndexes[I],S.a[I].s.totalChars),this._hasMaskedPath?z.length?E.translate(0,P.p.v[1]*z[0],-P.p.v[2]*z[1]):E.translate(0,P.p.v[1]*z,-P.p.v[2]*z):z.length?E.translate(P.p.v[0]*z[0],P.p.v[1]*z[1],-P.p.v[2]*z[2]):E.translate(P.p.v[0]*z,P.p.v[1]*z,-P.p.v[2]*z));if(e.strokeWidthAnim&&(q=U<0?0:U),e.strokeColorAnim&&(H="rgb("+Math.round(255*j[0])+","+Math.round(255*j[1])+","+Math.round(255*j[2])+")"),e.fillColorAnim&&e.fc&&(W="rgb("+Math.round(255*G[0])+","+Math.round(255*G[1])+","+Math.round(255*G[2])+")"),this._hasMaskedPath){if(E.translate(0,-e.ls),E.translate(0,b[1]*L*.01+r,0),this._pathData.p.v){x=(l.point[1]-p.point[1])/(l.point[0]-p.point[0]);var le=180*Math.atan(x)/Math.PI;l.point[0]<p.point[0]&&(le+=180),E.rotate(-le*Math.PI/180)}E.translate(O,N,0),s-=b[0]*k[n].an*.005,k[n+1]&&X!==k[n+1].ind&&(s+=k[n].an/2,s+=.001*e.tr*e.finalSize)}else{switch(E.translate(i,r,0),e.ps&&E.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:E.translate(k[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[k[n].line]),0,0);break;case 2:E.translate(k[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[k[n].line])/2,0,0)}E.translate(0,-e.ls),E.translate(B,0,0),E.translate(b[0]*k[n].an*.005,b[1]*L*.01,0),i+=k[n].l+.001*e.tr*e.finalSize}"html"===T?ee=E.toCSS():"svg"===T?ee=E.to2dCSS():te=[E.props[0],E.props[1],E.props[2],E.props[3],E.props[4],E.props[5],E.props[6],E.props[7],E.props[8],E.props[9],E.props[10],E.props[11],E.props[12],E.props[13],E.props[14],E.props[15]],Z=V}C<=n?(R=new LetterProps(Z,q,H,W,ee,te),this.renderedLetters.push(R),C+=1,this.lettersChangedFlag=!0):(R=this.renderedLetters[n],this.lettersChangedFlag=R.update(Z,q,H,W,ee,te)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(e,t,i){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,t,i),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,t,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,t){var i,r,n=t.length,a="";for(i=0;i<n;i+=1)"sh"===t[i].ty&&(r=t[i].ks.k,a+=buildShapeString(r,r.i.length,!0,e));return a},ITextElement.prototype.updateDocumentData=function(e,t){this.textProperty.updateDocumentData(e,t)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,t,i,r,n){switch(e.ps&&t.translate(e.ps[0],e.ps[1]+e.ascent,0),t.translate(0,-e.ls,0),e.j){case 1:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i]),0,0);break;case 2:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i])/2,0,0)}t.translate(r,n,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,t,i){this.textSpans=[],this.renderType="svg",this.initElement(e,t,i)}function ISolidElement(e,t,i){this.initElement(e,t,i)}function NullElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initFrame(),this.initTransform(e,t,i),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(e,t,i){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function SVGRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var i="";if(t&&t.title){var r=createNS("title"),n=createElementID();r.setAttribute("id",n),r.textContent=t.title,this.svgElement.appendChild(r),i+=n}if(t&&t.description){var a=createNS("desc"),o=createElementID();a.setAttribute("id",o),a.textContent=t.description,this.svgElement.appendChild(a),i+=" "+o}i&&this.svgElement.setAttribute("aria-labelledby",i);var s=createNS("defs");this.svgElement.appendChild(s);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",progressiveLoad:t&&t.progressiveLoad||!1,hideOnTransparent:!(t&&!1===t.hideOnTransparent),viewBoxOnly:t&&t.viewBoxOnly||!1,viewBoxSize:t&&t.viewBoxSize||!1,className:t&&t.className||"",id:t&&t.id||"",focusable:t&&t.focusable,filterSize:{width:t&&t.filterSize&&t.filterSize.width||"100%",height:t&&t.filterSize&&t.filterSize.height||"100%",x:t&&t.filterSize&&t.filterSize.x||"0%",y:t&&t.filterSize&&t.filterSize.y||"0%"},width:t&&t.width,height:t&&t.height,runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:s,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var t=0,i=e.length,r=[],n="";t<i;)e[t]===String.fromCharCode(13)||e[t]===String.fromCharCode(3)?(r.push(n),n=""):n+=e[t],t+=1;return r.push(n),r},SVGTextLottieElement.prototype.buildShapeData=function(e,t){if(e.shapes&&e.shapes.length){var i=e.shapes[0];if(i.it){var r=i.it[i.it.length-1];r.s&&(r.s.k[0]=t,r.s.k[1]=t)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){var e,t;this.addDynamicProperty(this);var i=this.textProperty.currentData;this.renderedLetters=createSizedArray(i?i.l.length:0),i.fc?this.layerElement.setAttribute("fill",this.buildColor(i.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),i.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(i.sc)),this.layerElement.setAttribute("stroke-width",i.sw)),this.layerElement.setAttribute("font-size",i.finalSize);var r=this.globalData.fontManager.getFontByName(i.f);if(r.fClass)this.layerElement.setAttribute("class",r.fClass);else{this.layerElement.setAttribute("font-family",r.fFamily);var n=i.fWeight,a=i.fStyle;this.layerElement.setAttribute("font-style",a),this.layerElement.setAttribute("font-weight",n)}this.layerElement.setAttribute("aria-label",i.t);var o,s=i.l||[],l=!!this.globalData.fontManager.chars;t=s.length;var c=this.mHelper,h=this.data.singleShape,u=0,d=0,p=!0,f=.001*i.tr*i.finalSize;if(!h||l||i.sz){var m,g=this.textSpans.length;for(e=0;e<t;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!l||!h||0===e){if(o=g>e?this.textSpans[e].span:createNS(l?"g":"text"),g<=e){if(o.setAttribute("stroke-linecap","butt"),o.setAttribute("stroke-linejoin","round"),o.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=o,l){var _=createNS("g");o.appendChild(_),this.textSpans[e].childSpan=_}this.textSpans[e].span=o,this.layerElement.appendChild(o)}o.style.display="inherit"}if(c.reset(),h&&(s[e].n&&(u=-f,d+=i.yOffset,d+=p?1:0,p=!1),this.applyTextPropertiesToMatrix(i,c,s[e].line,u,d),u+=s[e].l||0,u+=f),l){var y;if(1===(m=this.globalData.fontManager.getCharData(i.finalText[e],r.fStyle,this.globalData.fontManager.getFontByName(i.f).fFamily)).t)y=new SVGCompElement(m.data,this.globalData,this);else{var x=emptyShapeData;m.data&&m.data.shapes&&(x=this.buildShapeData(m.data,i.finalSize)),y=new SVGShapeElement(x,this.globalData,this)}if(this.textSpans[e].glyph){var v=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(v.layerElement),v.destroy()}this.textSpans[e].glyph=y,y._debug=!0,y.prepareFrame(0),y.renderFrame(),this.textSpans[e].childSpan.appendChild(y.layerElement),1===m.t&&this.textSpans[e].childSpan.setAttribute("transform","scale("+i.finalSize/100+","+i.finalSize/100+")")}else h&&o.setAttribute("transform","translate("+c.props[12]+","+c.props[13]+")"),o.textContent=s[e].val,o.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}h&&o&&o.setAttribute("d","")}else{var b=this.textContainer,w="start";switch(i.j){case 1:w="end";break;case 2:w="middle";break;default:w="start"}b.setAttribute("text-anchor",w),b.setAttribute("letter-spacing",f);var S=this.buildTextContents(i.finalText);for(t=S.length,d=i.ps?i.ps[1]+i.ascent:0,e=0;e<t;e+=1)(o=this.textSpans[e].span||createNS("tspan")).textContent=S[e],o.setAttribute("x",0),o.setAttribute("y",d),o.style.display="inherit",b.appendChild(o),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=o,d+=i.finalLineHeight;this.layerElement.appendChild(b)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,t,i=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)(t=this.textSpans[e].glyph)&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var e,t;this._sizeChanged=!0;var i,r,n,a=this.textAnimator.renderedLetters,o=this.textProperty.currentData.l;for(t=o.length,e=0;e<t;e+=1)o[e].n||(i=a[e],r=this.textSpans[e].span,(n=this.textSpans[e].glyph)&&n.renderFrame(),i._mdf.m&&r.setAttribute("transform",i.m),i._mdf.o&&r.setAttribute("opacity",i.o),i._mdf.sw&&r.setAttribute("stroke-width",i.sw),i._mdf.sc&&r.setAttribute("stroke",i.sc),i._mdf.fc&&r.setAttribute("fill",i.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)},NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var t=this.globalData.defs;this.setupGlobalData(e,t),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var i=createNS("clipPath"),r=createNS("rect");r.setAttribute("width",e.w),r.setAttribute("height",e.h),r.setAttribute("x",0),r.setAttribute("y",0);var n=createElementID();i.setAttribute("id",n),i.appendChild(r),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),t.appendChild(i),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var t=0,i=this.layers.length;for(t=0;t<i;t+=1)if(this.layers[t].ind===e)return t;return-1},SVGRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){t[e]=!0;var i=this.createItem(this.layers[e]);if(t[e]=i,getExpressionsPlugin()&&(0===this.layers[e].ty&&this.globalData.projectInterface.registerComposition(i),i.initExpressions()),this.appendElementInPos(i,e),this.layers[e].tt){var r="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(-1===r)return;if(this.elements[r]&&!0!==this.elements[r]){var n=t[r].getMatte(this.layers[e].tt);i.setMatte(n)}else this.buildItem(r),this.addPendingElement(i)}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var t=0,i=this.elements.length;t<i;){if(this.elements[t]===e){var r="tp"in e.data?this.findIndexByInd(e.data.tp):t-1,n=this.elements[r].getMatte(this.layers[t].tt);e.setMatte(n);break}t+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(this.renderedFrame!==e&&!this.destroyed){var t;null===e?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i=this.layers.length;for(this.completeLayers||this.checkLayers(e),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(e-this.layers[t].st);if(this.globalData._mdf)for(t=0;t<i;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){for(var r,n=0;n<t;)this.elements[n]&&!0!==this.elements[n]&&this.elements[n].getBaseElement()&&(r=this.elements[n].getBaseElement()),n+=1;r?this.layerElement.insertBefore(i,r):this.layerElement.appendChild(i)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initTransform(e,t,i),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&t.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var t=this.tm.v;t===this.data.op&&(t=this.data.op-1),this.renderedFrame=t}var i,r=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&(this.elements[i].prepareFrame(this.renderedFrame-this.layers[i].st),this.elements[i]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},ShapeTransformManager.prototype={addTransformSequence:function(e){var t,i=e.length,r="_";for(t=0;t<i;t+=1)r+=e[t].transform.key+"_";var n=this.sequences[r];return n||(n={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[r]=n,this.sequenceList.push(n)),n},processSequence:function(e,t){for(var i=0,r=e.transforms.length,n=t;i<r&&!t;){if(e.transforms[i].transform.mProps._mdf){n=!0;break}i+=1}if(n)for(e.finalTransform.reset(),i=r-1;i>=0;i-=1)e.finalTransform.multiply(e.transforms[i].transform.mProps.v);e._mdf=n},processSequences:function(e){var t,i=this.sequenceList.length;for(t=0;t<i;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,i=null,r=null;function n(){t||(r=function(){var t=createNS("svg"),i=createNS("filter"),r=createNS("feColorMatrix");return i.setAttribute("id",e),r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),i.appendChild(r),t.appendChild(i),t.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(t.style.display="none"),t}(),document.body.appendChild(r),t=createTag("canvas"),(i=t.getContext("2d")).filter="url(#"+e+")",i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1))}return{load:n,get:function(r){return t||n(),t.width=r.width,t.height=r.height,i.filter="url(#"+e+")",t}}};function createCanvas(e,t){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,t);var i=createTag("canvas");return i.width=e,i.height=t,i}var assetLoader={loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas:createCanvas},registeredEffects={};function CVEffects(e){var t,i,r=e.data.ef?e.data.ef.length:0;for(this.filters=[],t=0;t<r;t+=1){i=null;var n=e.data.ef[t].ty;registeredEffects[n]&&(i=new(0,registeredEffects[n].effect)(e.effectsManager.effectElements[t],e)),i&&this.filters.push(i)}this.filters.length&&e.addRenderableComponent(this)}function registerEffect(e,t){registeredEffects[e]={effect:t}}function CVMaskElement(e,t){var i;this.data=e,this.element=t,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var r=this.masksProperties.length,n=!1;for(i=0;i<r;i+=1)"n"!==this.masksProperties[i].mode&&(n=!0),this.viewData[i]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[i],3);this.hasMasks=n,n&&this.element.addRenderableComponent(this)}function CVBaseElement(){}CVEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e,t,i,r,n=this.element.finalTransform.mat,a=this.element.canvasContext,o=this.masksProperties.length;for(a.beginPath(),e=0;e<o;e+=1)if("n"!==this.masksProperties[e].mode){var s;this.masksProperties[e].inv&&(a.moveTo(0,0),a.lineTo(this.element.globalData.compSize.w,0),a.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),a.lineTo(0,this.element.globalData.compSize.h),a.lineTo(0,0)),r=this.viewData[e].v,t=n.applyToPointArray(r.v[0][0],r.v[0][1],0),a.moveTo(t[0],t[1]);var l=r._length;for(s=1;s<l;s+=1)i=n.applyToTriplePoints(r.o[s-1],r.i[s],r.v[s]),a.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);i=n.applyToTriplePoints(r.o[s-1],r.i[0],r.v[0]),a.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}this.element.globalData.renderer.save(!0),a.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};function CVShapeData(e,t,i,r){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var n,a=4;"rc"===t.ty?a=5:"el"===t.ty?a=6:"sr"===t.ty&&(a=7),this.sh=ShapePropertyFactory.getShapeProp(e,t,a,e);var o,s=i.length;for(n=0;n<s;n+=1)i[n].closed||(o={transforms:r.addTransformSequence(i[n].transforms),trNodes:[]},this.styledShapes.push(o),i[n].elements.push(o))}function CVShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,t,i)}function CVTextElement(e,t,i){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,t,i)}function CVImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.img=t.imageLoader.getAsset(this.assetData),this.initElement(e,t,i)}function CVSolidElement(e,t,i){this.initElement(e,t,i)}function CanvasRendererBase(){}function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){var e;for(this.stack=[],this.cArrPos=0,this.cTr=new Matrix,e=0;e<15;e+=1){var t=new CanvasContext;this.stack[e]=t}this._length=15,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}function CVCompElement(e,t,i){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function CanvasRenderer(e,t){this.animationItem=e,this.renderConfig={clearCanvas:!t||void 0===t.clearCanvas||t.clearCanvas,context:t&&t.context||null,progressiveLoad:t&&t.progressiveLoad||!1,preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",className:t&&t.className||"",id:t&&t.id||"",runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.renderConfig.dpr=t&&t.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=t&&t.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}function HBaseElement(){}function HSolidElement(e,t,i){this.initElement(e,t,i)}function HShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,t,i),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}function HTextElement(e,t,i){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,t,i)}function HCameraElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initHierarchy();var r=PropertyFactory.getProp;if(this.pe=r(this,e.pe,0,0,this),e.ks.p.s?(this.px=r(this,e.ks.p.x,1,0,this),this.py=r(this,e.ks.p.y,1,0,this),this.pz=r(this,e.ks.p.z,1,0,this)):this.p=r(this,e.ks.p,1,0,this),e.ks.a&&(this.a=r(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var n,a=e.ks.or.k.length;for(n=0;n<a;n+=1)e.ks.or.k[n].to=null,e.ks.or.k[n].ti=null}this.or=r(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=r(this,e.ks.rx,0,degToRads,this),this.ry=r(this,e.ks.ry,0,degToRads,this),this.rz=r(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}function HImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.initElement(e,t,i)}function HybridRendererBase(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}function HCompElement(e,t,i){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function HybridRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"},runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var i=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(i),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){this.hidden||this.isInRange&&!this.isTransparent||(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0].getContext("2d");this.clearCanvas(e),e.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");if(this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform),this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1).renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var i=assetLoader.getLumaCanvas(this.canvasContext.canvas);i.getContext("2d").drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(i,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!this.hidden&&!this.data.hd&&(1!==this.data.td||e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=0===this.data.ty;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,t){var i={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(t),transforms:[],elements:[],closed:!0===e.hd},r={};if("fl"===e.ty||"st"===e.ty?(r.c=PropertyFactory.getProp(this,e.c,1,255,this),r.c.k||(i.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")")):"gf"!==e.ty&&"gs"!==e.ty||(r.s=PropertyFactory.getProp(this,e.s,1,null,this),r.e=PropertyFactory.getProp(this,e.e,1,null,this),r.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),r.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),r.g=new GradientProperty(this,e.g,this)),r.o=PropertyFactory.getProp(this,e.o,0,.01,this),"st"===e.ty||"gs"===e.ty){if(i.lc=lineCapEnum[e.lc||2],i.lj=lineJoinEnum[e.lj||2],1==e.lj&&(i.ml=e.ml),r.w=PropertyFactory.getProp(this,e.w,0,null,this),r.w.k||(i.wi=r.w.v),e.d){var n=new DashProperty(this,e.d,"canvas",this);r.d=n,r.d.k||(i.da=r.d.dashArray,i.do=r.d.dashoffset[0])}}else i.r=2===e.r?"evenodd":"nonzero";return this.stylesList.push(i),r.style=i,r},CVShapeElement.prototype.createGroupElement=function(){return{it:[],prevViewData:[]}},CVShapeElement.prototype.createTransformElement=function(e){return{transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}}},CVShapeElement.prototype.createShapeElement=function(e){var t=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(t),this.addShapeToModifiers(t),t},CVShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var t,i=this.stylesList.length;for(t=0;t<i;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].closed=!0},CVShapeElement.prototype.searchShapes=function(e,t,i,r,n){var a,o,s,l,c,h,u=e.length-1,d=[],p=[],f=[].concat(n);for(a=u;a>=0;a-=1){if((l=this.searchProcessedElement(e[a]))?t[a]=i[l-1]:e[a]._shouldRender=r,"fl"===e[a].ty||"st"===e[a].ty||"gf"===e[a].ty||"gs"===e[a].ty)l?t[a].style.closed=!1:t[a]=this.createStyleElement(e[a],f),d.push(t[a].style);else if("gr"===e[a].ty){if(l)for(s=t[a].it.length,o=0;o<s;o+=1)t[a].prevViewData[o]=t[a].it[o];else t[a]=this.createGroupElement(e[a]);this.searchShapes(e[a].it,t[a].it,t[a].prevViewData,r,f)}else"tr"===e[a].ty?(l||(h=this.createTransformElement(e[a]),t[a]=h),f.push(t[a]),this.addTransformToStyleList(t[a])):"sh"===e[a].ty||"rc"===e[a].ty||"el"===e[a].ty||"sr"===e[a].ty?l||(t[a]=this.createShapeElement(e[a])):"tm"===e[a].ty||"rd"===e[a].ty||"pb"===e[a].ty||"zz"===e[a].ty||"op"===e[a].ty?(l?(c=t[a]).closed=!1:((c=ShapeModifiers.getModifier(e[a].ty)).init(this,e[a]),t[a]=c,this.shapeModifiers.push(c)),p.push(c)):"rp"===e[a].ty&&(l?(c=t[a]).closed=!0:(c=ShapeModifiers.getModifier(e[a].ty),t[a]=c,c.init(this,e,a,t),this.shapeModifiers.push(c),r=!1),p.push(c));this.addProcessedElement(e[a],a+1)}for(this.removeTransformFromStyleList(),this.closeStyles(d),u=p.length,a=0;a<u;a+=1)p[a].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,t){(e._opMdf||t.op._mdf||this._isFirstFrame)&&(t.opacity=e.opacity,t.opacity*=t.op.v,t._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,t,i,r,n,a,o,s,l,c=this.stylesList.length,h=this.globalData.renderer,u=this.globalData.canvasContext;for(e=0;e<c;e+=1)if(("st"!==(s=(l=this.stylesList[e]).type)&&"gs"!==s||0!==l.wi)&&l.data._shouldRender&&0!==l.coOp&&0!==this.globalData.currentGlobalAlpha){for(h.save(),a=l.elements,"st"===s||"gs"===s?(h.ctxStrokeStyle("st"===s?l.co:l.grd),h.ctxLineWidth(l.wi),h.ctxLineCap(l.lc),h.ctxLineJoin(l.lj),h.ctxMiterLimit(l.ml||0)):h.ctxFillStyle("fl"===s?l.co:l.grd),h.ctxOpacity(l.coOp),"st"!==s&&"gs"!==s&&u.beginPath(),h.ctxTransform(l.preTransforms.finalTransform.props),i=a.length,t=0;t<i;t+=1){for("st"!==s&&"gs"!==s||(u.beginPath(),l.da&&(u.setLineDash(l.da),u.lineDashOffset=l.do)),n=(o=a[t].trNodes).length,r=0;r<n;r+=1)"m"===o[r].t?u.moveTo(o[r].p[0],o[r].p[1]):"c"===o[r].t?u.bezierCurveTo(o[r].pts[0],o[r].pts[1],o[r].pts[2],o[r].pts[3],o[r].pts[4],o[r].pts[5]):u.closePath();"st"!==s&&"gs"!==s||(h.ctxStroke(),l.da&&u.setLineDash(this.dashResetter))}"st"!==s&&"gs"!==s&&this.globalData.renderer.ctxFill(l.r),h.restore()}},CVShapeElement.prototype.renderShape=function(e,t,i,r){var n,a;for(a=e,n=t.length-1;n>=0;n-=1)"tr"===t[n].ty?(a=i[n].transform,this.renderShapeTransform(e,a)):"sh"===t[n].ty||"el"===t[n].ty||"rc"===t[n].ty||"sr"===t[n].ty?this.renderPath(t[n],i[n]):"fl"===t[n].ty?this.renderFill(t[n],i[n],a):"st"===t[n].ty?this.renderStroke(t[n],i[n],a):"gf"===t[n].ty||"gs"===t[n].ty?this.renderGradientFill(t[n],i[n],a):"gr"===t[n].ty?this.renderShape(a,t[n].it,i[n].it):t[n].ty;r&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,t){if(this._isFirstFrame||t._mdf||e.transforms._mdf){var i,r,n,a=e.trNodes,o=t.paths,s=o._length;a.length=0;var l=e.transforms.finalTransform;for(n=0;n<s;n+=1){var c=o.shapes[n];if(c&&c.v){for(r=c._length,i=1;i<r;i+=1)1===i&&a.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),a.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[i],c.v[i])});1===r&&a.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),c.c&&r&&(a.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[0],c.v[0])}),a.push({t:"z"}))}}e.trNodes=a}},CVShapeElement.prototype.renderPath=function(e,t){if(!0!==e.hd&&e._shouldRender){var i,r=t.styledShapes.length;for(i=0;i<r;i+=1)this.renderStyledShape(t.styledShapes[i],t.sh)}},CVShapeElement.prototype.renderFill=function(e,t,i){var r=t.style;(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,t,i){var r,n=t.style;if(!n.grd||t.g._mdf||t.s._mdf||t.e._mdf||1!==e.t&&(t.h._mdf||t.a._mdf)){var a,o=this.globalData.canvasContext,s=t.s.v,l=t.e.v;if(1===e.t)r=o.createLinearGradient(s[0],s[1],l[0],l[1]);else{var c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2)),h=Math.atan2(l[1]-s[1],l[0]-s[0]),u=t.h.v;u>=1?u=.99:u<=-1&&(u=-.99);var d=c*u,p=Math.cos(h+t.a.v)*d+s[0],f=Math.sin(h+t.a.v)*d+s[1];r=o.createRadialGradient(p,f,0,s[0],s[1],c)}var m=e.g.p,g=t.g.c,_=1;for(a=0;a<m;a+=1)t.g._hasOpacity&&t.g._collapsable&&(_=t.g.o[2*a+1]),r.addColorStop(g[4*a]/100,"rgba("+g[4*a+1]+","+g[4*a+2]+","+g[4*a+3]+","+_+")");n.grd=r}n.coOp=t.o.v*i.opacity},CVShapeElement.prototype.renderStroke=function(e,t,i){var r=t.style,n=t.d;n&&(n._mdf||this._isFirstFrame)&&(r.da=n.dashArray,r.do=n.dashoffset[0]),(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity),(t.w._mdf||this._isFirstFrame)&&(r.wi=t.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=!1;e.fc?(t=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=t;var i=!1;e.sc&&(i=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var r,n,a,o,s,l,c,h,u,d,p,f,m=this.globalData.fontManager.getFontByName(e.f),g=e.l,_=this.mHelper;this.stroke=i,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,n=e.finalText.length;var y=this.data.singleShape,x=.001*e.tr*e.finalSize,v=0,b=0,w=!0,S=0;for(r=0;r<n;r+=1){o=(a=this.globalData.fontManager.getCharData(e.finalText[r],m.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily))&&a.data||{},_.reset(),y&&g[r].n&&(v=-x,b+=e.yOffset,b+=w?1:0,w=!1),u=(c=o.shapes?o.shapes[0].it:[]).length,_.scale(e.finalSize/100,e.finalSize/100),y&&this.applyTextPropertiesToMatrix(e,_,g[r].line,v,b),p=createSizedArray(u-1);var E=0;for(h=0;h<u;h+=1)if("sh"===c[h].ty){for(l=c[h].ks.k.i.length,d=c[h].ks.k,f=[],s=1;s<l;s+=1)1===s&&f.push(_.applyToX(d.v[0][0],d.v[0][1],0),_.applyToY(d.v[0][0],d.v[0][1],0)),f.push(_.applyToX(d.o[s-1][0],d.o[s-1][1],0),_.applyToY(d.o[s-1][0],d.o[s-1][1],0),_.applyToX(d.i[s][0],d.i[s][1],0),_.applyToY(d.i[s][0],d.i[s][1],0),_.applyToX(d.v[s][0],d.v[s][1],0),_.applyToY(d.v[s][0],d.v[s][1],0));f.push(_.applyToX(d.o[s-1][0],d.o[s-1][1],0),_.applyToY(d.o[s-1][0],d.o[s-1][1],0),_.applyToX(d.i[0][0],d.i[0][1],0),_.applyToY(d.i[0][0],d.i[0][1],0),_.applyToX(d.v[0][0],d.v[0][1],0),_.applyToY(d.v[0][0],d.v[0][1],0)),p[E]=f,E+=1}y&&(v+=g[r].l,v+=x),this.textSpans[S]?this.textSpans[S].elem=p:this.textSpans[S]={elem:p},S+=1}},CVTextElement.prototype.renderInnerContent=function(){var e,t,i,r,n,a;this.validateText(),this.canvasContext.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var o,s=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var c,h,u=null,d=null,p=null,f=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if((o=s[e])&&(f.save(),f.ctxTransform(o.p),f.ctxOpacity(o.o)),this.fill){for(o&&o.fc?u!==o.fc&&(f.ctxFillStyle(o.fc),u=o.fc):u!==this.values.fill&&(u=this.values.fill,f.ctxFillStyle(this.values.fill)),r=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<r;i+=1)for(a=(h=c[i]).length,this.globalData.canvasContext.moveTo(h[0],h[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(h[n],h[n+1],h[n+2],h[n+3],h[n+4],h[n+5]);this.globalData.canvasContext.closePath(),f.ctxFill()}if(this.stroke){for(o&&o.sw?p!==o.sw&&(p=o.sw,f.ctxLineWidth(o.sw)):p!==this.values.sWidth&&(p=this.values.sWidth,f.ctxLineWidth(this.values.sWidth)),o&&o.sc?d!==o.sc&&(d=o.sc,f.ctxStrokeStyle(o.sc)):d!==this.values.stroke&&(d=this.values.stroke,f.ctxStrokeStyle(this.values.stroke)),r=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<r;i+=1)for(a=(h=c[i]).length,this.globalData.canvasContext.moveTo(h[0],h[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(h[n],h[n+1],h[n+2],h[n+3],h[n+4],h[n+5]);this.globalData.canvasContext.closePath(),f.ctxStroke()}o&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var t,i,r=e.getContext("2d"),n=this.img.width,a=this.img.height,o=n/a,s=this.assetData.w/this.assetData.h,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;o>s&&"xMidYMid slice"===l||o<s&&"xMidYMid slice"!==l?t=(i=a)*s:i=(t=n)/s,r.drawImage(this.img,(n-t)/2,(a-i)/2,t,i,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){1===e[0]&&0===e[1]&&0===e[4]&&1===e[5]&&0===e[12]&&0===e[13]||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,t,i,r){this.canvasContext.fillRect(e,t,i,r)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){this.renderConfig.clearCanvas?this.contextData.reset():this.canvasContext.restore()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){this.renderConfig.clearCanvas?(e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)):this.canvasContext.restore()},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var t=this.animationItem.container.style;t.width="100%",t.height="100%";var i="0px 0px 0px";t.transformOrigin=i,t.mozTransformOrigin=i,t.webkitTransformOrigin=i,t["-webkit-transform"]=i,t.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,t){var i,r,n,a;if(this.reset(),e?(i=e,r=t,this.canvasContext.canvas.width=i,this.canvasContext.canvas.height=r):(this.animationItem.wrapper&&this.animationItem.container?(i=this.animationItem.wrapper.offsetWidth,r=this.animationItem.wrapper.offsetHeight):(i=this.canvasContext.canvas.width,r=this.canvasContext.canvas.height),this.canvasContext.canvas.width=i*this.renderConfig.dpr,this.canvasContext.canvas.height=r*this.renderConfig.dpr),-1!==this.renderConfig.preserveAspectRatio.indexOf("meet")||-1!==this.renderConfig.preserveAspectRatio.indexOf("slice")){var o=this.renderConfig.preserveAspectRatio.split(" "),s=o[1]||"meet",l=o[0]||"xMidYMid",c=l.substr(0,4),h=l.substr(4);n=i/r,(a=this.transformCanvas.w/this.transformCanvas.h)>n&&"meet"===s||a<n&&"slice"===s?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr)),this.transformCanvas.tx="xMid"===c&&(a<n&&"meet"===s||a>n&&"slice"===s)?(i-this.transformCanvas.w*(r/this.transformCanvas.h))/2*this.renderConfig.dpr:"xMax"===c&&(a<n&&"meet"===s||a>n&&"slice"===s)?(i-this.transformCanvas.w*(r/this.transformCanvas.h))*this.renderConfig.dpr:0,this.transformCanvas.ty="YMid"===h&&(a>n&&"meet"===s||a<n&&"slice"===s)?(r-this.transformCanvas.h*(i/this.transformCanvas.w))/2*this.renderConfig.dpr:"YMax"===h&&(a>n&&"meet"===s||a<n&&"slice"===s)?(r-this.transformCanvas.h*(i/this.transformCanvas.w))*this.renderConfig.dpr:0}else"none"===this.renderConfig.preserveAspectRatio?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){var e;for(this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),e=(this.layers?this.layers.length:0)-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,t){if((this.renderedFrame!==e||!0!==this.renderConfig.clearCanvas||t)&&!this.destroyed&&-1!==e){var i;this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||t,this.globalData.projectInterface.currentFrame=e;var r=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf){for(!0===this.renderConfig.clearCanvas?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame();!0!==this.renderConfig.clearCanvas&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){var i=this.createItem(this.layers[e],this,this.globalData);t[e]=i,i.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},CVContextData.prototype.duplicate=function(){var e=2*this._length,t=0;for(t=this._length;t<e;t+=1)this.stack[t]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var t,i=this.stack[this.cArrPos],r=i.transform,n=this.cTr.props;for(t=0;t<16;t+=1)n[t]=r[t];if(e){this.nativeContext.restore();var a=this.stack[this.cArrPos+1];this.appliedFillStyle=a.fillStyle,this.appliedStrokeStyle=a.strokeStyle,this.appliedLineWidth=a.lineWidth,this.appliedLineCap=a.lineCap,this.appliedLineJoin=a.lineJoin,this.appliedMiterLimit=a.miterLimit}this.nativeContext.setTransform(r[0],r[1],r[4],r[5],r[12],r[13]),(e||-1!==i.opacity&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var t=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var i,r=this.stack[this.cArrPos];for(i=0;i<16;i+=1)r.transform[i]=t[i];this.cArrPos+=1;var n=this.stack[this.cArrPos];n.opacity=r.opacity,n.fillStyle=r.fillStyle,n.strokeStyle=r.strokeStyle,n.lineWidth=r.lineWidth,n.lineCap=r.lineCap,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var t=this.cTr;this.transformMat.multiply(t),t.cloneFromProps(this.transformMat.props);var i=t.props;this.nativeContext.setTransform(i[0],i[1],i[4],i[5],i[12],i[13])},CVContextData.prototype.opacity=function(e){var t=this.stack[this.cArrPos].opacity;t*=e<0?0:e,this.stack[this.cArrPos].opacity!==t&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=t)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,t,i,r){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,t,i,r)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e,t=this.canvasContext;for(t.beginPath(),t.moveTo(0,0),t.lineTo(this.data.w,0),t.lineTo(this.data.w,this.data.h),t.lineTo(0,this.data.h),t.lineTo(0,0),t.clip(),e=this.layers.length-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var e;for(e=this.layers.length-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0!==this.data.bm&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting,extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?((e=createNS("rect")).setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):((e=createTag("div")).style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)},extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var t=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",t.w),e.setAttribute("height",t.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t=e[i].mProps.v.applyToPointArray(t[0],t[1],0);return t},HShapeElement.prototype.calculateShapeBoundingBox=function(e,t){var i,r,n,a,o,s=e.sh.v,l=e.transformers,c=s._length;if(!(c<=1)){for(i=0;i<c-1;i+=1)r=this.getTransformedPoint(l,s.v[i]),n=this.getTransformedPoint(l,s.o[i]),a=this.getTransformedPoint(l,s.i[i+1]),o=this.getTransformedPoint(l,s.v[i+1]),this.checkBounds(r,n,a,o,t);s.c&&(r=this.getTransformedPoint(l,s.v[i]),n=this.getTransformedPoint(l,s.o[i]),a=this.getTransformedPoint(l,s.i[0]),o=this.getTransformedPoint(l,s.v[0]),this.checkBounds(r,n,a,o,t))}},HShapeElement.prototype.checkBounds=function(e,t,i,r,n){this.getBoundsOfCurve(e,t,i,r);var a=this.shapeBoundingBox;n.x=bmMin(a.left,n.x),n.xMax=bmMax(a.right,n.xMax),n.y=bmMin(a.top,n.y),n.yMax=bmMax(a.bottom,n.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,t,i,r){for(var n,a,o,s,l,c,h,u=[[e[0],r[0]],[e[1],r[1]]],d=0;d<2;++d)a=6*e[d]-12*t[d]+6*i[d],n=-3*e[d]+9*t[d]-9*i[d]+3*r[d],o=3*t[d]-3*e[d],a|=0,o|=0,0===(n|=0)&&0===a||(0===n?(s=-o/a)>0&&s<1&&u[d].push(this.calculateF(s,e,t,i,r,d)):(l=a*a-4*o*n)>=0&&((c=(-a+bmSqrt(l))/(2*n))>0&&c<1&&u[d].push(this.calculateF(c,e,t,i,r,d)),(h=(-a-bmSqrt(l))/(2*n))>0&&h<1&&u[d].push(this.calculateF(h,e,t,i,r,d))));this.shapeBoundingBox.left=bmMin.apply(null,u[0]),this.shapeBoundingBox.top=bmMin.apply(null,u[1]),this.shapeBoundingBox.right=bmMax.apply(null,u[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,u[1])},HShapeElement.prototype.calculateF=function(e,t,i,r,n,a){return bmPow(1-e,3)*t[a]+3*bmPow(1-e,2)*e*i[a]+3*(1-e)*bmPow(e,2)*r[a]+bmPow(e,3)*n[a]},HShapeElement.prototype.calculateBoundingBox=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]&&e[i].sh?this.calculateShapeBoundingBox(e[i],t):e[i]&&e[i].it?this.calculateBoundingBox(e[i].it,t):e[i]&&e[i].style&&e[i].w&&this.expandStrokeBoundingBox(e[i].w,t)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,t){var i=0;if(e.keyframes){for(var r=0;r<e.keyframes.length;r+=1){var n=e.keyframes[r].s;n>i&&(i=n)}i*=e.mult}else i=e.v*e.mult;t.x-=i,t.xMax+=i,t.y-=i,t.yMax+=i},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,t=999999;if(e.x=t,e.xMax=-t,e.y=t,e.yMax=-t,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var i=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),i=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),i=!0),i||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var r=this.shapeCont.style,n="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";r.transform=n,r.webkitTransform=n}}},extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=this.innerElem.style,i=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";t.fill=i,t.color=i,e.sc&&(t.stroke=this.buildColor(e.sc),t.strokeWidth=e.sw+"px");var r,n,a=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(t.fontSize=e.finalSize+"px",t.lineHeight=e.finalSize+"px",a.fClass)this.innerElem.className=a.fClass;else{t.fontFamily=a.fFamily;var o=e.fWeight,s=e.fStyle;t.fontStyle=s,t.fontWeight=o}var l,c,h,u=e.l;n=u.length;var d,p=this.mHelper,f="",m=0;for(r=0;r<n;r+=1){if(this.globalData.fontManager.chars?(this.textPaths[m]?l=this.textPaths[m]:((l=createNS("path")).setAttribute("stroke-linecap",lineCapEnum[1]),l.setAttribute("stroke-linejoin",lineJoinEnum[2]),l.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[m]?h=(c=this.textSpans[m]).children[0]:((c=createTag("div")).style.lineHeight=0,(h=createNS("svg")).appendChild(l),styleDiv(c)))):this.isMasked?l=this.textPaths[m]?this.textPaths[m]:createNS("text"):this.textSpans[m]?(c=this.textSpans[m],l=this.textPaths[m]):(styleDiv(c=createTag("span")),styleDiv(l=createTag("span")),c.appendChild(l)),this.globalData.fontManager.chars){var g,_=this.globalData.fontManager.getCharData(e.finalText[r],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily);if(g=_?_.data:null,p.reset(),g&&g.shapes&&g.shapes.length&&(d=g.shapes[0].it,p.scale(e.finalSize/100,e.finalSize/100),f=this.createPathShape(p,d),l.setAttribute("d",f)),this.isMasked)this.innerElem.appendChild(l);else{if(this.innerElem.appendChild(c),g&&g.shapes){document.body.appendChild(h);var y=h.getBBox();h.setAttribute("width",y.width+2),h.setAttribute("height",y.height+2),h.setAttribute("viewBox",y.x-1+" "+(y.y-1)+" "+(y.width+2)+" "+(y.height+2));var x=h.style,v="translate("+(y.x-1)+"px,"+(y.y-1)+"px)";x.transform=v,x.webkitTransform=v,u[r].yOffset=y.y-1}else h.setAttribute("width",1),h.setAttribute("height",1);c.appendChild(h)}}else if(l.textContent=u[r].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(l);else{this.innerElem.appendChild(c);var b=l.style,w="translate3d(0,"+-e.finalSize/1.2+"px,0)";b.transform=w,b.webkitTransform=w}this.isMasked?this.textSpans[m]=l:this.textSpans[m]=c,this.textSpans[m].style.display="block",this.textPaths[m]=l,m+=1}for(;m<this.textSpans.length;)this.textSpans[m].style.display="none",m+=1},HTextElement.prototype.renderInnerContent=function(){var e;if(this.validateText(),this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var t="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=t,e.webkitTransform=t}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag){var i,r,n,a,o,s=0,l=this.textAnimator.renderedLetters,c=this.textProperty.currentData.l;for(r=c.length,i=0;i<r;i+=1)c[i].n?s+=1:(a=this.textSpans[i],o=this.textPaths[i],n=l[s],s+=1,n._mdf.m&&(this.isMasked?a.setAttribute("transform",n.m):(a.style.webkitTransform=n.m,a.style.transform=n.m)),a.style.opacity=n.o,n.sw&&n._mdf.sw&&o.setAttribute("stroke-width",n.sw),n.sc&&n._mdf.sc&&o.setAttribute("stroke",n.sc),n.fc&&n._mdf.fc&&(o.setAttribute("fill",n.fc),o.style.color=n.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var h=this.innerElem.getBBox();if(this.currentBBox.w!==h.width&&(this.currentBBox.w=h.width,this.svgElement.setAttribute("width",h.width)),this.currentBBox.h!==h.height&&(this.currentBBox.h=h.height,this.svgElement.setAttribute("height",h.height)),this.currentBBox.w!==h.width+2||this.currentBBox.h!==h.height+2||this.currentBBox.x!==h.x-1||this.currentBBox.y!==h.y-1){this.currentBBox.w=h.width+2,this.currentBBox.h=h.height+2,this.currentBBox.x=h.x-1,this.currentBBox.y=h.y-1,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var u="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=u,e.webkitTransform=u}}}},extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,t,i,r,n=this.comp.threeDElements.length;for(e=0;e<n;e+=1)if("3d"===(t=this.comp.threeDElements[e]).type){i=t.perspectiveElem.style,r=t.container.style;var a=this.pe.v+"px",o="0px 0px 0px",s="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";i.perspective=a,i.webkitPerspective=a,r.transformOrigin=o,r.mozTransformOrigin=o,r.webkitTransformOrigin=o,i.transform=s,i.webkitTransform=s}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e,t,i=this._isFirstFrame;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)i=this.hierarchy[e].finalTransform.mProp._mdf||i;if(i||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(e=t=this.hierarchy.length-1;e>=0;e-=1){var r=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-r.p.v[0],-r.p.v[1],r.p.v[2]),this.mat.rotateX(-r.or.v[0]).rotateY(-r.or.v[1]).rotateZ(r.or.v[2]),this.mat.rotateX(-r.rx.v).rotateY(-r.ry.v).rotateZ(r.rz.v),this.mat.scale(1/r.s.v[0],1/r.s.v[1],1/r.s.v[2]),this.mat.translate(r.a.v[0],r.a.v[1],r.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var n;n=this.p?[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var a=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)),o=[n[0]/a,n[1]/a,n[2]/a],s=Math.sqrt(o[2]*o[2]+o[0]*o[0]),l=Math.atan2(o[1],s),c=Math.atan2(o[0],-o[2]);this.mat.rotateY(c).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var h=!this._prevMat.equals(this.mat);if((h||this.pe._mdf)&&this.comp.threeDElements){var u,d,p;for(t=this.comp.threeDElements.length,e=0;e<t;e+=1)if("3d"===(u=this.comp.threeDElements[e]).type){if(h){var f=this.mat.toCSS();(p=u.container.style).transform=f,p.webkitTransform=f}this.pe._mdf&&((d=u.perspectiveElem.style).perspective=this.pe.v+"px",d.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null},extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),t=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(t),t.crossOrigin="anonymous",t.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)},extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},HybridRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){var r=this.layers[t];if(r.ddd&&this.supports3d)this.addTo3dContainer(i,t);else if(this.threeDElements)this.addTo3dContainer(i,t);else{for(var n,a,o=0;o<t;)this.elements[o]&&!0!==this.elements[o]&&this.elements[o].getBaseElement&&(a=this.elements[o],n=(this.layers[o].ddd?this.getThreeDContainerByPos(o):a.getBaseElement())||n),o+=1;n?r.ddd&&this.supports3d||this.layerElement.insertBefore(i,n):r.ddd&&this.supports3d||this.layerElement.appendChild(i)}}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var t=0,i=this.threeDElements.length;t<i;){if(this.threeDElements[t].startPos<=e&&this.threeDElements[t].endPos>=e)return this.threeDElements[t].perspectiveElem;t+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,t){var i,r,n=createTag("div");styleDiv(n);var a=createTag("div");if(styleDiv(a),"3d"===t){(i=n.style).width=this.globalData.compSize.w+"px",i.height=this.globalData.compSize.h+"px";var o="50% 50%";i.webkitTransformOrigin=o,i.mozTransformOrigin=o,i.transformOrigin=o;var s="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";(r=a.style).transform=s,r.webkitTransform=s}n.appendChild(a);var l={container:a,perspectiveElem:n,startPos:e,endPos:e,type:t};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var e,t,i=this.layers.length,r="";for(e=0;e<i;e+=1)this.layers[e].ddd&&3!==this.layers[e].ty?("3d"!==r&&(r="3d",t=this.createThreeDContainer(e,"3d")),t.endPos=Math.max(t.endPos,e)):("2d"!==r&&(r="2d",t=this.createThreeDContainer(e,"2d")),t.endPos=Math.max(t.endPos,e));for(e=(i=this.threeDElements.length)-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,t){for(var i=0,r=this.threeDElements.length;i<r;){if(t<=this.threeDElements[i].endPos){for(var n,a=this.threeDElements[i].startPos;a<t;)this.elements[a]&&this.elements[a].getBaseElement&&(n=this.elements[a].getBaseElement()),a+=1;n?this.threeDElements[i].container.insertBefore(e,n):this.threeDElements[i].container.appendChild(e);break}i+=1}},HybridRendererBase.prototype.configAnimation=function(e){var t=createTag("div"),i=this.animationItem.wrapper,r=t.style;r.width=e.w+"px",r.height=e.h+"px",this.resizerElem=t,styleDiv(t),r.transformStyle="flat",r.mozTransformStyle="flat",r.webkitTransformStyle="flat",this.renderConfig.className&&t.setAttribute("class",this.renderConfig.className),i.appendChild(t),r.overflow="hidden";var n=createNS("svg");n.setAttribute("width","1"),n.setAttribute("height","1"),styleDiv(n),this.resizerElem.appendChild(n);var a=createNS("defs");n.appendChild(a),this.data=e,this.setupGlobalData(e,n),this.globalData.defs=a,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e,t,i,r,n=this.animationItem.wrapper.offsetWidth,a=this.animationItem.wrapper.offsetHeight,o=n/a;this.globalData.compSize.w/this.globalData.compSize.h>o?(e=n/this.globalData.compSize.w,t=n/this.globalData.compSize.w,i=0,r=(a-this.globalData.compSize.h*(n/this.globalData.compSize.w))/2):(e=a/this.globalData.compSize.h,t=a/this.globalData.compSize.h,i=(n-this.globalData.compSize.w*(a/this.globalData.compSize.h))/2,r=0);var s=this.resizerElem.style;s.webkitTransform="matrix3d("+e+",0,0,0,0,"+t+",0,0,0,0,1,0,"+i+","+r+",0,1)",s.transform=s.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e,t=this.globalData.compSize.w,i=this.globalData.compSize.h,r=this.threeDElements.length;for(e=0;e<r;e+=1){var n=this.threeDElements[e].perspectiveElem.style;n.webkitPerspective=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))+"px",n.perspective=n.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var t,i=e.length,r=createTag("div");for(t=0;t<i;t+=1)if(e[t].xt){var n=this.createComp(e[t],r,this.globalData.comp,null);n.initExpressions(),this.globalData.projectInterface.registerComposition(n)}},extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,t){for(var i,r=0;r<t;)this.elements[r]&&this.elements[r].getBaseElement&&(i=this.elements[r].getBaseElement()),r+=1;i?this.layerElement.insertBefore(e,i):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)},extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(e){function t(t){for(var i=0,r=e.layers.length;i<r;){if(e.layers[i].nm===t||e.layers[i].ind===t)return e.elements[i].layerInterface;i+=1}return null}return Object.defineProperty(t,"_name",{value:e.data.nm}),t.layer=t,t.pixelAspect=1,t.height=e.data.h||e.globalData.compSize.h,t.width=e.data.w||e.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/e.globalData.frameRate,t.displayStartTime=0,t.numLayers=e.layers.length,t};function _typeof$2(e){return _typeof$2="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$2(e)}function seedRandom(e,t){var i,r=this,n=256,a="random",o=t.pow(n,6),s=t.pow(2,52),l=2*s,c=n-1;function h(e){var t,i=e.length,r=this,a=0,o=r.i=r.j=0,s=r.S=[];for(i||(e=[i++]);a<n;)s[a]=a++;for(a=0;a<n;a++)s[a]=s[o=c&o+e[a%i]+(t=s[a])],s[o]=t;r.g=function(e){for(var t,i=0,a=r.i,o=r.j,s=r.S;e--;)t=s[a=c&a+1],i=i*n+s[c&(s[a]=s[o=c&o+t])+(s[o]=t)];return r.i=a,r.j=o,i}}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){var i,r=[],n=_typeof$2(e);if(t&&"object"==n)for(i in e)try{r.push(d(e[i],t-1))}catch(a){}return r.length?r:"string"==n?e:e+"\0"}function p(e,t){for(var i,r=e+"",n=0;n<r.length;)t[c&n]=c&(i^=19*t[c&n])+r.charCodeAt(n++);return f(t)}function f(e){return String.fromCharCode.apply(0,e)}t["seed"+a]=function(c,m,g){var _=[],y=p(d((m=!0===m?{entropy:!0}:m||{}).entropy?[c,f(e)]:null===c?function(){try{if(i)return f(i.randomBytes(n));var t=new Uint8Array(n);return(r.crypto||r.msCrypto).getRandomValues(t),f(t)}catch(s){var a=r.navigator,o=a&&a.plugins;return[+new Date,r,o,r.screen,f(e)]}}():c,3),_),x=new h(_),v=function(){for(var e=x.g(6),t=o,i=0;e<s;)e=(e+i)*n,t*=n,i=x.g(1);for(;e>=l;)e/=2,t/=2,i>>>=1;return(e+i)/t};return v.int32=function(){return 0|x.g(4)},v.quick=function(){return x.g(4)/4294967296},v.double=v,p(f(x.S),e),(m.pass||g||function(e,i,r,n){return n&&(n.S&&u(n,x),e.state=function(){return u(x,{})}),r?(t[a]=e,i):e})(v,y,"global"in m?m.global:this==t,m.state)},p(t.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){return _typeof$1="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,t){return"number"===e||t instanceof Number||"boolean"===e||"string"===e}function $bm_neg(e){var t=_typeof$1(e);if("number"===t||e instanceof Number||"boolean"===t)return-e;if($bm_isInstanceOfArray(e)){var i,r=e.length,n=[];for(i=0;i<r;i+=1)n[i]=-e[i];return n}return e.propType?e.v:-e}initialize$2(BMMath);var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t)||"string"===i||"string"===r)return e+t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]+=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e+t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,a=e.length,o=t.length,s=[];n<a||n<o;)("number"===typeof e[n]||e[n]instanceof Number)&&("number"===typeof t[n]||t[n]instanceof Number)?s[n]=e[n]+t[n]:s[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return s}return 0}var add=sum;function sub(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t))return"string"===i&&(e=parseInt(e,10)),"string"===r&&(t=parseInt(t,10)),e-t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]-=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e-t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,a=e.length,o=t.length,s=[];n<a||n<o;)("number"===typeof e[n]||e[n]instanceof Number)&&("number"===typeof t[n]||t[n]instanceof Number)?s[n]=e[n]-t[n]:s[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return s}return 0}function mul(e,t){var i,r,n,a=_typeof$1(e),o=_typeof$1(t);if(isNumerable(a,e)&&isNumerable(o,t))return e*t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e[r]*t;return i}if(isNumerable(a,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e*t[r];return i}return 0}function div(e,t){var i,r,n,a=_typeof$1(e),o=_typeof$1(t);if(isNumerable(a,e)&&isNumerable(o,t))return e/t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e[r]/t;return i}if(isNumerable(a,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e/t[r];return i}return 0}function mod(e,t){return"string"===typeof e&&(e=parseInt(e,10)),"string"===typeof t&&(t=parseInt(t,10)),e%t}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,t,i){if(t>i){var r=i;i=t,t=r}return Math.min(Math.max(e,t),i)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,t){if("number"===typeof e||e instanceof Number)return t=t||0,Math.abs(e-t);var i;t||(t=helperLengthArray);var r=Math.min(e.length,t.length),n=0;for(i=0;i<r;i+=1)n+=Math.pow(t[i]-e[i],2);return Math.sqrt(n)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var t,i,r=e[0],n=e[1],a=e[2],o=Math.max(r,n,a),s=Math.min(r,n,a),l=(o+s)/2;if(o===s)t=0,i=0;else{var c=o-s;switch(i=l>.5?c/(2-o-s):c/(o+s),o){case r:t=(n-a)/c+(n<a?6:0);break;case n:t=(a-r)/c+2;break;case a:t=(r-n)/c+4}t/=6}return[t,i,l,e[3]]}function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function hslToRgb(e){var t,i,r,n=e[0],a=e[1],o=e[2];if(0===a)t=o,r=o,i=o;else{var s=o<.5?o*(1+a):o+a-o*a,l=2*o-s;t=hue2rgb(l,s,n+1/3),i=hue2rgb(l,s,n),r=hue2rgb(l,s,n-1/3)}return[t,i,r,e[3]]}function linear(e,t,i,r,n){if(void 0!==r&&void 0!==n||(r=t,n=i,t=0,i=1),i<t){var a=i;i=t,t=a}if(e<=t)return r;if(e>=i)return n;var o,s=i===t?0:(e-t)/(i-t);if(!r.length)return r+(n-r)*s;var l=r.length,c=createTypedArray("float32",l);for(o=0;o<l;o+=1)c[o]=r[o]+(n[o]-r[o])*s;return c}function random(e,t){if(void 0===t&&(void 0===e?(e=0,t=1):(t=e,e=void 0)),t.length){var i,r=t.length;e||(e=createTypedArray("float32",r));var n=createTypedArray("float32",r),a=BMMath.random();for(i=0;i<r;i+=1)n[i]=e[i]+a*(t[i]-e[i]);return n}return void 0===e&&(e=0),e+BMMath.random()*(t-e)}function createPath(e,t,i,r){var n,a=e.length,o=shapePool.newElement();o.setPathData(!!r,a);var s,l,c=[0,0];for(n=0;n<a;n+=1)s=t&&t[n]?t[n]:c,l=i&&i[n]?i[n]:c,o.setTripleAt(e[n][0],e[n][1],l[0]+e[n][0],l[1]+e[n][1],s[0]+e[n][0],s[1]+e[n][1],n,!0);return o}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(e,t){var i,r,n=this.pv.length?this.pv.length:1,a=createTypedArray("float32",n),o=Math.floor(5*time);for(i=0,r=0;i<o;){for(r=0;r<n;r+=1)a[r]+=-t+2*t*BMMath.random();i+=1}var s=5*time,l=s-Math.floor(s),c=createTypedArray("float32",n);if(n>1){for(r=0;r<n;r+=1)c[r]=this.pv[r]+a[r]+(-t+2*t*BMMath.random())*l;return c}return this.pv+a[0]+(-t+2*t*BMMath.random())*l}.bind(this);function loopInDuration(e,t){return loopIn(e,t,!0)}function loopOutDuration(e,t){return loopOut(e,t,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(e,t){var i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=Math.atan2(i[0],Math.sqrt(i[1]*i[1]+i[2]*i[2]))/degToRads;return[-Math.atan2(i[1],i[2])/degToRads,r,0]}function easeOut(e,t,i,r,n){return applyEase(easeOutBez,e,t,i,r,n)}function easeIn(e,t,i,r,n){return applyEase(easeInBez,e,t,i,r,n)}function ease(e,t,i,r,n){return applyEase(easeInOutBez,e,t,i,r,n)}function applyEase(e,t,i,r,n,a){void 0===n?(n=i,a=r):t=(t-i)/(r-i),t>1?t=1:t<0&&(t=0);var o=e(t);if($bm_isInstanceOfArray(n)){var s,l=n.length,c=createTypedArray("float32",l);for(s=0;s<l;s+=1)c[s]=(a[s]-n[s])*o+n[s];return c}return(a-n)*o+n}function nearestKey(e){var t,i,r,n=data.k.length;if(data.k.length&&"number"!==typeof data.k[0])if(i=-1,(e*=elem.comp.globalData.frameRate)<data.k[0].t)i=1,r=data.k[0].t;else{for(t=0;t<n-1;t+=1){if(e===data.k[t].t){i=t+1,r=data.k[t].t;break}if(e>data.k[t].t&&e<data.k[t+1].t){e-data.k[t].t>data.k[t+1].t-e?(i=t+2,r=data.k[t+1].t):(i=t+1,r=data.k[t].t);break}}-1===i&&(i=t+1,r=data.k[t].t)}else i=0,r=0;var a={};return a.index=i,a.time=r/elem.comp.globalData.frameRate,a}function key(e){var t,i,r;if(!data.k.length||"number"===typeof data.k[0])throw new Error("The property has no keyframe at index "+e);e-=1,t={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var n=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(r=n.length,i=0;i<r;i+=1)t[i]=n[i],t.value[i]=n[i];return t}function framesToTime(e,t){return t||(t=elem.comp.globalData.frameRate),e/t}function timeToFrames(e,t){return e||0===e||(e=time),t||(t=elem.comp.globalData.frameRate),e*t}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,t){return"string"===typeof value?void 0===t?value.substring(e):value.substring(e,t):""}function substr(e,t){return"string"===typeof value?void 0===t?value.substr(e):value.substr(e,t):""}function posterizeTime(e){time=0===e?0:Math.floor(time*e)/e,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={initExpressions:function(e){var t=0,i=[];e.renderer.compInterface=CompExpressionInterface(e.renderer),e.renderer.globalData.projectInterface.registerComposition(e.renderer),e.renderer.globalData.pushExpression=function(){t+=1},e.renderer.globalData.popExpression=function(){0===(t-=1)&&function(){var e,t=i.length;for(e=0;e<t;e+=1)i[e].release();i.length=0}()},e.renderer.globalData.registerExpressionProperty=function(e){-1===i.indexOf(e)&&i.push(e)}}};return e.resetFrame=ExpressionManager.resetFrame,e}(),MaskManagerInterface=function(){function e(e,t){this._mask=e,this._data=t}return Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(t){var i,r=createSizedArray(t.viewData.length),n=t.viewData.length;for(i=0;i<n;i+=1)r[i]=new e(t.viewData[i],t.masksProperties[i]);return function(e){for(i=0;i<n;){if(t.masksProperties[i].nm===e)return r[i];i+=1}return null}}}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},t={pv:[0,0,0],v:[0,0,0],mult:1};function i(e,t,i){Object.defineProperty(e,"velocity",{get:function(){return t.getVelocityAtTime(t.comp.currentFrame)}}),e.numKeys=t.keyframes?t.keyframes.length:0,e.key=function(r){if(!e.numKeys)return 0;var n="";n="s"in t.keyframes[r-1]?t.keyframes[r-1].s:"e"in t.keyframes[r-2]?t.keyframes[r-2].e:t.keyframes[r-2].s;var a="unidimensional"===i?new Number(n):Object.assign({},n);return a.time=t.keyframes[r-1].t/t.elem.comp.globalData.frameRate,a.value="unidimensional"===i?n[0]:n,a},e.valueAtTime=t.getValueAtTime,e.speedAtTime=t.getSpeedAtTime,e.velocityAtTime=t.getVelocityAtTime,e.propertyGroup=t.propertyGroup}function r(){return e}return function(n){return n?"unidimensional"===n.propType?function(t){t&&"pv"in t||(t=e);var r=1/t.mult,n=t.pv*r,a=new Number(n);return a.value=n,i(a,t,"unidimensional"),function(){return t.k&&t.getValue(),n=t.v*r,a.value!==n&&((a=new Number(n)).value=n,i(a,t,"unidimensional")),a}}(n):function(e){e&&"pv"in e||(e=t);var r=1/e.mult,n=e.data&&e.data.l||e.pv.length,a=createTypedArray("float32",n),o=createTypedArray("float32",n);return a.value=o,i(a,e,"multidimensional"),function(){e.k&&e.getValue();for(var t=0;t<n;t+=1)o[t]=e.v[t]*r,a[t]=o[t];return a}}(n):r}}(),TransformExpressionInterface=function(e){function t(e){switch(e){case"scale":case"Scale":case"ADBE Scale":case 6:return t.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return t.rotation;case"ADBE Rotate X":return t.xRotation;case"ADBE Rotate Y":return t.yRotation;case"position":case"Position":case"ADBE Position":case 2:return t.position;case"ADBE Position_0":return t.xPosition;case"ADBE Position_1":return t.yPosition;case"ADBE Position_2":return t.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return t.anchorPoint;case"opacity":case"Opacity":case 11:return t.opacity;default:return null}}var i,r,n,a;return Object.defineProperty(t,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(t,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(t,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(t,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(t,"scale",{get:ExpressionPropertyInterface(e.s)}),e.p?a=ExpressionPropertyInterface(e.p):(i=ExpressionPropertyInterface(e.px),r=ExpressionPropertyInterface(e.py),e.pz&&(n=ExpressionPropertyInterface(e.pz))),Object.defineProperty(t,"position",{get:function(){return e.p?a():[i(),r(),n?n():0]}}),Object.defineProperty(t,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(t,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(t,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(t,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(t,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(t,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(t,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(t,"orientation",{get:ExpressionPropertyInterface(e.or)}),t},LayerExpressionInterface=function(){function e(e){var t=new Matrix;return void 0!==e?this._elem.finalTransform.mProp.getValueAtTime(e).clone(t):this._elem.finalTransform.mProp.applyToMatrix(t),t}function t(e,t){var i=this.getMatrix(t);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.applyPoint(i,e)}function i(e,t){var i=this.getMatrix(t);return this.applyPoint(i,e)}function r(e,t){var i=this.getMatrix(t);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.invertPoint(i,e)}function n(e,t){var i=this.getMatrix(t);return this.invertPoint(i,e)}function a(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(e)}return e.applyToPointArray(t[0],t[1],t[2]||0)}function o(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(e)}return e.inversePoint(t)}function s(e){var t=new Matrix;if(t.reset(),this._elem.finalTransform.mProp.applyToMatrix(t),this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(t);return t.inversePoint(e)}return t.inversePoint(e)}function l(){return[1,1,1,1]}return function(c){var h;function u(e){switch(e){case"ADBE Root Vectors Group":case"Contents":case 2:return u.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return h;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return u.effect;case"ADBE Text Properties":return u.textInterface;default:return null}}u.getMatrix=e,u.invertPoint=o,u.applyPoint=a,u.toWorld=i,u.toWorldVec=t,u.fromWorld=n,u.fromWorldVec=r,u.toComp=i,u.fromComp=s,u.sampleImage=l,u.sourceRectAtTime=c.sourceRectAtTime.bind(c),u._elem=c;var d=getDescriptor(h=TransformExpressionInterface(c.finalTransform.mProp),"anchorPoint");return Object.defineProperties(u,{hasParent:{get:function(){return c.hierarchy.length}},parent:{get:function(){return c.hierarchy[0].layerInterface}},rotation:getDescriptor(h,"rotation"),scale:getDescriptor(h,"scale"),position:getDescriptor(h,"position"),opacity:getDescriptor(h,"opacity"),anchorPoint:d,anchor_point:d,transform:{get:function(){return h}},active:{get:function(){return c.isInRange}}}),u.startTime=c.data.st,u.index=c.data.ind,u.source=c.data.refId,u.height=0===c.data.ty?c.data.h:100,u.width=0===c.data.ty?c.data.w:100,u.inPoint=c.data.ip/c.comp.globalData.frameRate,u.outPoint=c.data.op/c.comp.globalData.frameRate,u._name=c.data.nm,u.registerMaskInterface=function(e){u.mask=new MaskManagerInterface(e,c)},u.registerEffectsInterface=function(e){u.effect=e},u}}(),propertyGroupFactory=function(e,t){return function(i){return(i=void 0===i?1:i)<=0?e:t(i-1)}},PropertyInterface=function(e,t){var i={_name:e};return function(e){return(e=void 0===e?1:e)<=0?i:t(e-1)}},EffectsExpressionInterface=function(){function e(i,r,n,a){function o(e){for(var t=i.ef,r=0,n=t.length;r<n;){if(e===t[r].nm||e===t[r].mn||e===t[r].ix)return 5===t[r].ty?c[r]:c[r]();r+=1}throw new Error}var s,l=propertyGroupFactory(o,n),c=[],h=i.ef.length;for(s=0;s<h;s+=1)5===i.ef[s].ty?c.push(e(i.ef[s],r.effectElements[s],r.effectElements[s].propertyGroup,a)):c.push(t(r.effectElements[s],i.ef[s].ty,a,l));return"ADBE Color Control"===i.mn&&Object.defineProperty(o,"color",{get:function(){return c[0]()}}),Object.defineProperties(o,{numProperties:{get:function(){return i.np}},_name:{value:i.nm},propertyGroup:{value:l}}),o.enabled=0!==i.en,o.active=o.enabled,o}function t(e,t,i,r){var n=ExpressionPropertyInterface(e.p);return e.p.setGroupProperty&&e.p.setGroupProperty(PropertyInterface("",r)),function(){return 10===t?i.comp.compInterface(e.p.v):n()}}return{createEffectsInterface:function(t,i){if(t.effectsManager){var r,n=[],a=t.data.ef,o=t.effectsManager.effectElements.length;for(r=0;r<o;r+=1)n.push(e(a[r],t.effectsManager.effectElements[r],i,t));var s=t.data.ef||[],l=function(e){for(r=0,o=s.length;r<o;){if(e===s[r].nm||e===s[r].mn||e===s[r].ix)return n[r];r+=1}return null};return Object.defineProperty(l,"numProperties",{get:function(){return s.length}}),l}return null}}}(),ShapePathInterface=function(e,t,i){var r=t.sh;function n(e){return"Shape"===e||"shape"===e||"Path"===e||"path"===e||"ADBE Vector Shape"===e||2===e?n.path:null}var a=propertyGroupFactory(n,i);return r.setGroupProperty(PropertyInterface("Path",a)),Object.defineProperties(n,{path:{get:function(){return r.k&&r.getValue(),r}},shape:{get:function(){return r.k&&r.getValue(),r}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:i}}),n},ShapeExpressionInterface=function(){function e(e,o,d){var p,f=[],m=e?e.length:0;for(p=0;p<m;p+=1)"gr"===e[p].ty?f.push(t(e[p],o[p],d)):"fl"===e[p].ty?f.push(i(e[p],o[p],d)):"st"===e[p].ty?f.push(n(e[p],o[p],d)):"tm"===e[p].ty?f.push(a(e[p],o[p],d)):"tr"===e[p].ty||("el"===e[p].ty?f.push(s(e[p],o[p],d)):"sr"===e[p].ty?f.push(l(e[p],o[p],d)):"sh"===e[p].ty?f.push(ShapePathInterface(e[p],o[p],d)):"rc"===e[p].ty?f.push(c(e[p],o[p],d)):"rd"===e[p].ty?f.push(h(e[p],o[p],d)):"rp"===e[p].ty?f.push(u(e[p],o[p],d)):"gf"===e[p].ty?f.push(r(e[p],o[p],d)):f.push((e[p],o[p],function(){return null})));return f}function t(t,i,r){var n=function(e){switch(e){case"ADBE Vectors Group":case"Contents":case 2:return n.content;default:return n.transform}};n.propertyGroup=propertyGroupFactory(n,r);var a=function(t,i,r){var n,a=function(e){for(var t=0,i=n.length;t<i;){if(n[t]._name===e||n[t].mn===e||n[t].propertyIndex===e||n[t].ix===e||n[t].ind===e)return n[t];t+=1}return"number"===typeof e?n[e-1]:null};a.propertyGroup=propertyGroupFactory(a,r),n=e(t.it,i.it,a.propertyGroup),a.numProperties=n.length;var s=o(t.it[t.it.length-1],i.it[i.it.length-1],a.propertyGroup);return a.transform=s,a.propertyIndex=t.cix,a._name=t.nm,a}(t,i,n.propertyGroup),s=o(t.it[t.it.length-1],i.it[i.it.length-1],n.propertyGroup);return n.content=a,n.transform=s,Object.defineProperty(n,"_name",{get:function(){return t.nm}}),n.numProperties=t.np,n.propertyIndex=t.ix,n.nm=t.nm,n.mn=t.mn,n}function i(e,t,i){function r(e){return"Color"===e||"color"===e?r.color:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",i)),t.o.setGroupProperty(PropertyInterface("Opacity",i)),r}function r(e,t,i){function r(e){return"Start Point"===e||"start point"===e?r.startPoint:"End Point"===e||"end point"===e?r.endPoint:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{startPoint:{get:ExpressionPropertyInterface(t.s)},endPoint:{get:ExpressionPropertyInterface(t.e)},opacity:{get:ExpressionPropertyInterface(t.o)},type:{get:function(){return"a"}},_name:{value:e.nm},mn:{value:e.mn}}),t.s.setGroupProperty(PropertyInterface("Start Point",i)),t.e.setGroupProperty(PropertyInterface("End Point",i)),t.o.setGroupProperty(PropertyInterface("Opacity",i)),r}function n(e,t,i){var r,n=propertyGroupFactory(c,i),a=propertyGroupFactory(l,n);function o(i){Object.defineProperty(l,e.d[i].nm,{get:ExpressionPropertyInterface(t.d.dataProps[i].p)})}var s=e.d?e.d.length:0,l={};for(r=0;r<s;r+=1)o(r),t.d.dataProps[r].p.setGroupProperty(a);function c(e){return"Color"===e||"color"===e?c.color:"Opacity"===e||"opacity"===e?c.opacity:"Stroke Width"===e||"stroke width"===e?c.strokeWidth:null}return Object.defineProperties(c,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},strokeWidth:{get:ExpressionPropertyInterface(t.w)},dash:{get:function(){return l}},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",n)),t.o.setGroupProperty(PropertyInterface("Opacity",n)),t.w.setGroupProperty(PropertyInterface("Stroke Width",n)),c}function a(e,t,i){function r(t){return t===e.e.ix||"End"===t||"end"===t?r.end:t===e.s.ix?r.start:t===e.o.ix?r.offset:null}var n=propertyGroupFactory(r,i);return r.propertyIndex=e.ix,t.s.setGroupProperty(PropertyInterface("Start",n)),t.e.setGroupProperty(PropertyInterface("End",n)),t.o.setGroupProperty(PropertyInterface("Offset",n)),r.propertyIndex=e.ix,r.propertyGroup=i,Object.defineProperties(r,{start:{get:ExpressionPropertyInterface(t.s)},end:{get:ExpressionPropertyInterface(t.e)},offset:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm}}),r.mn=e.mn,r}function o(e,t,i){function r(t){return e.a.ix===t||"Anchor Point"===t?r.anchorPoint:e.o.ix===t||"Opacity"===t?r.opacity:e.p.ix===t||"Position"===t?r.position:e.r.ix===t||"Rotation"===t||"ADBE Vector Rotation"===t?r.rotation:e.s.ix===t||"Scale"===t?r.scale:e.sk&&e.sk.ix===t||"Skew"===t?r.skew:e.sa&&e.sa.ix===t||"Skew Axis"===t?r.skewAxis:null}var n=propertyGroupFactory(r,i);return t.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",n)),t.transform.mProps.p.setGroupProperty(PropertyInterface("Position",n)),t.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",n)),t.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",n)),t.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",n)),t.transform.mProps.sk&&(t.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",n)),t.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",n))),t.transform.op.setGroupProperty(PropertyInterface("Opacity",n)),Object.defineProperties(r,{opacity:{get:ExpressionPropertyInterface(t.transform.mProps.o)},position:{get:ExpressionPropertyInterface(t.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(t.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(t.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(t.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(t.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(t.transform.mProps.sa)},_name:{value:e.nm}}),r.ty="tr",r.mn=e.mn,r.propertyGroup=i,r}function s(e,t,i){function r(t){return e.p.ix===t?r.position:e.s.ix===t?r.size:null}var n=propertyGroupFactory(r,i);r.propertyIndex=e.ix;var a="tm"===t.sh.ty?t.sh.prop:t.sh;return a.s.setGroupProperty(PropertyInterface("Size",n)),a.p.setGroupProperty(PropertyInterface("Position",n)),Object.defineProperties(r,{size:{get:ExpressionPropertyInterface(a.s)},position:{get:ExpressionPropertyInterface(a.p)},_name:{value:e.nm}}),r.mn=e.mn,r}function l(e,t,i){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.rotation:e.pt.ix===t?r.points:e.or.ix===t||"ADBE Vector Star Outer Radius"===t?r.outerRadius:e.os.ix===t?r.outerRoundness:!e.ir||e.ir.ix!==t&&"ADBE Vector Star Inner Radius"!==t?e.is&&e.is.ix===t?r.innerRoundness:null:r.innerRadius}var n=propertyGroupFactory(r,i),a="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,a.or.setGroupProperty(PropertyInterface("Outer Radius",n)),a.os.setGroupProperty(PropertyInterface("Outer Roundness",n)),a.pt.setGroupProperty(PropertyInterface("Points",n)),a.p.setGroupProperty(PropertyInterface("Position",n)),a.r.setGroupProperty(PropertyInterface("Rotation",n)),e.ir&&(a.ir.setGroupProperty(PropertyInterface("Inner Radius",n)),a.is.setGroupProperty(PropertyInterface("Inner Roundness",n))),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(a.p)},rotation:{get:ExpressionPropertyInterface(a.r)},points:{get:ExpressionPropertyInterface(a.pt)},outerRadius:{get:ExpressionPropertyInterface(a.or)},outerRoundness:{get:ExpressionPropertyInterface(a.os)},innerRadius:{get:ExpressionPropertyInterface(a.ir)},innerRoundness:{get:ExpressionPropertyInterface(a.is)},_name:{value:e.nm}}),r.mn=e.mn,r}function c(e,t,i){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.roundness:e.s.ix===t||"Size"===t||"ADBE Vector Rect Size"===t?r.size:null}var n=propertyGroupFactory(r,i),a="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,a.p.setGroupProperty(PropertyInterface("Position",n)),a.s.setGroupProperty(PropertyInterface("Size",n)),a.r.setGroupProperty(PropertyInterface("Rotation",n)),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(a.p)},roundness:{get:ExpressionPropertyInterface(a.r)},size:{get:ExpressionPropertyInterface(a.s)},_name:{value:e.nm}}),r.mn=e.mn,r}function h(e,t,i){function r(t){return e.r.ix===t||"Round Corners 1"===t?r.radius:null}var n=propertyGroupFactory(r,i),a=t;return r.propertyIndex=e.ix,a.rd.setGroupProperty(PropertyInterface("Radius",n)),Object.defineProperties(r,{radius:{get:ExpressionPropertyInterface(a.rd)},_name:{value:e.nm}}),r.mn=e.mn,r}function u(e,t,i){function r(t){return e.c.ix===t||"Copies"===t?r.copies:e.o.ix===t||"Offset"===t?r.offset:null}var n=propertyGroupFactory(r,i),a=t;return r.propertyIndex=e.ix,a.c.setGroupProperty(PropertyInterface("Copies",n)),a.o.setGroupProperty(PropertyInterface("Offset",n)),Object.defineProperties(r,{copies:{get:ExpressionPropertyInterface(a.c)},offset:{get:ExpressionPropertyInterface(a.o)},_name:{value:e.nm}}),r.mn=e.mn,r}return function(t,i,r){var n;function a(e){if("number"===typeof e)return 0===(e=void 0===e?1:e)?r:n[e-1];for(var t=0,i=n.length;t<i;){if(n[t]._name===e)return n[t];t+=1}return null}return a.propertyGroup=propertyGroupFactory(a,(function(){return r})),n=e(t,i,a.propertyGroup),a.numProperties=n.length,a._name="Contents",a}}(),TextExpressionInterface=function(e){var t;function i(e){return"ADBE Text Document"===e?i.sourceText:null}return Object.defineProperty(i,"sourceText",{get:function(){e.textProperty.getValue();var i=e.textProperty.currentData.t;return t&&i===t.value||((t=new String(i)).value=i||new String(i),Object.defineProperty(t,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),t}}),i};function _typeof(e){return _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var FootageInterface=function(){var e=function(e){function t(e){return"Outline"===e?t.outlineInterface():null}return t._name="Outline",t.outlineInterface=function(e){var t="",i=e.getFootageData();function r(e){if(i[e])return t=e,"object"===_typeof(i=i[e])?r:i;var n=e.indexOf(t);if(-1!==n){var a=parseInt(e.substr(n+t.length),10);return"object"===_typeof(i=i[a])?r:i}return""}return function(){return t="",i=e.getFootageData(),r}}(e),t};return function(t){function i(e){return"Data"===e?i.dataInterface:null}return i._name="Data",i.dataInterface=e(t),i}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers={searchExpressions:function(e,t,i){t.x&&(i.k=!0,i.x=!0,i.initiateExpression=ExpressionManager.initiateExpression,i.effectsSequence.push(i.initiateExpression(e,t,i).bind(i)))},getSpeedAtTime:function(e){var t=this.getValueAtTime(e),i=this.getValueAtTime(e+-.01),r=0;if(t.length){var n;for(n=0;n<t.length;n+=1)r+=Math.pow(i[n]-t[n],2);r=100*Math.sqrt(r)}else r=0;return r},getVelocityAtTime:function(e){if(void 0!==this.vel)return this.vel;var t,i,r=-.001,n=this.getValueAtTime(e),a=this.getValueAtTime(e+r);if(n.length)for(t=createTypedArray("float32",n.length),i=0;i<n.length;i+=1)t[i]=(a[i]-n[i])/r;else t=(a-n)/r;return t},getValueAtTime:function(e){return e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<e?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(e,this._cachingAtTime),this._cachingAtTime.lastFrame=e),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(e){this.propertyGroup=e}};function addPropertyDecorator(){function e(e,t,i){if(!this.k||!this.keyframes)return this.pv;e=e?e.toLowerCase():"";var r,n,a,o,s,l=this.comp.renderedFrame,c=this.keyframes,h=c[c.length-1].t;if(l<=h)return this.pv;if(i?n=h-(r=t?Math.abs(h-this.elem.comp.globalData.frameRate*t):Math.max(0,h-this.elem.data.ip)):((!t||t>c.length-1)&&(t=c.length-1),r=h-(n=c[c.length-1-t].t)),"pingpong"===e){if(Math.floor((l-n)/r)%2!==0)return this.getValueAtTime((r-(l-n)%r+n)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var u=this.getValueAtTime(n/this.comp.globalData.frameRate,0),d=this.getValueAtTime(h/this.comp.globalData.frameRate,0),p=this.getValueAtTime(((l-n)%r+n)/this.comp.globalData.frameRate,0),f=Math.floor((l-n)/r);if(this.pv.length){for(o=(s=new Array(u.length)).length,a=0;a<o;a+=1)s[a]=(d[a]-u[a])*f+p[a];return s}return(d-u)*f+p}if("continue"===e){var m=this.getValueAtTime(h/this.comp.globalData.frameRate,0),g=this.getValueAtTime((h-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(s=new Array(m.length)).length,a=0;a<o;a+=1)s[a]=m[a]+(m[a]-g[a])*((l-h)/this.comp.globalData.frameRate)/5e-4;return s}return m+(l-h)/.001*(m-g)}}return this.getValueAtTime(((l-n)%r+n)/this.comp.globalData.frameRate,0)}function t(e,t,i){if(!this.k)return this.pv;e=e?e.toLowerCase():"";var r,n,a,o,s,l=this.comp.renderedFrame,c=this.keyframes,h=c[0].t;if(l>=h)return this.pv;if(i?n=h+(r=t?Math.abs(this.elem.comp.globalData.frameRate*t):Math.max(0,this.elem.data.op-h)):((!t||t>c.length-1)&&(t=c.length-1),r=(n=c[t].t)-h),"pingpong"===e){if(Math.floor((h-l)/r)%2===0)return this.getValueAtTime(((h-l)%r+h)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var u=this.getValueAtTime(h/this.comp.globalData.frameRate,0),d=this.getValueAtTime(n/this.comp.globalData.frameRate,0),p=this.getValueAtTime((r-(h-l)%r+h)/this.comp.globalData.frameRate,0),f=Math.floor((h-l)/r)+1;if(this.pv.length){for(o=(s=new Array(u.length)).length,a=0;a<o;a+=1)s[a]=p[a]-(d[a]-u[a])*f;return s}return p-(d-u)*f}if("continue"===e){var m=this.getValueAtTime(h/this.comp.globalData.frameRate,0),g=this.getValueAtTime((h+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(s=new Array(m.length)).length,a=0;a<o;a+=1)s[a]=m[a]+(m[a]-g[a])*(h-l)/.001;return s}return m+(m-g)*(h-l)/.001}}return this.getValueAtTime((r-((h-l)%r+h))/this.comp.globalData.frameRate,0)}function i(e,t){if(!this.k)return this.pv;if(e=.5*(e||.4),(t=Math.floor(t||5))<=1)return this.pv;var i,r,n=this.comp.renderedFrame/this.comp.globalData.frameRate,a=n-e,o=t>1?(n+e-a)/(t-1):1,s=0,l=0;for(i=this.pv.length?createTypedArray("float32",this.pv.length):0;s<t;){if(r=this.getValueAtTime(a+s*o),this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]+=r[l];else i+=r;s+=1}if(this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]/=t;else i/=t;return i}function r(e){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var t=this._transformCachingAtTime.v;if(t.cloneFromProps(this.pre.props),this.appliedTransformations<1){var i=this.a.getValueAtTime(e);t.translate(-i[0]*this.a.mult,-i[1]*this.a.mult,i[2]*this.a.mult)}if(this.appliedTransformations<2){var r=this.s.getValueAtTime(e);t.scale(r[0]*this.s.mult,r[1]*this.s.mult,r[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var n=this.sk.getValueAtTime(e),a=this.sa.getValueAtTime(e);t.skewFromAxis(-n*this.sk.mult,a*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var o=this.r.getValueAtTime(e);t.rotate(-o*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var s=this.rz.getValueAtTime(e),l=this.ry.getValueAtTime(e),c=this.rx.getValueAtTime(e),h=this.or.getValueAtTime(e);t.rotateZ(-s*this.rz.mult).rotateY(l*this.ry.mult).rotateX(c*this.rx.mult).rotateZ(-h[2]*this.or.mult).rotateY(h[1]*this.or.mult).rotateX(h[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var u=this.px.getValueAtTime(e),d=this.py.getValueAtTime(e);if(this.data.p.z){var p=this.pz.getValueAtTime(e);t.translate(u*this.px.mult,d*this.py.mult,-p*this.pz.mult)}else t.translate(u*this.px.mult,d*this.py.mult,0)}else{var f=this.p.getValueAtTime(e);t.translate(f[0]*this.p.mult,f[1]*this.p.mult,-f[2]*this.p.mult)}return t}function n(){return this.v.clone(new Matrix)}var a=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(e,t,i){var o=a(e,t,i);return o.dynamicProperties.length?o.getValueAtTime=r.bind(o):o.getValueAtTime=n.bind(o),o.setGroupProperty=expressionHelpers.setGroupProperty,o};var o=PropertyFactory.getProp;PropertyFactory.getProp=function(r,n,a,s,l){var c=o(r,n,a,s,l);c.kf?c.getValueAtTime=expressionHelpers.getValueAtTime.bind(c):c.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(c),c.setGroupProperty=expressionHelpers.setGroupProperty,c.loopOut=e,c.loopIn=t,c.smooth=i,c.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(c),c.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(c),c.numKeys=1===n.a?n.k.length:0,c.propertyIndex=n.ix;var h=0;return 0!==a&&(h=createTypedArray("float32",1===n.a?n.k[0].s.length:n.k.length)),c._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:h},expressionHelpers.searchExpressions(r,n,c),c.k&&l.addDynamicProperty(c),c};var s=ShapePropertyFactory.getConstructorFunction(),l=ShapePropertyFactory.getKeyframedConstructorFunction();function c(){}c.prototype={vertices:function(e,t){this.k&&this.getValue();var i,r=this.v;void 0!==t&&(r=this.getValueAtTime(t,0));var n=r._length,a=r[e],o=r.v,s=createSizedArray(n);for(i=0;i<n;i+=1)s[i]="i"===e||"o"===e?[a[i][0]-o[i][0],a[i][1]-o[i][1]]:[a[i][0],a[i][1]];return s},points:function(e){return this.vertices("v",e)},inTangents:function(e){return this.vertices("i",e)},outTangents:function(e){return this.vertices("o",e)},isClosed:function(){return this.v.c},pointOnPath:function(e,t){var i=this.v;void 0!==t&&(i=this.getValueAtTime(t,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(i));for(var r,n=this._segmentsLength,a=n.lengths,o=n.totalLength*e,s=0,l=a.length,c=0;s<l;){if(c+a[s].addedLength>o){var h=s,u=i.c&&s===l-1?0:s+1,d=(o-c)/a[s].addedLength;r=bez.getPointInSegment(i.v[h],i.v[u],i.o[h],i.i[u],d,a[s]);break}c+=a[s].addedLength,s+=1}return r||(r=i.c?[i.v[0][0],i.v[0][1]]:[i.v[i._length-1][0],i.v[i._length-1][1]]),r},vectorOnPath:function(e,t,i){1==e?e=this.v.c:0==e&&(e=.999);var r=this.pointOnPath(e,t),n=this.pointOnPath(e+.001,t),a=n[0]-r[0],o=n[1]-r[1],s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2));return 0===s?[0,0]:"tangent"===i?[a/s,o/s]:[-o/s,a/s]},tangentOnPath:function(e,t){return this.vectorOnPath(e,t,"tangent")},normalOnPath:function(e,t){return this.vectorOnPath(e,t,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([c],s),extendPrototype([c],l),l.prototype.getValueAtTime=function(e){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<e?this._caching.lastIndex:0,this._cachingAtTime.lastTime=e,this.interpolateShape(e,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},l.prototype.initiateExpression=ExpressionManager.initiateExpression;var h=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(e,t,i,r,n){var a=h(e,t,i,r,n);return a.propertyIndex=t.ix,a.lock=!1,3===i?expressionHelpers.searchExpressions(e,t.pt,a):4===i&&expressionHelpers.searchExpressions(e,t.ks,a),a.k&&e.addDynamicProperty(a),a}}function initialize$1(){addPropertyDecorator()}function addDecorator(){TextProperty.prototype.getExpressionValue=function(e,t){var i=this.calculateExpression(t);if(e.t!==i){var r={};return this.copyData(r,e),r.t=i.toString(),r.__complete=!1,r}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=function(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function(e,t){var i,r,n=createNS("feMerge");for(n.setAttribute("result",e),r=0;r<t.length;r+=1)(i=createNS("feMergeNode")).setAttribute("in",t[r]),n.appendChild(i),n.appendChild(i);return n}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,t,i,r,n){this.filterManager=t;var a=createNS("feColorMatrix");a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","linearRGB"),a.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=a,a.setAttribute("result",r+"_tint_1"),e.appendChild(a),(a=createNS("feColorMatrix")).setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),a.setAttribute("result",r+"_tint_2"),e.appendChild(a),this.matrixFilter=a;var o=this.createMergeNode(r,[n,r+"_tint_1",r+"_tint_2"]);e.appendChild(o)}function SVGFillFilter(e,t,i,r){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),n.setAttribute("result",r),e.appendChild(n),this.matrixFilter=n}function SVGStrokeEffect(e,t,i){this.initialized=!1,this.filterManager=t,this.elem=i,this.paths=[]}function SVGTritoneFilter(e,t,i,r){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","linearRGB"),n.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(n);var a=createNS("feComponentTransfer");a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("result",r),this.matrixFilter=a;var o=createNS("feFuncR");o.setAttribute("type","table"),a.appendChild(o),this.feFuncR=o;var s=createNS("feFuncG");s.setAttribute("type","table"),a.appendChild(s),this.feFuncG=s;var l=createNS("feFuncB");l.setAttribute("type","table"),a.appendChild(l),this.feFuncB=l,e.appendChild(a)}function SVGProLevelsFilter(e,t,i,r){this.filterManager=t;var n=this.filterManager.effectElements,a=createNS("feComponentTransfer");(n[10].p.k||0!==n[10].p.v||n[11].p.k||1!==n[11].p.v||n[12].p.k||1!==n[12].p.v||n[13].p.k||0!==n[13].p.v||n[14].p.k||1!==n[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",a)),(n[17].p.k||0!==n[17].p.v||n[18].p.k||1!==n[18].p.v||n[19].p.k||1!==n[19].p.v||n[20].p.k||0!==n[20].p.v||n[21].p.k||1!==n[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",a)),(n[24].p.k||0!==n[24].p.v||n[25].p.k||1!==n[25].p.v||n[26].p.k||1!==n[26].p.v||n[27].p.k||0!==n[27].p.v||n[28].p.k||1!==n[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",a)),(n[31].p.k||0!==n[31].p.v||n[32].p.k||1!==n[32].p.v||n[33].p.k||1!==n[33].p.v||n[34].p.k||0!==n[34].p.v||n[35].p.k||1!==n[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",a)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(a.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(a)),(n[3].p.k||0!==n[3].p.v||n[4].p.k||1!==n[4].p.v||n[5].p.k||1!==n[5].p.v||n[6].p.k||0!==n[6].p.v||n[7].p.k||1!==n[7].p.v)&&((a=createNS("feComponentTransfer")).setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("result",r),e.appendChild(a),this.feFuncRComposed=this.createFeFunc("feFuncR",a),this.feFuncGComposed=this.createFeFunc("feFuncG",a),this.feFuncBComposed=this.createFeFunc("feFuncB",a))}function SVGDropShadowEffect(e,t,i,r,n){var a=t.container.globalData.renderConfig.filterSize,o=t.data.fs||a;e.setAttribute("x",o.x||a.x),e.setAttribute("y",o.y||a.y),e.setAttribute("width",o.width||a.width),e.setAttribute("height",o.height||a.height),this.filterManager=t;var s=createNS("feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("result",r+"_drop_shadow_1"),s.setAttribute("stdDeviation","0"),this.feGaussianBlur=s,e.appendChild(s);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",r+"_drop_shadow_1"),l.setAttribute("result",r+"_drop_shadow_2"),this.feOffset=l,e.appendChild(l);var c=createNS("feFlood");c.setAttribute("flood-color","#00ff00"),c.setAttribute("flood-opacity","1"),c.setAttribute("result",r+"_drop_shadow_3"),this.feFlood=c,e.appendChild(c);var h=createNS("feComposite");h.setAttribute("in",r+"_drop_shadow_3"),h.setAttribute("in2",r+"_drop_shadow_2"),h.setAttribute("operator","in"),h.setAttribute("result",r+"_drop_shadow_4"),e.appendChild(h);var u=this.createMergeNode(r,[r+"_drop_shadow_4",n]);e.appendChild(u)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+r+" 0"),this.matrixFilter.setAttribute("values",i[0]-t[0]+" 0 0 0 "+t[0]+" "+(i[1]-t[1])+" 0 0 0 "+t[1]+" "+(i[2]-t[2])+" 0 0 0 "+t[2]+" 0 0 0 1 0")}},SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[2].p.v,i=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+t[0]+" 0 0 0 0 "+t[1]+" 0 0 0 0 "+t[2]+" 0 0 0 "+i+" 0")}},SVGStrokeEffect.prototype.initialize=function(){var e,t,i,r,n=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(r=this.elem.maskManager.masksProperties.length,i=0):r=1+(i=this.filterManager.effectElements[0].p.v-1),(t=createNS("g")).setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1);i<r;i+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:i});if(3===this.filterManager.effectElements[10].p.v){var a=createNS("mask"),o=createElementID();a.setAttribute("id",o),a.setAttribute("mask-type","alpha"),a.appendChild(t),this.elem.globalData.defs.appendChild(a);var s=createNS("g");for(s.setAttribute("mask","url("+getLocationHref()+"#"+o+")");n[0];)s.appendChild(n[0]);this.elem.layerElement.appendChild(s),this.masker=a,t.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(n=this.elem.layerElement.children||this.elem.layerElement.childNodes;n.length;)this.elem.layerElement.removeChild(n[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(e){var t;this.initialized||this.initialize();var i,r,n=this.paths.length;for(t=0;t<n;t+=1)if(-1!==this.paths[t].m&&(i=this.elem.maskManager.viewData[this.paths[t].m],r=this.paths[t].p,(e||this.filterManager._mdf||i.prop._mdf)&&r.setAttribute("d",i.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||i.prop._mdf)){var a;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var o=.01*Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),s=.01*Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),l=r.getTotalLength();a="0 0 0 "+l*o+" ";var c,h=l*(s-o),u=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01,d=Math.floor(h/u);for(c=0;c<d;c+=1)a+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01+" ";a+="0 "+10*l+" 0 0"}else a="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01;r.setAttribute("stroke-dasharray",a)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(e||this.filterManager.effectElements[3].p._mdf)){var p=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(255*p[0])+","+bmFloor(255*p[1])+","+bmFloor(255*p[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v,n=r[0]+" "+i[0]+" "+t[0],a=r[1]+" "+i[1]+" "+t[1],o=r[2]+" "+i[2]+" "+t[2];this.feFuncR.setAttribute("tableValues",n),this.feFuncG.setAttribute("tableValues",a),this.feFuncB.setAttribute("tableValues",o)}},SVGProLevelsFilter.prototype.createFeFunc=function(e,t){var i=createNS(e);return i.setAttribute("type","table"),t.appendChild(i),i},SVGProLevelsFilter.prototype.getTableValue=function(e,t,i,r,n){for(var a,o,s=0,l=Math.min(e,t),c=Math.max(e,t),h=Array.call(null,{length:256}),u=0,d=n-r,p=t-e;s<=256;)o=(a=s/256)<=l?p<0?n:r:a>=c?p<0?r:n:r+d*Math.pow((a-e)/p,1/i),h[u]=o,u+=1,s+=256/255;return h.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t,i=this.filterManager.effectElements;this.feFuncRComposed&&(e||i[3].p._mdf||i[4].p._mdf||i[5].p._mdf||i[6].p._mdf||i[7].p._mdf)&&(t=this.getTableValue(i[3].p.v,i[4].p.v,i[5].p.v,i[6].p.v,i[7].p.v),this.feFuncRComposed.setAttribute("tableValues",t),this.feFuncGComposed.setAttribute("tableValues",t),this.feFuncBComposed.setAttribute("tableValues",t)),this.feFuncR&&(e||i[10].p._mdf||i[11].p._mdf||i[12].p._mdf||i[13].p._mdf||i[14].p._mdf)&&(t=this.getTableValue(i[10].p.v,i[11].p.v,i[12].p.v,i[13].p.v,i[14].p.v),this.feFuncR.setAttribute("tableValues",t)),this.feFuncG&&(e||i[17].p._mdf||i[18].p._mdf||i[19].p._mdf||i[20].p._mdf||i[21].p._mdf)&&(t=this.getTableValue(i[17].p.v,i[18].p.v,i[19].p.v,i[20].p.v,i[21].p.v),this.feFuncG.setAttribute("tableValues",t)),this.feFuncB&&(e||i[24].p._mdf||i[25].p._mdf||i[26].p._mdf||i[27].p._mdf||i[28].p._mdf)&&(t=this.getTableValue(i[24].p.v,i[25].p.v,i[26].p.v,i[27].p.v,i[28].p.v),this.feFuncB.setAttribute("tableValues",t)),this.feFuncA&&(e||i[31].p._mdf||i[32].p._mdf||i[33].p._mdf||i[34].p._mdf||i[35].p._mdf)&&(t=this.getTableValue(i[31].p.v,i[32].p.v,i[33].p.v,i[34].p.v,i[35].p.v),this.feFuncA.setAttribute("tableValues",t))}},extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var t=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var i=this.filterManager.effectElements[3].p.v,r=(this.filterManager.effectElements[2].p.v-90)*degToRads,n=i*Math.cos(r),a=i*Math.sin(r);this.feOffset.setAttribute("dx",n),this.feOffset.setAttribute("dy",a)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,t,i){this.initialized=!1,this.filterManager=t,this.filterElem=e,this.elem=i,i.matteElement=createNS("g"),i.matteElement.appendChild(i.layerElement),i.matteElement.appendChild(i.transformedElement),i.baseElement=i.matteElement}function SVGGaussianBlurEffect(e,t,i,r){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=t;var n=createNS("feGaussianBlur");n.setAttribute("result",r),e.appendChild(n),this.feGaussianBlur=n}function TransformEffect(){}function SVGTransformEffect(e,t){this.init(t)}function CVTransformEffect(e){this.init(e)}return SVGMatte3Effect.prototype.findSymbol=function(e){for(var t=0,i=_svgMatteSymbols.length;t<i;){if(_svgMatteSymbols[t]===e)return _svgMatteSymbols[t];t+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,t){var i=e.layerElement.parentNode;if(i){for(var r,n=i.children,a=0,o=n.length;a<o&&n[a]!==e.layerElement;)a+=1;a<=o-2&&(r=n[a+1]);var s=createNS("use");s.setAttribute("href","#"+t),r?i.insertBefore(s,r):i.appendChild(s)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,t){if(!this.findSymbol(t)){var i=createElementID(),r=createNS("mask");r.setAttribute("id",t.layerId),r.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(t);var n=e.globalData.defs;n.appendChild(r);var a=createNS("symbol");a.setAttribute("id",i),this.replaceInParent(t,i),a.appendChild(t.layerElement),n.appendChild(a);var o=createNS("use");o.setAttribute("href","#"+i),r.appendChild(o),t.data.hd=!1,t.show()}e.setMatte(t.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,t=this.elem.comp.elements,i=0,r=t.length;i<r;)t[i]&&t[i].data.ind===e&&this.setElementAsMask(this.elem,t[i]),i+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=.3*this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=3==i?0:t,n=2==i?0:t;this.feGaussianBlur.setAttribute("stdDeviation",r+" "+n);var a=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",a)}},TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var t=this.effectsManager.effectElements,i=t[0].p.v,r=t[1].p.v,n=1===t[2].p.v,a=t[3].p.v,o=n?a:t[4].p.v,s=t[5].p.v,l=t[6].p.v,c=t[7].p.v;this.matrix.reset(),this.matrix.translate(-i[0],-i[1],i[2]),this.matrix.scale(.01*o,.01*a,1),this.matrix.rotate(-c*degToRads),this.matrix.skewFromAxis(-s*degToRads,(l+90)*degToRads),this.matrix.translate(r[0],r[1],0),this._mdf=!0,this.opacity!==t[8].p.v&&(this.opacity=t[8].p.v,this._opMdf=!0)}},extendPrototype([TransformEffect],SVGTransformEffect),extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie},module.exports=factory())},879:function(e){e.exports=function(){"use strict";var e,t,i;function r(r,n){if(e)if(t){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),i=n(o),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=n;else e=n}return r(["exports"],(function(e){var t="3.6.0";let i;const r={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX):e}catch(t){i=e}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!r.API_URL)return null;try{const e=new URL(r.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function n(e){return r.API_URL_REGEX.test(e)}function a(e){return 0===e.indexOf("mapbox:")}function o(e){return r.API_CDN_URL_REGEX.test(e)}function s(e){return r.API_SPRITE_REGEX.test(e)}function l(e){return r.API_STYLE_REGEX.test(e)&&!s(e)}const c={create:"create",load:"load",fullLoad:"fullLoad"},h={mark(e){performance.mark(e)},measure(e,t,i){performance.measure(e,t,i)}};function u(e){const t=e.name.split("?")[0];return o(t)&&t.includes("mapbox-gl.js")?"javascript":o(t)&&t.includes("mapbox-gl.css")?"css":function(e){return r.API_FONTS_REGEX.test(e)}(t)?"fontRange":s(t)?"sprite":l(t)?"style":function(e){return r.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p={},f={};Object.defineProperty(f,"__esModule",{value:!0}),f.setMatrixArrayType=function(e){f.ARRAY_TYPE=g=e},f.toRadian=function(e){return e*y},f.equals=function(e,t){return Math.abs(e-t)<=m*Math.max(1,Math.abs(e),Math.abs(t))},f.RANDOM=f.ARRAY_TYPE=f.EPSILON=void 0;var m=1e-6;f.EPSILON=m;var g="undefined"!=typeof Float32Array?Float32Array:Array;f.ARRAY_TYPE=g;var _=Math.random;f.RANDOM=_;var y=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var x={};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}Object.defineProperty(x,"__esModule",{value:!0}),x.create=function(){var e=new b.ARRAY_TYPE(4);return b.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},x.clone=function(e){var t=new b.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},x.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},x.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},x.fromValues=function(e,t,i,r){var n=new b.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},x.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},x.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},x.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*a-n*r;return o?(e[0]=a*(o=1/o),e[1]=-r*o,e[2]=-n*o,e[3]=i*o,e):null},x.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},x.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},x.multiply=S,x.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+a*s,e[1]=n*l+o*s,e[2]=r*-s+a*l,e[3]=n*-s+o*l,e},x.scale=function(e,t,i){var r=t[1],n=t[2],a=t[3],o=i[0],s=i[1];return e[0]=t[0]*o,e[1]=r*o,e[2]=n*s,e[3]=a*s,e},x.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},x.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},x.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},x.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},x.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},x.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},x.subtract=E,x.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},x.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=b.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=b.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=b.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=b.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},x.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},x.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},x.sub=x.mul=void 0;var b=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==v(e)&&"function"!=typeof e)return{default:e};var t=w(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(w=function(e){return e?i:t})(e)}function S(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*s+a*l,e[1]=n*s+o*l,e[2]=r*c+a*h,e[3]=n*c+o*h,e}function E(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}x.mul=S,x.sub=E;var T={};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}Object.defineProperty(T,"__esModule",{value:!0}),T.create=function(){var e=new k.ARRAY_TYPE(6);return k.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},T.clone=function(e){var t=new k.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},T.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},T.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},T.fromValues=function(e,t,i,r,n,a){var o=new k.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=n,o[5]=a,o},T.set=function(e,t,i,r,n,a,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e},T.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=i*a-r*n;return l?(e[0]=a*(l=1/l),e[1]=-r*l,e[2]=-n*l,e[3]=i*l,e[4]=(n*s-a*o)*l,e[5]=(r*o-i*s)*l,e):null},T.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},T.multiply=A,T.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+a*c,e[1]=n*h+o*c,e[2]=r*-c+a*h,e[3]=n*-c+o*h,e[4]=s,e[5]=l,e},T.scale=function(e,t,i){var r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=i[0],c=i[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=n*c,e[3]=a*c,e[4]=o,e[5]=s,e},T.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=r*c+a*h+s,e[5]=n*c+o*h+l,e},T.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e},T.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},T.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},T.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},T.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},T.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},T.subtract=P,T.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},T.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},T.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},T.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=t[0],c=t[1],h=t[2],u=t[3],d=t[4],p=t[5];return Math.abs(i-l)<=k.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=k.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=k.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-d)<=k.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=k.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))},T.sub=T.mul=void 0;var k=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==C(e)&&"function"!=typeof e)return{default:e};var t=M(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(M=function(e){return e?i:t})(e)}function A(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=i[0],h=i[1],u=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*c+a*h,e[1]=n*c+o*h,e[2]=r*u+a*d,e[3]=n*u+o*d,e[4]=r*p+a*f+s,e[5]=n*p+o*f+l,e}function P(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}T.mul=A,T.sub=P;var I={};function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}Object.defineProperty(I,"__esModule",{value:!0}),I.create=function(){var e=new R.ARRAY_TYPE(9);return R.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},I.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},I.clone=function(e){var t=new R.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},I.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},I.fromValues=function(e,t,i,r,n,a,o,s,l){var c=new R.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=n,c[5]=a,c[6]=o,c[7]=s,c[8]=l,c},I.set=function(e,t,i,r,n,a,o,s,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e},I.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},I.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=h*o-s*c,d=-h*a+s*l,p=c*a-o*l,f=i*u+r*d+n*p;return f?(e[0]=u*(f=1/f),e[1]=(-h*r+n*c)*f,e[2]=(s*r-n*o)*f,e[3]=d*f,e[4]=(h*i-n*l)*f,e[5]=(-s*i+n*a)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(o*i-r*a)*f,e):null},I.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-s*c,e[1]=n*c-r*h,e[2]=r*s-n*o,e[3]=s*l-a*h,e[4]=i*h-n*l,e[5]=n*a-i*s,e[6]=a*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*a,e},I.determinant=function(e){var t=e[3],i=e[4],r=e[5],n=e[6],a=e[7],o=e[8];return e[0]*(o*i-r*a)+e[1]*(-o*t+r*n)+e[2]*(a*t-i*n)},I.multiply=L,I.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=d*r+p*o+c,e[7]=d*n+p*s+h,e[8]=d*a+p*l+u,e},I.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*n+d*s,e[2]=p*a+d*l,e[3]=p*o-d*r,e[4]=p*s-d*n,e[5]=p*l-d*a,e[6]=c,e[7]=h,e[8]=u,e},I.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},I.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},I.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},I.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,l=n+n,c=i*o,h=r*o,u=r*s,d=n*o,p=n*s,f=n*l,m=a*o,g=a*s,_=a*l;return e[0]=1-u-f,e[3]=h-_,e[6]=d+g,e[1]=h+_,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-u,e},I.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-r*o,x=i*l-n*o,v=i*c-a*o,b=r*l-n*s,w=r*c-a*s,S=n*c-a*l,E=h*m-u*f,T=h*g-d*f,C=h*_-p*f,k=u*g-d*m,M=u*_-p*m,A=d*_-p*g,P=y*A-x*M+v*k+b*C-w*T+S*E;return P?(e[0]=(s*A-l*M+c*k)*(P=1/P),e[1]=(l*C-o*A-c*T)*P,e[2]=(o*M-s*C+c*E)*P,e[3]=(n*M-r*A-a*k)*P,e[4]=(i*A-n*C+a*T)*P,e[5]=(r*C-i*M-a*E)*P,e[6]=(m*S-g*w+_*b)*P,e[7]=(g*v-f*S-_*x)*P,e[8]=(f*w-m*v+_*y)*P,e):null},I.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},I.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},I.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},I.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},I.subtract=F,I.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},I.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},I.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},I.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],_=t[6],y=t[7],x=t[8];return Math.abs(i-u)<=R.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-d)<=R.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=R.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=R.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-m)<=R.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-g)<=R.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=R.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=R.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-x)<=R.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))},I.sub=I.mul=void 0;var R=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==D(e)&&"function"!=typeof e)return{default:e};var t=z(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function z(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(z=function(e){return e?i:t})(e)}function L(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],x=i[7],v=i[8];return e[0]=d*r+p*o+f*c,e[1]=d*n+p*s+f*h,e[2]=d*a+p*l+f*u,e[3]=m*r+g*o+_*c,e[4]=m*n+g*s+_*h,e[5]=m*a+g*l+_*u,e[6]=y*r+x*o+v*c,e[7]=y*n+x*s+v*h,e[8]=y*a+x*l+v*u,e}function F(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}I.mul=L,I.sub=F;var B={};function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function(){var e=new N.ARRAY_TYPE(16);return N.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},B.clone=function(e){var t=new N.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},B.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},B.fromValues=function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){var g=new N.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=a,g[6]=o,g[7]=s,g[8]=l,g[9]=c,g[10]=h,g[11]=u,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},B.set=function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e[9]=h,e[10]=u,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},B.identity=j,B.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},B.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-r*o,x=i*l-n*o,v=i*c-a*o,b=r*l-n*s,w=r*c-a*s,S=n*c-a*l,E=h*m-u*f,T=h*g-d*f,C=h*_-p*f,k=u*g-d*m,M=u*_-p*m,A=d*_-p*g,P=y*A-x*M+v*k+b*C-w*T+S*E;return P?(e[0]=(s*A-l*M+c*k)*(P=1/P),e[1]=(n*M-r*A-a*k)*P,e[2]=(m*S-g*w+_*b)*P,e[3]=(d*w-u*S-p*b)*P,e[4]=(l*C-o*A-c*T)*P,e[5]=(i*A-n*C+a*T)*P,e[6]=(g*v-f*S-_*x)*P,e[7]=(h*S-d*v+p*x)*P,e[8]=(o*M-s*C+c*E)*P,e[9]=(r*C-i*M-a*E)*P,e[10]=(f*w-m*v+_*y)*P,e[11]=(u*v-h*w-p*y)*P,e[12]=(s*T-o*k-l*E)*P,e[13]=(i*k-r*T+n*E)*P,e[14]=(m*x-f*b-g*y)*P,e[15]=(h*b-u*x+d*y)*P,e):null},B.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(d*_-p*g)-u*(l*_-c*g)+m*(l*p-c*d),e[1]=-(r*(d*_-p*g)-u*(n*_-a*g)+m*(n*p-a*d)),e[2]=r*(l*_-c*g)-s*(n*_-a*g)+m*(n*c-a*l),e[3]=-(r*(l*p-c*d)-s*(n*p-a*d)+u*(n*c-a*l)),e[4]=-(o*(d*_-p*g)-h*(l*_-c*g)+f*(l*p-c*d)),e[5]=i*(d*_-p*g)-h*(n*_-a*g)+f*(n*p-a*d),e[6]=-(i*(l*_-c*g)-o*(n*_-a*g)+f*(n*c-a*l)),e[7]=i*(l*p-c*d)-o*(n*p-a*d)+h*(n*c-a*l),e[8]=o*(u*_-p*m)-h*(s*_-c*m)+f*(s*p-c*u),e[9]=-(i*(u*_-p*m)-h*(r*_-a*m)+f*(r*p-a*u)),e[10]=i*(s*_-c*m)-o*(r*_-a*m)+f*(r*c-a*s),e[11]=-(i*(s*p-c*u)-o*(r*p-a*u)+h*(r*c-a*s)),e[12]=-(o*(u*g-d*m)-h*(s*g-l*m)+f*(s*d-l*u)),e[13]=i*(u*g-d*m)-h*(r*g-n*m)+f*(r*d-n*u),e[14]=-(i*(s*g-l*m)-o*(r*g-n*m)+f*(r*l-n*s)),e[15]=i*(s*d-l*u)-o*(r*d-n*u)+h*(r*l-n*s),e},B.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-i*a)*(u*g-d*m)-(t*s-r*a)*(h*g-d*f)+(t*l-n*a)*(h*m-u*f)+(i*s-r*o)*(c*g-d*p)-(i*l-n*o)*(c*m-u*p)+(r*l-n*s)*(c*f-h*p)},B.multiply=U,B.translate=function(e,t,i){var r,n,a,o,s,l,c,h,u,d,p,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+s*g+u*_+t[12],e[13]=n*m+l*g+d*_+t[13],e[14]=a*m+c*g+p*_+t[14],e[15]=o*m+h*g+f*_+t[15]),e},B.scale=function(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},B.rotate=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b,w,S,E,T,C,k,M=r[0],A=r[1],P=r[2],I=Math.hypot(M,A,P);return I<N.EPSILON?null:(M*=I=1/I,A*=I,P*=I,n=Math.sin(i),a=Math.cos(i),l=t[1],c=t[2],h=t[3],d=t[5],p=t[6],f=t[7],g=t[9],_=t[10],y=t[11],x=M*M*(o=1-a)+a,w=M*A*o-P*n,S=A*A*o+a,E=P*A*o+M*n,T=M*P*o+A*n,C=A*P*o-M*n,k=P*P*o+a,e[0]=(s=t[0])*x+(u=t[4])*(v=A*M*o+P*n)+(m=t[8])*(b=P*M*o-A*n),e[1]=l*x+d*v+g*b,e[2]=c*x+p*v+_*b,e[3]=h*x+f*v+y*b,e[4]=s*w+u*S+m*E,e[5]=l*w+d*S+g*E,e[6]=c*w+p*S+_*E,e[7]=h*w+f*S+y*E,e[8]=s*T+u*C+m*k,e[9]=l*T+d*C+g*k,e[10]=c*T+p*C+_*k,e[11]=h*T+f*C+y*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},B.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*r,e[5]=o*n+h*r,e[6]=s*n+u*r,e[7]=l*n+d*r,e[8]=c*n-a*r,e[9]=h*n-o*r,e[10]=u*n-s*r,e[11]=d*n-l*r,e},B.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*r,e[1]=o*n-h*r,e[2]=s*n-u*r,e[3]=l*n-d*r,e[8]=a*r+c*n,e[9]=o*r+h*n,e[10]=s*r+u*n,e[11]=l*r+d*n,e},B.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*r,e[1]=o*n+h*r,e[2]=s*n+u*r,e[3]=l*n+d*r,e[4]=c*n-a*r,e[5]=h*n-o*r,e[6]=u*n-s*r,e[7]=d*n-l*r,e},B.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},B.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},B.fromRotation=function(e,t,i){var r,n,a,o=i[0],s=i[1],l=i[2],c=Math.hypot(o,s,l);return c<N.EPSILON?null:(o*=c=1/c,s*=c,l*=c,r=Math.sin(t),n=Math.cos(t),e[0]=o*o*(a=1-n)+n,e[1]=s*o*a+l*r,e[2]=l*o*a-s*r,e[3]=0,e[4]=o*s*a-l*r,e[5]=s*s*a+n,e[6]=l*s*a+o*r,e[7]=0,e[8]=o*l*a+s*r,e[9]=s*l*a-o*r,e[10]=l*l*a+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},B.fromXRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},B.fromYRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},B.fromZRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},B.fromRotationTranslation=G,B.fromQuat2=function(e,t){var i=new N.ARRAY_TYPE(3),r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=r*r+n*n+a*a+o*o;return u>0?(i[0]=2*(s*o+h*r+l*a-c*n)/u,i[1]=2*(l*o+h*n+c*r-s*a)/u,i[2]=2*(c*o+h*a+s*n-l*r)/u):(i[0]=2*(s*o+h*r+l*a-c*n),i[1]=2*(l*o+h*n+c*r-s*a),i[2]=2*(c*o+h*a+s*n-l*r)),G(e,t,i),e},B.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},B.getScaling=$,B.getRotation=function(e,t){var i=new N.ARRAY_TYPE(3);$(i,t);var r=1/i[0],n=1/i[1],a=1/i[2],o=t[0]*r,s=t[1]*n,l=t[2]*a,c=t[4]*r,h=t[5]*n,u=t[6]*a,d=t[8]*r,p=t[9]*n,f=t[10]*a,m=o+h+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(u-p)/g,e[1]=(d-l)/g,e[2]=(s-c)/g):o>h&&o>f?(g=2*Math.sqrt(1+o-h-f),e[3]=(u-p)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(d+l)/g):h>f?(g=2*Math.sqrt(1+h-o-f),e[3]=(d-l)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(u+p)/g):(g=2*Math.sqrt(1+f-o-h),e[3]=(s-c)/g,e[0]=(d+l)/g,e[1]=(u+p)/g,e[2]=.25*g),e},B.fromRotationTranslationScale=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3],l=n+n,c=a+a,h=o+o,u=n*l,d=n*c,p=n*h,f=a*c,m=a*h,g=o*h,_=s*l,y=s*c,x=s*h,v=r[0],b=r[1],w=r[2];return e[0]=(1-(f+g))*v,e[1]=(d+x)*v,e[2]=(p-y)*v,e[3]=0,e[4]=(d-x)*b,e[5]=(1-(u+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-_)*w,e[10]=(1-(u+f))*w,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},B.fromRotationTranslationScaleOrigin=function(e,t,i,r,n){var a=t[0],o=t[1],s=t[2],l=t[3],c=a+a,h=o+o,u=s+s,d=a*c,p=a*h,f=a*u,m=o*h,g=o*u,_=s*u,y=l*c,x=l*h,v=l*u,b=r[0],w=r[1],S=r[2],E=n[0],T=n[1],C=n[2],k=(1-(m+_))*b,M=(p+v)*b,A=(f-x)*b,P=(p-v)*w,I=(1-(d+_))*w,D=(g+y)*w,R=(f+x)*S,z=(g-y)*S,L=(1-(d+m))*S;return e[0]=k,e[1]=M,e[2]=A,e[3]=0,e[4]=P,e[5]=I,e[6]=D,e[7]=0,e[8]=R,e[9]=z,e[10]=L,e[11]=0,e[12]=i[0]+E-(k*E+P*T+R*C),e[13]=i[1]+T-(M*E+I*T+z*C),e[14]=i[2]+C-(A*E+D*T+L*C),e[15]=1,e},B.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,l=n+n,c=i*o,h=r*o,u=r*s,d=n*o,p=n*s,f=n*l,m=a*o,g=a*s,_=a*l;return e[0]=1-u-f,e[1]=h+_,e[2]=d-g,e[3]=0,e[4]=h-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},B.frustum=function(e,t,i,r,n,a,o){var s=1/(i-t),l=1/(n-r),c=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(n+r)*l,e[10]=(o+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*c,e[15]=0,e},B.perspectiveNO=q,B.perspectiveZO=function(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(a=1/(r-n)),e[14]=n*r*a):(e[10]=-1,e[14]=-r),e},B.perspectiveFromFieldOfView=function(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),c=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(n-a)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},B.orthoNO=H,B.orthoZO=function(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=a*c,e[15]=1,e},B.lookAt=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,f=t[0],m=t[1],g=t[2],_=r[0],y=r[1],x=r[2],v=i[0],b=i[1],w=i[2];return Math.abs(f-v)<N.EPSILON&&Math.abs(m-b)<N.EPSILON&&Math.abs(g-w)<N.EPSILON?j(e):(h=f-v,u=m-b,d=g-w,n=y*(d*=p=1/Math.hypot(h,u,d))-x*(u*=p),a=x*(h*=p)-_*d,o=_*u-y*h,(p=Math.hypot(n,a,o))?(n*=p=1/p,a*=p,o*=p):(n=0,a=0,o=0),s=u*o-d*a,l=d*n-h*o,c=h*a-u*n,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),e[0]=n,e[1]=s,e[2]=h,e[3]=0,e[4]=a,e[5]=l,e[6]=u,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*f+a*m+o*g),e[13]=-(s*f+l*m+c*g),e[14]=-(h*f+u*m+d*g),e[15]=1,e)},B.targetTo=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=r[0],l=r[1],c=r[2],h=n-i[0],u=a-i[1],d=o-i[2],p=h*h+u*u+d*d;p>0&&(h*=p=1/Math.sqrt(p),u*=p,d*=p);var f=l*d-c*u,m=c*h-s*d,g=s*u-l*h;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=u*g-d*m,e[5]=d*f-h*g,e[6]=h*m-u*f,e[7]=0,e[8]=h,e[9]=u,e[10]=d,e[11]=0,e[12]=n,e[13]=a,e[14]=o,e[15]=1,e},B.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},B.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},B.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},B.subtract=W,B.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},B.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},B.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},B.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=t[0],x=t[1],v=t[2],b=t[3],w=t[4],S=t[5],E=t[6],T=t[7],C=t[8],k=t[9],M=t[10],A=t[11],P=t[12],I=t[13],D=t[14],R=t[15];return Math.abs(i-y)<=N.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-x)<=N.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-v)<=N.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-b)<=N.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-w)<=N.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-S)<=N.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(l-E)<=N.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-T)<=N.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-C)<=N.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(u-k)<=N.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-M)<=N.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-A)<=N.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-P)<=N.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-I)<=N.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(g-D)<=N.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(_-R)<=N.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},B.sub=B.mul=B.ortho=B.perspective=void 0;var N=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==O(e)&&"function"!=typeof e)return{default:e};var t=V(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function V(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(V=function(e){return e?i:t})(e)}function j(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function U(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],x=i[0],v=i[1],b=i[2],w=i[3];return e[0]=x*r+v*s+b*u+w*m,e[1]=x*n+v*l+b*d+w*g,e[2]=x*a+v*c+b*p+w*_,e[3]=x*o+v*h+b*f+w*y,e[4]=(x=i[4])*r+(v=i[5])*s+(b=i[6])*u+(w=i[7])*m,e[5]=x*n+v*l+b*d+w*g,e[6]=x*a+v*c+b*p+w*_,e[7]=x*o+v*h+b*f+w*y,e[8]=(x=i[8])*r+(v=i[9])*s+(b=i[10])*u+(w=i[11])*m,e[9]=x*n+v*l+b*d+w*g,e[10]=x*a+v*c+b*p+w*_,e[11]=x*o+v*h+b*f+w*y,e[12]=(x=i[12])*r+(v=i[13])*s+(b=i[14])*u+(w=i[15])*m,e[13]=x*n+v*l+b*d+w*g,e[14]=x*a+v*c+b*p+w*_,e[15]=x*o+v*h+b*f+w*y,e}function G(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=r+r,l=n+n,c=a+a,h=r*s,u=r*l,d=r*c,p=n*l,f=n*c,m=a*c,g=o*s,_=o*l,y=o*c;return e[0]=1-(p+m),e[1]=u+y,e[2]=d-_,e[3]=0,e[4]=u-y,e[5]=1-(h+m),e[6]=f+g,e[7]=0,e[8]=d+_,e[9]=f-g,e[10]=1-(h+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $(e,t){var i=t[4],r=t[5],n=t[6],a=t[8],o=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,n),e[2]=Math.hypot(a,o,s),e}function q(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(a=1/(r-n)),e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e}function H(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=(o+a)*c,e[15]=1,e}function W(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}B.perspective=q,B.ortho=H,B.mul=U,B.sub=W;var Z={},X={};function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}Object.defineProperty(X,"__esModule",{value:!0}),X.create=K,X.clone=function(e){var t=new J.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},X.length=ee,X.fromValues=function(e,t,i){var r=new J.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=i,r},X.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},X.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},X.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},X.subtract=te,X.multiply=ie,X.divide=re,X.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},X.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},X.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},X.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},X.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},X.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},X.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},X.distance=ne,X.squaredDistance=ae,X.squaredLength=oe,X.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},X.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},X.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},X.dot=se,X.cross=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2];return e[0]=n*l-a*s,e[1]=a*o-r*l,e[2]=r*s-n*o,e},X.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e},X.hermite=function(e,t,i,r,n,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,c=o*(a-1),h=o*(3-2*a);return e[0]=t[0]*s+i[0]*l+r[0]*c+n[0]*h,e[1]=t[1]*s+i[1]*l+r[1]*c+n[1]*h,e[2]=t[2]*s+i[2]*l+r[2]*c+n[2]*h,e},X.bezier=function(e,t,i,r,n,a){var o=1-a,s=o*o,l=a*a,c=s*o,h=3*a*s,u=3*l*o,d=l*a;return e[0]=t[0]*c+i[0]*h+r[0]*u+n[0]*d,e[1]=t[1]*c+i[1]*h+r[1]*u+n[1]*d,e[2]=t[2]*c+i[2]*h+r[2]*u+n[2]*d,e},X.random=function(e,t){t=t||1;var i=2*J.RANDOM()*Math.PI,r=2*J.RANDOM()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e},X.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[3]*r+i[7]*n+i[11]*a+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/(o=o||1),e[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/o,e},X.transformMat3=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e},X.transformQuat=function(e,t,i){var r=i[0],n=i[1],a=i[2],o=t[0],s=t[1],l=t[2],c=n*l-a*s,h=a*o-r*l,u=r*s-n*o,d=n*u-a*h,p=a*c-r*u,f=r*h-n*c,m=2*i[3];return h*=m,u*=m,p*=2,f*=2,e[0]=o+(c*=m)+(d*=2),e[1]=s+h+p,e[2]=l+u+f,e},X.rotateX=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},X.rotateY=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},X.rotateZ=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},X.angle=function(e,t){var i=e[0],r=e[1],n=e[2],a=t[0],o=t[1],s=t[2],l=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(a*a+o*o+s*s),c=l&&se(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},X.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},X.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},X.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},X.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(i-a)<=J.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=J.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=J.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},X.forEach=X.sqrLen=X.len=X.sqrDist=X.dist=X.div=X.mul=X.sub=void 0;var J=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Y(e)&&"function"!=typeof e)return{default:e};var t=Q(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function Q(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Q=function(e){return e?i:t})(e)}function K(){var e=new J.ARRAY_TYPE(3);return J.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ee(e){return Math.hypot(e[0],e[1],e[2])}function te(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function ie(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function re(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function ne(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function ae(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function oe(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function se(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}X.sub=te,X.mul=ie,X.div=re,X.dist=ne,X.sqrDist=ae,X.len=ee,X.sqrLen=oe;var le,ce=(le=K(),function(e,t,i,r,n,a){var o,s;for(t||(t=3),i||(i=0),s=r?Math.min(r*t+i,e.length):e.length,o=i;o<s;o+=t)le[0]=e[o],le[1]=e[o+1],le[2]=e[o+2],n(le,le,a),e[o]=le[0],e[o+1]=le[1],e[o+2]=le[2];return e});X.forEach=ce;var he={};function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}Object.defineProperty(he,"__esModule",{value:!0}),he.create=fe,he.clone=function(e){var t=new de.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},he.fromValues=function(e,t,i,r){var n=new de.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},he.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},he.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},he.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},he.subtract=me,he.multiply=ge,he.divide=_e,he.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},he.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},he.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},he.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},he.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},he.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},he.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},he.distance=ye,he.squaredDistance=xe,he.length=ve,he.squaredLength=be,he.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},he.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},he.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=a*o,e},he.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},he.cross=function(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],a=i[0]*r[2]-i[2]*r[0],o=i[0]*r[3]-i[3]*r[0],s=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],h=t[0],u=t[1],d=t[2],p=t[3];return e[0]=u*c-d*l+p*s,e[1]=-h*c+d*o-p*a,e[2]=h*l-u*o+p*n,e[3]=-h*s+u*a-d*n,e},he.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e[3]=s+r*(i[3]-s),e},he.random=function(e,t){var i,r,n,a,o,s;t=t||1;do{o=(i=2*de.RANDOM()-1)*i+(r=2*de.RANDOM()-1)*r}while(o>=1);do{s=(n=2*de.RANDOM()-1)*n+(a=2*de.RANDOM()-1)*a}while(s>=1);var l=Math.sqrt((1-o)/s);return e[0]=t*i,e[1]=t*r,e[2]=t*n*l,e[3]=t*a*l,e},he.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,e},he.transformQuat=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2],c=i[3],h=c*r+s*a-l*n,u=c*n+l*r-o*a,d=c*a+o*n-s*r,p=-o*r-s*n-l*a;return e[0]=h*c+p*-o+u*-l-d*-s,e[1]=u*c+p*-s+d*-o-h*-l,e[2]=d*c+p*-l+h*-s-u*-o,e[3]=t[3],e},he.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},he.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},he.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},he.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=de.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=de.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=de.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=de.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},he.forEach=he.sqrLen=he.len=he.sqrDist=he.dist=he.div=he.mul=he.sub=void 0;var de=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==ue(e)&&"function"!=typeof e)return{default:e};var t=pe(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function pe(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(pe=function(e){return e?i:t})(e)}function fe(){var e=new de.ARRAY_TYPE(4);return de.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function me(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function ge(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function _e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function ye(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function xe(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return i*i+r*r+n*n+a*a}function ve(e){return Math.hypot(e[0],e[1],e[2],e[3])}function be(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}he.sub=me,he.mul=ge,he.div=_e,he.dist=ye,he.sqrDist=xe,he.len=ve,he.sqrLen=be;var we=function(){var e=fe();return function(t,i,r,n,a,o){var s,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,s=r;s<l;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}he.forEach=we,Object.defineProperty(Z,"__esModule",{value:!0}),Z.create=Pe,Z.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Z.setAxisAngle=Ie,Z.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Ee.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},Z.getAngle=function(e,t){var i=Oe(e,t);return Math.acos(2*i*i-1)},Z.multiply=De,Z.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-r*s,e},Z.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l-a*s,e[1]=n*l+o*s,e[2]=a*l+r*s,e[3]=o*l-n*s,e},Z.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*s,e[1]=n*l-r*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},Z.calculateW=function(e,t){var i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},Z.exp=Re,Z.ln=ze,Z.pow=function(e,t,i){return ze(e,t),Be(e,e,i),Re(e,e),e},Z.slerp=Le,Z.random=function(e){var t=Ee.RANDOM(),i=Ee.RANDOM(),r=Ee.RANDOM(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},Z.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return e[0]=-i*s,e[1]=-r*s,e[2]=-n*s,e[3]=a*s,e},Z.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Z.fromMat3=Fe,Z.fromEuler=function(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=a*l*h-o*s*c,e[1]=o*s*h+a*l*c,e[2]=o*l*c-a*s*h,e[3]=o*l*h+a*s*c,e},Z.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Z.setAxes=Z.sqlerp=Z.rotationTo=Z.equals=Z.exactEquals=Z.normalize=Z.sqrLen=Z.squaredLength=Z.len=Z.length=Z.lerp=Z.dot=Z.scale=Z.mul=Z.add=Z.set=Z.copy=Z.fromValues=Z.clone=void 0;var Ee=Ae(f),Te=Ae(I),Ce=Ae(X),ke=Ae(he);function Me(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Me=function(e){return e?i:t})(e)}function Ae(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Se(e)&&"function"!=typeof e)return{default:e};var i=Me(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}function Pe(){var e=new Ee.ARRAY_TYPE(4);return Ee.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ie(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function De(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*s+n*c-a*l,e[1]=n*h+o*l+a*s-r*c,e[2]=a*h+o*c+r*l-n*s,e[3]=o*h-r*s-n*l-a*c,e}function Re(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sqrt(i*i+r*r+n*n),s=Math.exp(a),l=o>0?s*Math.sin(o)/o:0;return e[0]=i*l,e[1]=r*l,e[2]=n*l,e[3]=s*Math.cos(o),e}function ze(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sqrt(i*i+r*r+n*n),s=o>0?Math.atan2(o,a)/o:0;return e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=.5*Math.log(i*i+r*r+n*n+a*a),e}function Le(e,t,i,r){var n,a,o,s,l,c=t[0],h=t[1],u=t[2],d=t[3],p=i[0],f=i[1],m=i[2],g=i[3];return(a=c*p+h*f+u*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>Ee.EPSILON?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-r)*n)/o,l=Math.sin(r*n)/o):(s=1-r,l=r),e[0]=s*c+l*p,e[1]=s*h+l*f,e[2]=s*u+l*m,e[3]=s*d+l*g,e}function Fe(e,t){var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*i,e[3]=(t[3*a+o]-t[3*o+a])*(i=.5/i),e[a]=(t[3*a+n]+t[3*n+a])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e}Z.clone=ke.clone,Z.fromValues=ke.fromValues,Z.copy=ke.copy,Z.set=ke.set,Z.add=ke.add,Z.mul=De;var Be=ke.scale;Z.scale=Be;var Oe=ke.dot;Z.dot=Oe,Z.lerp=ke.lerp;var Ne=ke.length;Z.length=Ne,Z.len=Ne;var Ve=ke.squaredLength;Z.squaredLength=Ve,Z.sqrLen=Ve;var je=ke.normalize;Z.normalize=je,Z.exactEquals=ke.exactEquals,Z.equals=ke.equals;var Ue,Ge,$e,qe=(Ue=Ce.create(),Ge=Ce.fromValues(1,0,0),$e=Ce.fromValues(0,1,0),function(e,t,i){var r=Ce.dot(t,i);return r<-.999999?(Ce.cross(Ue,Ge,t),Ce.len(Ue)<1e-6&&Ce.cross(Ue,$e,t),Ce.normalize(Ue,Ue),Ie(e,Ue,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Ce.cross(Ue,t,i),e[0]=Ue[0],e[1]=Ue[1],e[2]=Ue[2],e[3]=1+r,je(e,e))});Z.rotationTo=qe;var He,We,Ze=(He=Pe(),We=Pe(),function(e,t,i,r,n,a){return Le(He,t,n,a),Le(We,i,r,a),Le(e,He,We,2*a*(1-a)),e});Z.sqlerp=Ze;var Xe,Ye=(Xe=Te.create(),function(e,t,i,r){return Xe[0]=i[0],Xe[3]=i[1],Xe[6]=i[2],Xe[1]=r[0],Xe[4]=r[1],Xe[7]=r[2],Xe[2]=-t[0],Xe[5]=-t[1],Xe[8]=-t[2],je(e,Fe(e,Xe))});Z.setAxes=Ye;var Je={};function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=function(){var e=new Ke.ARRAY_TYPE(8);return Ke.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Je.clone=function(e){var t=new Ke.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Je.fromValues=function(e,t,i,r,n,a,o,s){var l=new Ke.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=r,l[4]=n,l[5]=a,l[6]=o,l[7]=s,l},Je.fromRotationTranslationValues=function(e,t,i,r,n,a,o){var s=new Ke.ARRAY_TYPE(8);s[0]=e,s[1]=t,s[2]=i,s[3]=r;var l=.5*n,c=.5*a,h=.5*o;return s[4]=l*r+c*i-h*t,s[5]=c*r+h*e-l*i,s[6]=h*r+l*t-c*e,s[7]=-l*e-c*t-h*i,s},Je.fromRotationTranslation=nt,Je.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Je.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Je.fromMat4=function(e,t){var i=et.create();tt.getRotation(i,t);var r=new Ke.ARRAY_TYPE(3);return tt.getTranslation(r,t),nt(e,i,r),e},Je.copy=at,Je.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Je.set=function(e,t,i,r,n,a,o,s,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e},Je.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Je.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Je.getTranslation=function(e,t){var i=t[4],r=t[5],n=t[6],a=t[7],o=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(i*c+a*o+r*l-n*s),e[1]=2*(r*c+a*s+n*o-i*l),e[2]=2*(n*c+a*l+i*s-r*o),e},Je.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=.5*i[0],l=.5*i[1],c=.5*i[2],h=t[4],u=t[5],d=t[6],p=t[7];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=o*s+n*c-a*l+h,e[5]=o*l+a*s-r*c+u,e[6]=o*c+r*l-n*s+d,e[7]=-r*s-n*l-a*c+p,e},Je.rotateX=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return et.rotateX(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Je.rotateY=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return et.rotateY(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Je.rotateZ=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return et.rotateZ(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Je.rotateByQuatAppend=function(e,t,i){var r=i[0],n=i[1],a=i[2],o=i[3],s=t[0],l=t[1],c=t[2],h=t[3];return e[0]=s*o+h*r+l*a-c*n,e[1]=l*o+h*n+c*r-s*a,e[2]=c*o+h*a+s*n-l*r,e[3]=h*o-s*r-l*n-c*a,e[4]=(s=t[4])*o+(h=t[7])*r+(l=t[5])*a-(c=t[6])*n,e[5]=l*o+h*n+c*r-s*a,e[6]=c*o+h*a+s*n-l*r,e[7]=h*o-s*r-l*n-c*a,e},Je.rotateByQuatPrepend=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*s+n*c-a*l,e[1]=n*h+o*l+a*s-r*c,e[2]=a*h+o*c+r*l-n*s,e[3]=o*h-r*s-n*l-a*c,e[4]=r*(h=i[7])+o*(s=i[4])+n*(c=i[6])-a*(l=i[5]),e[5]=n*h+o*l+a*s-r*c,e[6]=a*h+o*c+r*l-n*s,e[7]=o*h-r*s-n*l-a*c,e},Je.rotateAroundAxis=function(e,t,i,r){if(Math.abs(r)<Ke.EPSILON)return at(e,t);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var a=Math.sin(r),o=a*i[0]/n,s=a*i[1]/n,l=a*i[2]/n,c=Math.cos(r),h=t[0],u=t[1],d=t[2],p=t[3];e[0]=h*c+p*o+u*l-d*s,e[1]=u*c+p*s+d*o-h*l,e[2]=d*c+p*l+h*s-u*o,e[3]=p*c-h*o-u*s-d*l;var f=t[4],m=t[5],g=t[6],_=t[7];return e[4]=f*c+_*o+m*l-g*s,e[5]=m*c+_*s+g*o-f*l,e[6]=g*c+_*l+f*s-m*o,e[7]=_*c-f*o-m*s-g*l,e},Je.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Je.multiply=ot,Je.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Je.lerp=function(e,t,i,r){var n=1-r;return st(t,i)<0&&(r=-r),e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e[3]=t[3]*n+i[3]*r,e[4]=t[4]*n+i[4]*r,e[5]=t[5]*n+i[5]*r,e[6]=t[6]*n+i[6]*r,e[7]=t[7]*n+i[7]*r,e},Je.invert=function(e,t){var i=ct(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Je.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Je.normalize=function(e,t){var i=ct(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i,n=t[1]/i,a=t[2]/i,o=t[3]/i,s=t[4],l=t[5],c=t[6],h=t[7],u=r*s+n*l+a*c+o*h;e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=(s-r*u)/i,e[5]=(l-n*u)/i,e[6]=(c-a*u)/i,e[7]=(h-o*u)/i}return e},Je.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Je.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Je.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=t[0],u=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],_=t[7];return Math.abs(i-h)<=Ke.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-u)<=Ke.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=Ke.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=Ke.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-f)<=Ke.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=Ke.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=Ke.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=Ke.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Je.sqrLen=Je.squaredLength=Je.len=Je.length=Je.dot=Je.mul=Je.setReal=Je.getReal=void 0;var Ke=rt(f),et=rt(Z),tt=rt(B);function it(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(it=function(e){return e?i:t})(e)}function rt(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Qe(e)&&"function"!=typeof e)return{default:e};var i=it(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}function nt(e,t,i){var r=.5*i[0],n=.5*i[1],a=.5*i[2],o=t[0],s=t[1],l=t[2],c=t[3];return e[0]=o,e[1]=s,e[2]=l,e[3]=c,e[4]=r*c+n*l-a*s,e[5]=n*c+a*o-r*l,e[6]=a*c+r*s-n*o,e[7]=-r*o-n*s-a*l,e}function at(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ot(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[4],l=i[5],c=i[6],h=i[7],u=t[4],d=t[5],p=t[6],f=t[7],m=i[0],g=i[1],_=i[2],y=i[3];return e[0]=r*y+o*m+n*_-a*g,e[1]=n*y+o*g+a*m-r*_,e[2]=a*y+o*_+r*g-n*m,e[3]=o*y-r*m-n*g-a*_,e[4]=r*h+o*s+n*c-a*l+u*y+f*m+d*_-p*g,e[5]=n*h+o*l+a*s-r*c+d*y+f*g+p*m-u*_,e[6]=a*h+o*c+r*l-n*s+p*y+f*_+u*g-d*m,e[7]=o*h-r*s-n*l-a*c+f*y-u*m-d*g-p*_,e}Je.getReal=et.copy,Je.setReal=et.copy,Je.mul=ot;var st=et.dot;Je.dot=st;var lt=et.length;Je.length=lt,Je.len=lt;var ct=et.squaredLength;Je.squaredLength=ct,Je.sqrLen=ct;var ht={};function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=ft,ht.clone=function(e){var t=new dt.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},ht.fromValues=function(e,t){var i=new dt.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},ht.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},ht.set=function(e,t,i){return e[0]=t,e[1]=i,e},ht.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},ht.subtract=mt,ht.multiply=gt,ht.divide=_t,ht.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},ht.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},ht.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},ht.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},ht.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},ht.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},ht.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},ht.distance=yt,ht.squaredDistance=xt,ht.length=vt,ht.squaredLength=bt,ht.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},ht.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},ht.normalize=function(e,t){var i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},ht.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},ht.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},ht.lerp=function(e,t,i,r){var n=t[0],a=t[1];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e},ht.random=function(e,t){t=t||1;var i=2*dt.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},ht.transformMat2=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e},ht.transformMat2d=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e},ht.transformMat3=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},ht.transformMat4=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},ht.rotate=function(e,t,i,r){var n=t[0]-i[0],a=t[1]-i[1],o=Math.sin(r),s=Math.cos(r);return e[0]=n*s-a*o+i[0],e[1]=n*o+a*s+i[1],e},ht.angle=function(e,t){var i=e[0],r=e[1],n=t[0],a=t[1],o=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+a*a);return Math.acos(Math.min(Math.max(o&&(i*n+r*a)/o,-1),1))},ht.zero=function(e){return e[0]=0,e[1]=0,e},ht.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},ht.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ht.equals=function(e,t){var i=e[0],r=e[1],n=t[0],a=t[1];return Math.abs(i-n)<=dt.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=dt.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},ht.forEach=ht.sqrLen=ht.sqrDist=ht.dist=ht.div=ht.mul=ht.sub=ht.len=void 0;var dt=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==ut(e)&&"function"!=typeof e)return{default:e};var t=pt(void 0);if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=r?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}(f);function pt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(pt=function(e){return e?i:t})(e)}function ft(){var e=new dt.ARRAY_TYPE(2);return dt.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function mt(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function gt(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function _t(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function yt(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function xt(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function vt(e){return Math.hypot(e[0],e[1])}function bt(e){var t=e[0],i=e[1];return t*t+i*i}ht.len=vt,ht.sub=mt,ht.mul=gt,ht.div=_t,ht.dist=yt,ht.sqrDist=xt,ht.sqrLen=bt;var wt=function(){var e=ft();return function(t,i,r,n,a,o){var s,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,s=r;s<l;s+=i)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}ht.forEach=wt,Object.defineProperty(p,"__esModule",{value:!0}),e.aB=p.vec4=e.$=p.vec3=p.vec2=p.quat2=e.aw=p.quat=e.ae=p.mat4=e.bE=p.mat3=p.mat2d=e.aD=p.mat2=p.glMatrix=void 0;var Et=Lt(f);p.glMatrix=Et;var Tt=Lt(x);e.aD=p.mat2=Tt;var Ct=Lt(T);p.mat2d=Ct;var kt=Lt(I);e.bE=p.mat3=kt;var Mt=Lt(B);e.ae=p.mat4=Mt;var At=Lt(Z);e.aw=p.quat=At;var Pt=Lt(Je);p.quat2=Pt;var It=Lt(ht);p.vec2=It;var Dt=Lt(X);e.$=p.vec3=Dt;var Rt=Lt(he);function zt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(zt=function(e){return e?i:t})(e)}function Lt(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==St(e)&&"function"!=typeof e)return{default:e};var i=zt(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}e.aB=p.vec4=Rt;var Ft=Bt;function Bt(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}Bt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=n/a}var o=0,s=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?o=i:s=i,i=.5*(s-o)+o;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Ot=d(Ft),Nt=Vt;function Vt(e,t){this.x=e,this.y=t}Vt.prototype={clone:function(){return new Vt(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Vt.convert=function(e){return e instanceof Vt?e:Array.isArray(e)?new Vt(e[0],e[1]):e};var jt=d(Nt);function Ut(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Ut(e[i],t[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!Ut(e[i],t[i]))return!1;return!0}return e===t}const Gt=Math.PI/180,$t=180/Math.PI;function qt(e){return e*Gt}function Ht(e){return e*$t}const Wt=[[0,0],[1,0],[1,1],[0,1]];function Zt(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Xt(e,t,i,r){const n=new Ot(e,t,i,r);return function(e){return n.solve(e)}}const Yt=Xt(.25,.1,.25,1);function Jt(e,t,i){return Math.min(i,Math.max(t,e))}function Qt(e,t,i){return(i=Jt((i-e)/(t-e),0,1))*i*(3-2*i)}function Kt(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function ei(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const n=new Array(e.length);let a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),n[o]=t,0==--r&&i(a,n)}))}))}function ti(e){const t=[];for(const i in e)t.push(e[i]);return t}function ii(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(const n of i)for(const t in n)e[t]=n[t];return e}let ri=1;function ni(){return ri++}function ai(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function oi(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function si(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function li(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function ci(e,t){return-1!==e.indexOf(t,e.length-t.length)}function hi(e,t,i){const r={};for(const n in e)r[n]=t.call(this,e[n],n,e);return r}function ui(e,t,i){const r={};for(const n in e)t.call(this,e[n],n,e)&&(r[n]=e[n]);return r}function di(e){return Array.isArray(e)?e.map(di):"object"==typeof e&&e?hi(e,di):e}const pi={};function fi(e){pi[e]||("undefined"!=typeof console&&console.warn(e),pi[e]=!0)}function mi(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function gi(e){let t=0;for(let i,r,n=0,a=e.length,o=a-1;n<a;o=n++)i=e[n],r=e[o],t+=(r.x-i.x)*(i.y+r.y);return t}function _i(e){let[t,i,r]=e;const n=qt(i+90),a=qt(r);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:i,polar:r}}function yi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function xi(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const a=r||n;return t[i]=!a||a.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let vi,bi,wi,Si,Ei,Ti,Ci=null;function ki(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function Mi(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Ai(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<r?t=n+1:i=n}return t}function Pi(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<=r?t=n+1:i=n}return t}function Ii(e){return e>0?1/(1.001-e):1+e}function Di(e){return e>0?1-1/(1.001-e):-e}function Ri(){return null==vi&&(vi=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),vi}const zi={now:()=>void 0!==Si?Si:performance.now(),setNow(e){Si=e},restoreNow(){Si=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:i,height:r}=e;Ei||(Ei=document.createElement("canvas"));const n=Ei.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>Ei.width||r>Ei.height)&&(Ei.width=i,Ei.height=r),n.clearRect(-t,-t,i+2*t,r+2*t),n.drawImage(e,0,0,i,r),n.getImageData(-t,-t,i+2*t,r+2*t)},resolveURL:e=>(bi||(bi=document.createElement("a")),bi.href=e,bi.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==wi&&(wi=window.matchMedia("(prefers-reduced-motion: reduce)")),wi.matches)},hasCanvasFingerprintNoise(){if(void 0!==Ti)return Ti;if(!Ri())return Ti=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<e.width;++n)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(n,0,1,1);const r=t.getImageData(0,0,e.width,e.height);i=0;for(let n=0;n<r.data.length;++n)if(n%4!=3&&i++!==r.data[n])return Ti=!0,!0;return Ti=!1,!1}};function Li(e,t){const i=e.indexOf("?");if(i<0)return`${e}?${new URLSearchParams(t).toString()}`;const r=new URLSearchParams(e.slice(i));for(const n in t)r.set(n,t[n]);return`${e.slice(0,i)}?${r.toString()}`}function Fi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const i=e.indexOf("?");if(i<0)return e;const r=new URLSearchParams,n=new URLSearchParams(e.slice(i));for(const o of t.persistentParams){const e=n.get(o);e&&r.set(o,e)}const a=r.toString();return`${e.slice(0,i)}${a.length>0?`?${a}`:""}`}const Bi="mapbox-tiles";let Oi=500,Ni=50;const Vi=["language","worldview","jobid"];let ji,Ui;function Gi(){try{return caches}catch(e){}}function $i(){const e=Gi();e&&!ji&&(ji=e.open(Bi))}let qi=1/0;const Hi={supported:!1,testSupport:function(e){!Xi&&Zi&&(Yi?Qi(e):Wi=e)}};let Wi,Zi,Xi=!1,Yi=!1;const Ji="undefined"!=typeof self?self:{};function Qi(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Zi),e.isContextLost())return;Hi.supported=!0}catch(e){}e.deleteTexture(t),Xi=!0}Ji.document&&(Zi=Ji.document.createElement("img"),Zi.onload=function(){Wi&&Qi(Wi),Wi=null,Yi=!0},Zi.onerror=function(){Xi=!0,Wi=null},Zi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ki={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Ki);class er extends Error{constructor(e,t,i){401===t&&n(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const tr=yi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,ir=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(tr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new AbortController,r=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:tr(),referrerPolicy:e.referrerPolicy,signal:i.signal});let a=!1,o=!1;const s=(l=r.url).indexOf("sku=")>0&&n(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(i,n,a)=>{if(o)return;if(i&&"SecurityError"!==i.message&&fi(i.toString()),n&&a)return h(n);const l=Date.now();fetch(r).then((i=>{if(i.ok){const e=s?i.clone():null;return h(i,e,l)}return t(new er(i.statusText,i.status,e.url))})).catch((i=>{"AbortError"!==i.name&&t(new Error(`${i.message} ${e.url}`))}))},h=(i,n,s)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{o||(n&&s&&function(e,t,i){if($i(),!ji)return;const r=xi(t.headers.get("Cache-Control")||"");if(r["no-store"])return;const n={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e))),r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString());const a=n.headers.get("Expires");if(!a)return;if(new Date(a).getTime()-i<42e4)return;let o=Fi(e.url,{persistentParams:Vi});if(206===t.status){const t=e.headers.get("Range");if(!t)return;n.status=200,o=Li(o,{range:t})}!function(e,t){if(void 0===Ui)try{new Response(new ReadableStream),Ui=!0}catch(e){Ui=!1}Ui?t(e.body):e.blob().then(t)}(t,(e=>{const i=new Response(200!==(r=t.status)&&404!==r&&[101,103,204,205,304].includes(r)?null:e,n);var r;$i(),ji&&ji.then((e=>e.put(o,i))).catch((e=>fi(e.message)))}))}(r,n,s),a=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return s?function(e,t){if($i(),!ji)return t(null);ji.then((i=>{let r=Fi(e.url,{persistentParams:Vi});const n=e.headers.get("Range");n&&(r=Li(r,{range:n})),i.match(r).then((e=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=xi(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(e);i.delete(r),n&&i.put(r,e.clone()),t(null,e,n)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{o=!0,a||i.abort()}}}(e,t);if(yi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const r in e.headers)i.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===e.type)try{r=JSON.parse(i.response)}catch(e){return t(e)}t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new er(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},rr=function(e,t){return ir(ii(e,{type:"arrayBuffer"}),t)};function nr(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const ar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let or,sr;or=[],sr=0;const lr=function(e,t){if(Hi.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),sr>=r.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return or.push(i),i}sr++;let i=!1;const n=()=>{if(!i)for(i=!0,sr--;or.length&&sr<r.MAX_PARALLEL_IMAGE_REQUESTS;){const e=or.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=lr(t,i).cancel)}},a=rr(e,((e,i,r,a)=>{n(),e?t(e):i&&(self.createImageBitmap?function(e,t){const i=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(i).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((e,i)=>t(e,i,r,a))):function(e,t){const i=new Image;i.onload=()=>{t(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=ar}))},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(r):ar}(i,((e,i)=>t(e,i,r,a))))}));return{cancel:()=>{a.cancel(),n()}}},cr="01",hr="NO_ACCESS_TOKEN",ur=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dr(e){const t=e.match(ur);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function pr(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const fr="mapbox.eventData";function mr(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class gr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=mr(r.ACCESS_TOKEN);let i="";return i=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):r.ACCESS_TOKEN||"",e?`${fr}.${e}:${i}`:`${fr}:${i}`}fetchEventData(){const e=ki("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const r=localStorage.getItem(i);r&&(this.anonId=r)}catch(e){fi("Unable to read from LocalStorage")}}saveEventData(){const e=ki("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(e&&r)try{localStorage.setItem(i,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){fi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,n){if(!r.EVENTS_URL)return;const a=dr(r.EVENTS_URL);a.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString()},s=t?ii(o,t):o,l={url:pr(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return ir(ii(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const _r=new class extends gr{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){r.EVENTS_URL&&r.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>a(e)||n(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=mr(r.ACCESS_TOKEN),n=i?i.u:r.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;si(this.anonId)||(this.anonId=ai(),a=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),i=(o-this.eventData.lastSuccess)/864e5;a=a||i>=1||i<-1||e.getDate()!==t.getDate()}else a=!0;a?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:cr,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=n)}),e):this.processRequests()}},yr=_r.postTurnstileEvent.bind(_r),xr=new class extends gr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,r.EVENTS_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(hr)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),si(this.anonId)||(this.anonId=ai()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:cr,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):i&&(this.success[i]=!0)}),e))}remove(){this.errorCb=null}},vr=xr.postMapLoadEvent.bind(xr),br=new class extends gr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(e){let t=this.mapInstanceIdMap.get(e);return t||(t=ai(),this.mapInstanceIdMap.set(e,t)),t}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(e,t){const{map:i,style:n,importedStyles:a}=t;if(!r.EVENTS_URL||!e&&!r.ACCESS_TOKEN)return;const o=this.getMapInstanceId(i),s={mapInstanceId:o,eventId:this.getEventId(o),style:n};a.length&&(s.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:s},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,(()=>{}),e)}},wr=br.postStyleLoadEvent.bind(br),Sr=new class extends gr{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){r.EVENTS_URL&&(e||r.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:r}=this.queue.shift(),n=function(e){const i=performance.getEntriesByType("resource"),r=performance.getEntriesByType("mark"),n=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const r of e[i]){const e=`${i}ResolveRangeMin`,n=`${i}ResolveRangeMax`,a=`${i}RequestCount`,o=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,r.startTime),t[n]=Math.max(t[n]||-1/0,r.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==r.transferSize&&0===r.transferSize&&s(o),s(a)}return t}(function(e,t){const i={};if(e)for(const r of e){const e=t(r);void 0===i[e]&&(i[e]=[]),i[e].push(r)}return i}(i,u)),a=window.devicePixelRatio,o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=o?o.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const t in n)d(h.counters,t,n[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",e.interactionRange[0]),d(h.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const t of Object.keys(c)){const e=c[t],i=r.find((t=>t.name===e));i&&d(h.counters,e,i.startTime)}return d(h.counters,"visibilityHidden",e.visibilityHidden),d(h.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(l(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(i)),d(h.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",e.fogEnabled?"true":"false"),d(h.attributes,"projection",e.projection),d(h.attributes,"zoom",e.zoom),d(h.metadata,"devicePixelRatio",a),d(h.metadata,"connectionEffectiveType",s),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",e.width/a),d(h.metadata,"mapHeight",e.height/a),d(h.metadata,"webglRenderer",e.renderer),d(h.metadata,"webglVendor",e.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(r);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(i,n,(()=>{}),e)}},Er=Sr.postPerformanceEvent.bind(Sr),Tr=new class extends gr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!r.API_URL||!r.SESSION_PATH)return;const a=dr(r.API_URL+r.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${n||r.ACCESS_TOKEN||""}`);const o={url:pr(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return ir(ii(e,{method:"GET"}),t)}(o,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,r.SESSION_PATH&&r.API_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(hr)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},Cr=Tr.getSessionAPI.bind(Tr),kr=new Set;var Mr={exports:{}},Ar={exports:function(e,t){var i,r,n,a,o,s,l,c;for(r=e.length-(i=3&e.length),n=t,o=3432918353,s=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(a=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}},Pr={exports:function(e,t){for(var i,r=e.length,n=t^r,a=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}},Ir=Ar.exports,Dr=Pr.exports;Mr.exports=Ir,Mr.exports.murmur3=Ir,Mr.exports.murmur2=Dr;var Rr=d(Mr.exports);class zr{constructor(e){ii(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class Lr extends zr{constructor(e){super("error",ii({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}function Fr(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Br(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class Or{on(e,t){return this._listeners=this._listeners||{},Fr(e,t,this._listeners),this}off(e,t){return Br(e,t,this._listeners),Br(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Fr(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){const i="string"==typeof e?new zr(e,t):e,r=i.type;if(this.listens(r)){i.target=this;const e=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of e)r.call(this,i);const t=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const a of t)Br(r,a,this._oneTimeListeners),a.call(this,i);const n=this._eventedParent;n&&(ii(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(i))}else i instanceof Lr&&console.error(i.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}e.G=void 0;var Nr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Vr(e){return(e=Math.round(e))<0?0:e>255?255:e}function jr(e){return Vr("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Ur(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Gr(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{e.G={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in Nr)return Nr[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var a=i.substr(0,r),o=i.substr(r+1,n-(r+1)).split(","),s=1;switch(a){case"rgba":if(4!==o.length)return null;s=Ur(o.pop());case"rgb":return 3!==o.length?null:[jr(o[0]),jr(o[1]),jr(o[2]),s];case"hsla":if(4!==o.length)return null;s=Ur(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,c=Ur(o[1]),h=Ur(o[2]),u=h<=.5?h*(c+1):h+c-h*c,d=2*h-u;return[Vr(255*Gr(d,u,l+1/3)),Vr(255*Gr(d,u,l)),Vr(255*Gr(d,u,l-1/3)),s];default:return null}}return null}}catch(e){}class $r{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=i,this.a=r}static parse(t){if(!t)return;if(t instanceof $r)return t;if("string"!=typeof t)return;const i=e.G(t);return i?new $r(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,t,i,r]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toRenderColor(e){const{r:t,g:i,b:r,a:n}=this;return new qr(e,t,i,r,n)}}class qr{constructor(e,t,i,r,n){if(e){const a=e.image.height,o=a*a;t=0===n?0:t/n*(a-1),i=0===n?0:i/n*(a-1),r=0===n?0:r/n*(a-1);const s=Math.floor(t),l=Math.floor(i),c=Math.floor(r),h=Math.ceil(t),u=Math.ceil(i),d=Math.ceil(r),p=t-s,f=i-l,m=r-c,g=e.image.data,_=4*(s+l*o+c*a),y=4*(s+l*o+d*a),x=4*(s+u*o+c*a),v=4*(s+u*o+d*a),b=4*(h+l*o+c*a),w=4*(h+l*o+d*a),S=4*(h+u*o+c*a),E=4*(h+u*o+d*a);if(_<0||E>=g.length)throw new Error("out of range");this.r=Hr(Hr(Hr(g[_],g[y],m),Hr(g[x],g[v],m),f),Hr(Hr(g[b],g[w],m),Hr(g[S],g[E],m),f),p)/255*n,this.g=Hr(Hr(Hr(g[_+1],g[y+1],m),Hr(g[x+1],g[v+1],m),f),Hr(Hr(g[b+1],g[w+1],m),Hr(g[S+1],g[E+1],m),f),p)/255*n,this.b=Hr(Hr(Hr(g[_+2],g[y+2],m),Hr(g[x+2],g[v+2],m),f),Hr(Hr(g[b+2],g[w+2],m),Hr(g[S+2],g[E+2],m),f),p)/255*n,this.a=n}else this.r=t,this.g=i,this.b=r,this.a=n}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}toArray01(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01Scaled(e){const{r:t,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[t/n*e,i/n*e,r/n*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}toArray01Linear(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(t/r,2.2),Math.pow(i/r,2.2),r]}}function Hr(e,t,i){return e*(1-i)+t*i}function Wr(e,t,i){return e.map(((e,r)=>Hr(e,t[r],i)))}$r.black=new $r(0,0,0,1),$r.white=new $r(1,1,1,1),$r.transparent=new $r(0,0,0,0),$r.red=new $r(1,0,0,1),$r.blue=new $r(0,0,1,1);var Zr=Object.freeze({__proto__:null,array:Wr,color:function(e,t,i){return new $r(Hr(e.r,t.r,i),Hr(e.g,t.g,i),Hr(e.b,t.b,i),Hr(e.a,t.a,i))},number:Hr});function Xr(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(const n of i)for(const t in n)e[t]=n[t];return e}class Yr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Jr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[i,r]of t)this.bindings[i]=r}concat(e){return new Jr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Qr={kind:"null"},Kr={kind:"number"},en={kind:"string"},tn={kind:"boolean"},rn={kind:"color"},nn={kind:"object"},an={kind:"value"},on={kind:"collator"},sn={kind:"formatted"},ln={kind:"resolvedImage"};function cn(e,t){return{kind:"array",itemType:e,N:t}}function hn(e){if("array"===e.kind){const t=hn(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const un=[Qr,Kr,en,tn,rn,sn,nn,cn(an),ln];function dn(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!dn(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of un)if(!dn(e,t))return null}return`Expected ${hn(e)} but found ${hn(t)} instead.`}function pn(e,t){return t.some((t=>t.kind===e.kind))}function fn(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class mn{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gn{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class _n{constructor(e){this.sections=e}static fromString(e){return new _n([new gn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof _n?e:_n.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toRenderColor(null).toArray())),e.push(i)}return e}}class yn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new yn({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function xn(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof $r)return!0;if(e instanceof mn)return!0;if(e instanceof _n)return!0;if(e instanceof yn)return!0;if(Array.isArray(e)){for(const t of e)if(!vn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!vn(e[t]))return!1;return!0}return!1}function bn(e){if(null===e)return Qr;if("string"==typeof e)return en;if("boolean"==typeof e)return tn;if("number"==typeof e)return Kr;if(e instanceof $r)return rn;if(e instanceof mn)return on;if(e instanceof _n)return sn;if(e instanceof yn)return ln;if(Array.isArray(e)){const t=e.length;let i;for(const r of e){const e=bn(r);if(i){if(i===e)continue;i=an;break}i=e}return cn(i||an,t)}return nn}function wn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof $r||e instanceof _n||e instanceof yn?e.toString():JSON.stringify(e)}class Sn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!vn(e[1]))return t.error("invalid value");const i=e[1];let r=bn(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Sn(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $r?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof _n?this.value.serialize():this.value}}class En{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Tn={string:en,number:Kr,boolean:tn,object:nn};class Cn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,a;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Tn)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Tn[i],r++}else n=an;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],r++}i=cn(n,a)}else i=Tn[n];const a=[];for(;r<e.length;r++){const i=t.parse(e[r],r,an);if(!i)return null;a.push(i)}return new Cn(i,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!dn(this.type,bn(i)))return i;if(t===this.args.length-1)throw new En(`The expression ${JSON.stringify(this.args[t].serialize())} evaluated to ${hn(bn(i))} but was expected to be of type ${hn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class kn{constructor(e){this.type=sn,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let a=1;a<=e.length-1;++a){const i=e[a];if(n&&"object"==typeof i&&!Array.isArray(i)){n=!1;let e=null;if(i["font-scale"]&&(e=t.parse(i["font-scale"],1,Kr),!e))return null;let a=null;if(i["text-font"]&&(a=t.parse(i["text-font"],1,cn(en)),!a))return null;let o=null;if(i["text-color"]&&(o=t.parse(i["text-color"],1,rn),!o))return null;const s=r[r.length-1];s.scale=e,s.font=a,s.textColor=o}else{const i=t.parse(e[a],1,an);if(!i)return null;const o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:i,scale:null,font:null,textColor:null})}}return new kn(r)}evaluate(e){return new _n(this.sections.map((t=>{const i=t.content.evaluate(e);return bn(i)===ln?new gn("",i,null,null,null):new gn(wn(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Mn{constructor(e,t){this.type=ln,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const i=t.parse(e[1],1,en);if(!i)return t.error("No image name provided.");if(2===e.length)return new Mn(i);const r=t.parse(e[2],1,en);return r?new Mn(i,r):t.error("Secondary image variant is not a string.")}evaluate(e){const t=yn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function An(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Pn={"to-boolean":tn,"to-color":rn,"to-number":Kr,"to-string":en};class In{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],r=[];let n=Qr;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);n=cn(t.expectedType.itemType,i)}else{if(!(i>0&&vn(e[1][0])))return null;n=cn(bn(e[1][0]),i)}for(let a=0;a<i;a++){const i=e[1][a];let o;if("array"===An(i))o=t.parse(i,void 0,n.itemType);else{const e=An(i);if(e!==n.itemType.kind)return t.error(`Expected ${n.itemType.kind} but found ${e}.`);o=t.registry.literal.parse(["literal",void 0===i?null:i],t)}if(!o)return null;r.push(o)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");n=Pn[i];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,an);if(!n)return null;r.push(n)}}return new In(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof $r)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:xn(t[0],t[1],t[2],t[3]),!i))return new $r(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new En(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new En(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?_n.fromString(wn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?yn.fromString(wn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):wn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new kn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Mn(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Dn=["Unknown","Point","LineString","Polygon"];class Rn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Dn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=$r.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class zn{constructor(e,t,i,r,n){this.name=e,this.type=t,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=zn.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=zn.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=[];let s=null,l=-1;for(const[c,h]of a){if(Array.isArray(c)&&c.length!==e.length-1)continue;o.push(c),l++,s=new eo(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const r=[];let a=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(c)?c[t-1]:c.type,o=s.parse(i,1+r.length,n);if(!o){a=!0;break}r.push(o)}if(!a)if(Array.isArray(c)&&c.length!==r.length)s.error(`Expected ${c.length} arguments, but found ${r.length} instead.`);else{for(let e=0;e<r.length;e++){const t=Array.isArray(c)?c[e]:c.type,i=r[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new zn(i,n,h,r,l)}}if(1===o.length)t.errors.push(...s.errors);else{const i=(o.length?o:a.map((e=>{let[t]=e;return t}))).map(Ln).join(" | "),r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],1+r.length);if(!i)return null;r.push(hn(i.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){zn.definitions=t;for(const i in t)e[i]=zn}}function Ln(e){return Array.isArray(e)?`(${e.map(hn).join(", ")})`:`(${hn(e.type)}...)`}class Fn{constructor(e,t,i){this.type=on,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,tn);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,tn);if(!n)return null;let a=null;return i.locale&&(a=t.parse(i.locale,1,en),!a)?null:new Fn(r,n,a)}evaluate(e){return new mn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Bn(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Nn;for(;r>i;){if(r-i>600){const a=r-i+1,o=t-i+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Bn(e,t,Math.max(i,Math.floor(t-o*l/a+c)),Math.min(r,Math.floor(t+(a-o)*l/a+c)),n)}const a=e[t];let o=i,s=r;for(On(e,i,t),n(e[r],a)>0&&On(e,i,r);o<s;){for(On(e,o,s),o++,s--;n(e[o],a)<0;)o++;for(;n(e[s],a)>0;)s--}0===n(e[i],a)?On(e,i,s):(s++,On(e,s,r)),s<=t&&(i=s+1),t<=s&&(r=s-1)}}function On(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Nn(e,t){return e<t?-1:e>t?1:0}function Vn(e){let t=0;for(let i,r,n=0,a=e.length,o=a-1;n<a;o=n++)i=e[n],r=e[o],t+=(r.x-i.x)*(i.y+r.y);return t}function jn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Un(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Gn(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],a=e[0]-i[0],o=e[1]-i[1];return r*o-a*n==0&&r*a<=0&&n*o<=0}function $n(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,c=s-1;t<s;c=t++){const s=l[c],h=l[t];if(Gn(e,s,h))return i;(a=s)[1]>(n=e)[1]!=(o=h)[1]>n[1]&&n[0]<(o[0]-a[0])*(n[1]-a[1])/(o[1]-a[1])+a[0]&&(r=!r)}}var n,a,o;return r}function qn(e,t,i,r){const n=r[0]-i[0],a=r[1]-i[1],o=(e[0]-i[0])*a-n*(e[1]-i[1]),s=(t[0]-i[0])*a-n*(t[1]-i[1]);return o>0&&s<0||o<0&&s>0}function Hn(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(a=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*a[0]&&!(!qn(e,t,i,r)||!qn(i,r,e,t));var n,a}const Wn=8192;function Zn(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*Wn),Math.round(r*n*Wn)]}function Xn(e,t){for(let i=0;i<t.length;i++)if($n(e,t[i]))return!0;return!1}function Yn(e,t,i){for(const r of i)for(let i=0,n=r.length,a=n-1;i<n;a=i++)if(Hn(e,t,r[a],r[i]))return!0;return!1}function Jn(e,t){for(let i=0;i<e.length;++i)if(!$n(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Yn(e[i],e[i+1],t))return!1;return!0}function Qn(e,t){for(let i=0;i<t.length;i++)if(Jn(e,t[i]))return!0;return!1}function Kn(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=[];for(let r=0;r<e[n].length;r++){const o=Zn(e[n][r],i);jn(t,o),a.push(o)}r.push(a)}return r}function ea(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=Kn(e[n],t,i);r.push(a)}return r}function ta(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}jn(t,e)}function ia(e,t,i,r){const n=Math.pow(2,r.z)*Wn,a=[r.x*Wn,r.y*Wn],o=[];if(!e)return o;for(const s of e)for(const e of s){const r=[e.x+a[0],e.y+a[1]];ta(r,t,i,n),o.push(r)}return o}function ra(e,t,i,r){const n=Math.pow(2,r.z)*Wn,a=[r.x*Wn,r.y*Wn],o=[];if(!e)return o;for(const l of e){const e=[];for(const i of l){const r=[i.x+a[0],i.y+a[1]];jn(t,r),e.push(r)}o.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of o)for(const r of e)ta(r,t,i,n)}var s;return o}class na{constructor(e,t){this.type=tn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(vn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new na(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new na(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new na(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const a=Kn(t.coordinates,r,n),o=ia(e.geometry(),i,r,n);if(!Un(i,r))return!1;for(const e of o)if(!$n(e,a))return!1}if("MultiPolygon"===t.type){const a=ea(t.coordinates,r,n),o=ia(e.geometry(),i,r,n);if(!Un(i,r))return!1;for(const e of o)if(!Xn(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const a=Kn(t.coordinates,r,n),o=ra(e.geometry(),i,r,n);if(!Un(i,r))return!1;for(const e of o)if(!Jn(e,a))return!1}if("MultiPolygon"===t.type){const a=ea(t.coordinates,r,n),o=ra(e.geometry(),i,r,n);if(!Un(i,r))return!1;for(const e of o)if(!Qn(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const aa={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},oa=1/298.257223563,sa=oa*(2-oa),la=Math.PI/180;class ca{static fromTile(e,t,i){const r=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),n=Math.atan(.5*(Math.exp(r)-Math.exp(-r)))/la;return new ca(n,i)}static get units(){return aa}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!aa[t])throw new Error(`Unknown unit ${t}. Use one of: ${Object.keys(aa).join(", ")}`);const i=6378.137*la*(t?aa[t]:1),r=Math.cos(e*la),n=1/(1-sa*(1-r*r)),a=Math.sqrt(n);this.kx=i*a*r,this.ky=i*a*n*(1-sa)}distance(e,t){const i=da(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)}bearing(e,t){const i=da(t[0]-e[0])*this.kx;return Math.atan2(i,(t[1]-e[1])*this.ky)/la}destination(e,t,i){const r=i*la;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)}offset(e,t,i){return[e[0]+t/this.kx,e[1]+i/this.ky]}lineDistance(e){let t=0;for(let i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}area(e){let t=0;for(let i=0;i<e.length;i++){const r=e[i];for(let e=0,n=r.length,a=n-1;e<n;a=e++)t+=da(r[e][0]-r[a][0])*(r[e][1]+r[a][1])*(i?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let i=0;if(t<=0)return e[0];for(let r=0;r<e.length-1;r++){const n=e[r],a=e[r+1],o=this.distance(n,a);if(i+=o,i>t)return ua(n,a,(t-(i-o))/o)}return e[e.length-1]}pointToSegmentDistance(e,t,i){let[r,n]=t,a=da(i[0]-r)*this.kx,o=(i[1]-n)*this.ky;if(0!==a||0!==o){const t=(da(e[0]-r)*this.kx*a+(e[1]-n)*this.ky*o)/(a*a+o*o);t>1?(r=i[0],n=i[1]):t>0&&(r+=a/this.kx*t,n+=o/this.ky*t)}return a=da(e[0]-r)*this.kx,o=(e[1]-n)*this.ky,Math.sqrt(a*a+o*o)}pointOnLine(e,t){let i=1/0,r=e[0][0],n=e[0][1],a=0,o=0;for(let s=0;s<e.length-1;s++){let l=e[s][0],c=e[s][1],h=da(e[s+1][0]-l)*this.kx,u=(e[s+1][1]-c)*this.ky,d=0;0===h&&0===u||(d=(da(t[0]-l)*this.kx*h+(t[1]-c)*this.ky*u)/(h*h+u*u),d>1?(l=e[s+1][0],c=e[s+1][1]):d>0&&(l+=h/this.kx*d,c+=u/this.ky*d)),h=da(t[0]-l)*this.kx,u=(t[1]-c)*this.ky;const p=h*h+u*u;p<i&&(i=p,r=l,n=c,a=s,o=d)}return{point:[r,n],index:a,t:Math.max(0,Math.min(1,o))}}lineSlice(e,t,i){let r=this.pointOnLine(i,e),n=this.pointOnLine(i,t);if(r.index>n.index||r.index===n.index&&r.t>n.t){const e=r;r=n,n=e}const a=[r.point],o=r.index+1,s=n.index;!ha(i[o],a[0])&&o<=s&&a.push(i[o]);for(let l=o+1;l<=s;l++)a.push(i[l]);return ha(i[s],n.point)||a.push(n.point),a}lineSliceAlong(e,t,i){let r=0;const n=[];for(let a=0;a<i.length-1;a++){const o=i[a],s=i[a+1],l=this.distance(o,s);if(r+=l,r>e&&0===n.length&&n.push(ua(o,s,(e-(r-l))/l)),r>=t)return n.push(ua(o,s,(t-(r-l))/l)),n;r>e&&n.push(s)}return n}bufferPoint(e,t){const i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[0]+r,e[1]+i]}bufferBBox(e,t){const i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[2]+r,e[3]+i]}insideBBox(e,t){return da(e[0]-t[0])>=0&&da(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function ha(e,t){return e[0]===t[0]&&e[1]===t[1]}function ua(e,t,i){const r=da(t[0]-e[0]);return[e[0]+r*i,e[1]+(t[1]-e[1])*i]}function da(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class pa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const a=r+1;if(a<this.length&&i(t[a],t[r])<0&&(r=a),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}}var fa=8192;function ma(e,t){return t.dist-e.dist}const ga=100,_a=50;function ya(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function xa(e){return e[1]-e[0]+1}function va(e,t){const i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function ba(e,t){if(e[0]>e[1])return[null,null];const i=xa(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===i)return[e,null];const t=Math.floor(i/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function wa(e,t){const i=[1/0,1/0,-1/0,-1/0];if(!va(t,e.length))return i;for(let r=t[0];r<=t[1];++r)jn(i,e[r]);return i}function Sa(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let r=0;r<e[i].length;++r)jn(t,e[i][r]);return t}function Ea(e,t,i){if(ya(e)||ya(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function Ta(e){return 360*e-180}function Ca(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ka(e,t){const i=Math.pow(2,t.z),r=(e.y/fa+t.y)/i;return[Ta((e.x/fa+t.x)/i),Ca(r)]}function Ma(e,t){const i=[];for(let r=0;r<e.length;++r)i.push(ka(e[r],t));return i}function Aa(e,t,i){const r=i.pointOnLine(t,e).point;return i.distance(e,r)}function Pa(e,t,i,r,n){const a=i.slice(r[0],r[1]+1);let o=1/0;for(let s=t[0];s<=t[1];++s)if(0===(o=Math.min(o,Aa(e[s],a,n))))return 0;return o}function Ia(e,t,i,r,n){const a=Math.min(n.pointToSegmentDistance(e,i,r),n.pointToSegmentDistance(t,i,r)),o=Math.min(n.pointToSegmentDistance(i,e,t),n.pointToSegmentDistance(r,e,t));return Math.min(a,o)}function Da(e,t,i,r,n){if(!va(t,e.length)||!va(r,i.length))return NaN;let a=1/0;for(let o=t[0];o<t[1];++o)for(let t=r[0];t<r[1];++t){if(Hn(e[o],e[o+1],i[t],i[t+1]))return 0;a=Math.min(a,Ia(e[o],e[o+1],i[t],i[t+1],n))}return a}function Ra(e,t,i,r,n){if(!va(t,e.length)||!va(r,i.length))return NaN;let a=1/0;for(let o=t[0];o<=t[1];++o)for(let t=r[0];t<=r[1];++t)if(0===(a=Math.min(a,n.distance(e[o],i[t]))))return a;return a}function za(e,t,i){if($n(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(e,n[t-1],n[0]))))return r;if(0===(r=Math.min(r,Aa(e,n,i))))return r}return r}function La(e,t,i,r){if(!va(t,e.length))return NaN;for(let a=t[0];a<=t[1];++a)if($n(e[a],i,!0))return 0;let n=1/0;for(let a=t[0];a<t[1];++a)for(const t of i)for(let i=0,o=t.length,s=o-1;i<o;s=i++){if(Hn(e[a],e[a+1],t[s],t[i]))return 0;n=Math.min(n,Ia(e[a],e[a+1],t[s],t[i],r))}return n}function Fa(e,t){for(const i of e)for(let e=0;e<=i.length-1;++e)if($n(i[e],t,!0))return!0;return!1}function Ba(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const n=Sa(e),a=Sa(t);if(r!==1/0&&Ea(n,a,i)>=r)return r;if(Un(n,a)){if(Fa(e,t))return 0}else if(Fa(t,e))return 0;let o=r;for(const s of e)for(let e=0,r=s.length,n=r-1;e<r;n=e++)for(const a of t)for(let t=0,r=a.length,l=r-1;t<r;l=t++){if(Hn(s[n],s[e],a[l],a[t]))return 0;o=Math.min(o,Ia(s[n],s[e],a[l],a[t],i))}return o}function Oa(e,t,i,r,n,a,o){if(null===a||null===o)return;const s=Ea(wa(r,a),wa(n,o),i);s<t&&e.push({dist:s,range1:a,range2:o})}function Na(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(r.distance(e[0],i[0][0]),n);if(0===a)return a;const o=new pa([{dist:0,range1:[0,e.length-1],range2:[0,0]}],ma),s=t?_a:ga,l=Sa(i);for(;o.length;){const n=o.pop();if(n.dist>=a)continue;const c=n.range1;if(xa(c)<=s){if(!va(c,e.length))return NaN;if(t){const t=La(e,c,i,r);if(0===(a=Math.min(a,t)))return a}else for(let t=c[0];t<=c[1];++t){const n=za(e[t],i,r);if(0===(a=Math.min(a,n)))return a}}else{const i=ba(c,t);if(null!==i[0]){const t=Ea(wa(e,i[0]),l,r);t<a&&o.push({dist:t,range1:i[0],range2:[0,0]})}if(null!==i[1]){const t=Ea(wa(e,i[1]),l,r);t<a&&o.push({dist:t,range1:i[1],range2:[0,0]})}}}return a}function Va(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,n.distance(e[0],i[0]));if(0===o)return o;const s=new pa([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],ma),l=t?_a:ga,c=r?_a:ga;for(;s.length;){const a=s.pop();if(a.dist>=o)continue;const h=a.range1,u=a.range2;if(xa(h)<=l&&xa(u)<=c){if(!va(h,e.length)||!va(u,i.length))return NaN;if(t&&r?o=Math.min(o,Da(e,h,i,u,n)):t||r?t&&!r?o=Math.min(o,Pa(i,u,e,h,n)):!t&&r&&(o=Math.min(o,Pa(e,h,i,u,n))):o=Math.min(o,Ra(e,h,i,u,n)),0===o)return o}else{const a=ba(h,t),l=ba(u,r);Oa(s,o,n,e,i,a[0],l[0]),Oa(s,o,n,e,i,a[0],l[1]),Oa(s,o,n,e,i,a[1],l[0]),Oa(s,o,n,e,i,a[1],l[1])}}return o}function ja(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=wa(e,[0,e.length-1]);for(const o of i)if(!(n!==1/0&&Ea(a,wa(o,[0,o.length-1]),r)>=n)&&(n=Math.min(n,Va(e,t,o,!0,r,n)),0===n))return n;return n}function Ua(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=wa(e,[0,e.length-1]);for(const o of i){if(n!==1/0&&Ea(a,Sa(o),r)>=n)continue;const i=Na(e,t,o,r,n);if(isNaN(i))return i;if(0===(n=Math.min(n,i)))return n}return n}function Ga(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class $a{constructor(e,t){this.type=Kr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(vn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(Ga(t.features[e].geometry.type))return new $a(t,t.features[e].geometry)}else if("Feature"===t.type){if(Ga(t.geometry.type))return new $a(t,t.geometry)}else if(Ga(t.type))return new $a(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),i=e.canonicalID();if(null!=t&&null!=i){if("Point"===e.geometryType())return function(e,t,i){const r=[];for(const a of e)for(const e of a)r.push(ka(e,t));const n=new ca(r[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?Va(r,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n):"MultiLineString"===i.type?ja(r,!1,i.coordinates,n):"Polygon"===i.type||"MultiPolygon"===i.type?Ua(r,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,n):null}(t,i,this.geometries);if("LineString"===e.geometryType())return function(e,t,i){const r=[];for(const a of e){const e=[];for(const i of a)e.push(ka(i,t));r.push(e)}const n=new ca(r[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return ja("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const a=ja(i.coordinates[t],!0,r,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}if("Polygon"===i.type||"MultiPolygon"===i.type){let e=1/0;for(let t=0;t<r.length;t++){const a=Ua(r[t],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return null}(t,i,this.geometries);if("Polygon"===e.geometryType())return function(e,t,i){const r=[];for(const a of function(e){const t=e.length;if(t<=1)return[e];const i=[];let r,n;for(let a=0;a<t;a++){const t=Vn(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===n&&(n=t<0),n===t<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(e)){const e=[];for(let i=0;i<a.length;++i)e.push(Ma(a[i],t));r.push(e)}const n=new ca(r[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Ua("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const a=Ua(i.coordinates[t],!0,r,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return"Polygon"===i.type||"MultiPolygon"===i.type?function(e,t,i){let r=1/0;for(const n of e)for(const e of t){const t=Ba(n,e,i,r);if(isNaN(t))return t;if(0===(r=Math.min(r,t)))return r}return r}("Polygon"===i.type?[i.coordinates]:i.coordinates,r,n):null}(t,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qa(e,t){switch(e){case"string":return wn(t);case"number":return+t;case"boolean":return!!t;case"color":return $r.parse(t);case"formatted":return _n.fromString(wn(t));case"resolvedImage":return yn.fromString(wn(t))}return t}function Ha(e,t,i,r){return void 0!==r&&(e=r*Math.round(e/r)),void 0!==t&&e<t&&(e=t),void 0!==i&&e>i&&(e=i),e}class Wa{constructor(e,t,i){this.type=e,this.key=t,this.scope=i}static parse(e,t){let i=t.expectedType;if(null==i&&(i=an),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const r=t.parse(e[1],1);if(!(r instanceof Sn))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const n=t.parse(e[2],2);return n instanceof Sn?new Wa(i,wn(r.value),wn(n.value)):t.error("Scope of 'config' expression must be a string literal.")}return new Wa(i,wn(r.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),i=e.getConfig(t);if(!i)return null;const{type:r,value:n,values:a,minValue:o,maxValue:s,stepValue:l}=i,c=i.default.evaluate(e);let h=c;if(n){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),h=n.evaluate(e),e.scope=t}return r&&(h=qa(r,h)),void 0===h||void 0===o&&void 0===s&&void 0===l||("number"==typeof h?h=Ha(h,o,s,l):Array.isArray(h)&&(h=h.map((e=>"number"==typeof e?Ha(e,o,s,l):e)))),void 0!==n&&void 0!==h&&a&&!a.includes(h)&&(h=c,r&&(h=qa(r,h))),(r&&r!==this.type||void 0!==h&&bn(h)!==this.type)&&(h=qa(this.type.kind,h)),h}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Za(e){if(e instanceof zn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof na)return!1;if(e instanceof $a)return!1;let t=!0;return e.eachChild((e=>{t&&!Za(e)&&(t=!1)})),t}function Xa(e){if(e instanceof zn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Xa(e)&&(t=!1)})),t}function Ya(e){if(e instanceof Wa)return new Set([e.key]);let t=new Set;return e.eachChild((e=>{t=new Set([...t,...Ya(e)])})),t}function Ja(e,t){if(e instanceof zn&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Ja(e,t)&&(i=!1)})),i}class Qa{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Qa(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ka{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Jr,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i,this._scope=a,this.options=o}parse(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||i?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new Cn(t,[e]):"coerce"===i?new In(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof e[0]?this.registry[e[0]]:void 0;if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Sn)&&"resolvedImage"!==n.type.kind&&to(n)){const t=new Rn(this._scope,this.options);try{n=new Sn(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return In.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Ka(this.registry,r,t||null,n,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];const n=`${this.key}${i.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Yr(n,e))}checkSubtype(e,t){const i=dn(e,t);return i&&this.error(i),i}}var eo=Ka;function to(e){if(e instanceof Qa)return to(e.boundExpression);if(e instanceof zn&&"error"===e.name)return!1;if(e instanceof Fn)return!1;if(e instanceof na)return!1;if(e instanceof $a)return!1;if(e instanceof Wa)return!1;const t=e instanceof In||e instanceof Cn;let i=!0;return e.eachChild((e=>{i=t?i&&to(e):i&&e instanceof Sn})),!!i&&Za(e)&&Ja(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function io(e,t){const i=e.length-1;let r,n,a=0,o=i,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),r=e[s],n=e[s+1],r<=t){if(s===i||t<n)return s;a=s+1}else{if(!(r>t))throw new En("Input is not a number.");o=s-1}return 0}class ro{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,n]of i)this.labels.push(r),this.outputs.push(n)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Kr);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let a=1;a<e.length;a+=2){const i=1===a?-1/0:e[a],o=e[a+1],s=a,l=a+1;if("number"!=typeof i)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=i)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(o,l,n);if(!c)return null;n=n||c.type,r.push([i,c])}return new ro(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[io(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const no=.95047,ao=1.08883,oo=4/29,so=6/29,lo=3*so*so,co=so*so*so,ho=Math.PI/180,uo=180/Math.PI;function po(e){return e>co?Math.pow(e,1/3):e/lo+oo}function fo(e){return e>so?e*e*e:lo*(e-oo)}function mo(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function go(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function _o(e){const t=go(e.r),i=go(e.g),r=go(e.b),n=po((.4124564*t+.3575761*i+.1804375*r)/no),a=po((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*a-16,a:500*(n-a),b:200*(a-po((.0193339*t+.119192*i+.9503041*r)/ao)),alpha:e.a}}function yo(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*fo(t),i=no*fo(i),r=ao*fo(r),new $r(mo(3.2404542*i-1.5371385*t-.4985314*r),mo(-.969266*i+1.8760108*t+.041556*r),mo(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function xo(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const vo={forward:_o,reverse:yo,interpolate:function(e,t,i){return{l:Hr(e.l,t.l,i),a:Hr(e.a,t.a,i),b:Hr(e.b,t.b,i),alpha:Hr(e.alpha,t.alpha,i)}}},bo={forward:function(e){const{l:t,a:i,b:r}=_o(e),n=Math.atan2(r,i)*uo;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ho,i=e.c;return yo({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:xo(e.h,t.h,i),c:Hr(e.c,t.c,i),l:Hr(e.l,t.l,i),alpha:Hr(e.alpha,t.alpha,i)}}};var wo=Object.freeze({__proto__:null,hcl:bo,lab:vo});class So{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[a,o]of n)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=Eo(t,e.base,i,r);else if("linear"===e.name)n=Eo(t,1,i,r);else if("cubic-bezier"===e.name){const a=e.controlPoints;n=new Ot(a[0],a[1],a[2],a[3]).solve(Eo(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...a]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Kr),!n)return null;const o=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=rn:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<a.length;l+=2){const e=a[l],i=a[l+1],r=l+3,n=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(o.length&&o[o.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(i,n,s);if(!c)return null;s=s||c.type,o.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new So(s,i,r,n,o):t.error(`Type ${hn(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const a=io(t,r),o=So.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=i[a].evaluate(e),l=i[a+1].evaluate(e);return"interpolate"===this.operator?Zr[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?bo.reverse(bo.interpolate(bo.forward(s),bo.forward(l),o)):vo.reverse(vo.interpolate(vo.forward(s),vo.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)t.push(this.labels[i],this.outputs[i].serialize());return t}}function Eo(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}class To{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const o of e.slice(1)){const e=t.parse(o,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const a=r&&n.some((e=>dn(r,e.type)));return new To(a?an:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof yn&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Co{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const a=t.parse(e[n+1],n+1);if(!a)return null;i.push([r,a])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Co(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class ko{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Kr),r=t.parse(e[2],2,cn(t.expectedType||an));return i&&r?new ko(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new En(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new En(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new En(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Mo{constructor(e,t){this.type=tn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,an),r=t.parse(e[2],2,an);return i&&r?pn(i.type,[tn,en,Kr,Qr,an])?new Mo(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!fn(t,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${hn(bn(t))} instead.`);if(!fn(i,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${hn(bn(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ao{constructor(e,t,i){this.type=Kr,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,an),r=t.parse(e[2],2,an);if(!i||!r)return null;if(!pn(i.type,[tn,en,Kr,Qr,an]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Kr);return n?new Ao(i,r,n):null}return new Ao(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!fn(t,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${hn(bn(t))} instead.`);if(!fn(i,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${hn(bn(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Po{constructor(e,t,i,r,n,a){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},a=[];for(let l=2;l<e.length-1;l+=2){let o=e[l];const s=e[l+1];Array.isArray(o)||(o=[o]);const c=t.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const e of o){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,bn(e)))return null}else i=bn(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=a.length}const h=t.parse(s,l,r);if(!h)return null;r=r||h.type,a.push(h)}const o=t.parse(e[1],1,an);if(!o)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==o.type.kind&&t.concat(1).checkSubtype(i,o.type)?null:new Po(i,r,o,n,a,s):null}evaluate(e){const t=this.input.evaluate(e);return(bn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const a of t){const e=r[this.cases[a]];void 0===e?(r[this.cases[a]]=i.length,i.push([this.cases[a],[a]])):i[e][1].push(a)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[a,o]of i)e.push(1===o.length?n(o[0]):o.map(n)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}class Io{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let a=1;a<e.length-1;a+=2){const n=t.parse(e[a],a,tn);if(!n)return null;const o=t.parse(e[a+1],a+1,i);if(!o)return null;r.push([n,o]),i=i||o.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new Io(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((e=>{let[t,i]=e;return i.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Do{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,an),r=t.parse(e[2],2,Kr);if(!i||!r)return null;if(!pn(i.type,[cn(an),en,an]))return t.error(`Expected first argument to be of type array or string, but found ${hn(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Kr);return n?new Do(i.type,i,r,n):null}return new Do(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!fn(t,["string","array"]))throw new En(`Expected first argument to be of type array or string, but found ${hn(bn(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ro(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function zo(e,t,i,r){return 0===r.compare(t,i)}function Lo(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=tn,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let a=t.parse(e[1],1,an);if(!a)return null;if(!Ro(i,a.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${hn(a.type)}'.`);let o=t.parse(e[2],2,an);if(!o)return null;if(!Ro(i,o.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${hn(o.type)}'.`);if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${hn(a.type)}' and '${hn(o.type)}'.`);r&&("value"===a.type.kind&&"value"!==o.type.kind?a=new Cn(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new Cn(a.type,[o])));let s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,on),!s)return null}return new n(a,o,s)}evaluate(n){const a=this.lhs.evaluate(n),o=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=bn(a),i=bn(o);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new En(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=bn(a),i=bn(o);if("string"!==e.kind||"string"!==i.kind)return t(n,a,o)}return this.collator?i(n,a,o,this.collator.evaluate(n)):t(n,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Fo=Lo("==",(function(e,t,i){return t===i}),zo),Bo=Lo("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!zo(0,t,i,r)})),Oo=Lo("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),No=Lo(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),Vo=Lo("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),jo=Lo(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class Uo{constructor(e,t,i,r,n,a){this.type=en,this.number=e,this.locale=t,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=a}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Kr);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,en),!n))return null;let a=null;if(r.currency&&(a=t.parse(r.currency,1,en),!a))return null;let o=null;if(r.unit&&(o=t.parse(r.unit,1,en),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,Kr),!s))return null;let l=null;return r["max-fraction-digits"]&&(l=t.parse(r["max-fraction-digits"],1,Kr),!l)?null:new Uo(i,n,a,o,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Go{constructor(e){this.type=Kr,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${hn(i.type)} instead.`):new Go(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new En(`Expected value to be of type string or array, but found ${hn(bn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function $o(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const qo={"==":Fo,"!=":Bo,">":No,"<":Oo,">=":jo,"<=":Vo,array:Cn,at:ko,boolean:Cn,case:Io,coalesce:To,collator:Fn,format:kn,image:Mn,in:Mo,"index-of":Ao,interpolate:So,"interpolate-hcl":So,"interpolate-lab":So,length:Go,let:Co,literal:Sn,match:Po,number:Cn,"number-format":Uo,object:Cn,slice:Do,step:ro,string:Cn,"to-boolean":In,"to-color":In,"to-number":In,"to-string":In,var:Qa,within:na,distance:$a,config:Wa};function Ho(e,t){let[i,r,n,a]=t;i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=a?a.evaluate(e):1,s=xn(i,r,n,o);if(s)throw new En(s);return new $r(i/255*o,r/255*o,n/255*o,o)}function Wo(e,t){let[i,r,n,a]=t;i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=a?a.evaluate(e):1,s=function(e,t,i,r){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'h' must be between 0 and 360.`}(i,r,n,o);if(s)throw new En(s);const l=`hsla(${i}, ${r}%, ${n}%, ${o})`,c=$r.parse(l);if(!c)throw new En(`Failed to parse HSLA color: ${l}`);return c}function Zo(e,t){return e in t}function Xo(e,t){const i=t[e];return void 0===i?null:i}function Yo(e){return{type:e}}function Jo(e){return{result:"success",value:e}}function Qo(e){return{result:"error",value:e}}function Ko(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function es(e){return"data-driven"===e["property-type"]}function ts(e){return Ko(e.expression,"measure-light")}function is(e){return Ko(e.expression,"zoom")}function rs(e){return!!e.expression&&e.expression.interpolated}function ns(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function as(e){return e}function os(e,t){const i="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||!(r||void 0!==e.property),a=e.type||(rs(t)?"exponential":"interval");if(i&&((e=Xr({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],$r.parse(e[1])]))),e.default=$r.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!wo[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let o,s,l;if("exponential"===a)o=hs;else if("interval"===a)o=cs;else if("categorical"===a){o=ls,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);o=us}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],a=n[0].zoom;void 0===i[a]&&(i[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},r.push(a)),i[a].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,os(i[e],t)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:So.interpolationFactor.bind(void 0,a),zoomStops:n.map((e=>e[0])),evaluate:(i,r)=>{let{zoom:a}=i;return hs({stops:n,base:e.base},t,a).evaluate(a,r)}}}if(n){const i="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:So.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:i=>{let{zoom:r}=i;return o(e,t,r,s,l)}}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?ss(e.default,t.default):o(e,t,n,s,l)}}}function ss(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function ls(e,t,i,r,n){return ss(typeof i===n?r[i]:void 0,e.default,t.default)}function cs(e,t,i){if("number"!==An(i))return ss(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=io(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function hs(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==An(i))return ss(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const a=io(e.stops.map((e=>e[0])),i),o=function(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1];let c=Zr[t.type]||as;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=wo[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),o))}return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return c(r,n,o)}}:c(s,l,o)}function us(e,t,i){return"color"===t.type?i=$r.parse(i):"formatted"===t.type?i=_n.fromString(i.toString()):"resolvedImage"===t.type?i=yn.fromString(i.toString()):An(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),ss(i,e.default,t.default)}zn.register(qo,{error:[{kind:"error"},[en],(e,t)=>{let[i]=t;throw new En(i.evaluate(e))}],typeof:[en,[an],(e,t)=>{let[i]=t;return hn(bn(i.evaluate(e)))}],"to-rgba":[cn(Kr,4),[rn],(e,t)=>{let[i]=t;return i.evaluate(e).toRenderColor(null).toArray()}],rgb:[rn,[Kr,Kr,Kr],Ho],rgba:[rn,[Kr,Kr,Kr,Kr],Ho],hsl:[rn,[Kr,Kr,Kr],Wo],hsla:[rn,[Kr,Kr,Kr,Kr],Wo],has:{type:tn,overloads:[[[en],(e,t)=>{let[i]=t;return Zo(i.evaluate(e),e.properties())}],[[en,nn],(e,t)=>{let[i,r]=t;return Zo(i.evaluate(e),r.evaluate(e))}]]},get:{type:an,overloads:[[[en],(e,t)=>{let[i]=t;return Xo(i.evaluate(e),e.properties())}],[[en,nn],(e,t)=>{let[i,r]=t;return Xo(i.evaluate(e),r.evaluate(e))}]]},"feature-state":[an,[en],(e,t)=>{let[i]=t;return Xo(i.evaluate(e),e.featureState||{})}],properties:[nn,[],e=>e.properties()],"geometry-type":[en,[],e=>e.geometryType()],id:[an,[],e=>e.id()],zoom:[Kr,[],e=>e.globals.zoom],pitch:[Kr,[],e=>e.globals.pitch||0],"distance-from-center":[Kr,[],e=>e.distanceFromCenter()],"measure-light":[Kr,[en],(e,t)=>{let[i]=t;return e.measureLight(i.evaluate(e))}],"heatmap-density":[Kr,[],e=>e.globals.heatmapDensity||0],"line-progress":[Kr,[],e=>e.globals.lineProgress||0],"raster-value":[Kr,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[Kr,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[Kr,[],e=>e.globals.skyRadialProgress||0],accumulated:[an,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Kr,Yo(Kr),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Kr,Yo(Kr),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Kr,overloads:[[[Kr,Kr],(e,t)=>{let[i,r]=t;return i.evaluate(e)-r.evaluate(e)}],[[Kr],(e,t)=>{let[i]=t;return-i.evaluate(e)}]]},"/":[Kr,[Kr,Kr],(e,t)=>{let[i,r]=t;return i.evaluate(e)/r.evaluate(e)}],"%":[Kr,[Kr,Kr],(e,t)=>{let[i,r]=t;return i.evaluate(e)%r.evaluate(e)}],ln2:[Kr,[],()=>Math.LN2],pi:[Kr,[],()=>Math.PI],e:[Kr,[],()=>Math.E],"^":[Kr,[Kr,Kr],(e,t)=>{let[i,r]=t;return Math.pow(i.evaluate(e),r.evaluate(e))}],sqrt:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.sqrt(i.evaluate(e))}],log10:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))/Math.LN10}],ln:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))}],log2:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))/Math.LN2}],sin:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.sin(i.evaluate(e))}],cos:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.cos(i.evaluate(e))}],tan:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.tan(i.evaluate(e))}],asin:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.asin(i.evaluate(e))}],acos:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.acos(i.evaluate(e))}],atan:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.atan(i.evaluate(e))}],min:[Kr,Yo(Kr),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Kr,Yo(Kr),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.abs(i.evaluate(e))}],round:[Kr,[Kr],(e,t)=>{let[i]=t;const r=i.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.floor(i.evaluate(e))}],ceil:[Kr,[Kr],(e,t)=>{let[i]=t;return Math.ceil(i.evaluate(e))}],"filter-==":[tn,[en,an],(e,t)=>{let[i,r]=t;return e.properties()[i.value]===r.value}],"filter-id-==":[tn,[an],(e,t)=>{let[i]=t;return e.id()===i.value}],"filter-type-==":[tn,[en],(e,t)=>{let[i]=t;return e.geometryType()===i.value}],"filter-<":[tn,[en,an],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[tn,[an],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[tn,[en,an],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[tn,[an],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[tn,[en,an],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[tn,[an],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[tn,[en,an],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[tn,[an],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[tn,[an],(e,t)=>{let[i]=t;return i.value in e.properties()}],"filter-has-id":[tn,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[tn,[cn(en)],(e,t)=>{let[i]=t;return i.value.indexOf(e.geometryType())>=0}],"filter-id-in":[tn,[cn(an)],(e,t)=>{let[i]=t;return i.value.indexOf(e.id())>=0}],"filter-in-small":[tn,[en,cn(an)],(e,t)=>{let[i,r]=t;return r.value.indexOf(e.properties()[i.value])>=0}],"filter-in-large":[tn,[en,cn(an)],(e,t)=>{let[i,r]=t;return function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[i.value],r.value,0,r.value.length-1)}],all:{type:tn,overloads:[[[tn,tn],(e,t)=>{let[i,r]=t;return i.evaluate(e)&&r.evaluate(e)}],[Yo(tn),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(e,t)=>{let[i,r]=t;return i.evaluate(e)||r.evaluate(e)}],[Yo(tn),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[tn,[tn],(e,t)=>{let[i]=t;return!i.evaluate(e)}],"is-supported-script":[tn,[en],(e,t)=>{let[i]=t;const r=e.globals&&e.globals.isSupportedScript;return!r||r(i.evaluate(e))}],upcase:[en,[en],(e,t)=>{let[i]=t;return i.evaluate(e).toUpperCase()}],downcase:[en,[en],(e,t)=>{let[i]=t;return i.evaluate(e).toLowerCase()}],concat:[en,Yo(an),(e,t)=>t.map((t=>wn(t.evaluate(e)))).join("")],"resolved-locale":[en,[on],(e,t)=>{let[i]=t;return i.evaluate(e).resolvedLocale()}],random:[Kr,[Kr,Kr,an],(e,t)=>{const[i,r,n]=t.map((t=>t.evaluate(e)));if(i>r)return i;if(i===r)return i;let a;if("string"==typeof n)a=function(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}(n);else{if("number"!=typeof n)throw new En(`Invalid seed input: ${n}`);a=n}return i+$o(a)()*(r-i)}]});class ds{constructor(e,t,i,r){this.expression=e,this._warningHistory={},this._evaluator=new Rn(i,r),this._defaultValue=t?function(e){return"color"===e.type&&(ns(e.default)||Array.isArray(e.default))?new $r(0,0,0,0):"color"===e.type?$r.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,a,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,a,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${e.message}`)),this._defaultValue}}}function ps(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in qo}function fs(e,t,i,r){const n=new eo(qo,[],t?function(e){const t={color:rn,string:en,number:Kr,enum:en,boolean:tn,formatted:sn,resolvedImage:ln};return"array"===e.type?cn(t[e.value]||an,e.length):t[e.type]}(t):void 0,void 0,void 0,i,r),a=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?Jo(new ds(a,t,i,r)):Qo(n.errors)}class ms{constructor(e,t,i){this.kind=e,this._styleExpression=t,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!Xa(t.expression),this.configDependencies=Ya(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}}class gs{constructor(e,t,i,r,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Xa(t.expression),this.isLightConstant=n,this.configDependencies=Ya(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}interpolationFactor(e,t,i){return this.interpolationType?So.interpolationFactor(this.interpolationType,e,t,i):0}}function _s(e,t,i,r){if("error"===(e=fs(e,t,i,r)).result)return e;const n=e.value.expression,a=Za(n);if(!a&&!es(t))return Qo([new Yr("","data expressions not supported")]);const o=Ja(n,["zoom","pitch","distance-from-center"]);if(!o&&!is(t))return Qo([new Yr("","zoom expressions not supported")]);const s=Ja(n,["measure-light"]);if(!s&&!ts(t))return Qo([new Yr("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=xs(n);return c||o||l?c instanceof Yr?Qo([c]):c instanceof So&&!rs(t)?Qo([new Yr("",'"interpolate" expressions cannot be used with this property')]):Jo(c?new gs(a?"camera":"composite",e.value,c.labels,c instanceof So?c.interpolation:void 0,s):new ms(a?"constant":"source",e.value,s)):Qo([new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ys{constructor(e,t){this._parameters=e,this._specification=t,Xr(this,os(this._parameters,this._specification))}static deserialize(e){return new ys(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function xs(e){let t=null;if(e instanceof Co)t=xs(e.result);else if(e instanceof To){for(const i of e.args)if(t=xs(i),t)break}else(e instanceof ro||e instanceof So)&&e.input instanceof zn&&"zoom"===e.input.name&&(t=e);return t instanceof Yr||e.eachChild((e=>{const i=xs(e);i instanceof Yr?t=i:t&&i&&t!==i&&(t=new Yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var vs=ws,bs=3;function ws(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var a=0;a<this.d*this.d;a++){var o=n[bs+a],s=n[bs+a+1];r.push(o===s?null:n.subarray(o,s))}var l=n[bs+r.length+1];this.keys=n.subarray(n[bs+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var h=i/t*e;this.min=-h,this.max=e+h}ws.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},ws.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ws.prototype._insertCell=function(e,t,i,r,n,a){this.cells[n].push(a)},ws.prototype.query=function(e,t,i,r,n){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=i&&o<=r&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,r,this._queryCell,s,{},n),s},ws.prototype._queryCell=function(e,t,i,r,n,a,o,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,h=this.bboxes,u=0;u<l.length;u++){var d=l[u];if(void 0===o[d]){var p=4*d;(s?s(h[p+0],h[p+1],h[p+2],h[p+3]):e<=h[p+2]&&t<=h[p+3]&&i>=h[p+0]&&r>=h[p+1])?(o[d]=!0,a.push(c[d])):o[d]=!1}}},ws.prototype._forEachCell=function(e,t,i,r,n,a,o,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(i),u=this._convertToCellCoord(r),d=l;d<=h;d++)for(var p=c;p<=u;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,a,o,s))return}},ws.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ws.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ws.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=bs+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];n[bs+o]=a,n.set(s,a),a+=s.length}return n[bs+e.length]=a,n.set(this.keys,a),n[bs+e.length+1]=a+=this.keys.length,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};var Ss=d(vs);const Es={};function Ts(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),Es[t]={klass:e,omit:i.omit||[]}}Ts(Object,"Object"),Ss.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},Ss.deserialize=function(e){return new Ss(e.buffer)},Object.defineProperty(Ss,"name",{value:"Grid"}),Ts(Ss,"Grid"),Ts($r,"Color"),Ts(Error,"Error"),Ts(_n,"Formatted"),Ts(gn,"FormattedSection"),Ts(er,"AJAXError"),Ts(yn,"ResolvedImage"),Ts(ys,"StylePropertyFunction"),Ts(ds,"StyleExpression",{omit:["_evaluator"]}),Ts(gs,"ZoomDependentExpression"),Ts(ms,"ZoomConstantExpression"),Ts(zn,"CompoundExpression",{omit:["_evaluate"]});for(const Tb in qo)Es[qo[Tb]._classRegistryKey]||Ts(qo[Tb],`Expression${Tb}`);function Cs(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ks(e){return self.ImageBitmap&&e instanceof ImageBitmap}function Ms(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Cs(e)||ks(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.add(i.buffer),i}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(Ms(r,t));return i}if(e instanceof Map){const t={$name:"Map"};for(const[i,r]of e.entries())t[i]=Ms(r);return t}if(e instanceof Set){const t={$name:"Set"};let i=0;for(const r of e.values())t[++i]=Ms(r);return t}if("object"==typeof e){const i=e.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const i in e)e.hasOwnProperty(i)&&(Es[r].omit.indexOf(i)>=0||(n[i]=Ms(e[i],t)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof e)}function As(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Cs(e)||ks(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(As);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const i of Object.keys(e))"$name"!==i&&t.set(i,As(e[i]));return t}if("Set"===t){const t=new Set;for(const i of Object.keys(e))"$name"!==i&&t.add(As(e[i]));return t}const{klass:i}=Es[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const n of Object.keys(e))"$name"!==n&&(r[n]=As(e[n]));return r}throw new Error("can't deserialize object of type "+typeof e)}const Ps={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Is(e){for(const t of e)if(zs(t.charCodeAt(0)))return!0;return!1}function Ds(e){for(const t of e)if(!Rs(t.charCodeAt(0)))return!1;return!0}function Rs(e){return!(Ps.Arabic(e)||Ps["Arabic Supplement"](e)||Ps["Arabic Extended-A"](e)||Ps["Arabic Presentation Forms-A"](e)||Ps["Arabic Presentation Forms-B"](e))}function zs(e){return!(746!==e&&747!==e&&(e<4352||!(Ps["Bopomofo Extended"](e)||Ps.Bopomofo(e)||Ps["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Ps["CJK Compatibility Ideographs"](e)||Ps["CJK Compatibility"](e)||Ps["CJK Radicals Supplement"](e)||Ps["CJK Strokes"](e)||!(!Ps["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Ps["CJK Unified Ideographs Extension A"](e)||Ps["CJK Unified Ideographs"](e)||Ps["Enclosed CJK Letters and Months"](e)||Ps["Hangul Compatibility Jamo"](e)||Ps["Hangul Jamo Extended-A"](e)||Ps["Hangul Jamo Extended-B"](e)||Ps["Hangul Jamo"](e)||Ps["Hangul Syllables"](e)||Ps.Hiragana(e)||Ps["Ideographic Description Characters"](e)||Ps.Kanbun(e)||Ps["Kangxi Radicals"](e)||Ps["Katakana Phonetic Extensions"](e)||Ps.Katakana(e)&&12540!==e||!(!Ps["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Ps["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Ps["Unified Canadian Aboriginal Syllabics"](e)||Ps["Unified Canadian Aboriginal Syllabics Extended"](e)||Ps["Vertical Forms"](e)||Ps["Yijing Hexagram Symbols"](e)||Ps["Yi Syllables"](e)||Ps["Yi Radicals"](e))))}function Ls(e){return!(zs(e)||function(e){return!!(Ps["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Ps["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Ps["Letterlike Symbols"](e)||Ps["Number Forms"](e)||Ps["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ps["Control Pictures"](e)&&9251!==e||Ps["Optical Character Recognition"](e)||Ps["Enclosed Alphanumerics"](e)||Ps["Geometric Shapes"](e)||Ps["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ps["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ps["CJK Symbols and Punctuation"](e)||Ps.Katakana(e)||Ps["Private Use Area"](e)||Ps["CJK Compatibility Forms"](e)||Ps["Small Form Variants"](e)||Ps["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Fs(e){return e>=1424&&e<=2303||Ps["Arabic Presentation Forms-A"](e)||Ps["Arabic Presentation Forms-B"](e)}function Bs(e,t){return!(!t&&Fs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Ps.Khmer(e))}function Os(e){for(const t of e)if(Fs(t.charCodeAt(0)))return!0;return!1}const Ns="deferred",Vs="loading",js="loaded";let Us=null,Gs="unavailable",$s=null;const qs=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Gs="error"),Us&&Us(e)};function Hs(){Ws.fire(new zr("pluginStateChange",{pluginStatus:Gs,pluginURL:$s}))}const Ws=new Or,Zs=function(){return Gs},Xs=function(){if(Gs!==Ns||!$s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gs=Vs,Hs(),$s&&rr({url:$s},(e=>{e?qs(e):(Gs=js,Hs())}))},Ys={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gs===js||null!=Ys.applyArabicShaping,isLoading:()=>Gs===Vs,setState(e){Gs=e.pluginStatus,$s=e.pluginURL},isParsed:()=>null!=Ys.applyArabicShaping&&null!=Ys.processBidirectionalText&&null!=Ys.processStyledBidirectionalText,getPluginURL:()=>$s};class Js{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!Bs(i.charCodeAt(0),t))return!1;return!0}(e,Ys.isLoaded())}}class Qs{constructor(e,t,i,r){this.property=e,this.value=t,this.expression=function(e,t,i,r){if(ns(e))return new ys(e,t);if(ps(e)||Array.isArray(e)&&e.length>0){const n=_s(e,t,i,r);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=$r.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification,i,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Ks{constructor(e,t,i){this.property=e,this.value=new Qs(e,void 0,t,i)}transitioned(e,t){return new tl(this.property,this.value,t,ii({},e.transition,this.transition),e.now)}untransitioned(){return new tl(this.property,this.value,null,{},0)}}class el{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=i,this.configDependencies=new Set}getValue(e){return di(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ks(this._values[e].property,this._scope,this._options)),this._values[e].value=new Qs(this._values[e].property,null===t?void 0:di(t),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,t){t&&(this._options=t);const i=this._properties.properties;if(e)for(const r in e){const t=e[r];if(ci(r,"-transition")){const e=r.slice(0,-11);i[e]&&this.setTransition(e,t)}else i.hasOwnProperty(r)&&this.setValue(r,t)}}getTransition(e){return di(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ks(this._values[e].property)),this._values[e].transition=di(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new il(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new il(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class tl{constructor(e,t,i,r,n){const a=r.delay||0,o=r.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+a,this.end=this.begin+o,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),a=this.prior;if(a){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return a.possiblyEvaluate(e,t,i);{const o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,i),n,Zt(o))}}return n}}class il{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new al(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class rl{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=i,this.configDependencies=new Set}getValue(e){return di(this._values[e].value)}setValue(e,t){this._values[e]=new Qs(this._values[e].property,null===t?void 0:di(t),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new al(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class nl{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class al{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ol{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const r=Zr[this.specification.type];return r?r(e,t,i):e}}class sl{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new nl(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new nl(this,{kind:"constant",value:void 0},e.parameters);const r=Zr[this.specification.type];return r?new nl(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,a){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,a)}}class ll{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class cl{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Js(0,{});for(const i in e){const r=e[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new Qs(r,void 0),a=this.defaultTransitionablePropertyValues[i]=new Ks(r);this.defaultTransitioningPropertyValues[i]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(t)}}}Ts(sl,"DataDrivenProperty"),Ts(ol,"DataConstantProperty"),Ts(ll,"ColorRampProperty");var hl=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ul(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function dl(e){if(Array.isArray(e))return e.map(dl);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=dl(e[i]);return t}return ul(e)}function pl(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!pl(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function fl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};pl(e)||(e=bl(e));const i=e;let r=!0;try{r=function(e){if(!_l(e))return e;let t=dl(e);return gl(t),t=ml(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=hl[`filter_${t}`],a=fs(r,n);let o=null;if("error"===a.result)throw new Error(a.value.map((e=>`${e.key}: ${e.message}`)).join(", "));o=(e,t,i)=>a.value.evaluate(e,t,{},i);let s=null,l=null;if(r!==i){const e=fs(i,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,i,r,n,a)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,a),l=!Za(e.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:vl(r),needFeature:!!l}}function ml(e){if(!Array.isArray(e))return e;const t=function(e){if(yl.has(e[0]))for(let t=1;t<e.length;t++)if(_l(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>ml(e)))}function gl(e){let t=!1;const i=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||_l(e[r]),i.push(e[r+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||_l(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||_l(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let r=1;r<e.length;r++)gl(e[r])}function _l(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let i=1;i<e.length;i++)if(_l(e[i]))return!0;return!1}const yl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xl(e,t){return e<t?-1:e>t?1:0}function vl(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(vl(e[t]))return!0;return!1}function bl(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?wl(e[1],e[2],"=="):"!="===t?Tl(wl(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?wl(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(bl))):"all"===t?["all"].concat(e.slice(1).map(bl)):"none"===t?["all"].concat(e.slice(1).map(bl).map(Tl)):"in"===t?Sl(e[1],e.slice(2)):"!in"===t?Tl(Sl(e[1],e.slice(2))):"has"===t?El(e[1]):"!has"!==t||Tl(El(e[1]));var i}function wl(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function Sl(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(xl)]]:["filter-in-small",e,["literal",t]]}}function El(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Tl(e){return["!",e]}const Cl="\x1f";function kl(e,t){return t?`${e}${Cl}${t}`:e}const Ml="-transition",Al=new Set(["fill","line","background","hillshade","raster"]);class Pl extends Or{constructor(e,t,i,r,n){if(super(),this.id=e.id,this.fqid=kl(this.id,i),this.type=e.type,this.scope=i,this.lut=r,this.options=n,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new rl(t.layout,this.scope,n),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),t.paint)){this._transitionablePaint=new el(t.paint,this.scope,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new al(t.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Al.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ci(e,Ml)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const i=this._transitionablePaint,r=i._properties.properties;if(ci(e,Ml)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const n=i._values[e],a=n.value.isDataDriven(),o=n.value;i.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const s=i._values[e].value,l=s.isDataDriven(),c=ci(e,"pattern")||"line-dasharray"===e;return l||a||c||this._handleOverridablePaintPropertyUpdate(e,o,s)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,i){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return ui({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof nl&&es(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=fl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,i,r,n,a,o,s,l){}queryIntersectsMatchingFeature(e,t,i,r){}}const Il={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dl{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rl{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=0,r=0;return{members:e.map((e=>{const n=Il[e.type].BYTES_PER_ELEMENT,a=i=Ll(i,Math.max(t,n)),o=e.components||1;return r=Math.max(r,n),i+=n*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Ll(i,Math.max(r,t)),alignment:t}}function Ll(e,t){return Math.ceil(e/t)*t}class Fl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}Fl.prototype.bytesPerElement=4,Ts(Fl,"StructArrayLayout2i4");class Bl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Bl.prototype.bytesPerElement=6,Ts(Bl,"StructArrayLayout3i6");class Ol extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,e}}Ol.prototype.bytesPerElement=8,Ts(Ol,"StructArrayLayout4i8");class Nl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=5*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,this.int16[o+4]=a,e}}Nl.prototype.bytesPerElement=10,Ts(Nl,"StructArrayLayout5i10");class Vl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=6*e,c=12*e,h=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[h+2]=s,e}}Vl.prototype.bytesPerElement=12,Ts(Vl,"StructArrayLayout2i4ub1f12");class jl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=r,this.float32[a+3]=n,e}}jl.prototype.bytesPerElement=16,Ts(jl,"StructArrayLayout4f16");class Ul extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}Ul.prototype.bytesPerElement=12,Ts(Ul,"StructArrayLayout3f12");class Gl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=6*e,s=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,this.float32[s+2]=a,e}}Gl.prototype.bytesPerElement=12,Ts(Gl,"StructArrayLayout4ui1f12");class $l extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=i,this.uint16[a+2]=r,this.uint16[a+3]=n,e}}$l.prototype.bytesPerElement=8,Ts($l,"StructArrayLayout4ui8");class ql extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)}emplace(e,t,i,r,n,a,o){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,e}}ql.prototype.bytesPerElement=12,Ts(ql,"StructArrayLayout6i12");class Hl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,a,o,s,l,c,h,u)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=h,this.int16[p+10]=u,this.int16[p+11]=d,e}}Hl.prototype.bytesPerElement=24,Ts(Hl,"StructArrayLayout4i4ui4i24");class Wl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)}emplace(e,t,i,r,n,a,o){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.float32[l+2]=n,this.float32[l+3]=a,this.float32[l+4]=o,e}}Wl.prototype.bytesPerElement=20,Ts(Wl,"StructArrayLayout3i3f20");class Zl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Zl.prototype.bytesPerElement=4,Ts(Zl,"StructArrayLayout1ul4");class Xl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}Xl.prototype.bytesPerElement=4,Ts(Xl,"StructArrayLayout2ui4");class Yl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,a,o,s,l,c,h,u,d)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=a,this.float32[m+3]=o,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=h,this.uint32[m+8]=u,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Yl.prototype.bytesPerElement=40,Ts(Yl,"StructArrayLayout5i4f1i1ul2ui40");class Jl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=a,this.int16[l+6]=o,this.int16[l+7]=s,e}}Jl.prototype.bytesPerElement=16,Ts(Jl,"StructArrayLayout3i2i2i16");class Ql extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.int16[s+6]=n,this.int16[s+7]=a,e}}Ql.prototype.bytesPerElement=16,Ts(Ql,"StructArrayLayout2f1f2i16");class Kl extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[o+1]=r,this.float32[o+2]=n,e}}Kl.prototype.bytesPerElement=12,Ts(Kl,"StructArrayLayout2ub2f12");class ec extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}ec.prototype.bytesPerElement=6,Ts(ec,"StructArrayLayout3ui6");class tc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b){const w=30*e,S=15*e,E=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=r,this.float32[S+2]=n,this.float32[S+3]=a,this.uint16[w+8]=o,this.uint16[w+9]=s,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=h,this.uint16[w+16]=u,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[E+48]=g,this.uint8[E+49]=_,this.uint8[E+50]=y,this.uint32[S+13]=x,this.int16[w+28]=v,this.uint8[E+58]=b,e}}tc.prototype.bytesPerElement=60,Ts(tc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ic extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b,w,S,E,T,C,k,M,A,P,I){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b,w,S,E,T,C,k,M,A,P,I)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b,w,S,E,T,C,k,M,A,P,I,D){const R=20*e,z=40*e,L=80*e;return this.float32[R+0]=t,this.float32[R+1]=i,this.int16[z+4]=r,this.int16[z+5]=n,this.int16[z+6]=a,this.int16[z+7]=o,this.int16[z+8]=s,this.int16[z+9]=l,this.int16[z+10]=c,this.int16[z+11]=h,this.int16[z+12]=u,this.uint16[z+13]=d,this.uint16[z+14]=p,this.uint16[z+15]=f,this.uint16[z+16]=m,this.uint16[z+17]=g,this.uint16[z+18]=_,this.uint16[z+19]=y,this.uint16[z+20]=x,this.uint16[z+21]=v,this.uint16[z+22]=b,this.uint16[z+23]=w,this.uint16[z+24]=S,this.uint16[z+25]=E,this.uint16[z+26]=T,this.uint16[z+27]=C,this.uint32[R+14]=k,this.float32[R+15]=M,this.float32[R+16]=A,this.float32[R+17]=P,this.float32[R+18]=I,this.uint8[L+76]=D,e}}ic.prototype.bytesPerElement=80,Ts(ic,"StructArrayLayout2f9i15ui1ul4f1ub80");class rc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}rc.prototype.bytesPerElement=4,Ts(rc,"StructArrayLayout1f4");class nc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,this.float32[o+4]=a,e}}nc.prototype.bytesPerElement=20,Ts(nc,"StructArrayLayout5f20");class ac extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=a,this.float32[l+5]=o,this.float32[l+6]=s,e}}ac.prototype.bytesPerElement=28,Ts(ac,"StructArrayLayout7f28");class oc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=i,this.uint16[a+3]=r,this.uint16[a+4]=n,e}}oc.prototype.bytesPerElement=12,Ts(oc,"StructArrayLayout1ul3ui12");class sc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}sc.prototype.bytesPerElement=2,Ts(sc,"StructArrayLayout1ui2");class lc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}lc.prototype.bytesPerElement=8,Ts(lc,"StructArrayLayout2f8");class cc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=i,this.float32[_+2]=r,this.float32[_+3]=n,this.float32[_+4]=a,this.float32[_+5]=o,this.float32[_+6]=s,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=h,this.float32[_+10]=u,this.float32[_+11]=d,this.float32[_+12]=p,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,e}}cc.prototype.bytesPerElement=64,Ts(cc,"StructArrayLayout16f64");class hc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=n,this.float32[c+2]=a,this.float32[c+3]=o,this.float32[c+4]=s,e}}hc.prototype.bytesPerElement=20,Ts(hc,"StructArrayLayout4ui3f20");class uc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}uc.prototype.bytesPerElement=2,Ts(uc,"StructArrayLayout1i2");class dc extends Rl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}dc.prototype.bytesPerElement=1,Ts(dc,"StructArrayLayout1ub1");class pc extends Dl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pc.prototype.size=40;class fc extends Yl{get(e){return new pc(this,e)}}Ts(fc,"CollisionBoxArray");class mc extends Dl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}mc.prototype.size=60;class gc extends tc{get(e){return new mc(this,e)}}Ts(gc,"PlacedSymbolArray");class _c extends Dl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}_c.prototype.size=80;class yc extends ic{get(e){return new _c(this,e)}}Ts(yc,"SymbolInstanceArray");class xc extends rc{getoffsetX(e){return this.float32[1*e+0]}}Ts(xc,"GlyphOffsetArray");class vc extends Fl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ts(vc,"SymbolLineVertexArray");class bc extends Dl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bc.prototype.size=12;class wc extends oc{get(e){return new bc(this,e)}}Ts(wc,"FeatureIndexArray");class Sc extends Xl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ts(Sc,"FillExtrusionCentroidArray");class Ec extends Dl{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}Ec.prototype.size=8;class Tc extends Ol{get(e){return new Ec(this,e)}}Ts(Tc,"FillExtrusionWallArray");const Cc=zl([{name:"a_pos",components:2,type:"Int16"}],4),kc=zl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Mc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>Mc.MAX_VERTEX_ARRAY_LENGTH&&fi(`Max vertices per segment is ${Mc.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>Mc.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(e,t,i,r){return this._prepareSegment(e,t.length,i.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new Mc([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function Ac(e,t){return 256*(e=Jt(Math.floor(e),0,255))+Jt(Math.floor(t),0,255)}Mc.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ts(Mc,"SegmentVector");const Pc=zl([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ic=zl([{name:"a_dash",components:4,type:"Uint16"}]);class Dc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(Rc(e)),this.positions.push(t,i,r)}eachPosition(e,t){const i=Rc(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=i?n=e:r=e+1}for(;this.ids[r]===i;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return zc(i,r,0,i.length-1),t&&(t.add(i.buffer),t.add(r.buffer)),{ids:i,positions:r}}static deserialize(e){const t=new Dc;let i;t.ids=e.ids,t.positions=e.positions;for(const r of t.ids)r!==i&&t.uniqueIds.push(r),i=r;return t.indexed=!0,t}}function Rc(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Rr(String(e))}function zc(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let a=i-1,o=r+1;for(;;){do{a++}while(e[a]<n);do{o--}while(e[o]>n);if(a>=o)break;Lc(e,a,o),Lc(t,3*a,3*o),Lc(t,3*a+1,3*o+1),Lc(t,3*a+2,3*o+2)}o-i<r-o?(zc(e,t,i,o),i=o+1):(zc(e,t,o+1,r),r=o)}}function Lc(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}Ts(Dc,"FeaturePositionMap");class Fc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Bc extends Fc{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Oc extends Fc{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Nc extends Fc{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class Vc extends Fc{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class jc extends Fc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Uc extends Fc{constructor(e){super(e),this.current=$r.transparent.toRenderColor(null)}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Gc=new Float32Array(16);class $c extends Fc{constructor(e){super(e),this.current=Gc}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const qc=new Float32Array(9),Hc=new Float32Array(4);class Wc extends Fc{constructor(e){super(e),this.current=Hc}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Zc(e){return[Ac(255*e.r,255*e.g),Ac(255*e.b,255*e.a)]}class Xc{constructor(e,t,i,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i,this.context=r}setUniform(e,t,i,r,n){const a=r.constantOr(this.value);t.set(e,n,a instanceof $r?a.toRenderColor(this.context.lut):a)}getBinding(e,t){return"color"===this.type?new Uc(e):new Oc(e)}}class Yc{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,r,n){const a="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;a&&t.set(e,n,a)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new jc(e):new Oc(e)}}class Jc{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n,a,o){const s=this.paintVertexArray.length,l=this.expression.evaluate(new Js(0,{brightness:a}),t,{},n,r,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,l,this.context)}updatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate({zoom:0,brightness:o},i,r,void 0,n);this._setPaintValue(e,t,s,this.context)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=Zc(i.toRenderColor(r.lut));for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qc{constructor(e,t,i,r,n,a){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.context=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate(new Js(this.context.zoom,{brightness:a}),t,{},n,r,o),l=this.expression.evaluate(new Js(this.context.zoom+1,{brightness:a}),t,{},n,r,o),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,s,l,this.context)}updatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate({zoom:this.context.zoom,brightness:o},i,r,void 0,n),l=this.expression.evaluate({zoom:this.context.zoom+1,brightness:o},i,r,void 0,n);this._setPaintValue(e,t,s,l,this.context)}_setPaintValue(e,t,i,r,n){if("color"===this.type){const r=Zc(i.toRenderColor(n.lut)),a=Zc(i.toRenderColor(n.lut));for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],a[0],a[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,r,n){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,o=Jt(this.expression.interpolationFactor(a,this.context.zoom,this.context.zoom+1),0,1);t.set(e,n,o)}getBinding(e,t){return new Oc(e)}}class Kc{constructor(e,t,i,r,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===i?Ic:Pc).members;for(let a=0;a<t.length;++a);this.paintVertexArray=new r}populatePaintArray(e,t,i,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n,a,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],a)}_setPaintValues(e,t,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:a,br:o,pixelRatio:s}=n;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,a[0],a[1],o[0],o[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class eh{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const r=[];for(const n in e.paint._values){const a=e.paint.get(n);if(!i(n))continue;if(!(a instanceof nl&&es(a.property.specification)))continue;const o=rh(n,e.type),s=a.value,l=a.property.specification.type,c=!!a.property.useIntegerZoom,h="line-dasharray"===n||n.endsWith("pattern"),u="line-dasharray"===n&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||u)if("source"===s.kind||u||h){const t=oh(n,l,"source");this.binders[n]=h?new Kc(s,o,l,t,e.id):new Jc(s,o,l,t),r.push(`/a_${n}`)}else{const e=oh(n,l,"composite");this.binders[n]=new Qc(s,o,l,c,t,e),r.push(`/z_${n}`)}else this.binders[n]=h?new Yc(s.value,o):new Xc(s.value,o,l,t),r.push(`/u_${n}`)}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Jc||t instanceof Qc?t.maxValue:0}populatePaintArrays(e,t,i,r,n,a,o){for(const s in this.binders){const l=this.binders[s];l.context=this.context,(l instanceof Jc||l instanceof Qc||l instanceof Kc)&&l.populatePaintArray(e,t,i,r,n,a,o)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof Yc&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,r,n,a,o,s){let l=!1;const c=Object.keys(e),h=0!==c.length,u=h?c:t.uniqueIds;this.context.lut=n.lut;for(const d in this.binders){const c=this.binders[d];if(c.context=this.context,(c instanceof Jc||c instanceof Qc||c instanceof Kc)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=n.paint.get(d);c.expression=p.value;for(const i of u){const n=e[i.toString()];t.eachPosition(i,((e,t,i)=>{const l=r.feature(e);c.updatePaintArray(t,i,l,n,a,o,s)}))}if(!h)for(const t of i.uniqueIds){const n=e[t.toString()];i.eachPosition(t,((e,t,i)=>{const l=r.feature(e);c.updatePaintArray(t,i,l,n,a,o,s)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Xc||i instanceof Yc)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Jc||i instanceof Qc||i instanceof Kc)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Xc||i instanceof Yc||i instanceof Qc)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Xc||r instanceof Yc||r instanceof Qc)for(const n of r.uniformNames)t.push({name:n,property:i,binding:r.getBinding(e,n)})}return t}setUniforms(e,t,i,r,n){for(const{name:a,property:o,binding:s}of i)this.binders[o].setUniform(e,s,n,r.get(o),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Jc||t instanceof Qc||t instanceof Kc)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Jc||i instanceof Qc||i instanceof Kc)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Jc||t instanceof Qc||t instanceof Kc)&&t.destroy()}}}class th{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new eh(r,t,i);this.needsUpload=!1,this._featureMap=new Dc,this._featureMapWithoutIds=new Dc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,i,r,n,a,o,s){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,r,n,a,o,s);void 0!==t.id?this._featureMap.add(t.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r,n,a){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,o,r,n,a||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ih={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function rh(e,t){return ih[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const nh={"line-pattern":{source:Gl,composite:Gl},"fill-pattern":{source:Gl,composite:Gl},"fill-extrusion-pattern":{source:Gl,composite:Gl},"line-dasharray":{source:$l,composite:$l}},ah={color:{source:lc,composite:jl},number:{source:rc,composite:lc}};function oh(e,t,i){const r=nh[e];return r&&r[i]||ah[t][i]}Ts(Xc,"ConstantBinder"),Ts(Yc,"PatternConstantBinder"),Ts(Jc,"SourceExpressionBinder"),Ts(Kc,"PatternCompositeBinder"),Ts(Qc,"CompositeExpressionBinder"),Ts(eh,"ProgramConfiguration",{omit:["_buffers"]}),Ts(th,"ProgramConfigurationSet");const sh=fa/Math.PI/2,lh=5,ch=6,hh=16383,uh=64,dh=[uh,32,16],ph=-sh,fh=sh;function mh(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:sh;return i=qt(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function gh(e,t,i){return mh(Math.cos(qt(e)),Math.sin(qt(e)),t,i)}const _h=6371008.8,yh=2*Math.PI*_h;class xh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xh(Kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return _h*Math.acos(Math.min(n,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new vh({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return gh(this.lat,this.lng,sh+e*sh/_h)}static convert(e){if(e instanceof xh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new xh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new xh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class vh{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof xh?new xh(e.lng,e.lat):xh.convert(e),this}setSouthWest(e){return this._sw=e instanceof xh?new xh(e.lng,e.lat):xh.convert(e),this}extend(e){const t=this._sw,i=this._ne;let r,n;if(e instanceof xh)r=e,n=e;else{if(!(e instanceof vh))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(vh.convert(e)):this.extend(xh.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(xh.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new xh(r.lng,r.lat),this._ne=new xh(n.lng,n.lat)),this}getCenter(){return new xh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xh(this.getWest(),this.getNorth())}getSouthEast(){return new xh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=xh.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return!e||e instanceof vh?e:new vh(e)}}var bh={};!function(e,t){!function(e){function t(e,t,r){var n=i(256*e,256*(t=Math.pow(2,r)-t-1),r),a=i(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+a[0]+","+a[1]}function i(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=function(e,i,r,n,a,o){return o=o||{},e+"?"+["bbox="+t(r,n,a),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+i].join("&")},e.getTileBBox=t,e.getMercCoords=i,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,bh);var wh=bh;class Sh{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=Ch(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=wh.getTileBBox(this.x,this.y,this.z),r=function(e,t,i){let r,n="";for(let a=e;a>0;a--)r=1<<a-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Eh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ch(e,t.z,t.z,t.x,t.y)}}class Th{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new Sh(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:Ch(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Th(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Th(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Ch(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Ch(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Th(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Th(t,this.wrap,t,i,r),new Th(t,this.wrap,t,i+1,r),new Th(t,this.wrap,t,i,r+1),new Th(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Th(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Th(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Eh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ch(e,t,i,r,n){const a=1<<Math.min(i,22);let o=a*(n%a)+r%a;return e&&i<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*o+i)+(t-i)}const kh=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new Th(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new Th(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new Th(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Th(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Ts(Sh,"CanonicalTileID"),Ts(Th,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Mh=0,Ah=25.5;function Ph(e){return yh*Math.cos(e*Math.PI/180)}function Ih(e){return(180+e)/360}function Dh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Rh(e,t){return e/Ph(t)}function zh(e){return 360*e-180}function Lh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Fh(e,t){return e*Ph(Lh(t))}const Bh=85.051129;function Oh(e){return Math.cos(qt(Jt(e,-Bh,Bh)))}function Nh(e,t){const i=Jt(t,Mh,Ah),r=Math.pow(2,i);return Oh(e)*yh/(512*r)}function Vh(e){return 1/Math.cos(e*Math.PI/180)}function jh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=Math.exp(Math.PI*(1-(e.y+t/fa)/(1<<e.z)*2));return 80150034*i/(i*i+1)/fa/(1<<e.z)}class Uh{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=xh.convert(e);return new Uh(Ih(i.lng),Dh(i.lat),Rh(t,i.lat))}toLngLat(){return new xh(zh(this.x),Lh(this.y))}toAltitude(){return Fh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/yh*Vh(Lh(this.y))}}function Gh(e,t,i,r,n,a,o,s,l){const c=(t+r)/2,h=(i+n)/2,u=new jt(c,h);s(u),function(e,t,i,r,n,a){const o=i-n,s=r-a;return Math.abs((r-t)*o-(i-e)*s)/Math.hypot(o,s)}(u.x,u.y,a.x,a.y,o.x,o.y)>=l?(Gh(e,t,i,c,h,a,u,s,l),Gh(e,c,h,r,n,u,o,s,l)):e.push(o)}function $h(e,t,i){let r=e[0],n=r.x,a=r.y;t(r);const o=[r];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:h}=l;t(l),Gh(o,n,a,c,h,r,l,t,i),n=c,a=h,r=l}return o}function qh(e,t,i,r){if(r(t,i)){const n=t.add(i)._mult(.5);qh(e,t,n,r),qh(e,n,i,r)}else e.push(i)}function Hh(e,t){let i=e[0];const r=[i];for(let n=1;n<e.length;n++){const a=e[n];qh(r,i,a,t),i=a}return r}const Wh=Math.pow(2,14)-1,Zh=-Wh-1;function Xh(e,t){const i=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=Jt(i,Zh,Wh),e.y=Jt(r,Zh,Wh),(i<e.x||i>e.x+1||r<e.y||r>e.y+1)&&fi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Yh(e,t,i){const r=e.loadGeometry(),n=e.extent,a=fa/n;if(t&&i&&i.projection.isReprojectedInTileSpace){const a=1<<t.z,{scale:o,x:s,y:l,projection:c}=i,h=e=>{const i=zh((t.x+e.x/n)/a),r=Lh((t.y+e.y/n)/a),h=c.project(i,r);e.x=(h.x*o-s)*n,e.y=(h.y*o-l)*n};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=$h(r[t],h,1);else{const e=[];for(const i of r[t])i.x<0||i.x>=n||i.y<0||i.y>=n||(h(i),e.push(i));r[t]=e}}for(const o of r)for(const e of o)Xh(e,a);return r}function Jh(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Yh(e):[]}}function Qh(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}function Kh(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fl,this.indexArray=new ec,this.segments=new Mc,this.programConfigurations=new th(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}updateFootprints(e,t){}populate(e,t,i,r){const n=this.layers[0],a=[];let o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:h,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Jh(l,e);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),t,i))continue;const n=o?o.evaluate(t,{},i):void 0,s={id:c,properties:l.properties,type:l.type,sourceLayerIndex:u,index:h,geometry:e?t.geometry:Yh(l,i,r),patterns:{},sortKey:n};a.push(s)}o&&a.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new ql,s=r.projection);for(const l of a){const{geometry:r,index:n,sourceLayerIndex:a}=l,o=e[n].feature;this.addFeature(l,r,n,t.availableImages,i,s,t.brightness),t.featureIndex.insert(o,r,n,a,this.index)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kc.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,r,n,a,o){for(const s of t)for(const t of s){const i=t.x,r=t.y;if(i<0||i>=fa||r<0||r>=fa)continue;if(a){const e=a.projectTilePoint(i,r,n),t=a.upVector(n,i,r),o=this.globeExtVertexArray;Kh(o,e,t),Kh(o,e,t),Kh(o,e,t),Kh(o,e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=o.vertexLength;Qh(this.layoutVertexArray,i,r,-1,-1),Qh(this.layoutVertexArray,i,r,1,-1),Qh(this.layoutVertexArray,i,r,1,1),Qh(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,n,o)}}function tu(e,t){for(let i=0;i<e.length;i++)if(hu(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(hu(e,t[i]))return!0;return!!au(e,t)}function iu(e,t,i){return!!hu(e,t)||!!su(t,e,i)}function ru(e,t){if(1===e.length)return cu(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(hu(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(cu(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(au(e,t[i]))return!0;return!1}function nu(e,t,i){if(e.length>1){if(au(e,t))return!0;for(let r=0;r<t.length;r++)if(su(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(su(e[r],t,i))return!0;return!1}function au(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(ou(r,n,t[e],t[e+1]))return!0}return!1}function ou(e,t,i,r){return mi(e,i,r)!==mi(t,i,r)&&mi(e,t,i)!==mi(e,t,r)}function su(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let n=1;n<t.length;n++)if(lu(e,t[n-1],t[n])<r)return!0;return!1}function lu(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function cu(e,t){let i,r,n,a=!1;for(let o=0;o<e.length;o++){i=e[o];for(let e=0,o=i.length-1;e<i.length;o=e++)r=i[e],n=i[o],r.y>t.y!=n.y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(a=!a)}return a}function hu(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const a=e[r],o=e[n];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}function uu(e,t,i,r,n){for(const o of e)if(t<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const a=[new jt(t,i),new jt(t,n),new jt(r,n),new jt(r,i)];if(e.length>2)for(const o of a)if(hu(e,o))return!0;for(let o=0;o<e.length-1;o++)if(du(e[o],e[o+1],a))return!0;return!1}function du(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const a=mi(e,t,i[0]);return a!==mi(e,t,i[1])||a!==mi(e,t,i[2])||a!==mi(e,t,i[3])}function pu(e,t,i,r,n,a){let o=t.y-e.y,s=e.x-t.x;if(a=a||0){const e=o*o+s*s;if(0===e)return!0;const t=Math.sqrt(e);o/=t,s/=t}return!((i.x-e.x)*o+(i.y-e.y)*s-a<0||(r.x-e.x)*o+(r.y-e.y)*s-a<0||(n.x-e.x)*o+(n.y-e.y)*s-a<0)}function fu(e,t,i,r,n,a,o){return!(pu(e,t,r,n,a,o)||pu(t,i,r,n,a,o)||pu(i,e,r,n,a,o)||pu(r,n,e,t,i,o)||pu(n,a,e,t,i,o)||pu(a,r,e,t,i,o))}function mu(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function gu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function _u(e,t,i,r,n){if(!t[0]&&!t[1])return e;const a=jt.convert(t)._mult(n);"viewport"===i&&a._rotate(-r);const o=[];for(let s=0;s<e.length;s++)o.push(e[s].sub(a));return o}function yu(e,t,i,r){const n=jt.convert(e)._mult(r);return"viewport"===t&&n._rotate(-i),n}let xu,vu;Ts(eu,"CircleBucket",{omit:["layers"]});class bu{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,i,r){const n=e.$.dot(i,this.dir);if(Math.abs(n)<1e-6)return!1;const a=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*a,r[1]=this.pos[1]+this.dir[1]*a,r[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(t,i,r){if(e.$.equals(this.pos,t)||0===i)return r[0]=r[1]=r[2]=0,!1;const[n,a,o]=this.dir,s=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],h=n*n+a*a+o*o,u=2*(s*n+l*a+c*o),d=u*u-4*h*(s*s+l*l+c*c-i*i);if(d<0){const e=Math.max(-u/2,0),t=s+n*e,h=l+a*e,d=c+o*e,p=Math.hypot(t,h,d);return r[0]=t*i/p,r[1]=h*i/p,r[2]=d*i/p,!1}{const e=(-u-Math.sqrt(d))/(2*h);if(e<0){const e=Math.hypot(s,l,c);return r[0]=s*i/e,r[1]=l*i/e,r[2]=c*i/e,!1}return r[0]=s+n*e,r[1]=l+a*e,r[2]=c+o*e,!0}}}class wu{constructor(e,t,i,r,n){this.TL=e,this.TR=t,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(t,i,r){const n=[-1,1,1],a=[1,1,1],o=[1,-1,1],s=[-1,-1,1],l=e.$.transformMat4(n,n,t),c=e.$.transformMat4(a,a,t),h=e.$.transformMat4(o,o,t),u=e.$.transformMat4(s,s,t);return new wu(l,c,h,u,i/r)}}function Su(t,i,r){let n=1/0,a=-1/0;const o=[];for(const s of t){e.$.sub(o,s,i);const t=e.$.dot(o,r);n=Math.min(n,t),a=Math.max(a,t)}return[n,a]}function Eu(t,i){let r=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let o=0;for(let t=0;t<i.length;t++)o+=e.$.dot(a,i[t])+a[3]>=0;if(0===o)return 0;o!==i.length&&(r=!1)}return r?2:1}function Tu(e,t){for(const i of e.projections){const r=Su(t,e.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function Cu(t,i){let r=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,e.aB.dot(n,i)>=0&&r++;return r}class ku{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Mu.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.$.sub([],this.points[2],this.points[3]),e.$.sub([],this.points[0],this.points[3]),e.$.sub([],this.points[4],this.points[0]),e.$.sub([],this.points[5],this.points[1]),e.$.sub([],this.points[6],this.points[2]),e.$.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],i=[e[2],0,-e[0]];this.projections.push({axis:t,projection:Su(this.points,this.points[0],t)}),this.projections.push({axis:i,projection:Su(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(t,i,r,n){const a=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=e.aB.transformMat4([],r,t),s=1/o[3]/i*a;return e.aB.mul(o,o,[s,s,n?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const i=e.$.sub([],o[t[0]],o[t[1]]),r=e.$.sub([],o[t[2]],o[t[1]]),n=e.$.normalize([],e.$.cross([],i,r)),a=-e.$.dot(n,o[t[1]]);return n.concat(a)})),l=[];for(let e=0;e<o.length;e++)l.push([o[e][0],o[e][1],o[e][2]]);return new ku(l,s)}intersectsPrecise(t,i,r){for(let e=0;e<i.length;e++)if(!Cu(t,i[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!Cu(t,this.planes[e]))return 0;for(const n of r)for(const i of this.frustumEdges){const r=e.$.cross([],n,i),a=e.$.length(r);if(0===a)continue;e.$.scale(r,r,1/a);const o=Su(this.points,this.points[0],r),s=Su(t,this.points[0],r);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}containsPoint(t){for(const i of this.planes){const r=i[3];if(e.$.dot([i[0],i[1],i[2]],t)+r<0)return!1}return!0}}class Mu{static fromPoints(t){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of t)e.$.min(i,i,n),e.$.max(r,r,n);return new Mu(i,r)}static fromTileIdAndHeight(e,t,i){const r=1<<e.canonical.z,n=e.canonical.x,a=e.canonical.y;return new Mu([n/r,a/r,t],[(n+1)/r,(a+1)/r,i])}static applyTransform(t,i){const r=t.getCorners();for(let n=0;n<r.length;++n)e.$.transformMat4(r[n],r[n],i);return Mu.fromPoints(r)}static applyTransformFast(e,t){const i=[t[12],t[13],t[14]],r=[...i];for(let n=0;n<3;n++)for(let a=0;a<3;a++){const o=t[4*a+n],s=o*e.min[a],l=o*e.max[a];i[n]+=Math.min(s,l),r[n]+=Math.max(s,l)}return new Mu(i,r)}static projectAabbCorners(t,i){const r=t.getCorners();for(let n=0;n<r.length;++n)e.$.transformMat4(r[n],r[n],i);return r}constructor(t,i){this.min=t,this.max=i,this.center=e.$.scale([],e.$.add([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],r=e.$.clone(this.min),n=e.$.clone(this.max);for(let e=0;e<i.length;e++)r[e]=i[e]?this.min[e]:this.center[e],n[e]=i[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Mu(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Eu(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Eu(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Tu(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Tu(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ts(Mu,"Aabb");const Au=zl([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Pu}=Au,Iu=zl([{name:"a_pos_3",components:3,type:"Int16"}]);var Du=zl([{name:"a_pos",type:"Int16",components:2}]);function Ru(e){return e*sh/_h}const zu=[new Mu([ph,ph,ph],[fh,fh,fh]),new Mu([ph,ph,ph],[0,0,fh]),new Mu([0,ph,ph],[fh,0,fh]),new Mu([ph,0,ph],[0,fh,fh]),new Mu([0,0,ph],[fh,fh,fh])];function Lu(t,i,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=e.$.scale([],t._camera.position,t.worldSize),o=[i,r,1,1];e.aB.transformMat4(o,o,t.pixelMatrixInverse),e.aB.scale(o,o,1/o[3]);const s=e.$.sub([],o,a),l=e.$.normalize([],s),c=t.globeMatrix,h=[c[12],c[13],c[14]],u=e.$.sub([],h,a),d=e.$.length(u),p=e.$.normalize([],u),f=t.worldSize/(2*Math.PI),m=e.$.dot(p,l),g=Math.asin(f/d);if(g<Math.acos(m)){if(!n)return null;const t=[],i=[];e.$.scale(t,l,d/m),e.$.normalize(i,e.$.sub(i,t,u)),e.$.normalize(l,e.$.add(l,u,e.$.scale(l,i,Math.tan(g)*d)))}const _=[];new bu(a,l).closestPointOnSphere(h,f,_);const y=e.$.normalize([],Mi(c,0)),x=e.$.normalize([],Mi(c,1)),v=e.$.normalize([],Mi(c,2)),b=e.$.dot(y,_),w=e.$.dot(x,_),S=e.$.dot(v,_),E=Ht(Math.asin(-w/f));let T=Ht(Math.atan2(b,S));T=t.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(t.center.lng,T);const C=Ih(T),k=Jt(Dh(E),0,1);return new Uh(C,k)}class Fu{constructor(t,i,r){this.a=e.$.sub([],t,r),this.b=e.$.sub([],i,r),this.center=r;const n=e.$.normalize([],this.a),a=e.$.normalize([],this.b);this.angle=Math.acos(e.$.dot(n,a))}}function Bu(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,r){const n=Math.sin(i);return e*(Math.sin((1-r)*i)/n)+t*(Math.sin(r*i)/n)}(e.a[t],e.b[t],e.angle,Jt(i,0,1))+e.center[t]}function Ou(e){if(e.z<=1)return zu[e.z+2*e.y+e.x];const t=$u(Gu(e));return Mu.fromPoints(t)}function Nu(t,i,r){return e.$.scale(t,t,1-r),e.$.scaleAndAdd(t,t,i,r)}function Vu(t,i){const r=Ku(i.zoom);if(0===r)return Ou(t);const n=Gu(t),a=$u(n),o=Ih(n.getWest())*i.worldSize,s=Ih(n.getEast())*i.worldSize,l=Dh(n.getNorth())*i.worldSize,c=Dh(n.getSouth())*i.worldSize,h=[o,l,0],u=[s,l,0],d=[o,c,0],p=[s,c,0],f=e.ae.invert([],i.globeMatrix);return e.$.transformMat4(h,h,f),e.$.transformMat4(u,u,f),e.$.transformMat4(d,d,f),e.$.transformMat4(p,p,f),a[0]=Nu(a[0],d,r),a[1]=Nu(a[1],p,r),a[2]=Nu(a[2],u,r),a[3]=Nu(a[3],h,r),Mu.fromPoints(a)}function ju(t,i,r){for(const n of t)e.$.transformMat4(n,n,i),e.$.scale(n,n,r)}function Uu(t,i,r,n){const a=i/t.worldSize,o=t.globeMatrix;if(r.z<=1){const e=Ou(r).getCorners();return ju(e,o,a),Mu.fromPoints(e)}const s=Gu(r,n),l=$u(s,sh+Ru(t._tileCoverLift));ju(l,o,a);const c=Number.MAX_VALUE,h=[-c,-c,-c],u=[c,c,c];if(s.contains(t.center)){for(const t of l)e.$.min(u,u,t),e.$.max(h,h,t);h[2]=0;const i=t.point,r=[i.x*a,i.y*a,0];return e.$.min(u,u,r),e.$.max(h,h,r),new Mu(u,h)}if(t._tileCoverLift>0){for(const t of l)e.$.min(u,u,t),e.$.max(h,h,t);return new Mu(u,h)}const d=[o[12]*a,o[13]*a,o[14]*a],p=s.getCenter(),f=Jt(t.center.lat,-Bh,Bh),m=Jt(p.lat,-Bh,Bh),g=Ih(t.center.lng),_=Dh(f);let y=g-Ih(p.lng);const x=_-Dh(m);y>.5?y-=1:y<-.5&&(y+=1);let v=0;if(Math.abs(y)>Math.abs(x))v=y>=0?1:3;else{v=x>=0?0:2;const t=[o[4]*a,o[5]*a,o[6]*a],i=-Math.sin(qt(x>=0?s.getSouth():s.getNorth()))*sh;e.$.scaleAndAdd(d,d,t,i)}const b=l[v],w=l[(v+1)%4],S=new Fu(b,w,d),E=[Bu(S,0)||b[0],Bu(S,1)||b[1],Bu(S,2)||b[2]],T=Ku(t.zoom);if(T>0){const n=function(e,t,i,r,n){let{x:a,y:o,z:s}=e;const l=1/(1<<s);let c=a*l,h=c+l,u=o*l,d=u+l,p=0;const f=(c+h)/2-r;return f>.5?p=-1:f<-.5&&(p=1),c=((c+p)*t-(r*=t))*i+r,h=((h+p)*t-r)*i+r,u=(u*t-(n*=t))*i+n,d=(d*t-n)*i+n,[[c,d,0],[h,d,0],[h,u,0],[c,u,0]]}(r,i,t._pixelsPerMercatorPixel,g,_);for(let e=0;e<l.length;e++)Nu(l[e],n[e],T);const a=e.$.add([],n[v],n[(v+1)%4]);e.$.scale(a,a,.5),Nu(E,a,T)}for(const C of l)e.$.min(u,u,C),e.$.max(h,h,C);return u[2]=Math.min(b[2],w[2]),e.$.min(u,u,E),e.$.max(h,h,E),new Mu(u,h)}function Gu(e){let{x:t,y:i,z:r}=e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=1/(1<<r),o=new xh(zh(t*a),i===(1<<r)-1&&n?-90:Lh((i+1)*a)),s=new xh(zh((t+1)*a),0===i&&n?90:Lh(i*a));return new vh(o,s)}function $u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sh;const i=qt(e.getNorth()),r=qt(e.getSouth()),n=Math.cos(i),a=Math.cos(r),o=Math.sin(i),s=Math.sin(r),l=e.getWest(),c=e.getEast();return[mh(a,s,l,t),mh(a,s,c,t),mh(n,o,c,t),mh(n,o,l,t)]}function qu(e,t,i,r){const n=1<<i.z,a=(e/fa+i.x)/n;return gh(Lh((t/fa+i.y)/n),zh(a),r)}function Hu(e){let{min:t,max:i}=e;return hh/Math.max(i[0]-t[0],i[1]-t[1],i[2]-t[2])}const Wu=new Float64Array(16);function Zu(t){const i=Hu(t),r=e.ae.fromScaling(Wu,[i,i,i]);return e.ae.translate(r,r,e.$.negate([],t.min))}function Xu(t){const i=e.ae.fromTranslation(Wu,t.min),r=1/Hu(t);return e.ae.scale(i,i,[r,r,r])}function Yu(e){const t=fa/(2*Math.PI);return e/(2*Math.PI)/t}function Ju(e,t){return fa/(512*Math.pow(2,e))*Hu(Ou(t))}function Qu(t,i,r,n,a){const o=Yu(r),s=[t,i,-r/(2*Math.PI)],l=e.ae.identity(new Float64Array(16));return e.ae.translate(l,l,s),e.ae.scale(l,l,[o,o,o]),e.ae.rotateX(l,l,qt(-a)),e.ae.rotateY(l,l,qt(-n)),l}function Ku(e){return Qt(lh,ch,e)}function ed(t,i){const r=gh(i.lat,i.lng),n=function(t){const i=gh(t._center.lat,t._center.lng),r=e.$.fromValues(0,1,0);let n=e.$.cross([],r,i);const a=e.ae.fromRotation([],-t.angle,i);n=e.$.transformMat4(n,n,a),e.ae.fromRotation(a,-t._pitch,n);const o=e.$.normalize([],i);return e.$.scale(o,o,Ru(t.cameraToCenterDistance/t.pixelsPerMeter)),e.$.transformMat4(o,o,a),e.$.add([],i,o)}(t),a=e.$.subtract([],n,r);return e.$.angle(a,r)}function td(e,t){return ed(e,t)>Math.PI/2*1.01}const id=qt(85),rd=Math.cos(id),nd=Math.sin(id),ad=e.ae.create(),od=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function sd(t,i,r,n,a,o,s,l,c){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(c*=t.pixelToTileUnitsFactor);const h=t.tileID.canonical,u=r.projection.upVectorScale(h,r.center.lat,r.worldSize).metersToTile;for(const d of i)for(const i of d){const d=i.add(l),p=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(d.x,d.y,!0):0,f=r.projection.projectTilePoint(d.x,d.y,h);if(p>0){const e=r.projection.upVector(h,d.x,d.y);f.x+=e[0]*u*p,f.y+=e[1]*u*p,f.z+=e[2]*u*p}const m=o?d:ld(f.x,f.y,f.z,n),g=o?t.tilespaceRays.map((e=>ud(e,p))):t.queryGeometry.screenGeometry,_=e.aB.transformMat4([],[f.x,f.y,f.z,1],n);if(!s&&o?c*=_[3]/r.cameraToCenterDistance:s&&!o&&(c*=r.cameraToCenterDistance/_[3]),o){const e=Lh((i.y/fa+h.y)/(1<<h.z));c/=r.projection.pixelsPerMeter(e,1)/Rh(1,e)}if(iu(g,m,c))return!0}return!1}function ld(t,i,r,n){const a=e.aB.transformMat4([],[t,i,r,1],n);return new jt(a[0]/a[3],a[1]/a[3])}const cd=e.$.fromValues(0,0,0),hd=e.$.fromValues(0,0,1);function ud(t,i){const r=e.$.create();return cd[2]=i,t.intersectsPlane(cd,hd,r),new jt(r[0],r[1])}class dd extends eu{}function pd(e,t,i,r){let{width:n,height:a}=t;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==n*a*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(n*a*i);return e.width=n,e.height=a,e.data=r,e}function fd(e,t,i){const{width:r,height:n}=t;r===e.width&&n===e.height||(md(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i,null),e.width=r,e.height=n,e.data=t.data)}function md(e,t,i,r,n,a,o,s){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,h=4===a&&s;for(let u=0;u<n.height;u++){const s=((i.y+u)*e.width+i.x)*a,d=((r.y+u)*t.width+r.x)*a;if(h)for(let e=0;e<n.width;e++){const t=s+e*a+3,i=d+e*a;c[i+0]=255,c[i+1]=255,c[i+2]=255,c[i+3]=l[t]}else if(o)for(let e=0;e<n.width;e++){const t=s+e*a,i=d+e*a,r=l[t+3],n=new $r(l[t+0]/255*r,l[t+1]/255*r,l[t+2]/255*r,r).toRenderColor(o).toArray();c[i+0]=n[0],c[i+1]=n[1],c[i+2]=n[2],c[i+3]=n[3]}else for(let e=0;e<n.width*a;e++)c[d+e]=l[s+e]}return t}Ts(dd,"HeatmapBucket",{omit:["layers"]});class gd{constructor(e,t){pd(this,e,1,t)}resize(e){fd(this,new gd(e),1)}clone(){return new gd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){md(e,t,i,r,n,1,null)}}class _d{constructor(e,t){pd(this,e,4,t)}resize(e){fd(this,new _d(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _d({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n,a,o){md(e,t,i,r,n,4,a,o)}}class yd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}let xd,vd,bd,wd;function Sd(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new _d({width:i,height:r}),a=(i,r,a)=>{t[e.evaluationKey]=a;const o=e.expression.evaluate(t);o&&(n.data[i+r+0]=Math.floor(255*o.r/o.a),n.data[i+r+1]=Math.floor(255*o.g/o.a),n.data[i+r+2]=Math.floor(255*o.b/o.a),n.data[i+r+3]=Math.floor(255*o.a))};if(e.clips)for(let o=0,s=0;o<r;++o,s+=4*i)for(let t=0,r=0;t<i;t++,r+=4){const n=t/(i-1),{start:l,end:c}=e.clips[o];a(s,r,l*(1-n)+c*n)}else for(let o=0,s=0;o<i;o++,s+=4)a(0,s,o/(i-1));return n}Ts(gd,"AlphaImage"),Ts(_d,"RGBAImage");const Ed=zl([{name:"a_pos",components:2,type:"Int16"}],4),{members:Td}=Ed;function Cd(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,n=r?t[0]*i:e.length;let a=kd(e,0,n,i,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(r&&(a=function(e,t,i,r){const n=[];for(let a=0,o=t.length;a<o;a++){const i=kd(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r,!1);i===i.next&&(i.steiner=!0),n.push(Od(i))}n.sort(zd);for(let a=0;a<n.length;a++)i=Ld(n[a],i);return i}(e,t,a,i)),e.length>80*i){s=1/0,l=1/0;let t=-1/0,r=-1/0;for(let a=i;a<n;a+=i){const i=e[a],n=e[a+1];i<s&&(s=i),n<l&&(l=n),i>t&&(t=i),n>r&&(r=n)}c=Math.max(t-s,r-l),c=0!==c?32767/c:0}return Ad(a,o,i,s,l,c,0),o}function kd(e,t,i,r,n){let a;if(n===function(e,t,i,r){let n=0;for(let a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}(e,t,i,r)>0)for(let o=t;o<i;o+=r)a=Zd(o/r|0,e[o],e[o+1],a);else for(let o=i-r;o>=t;o-=r)a=Zd(o/r|0,e[o],e[o+1],a);return a&&Ud(a,a.next)&&(Xd(a),a=a.next),a}function Md(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!Ud(r,r.next)&&0!==jd(r.prev,r,r.next))r=r.next;else{if(Xd(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function Ad(e,t,i,r,n,a,o){if(!e)return;!o&&a&&function(e,t,i,r){let n=e;do{0===n.z&&(n.z=Bd(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i=1;do{let r,n=e;e=null;let a=null;for(t=0;n;){t++;let o=n,s=0;for(let e=0;e<i&&(s++,o=o.nextZ,o);e++);let l=i;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||n.z<=o.z)?(r=n,n=n.nextZ,s--):(r=o,o=o.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=o}a.nextZ=null,i*=2}while(t>1)}(n)}(e,r,n,a);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?Id(e,r,n,a):Pd(e))t.push(l.i,e.i,c.i),Xd(e),e=c.next,s=c.next;else if((e=c)===s){o?1===o?Ad(e=Dd(Md(e),t),t,i,r,n,a,2):2===o&&Rd(e,t,i,r,n,a):Ad(Md(e),t,i,r,n,a,1);break}}}function Pd(e){const t=e.prev,i=e,r=e.next;if(jd(t,i,r)>=0)return!1;const n=t.x,a=i.x,o=r.x,s=t.y,l=i.y,c=r.y,h=n<a?n<o?n:o:a<o?a:o,u=s<l?s<c?s:c:l<c?l:c,d=n>a?n>o?n:o:a>o?a:o,p=s>l?s>c?s:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Nd(n,s,a,l,o,c,f.x,f.y)&&jd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Id(e,t,i,r){const n=e.prev,a=e,o=e.next;if(jd(n,a,o)>=0)return!1;const s=n.x,l=a.x,c=o.x,h=n.y,u=a.y,d=o.y,p=s<l?s<c?s:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=s>l?s>c?s:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,_=Bd(p,f,t,i,r),y=Bd(m,g,t,i,r);let x=e.prevZ,v=e.nextZ;for(;x&&x.z>=_&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&Nd(s,h,l,u,c,d,x.x,x.y)&&jd(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==o&&Nd(s,h,l,u,c,d,v.x,v.y)&&jd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;x&&x.z>=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&Nd(s,h,l,u,c,d,x.x,x.y)&&jd(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==o&&Nd(s,h,l,u,c,d,v.x,v.y)&&jd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Dd(e,t){let i=e;do{const r=i.prev,n=i.next.next;!Ud(r,n)&&Gd(r,i,i.next,n)&&Hd(r,n)&&Hd(n,r)&&(t.push(r.i,i.i,n.i),Xd(i),Xd(i.next),i=e=n),i=i.next}while(i!==e);return Md(i)}function Rd(e,t,i,r,n,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Vd(o,e)){let s=Wd(o,e);return o=Md(o,o.next),s=Md(s,s.next),Ad(o,t,i,r,n,a,0),void Ad(s,t,i,r,n,a,0)}e=e.next}o=o.next}while(o!==e)}function zd(e,t){return e.x-t.x}function Ld(e,t){const i=function(e,t){let i=t;const r=e.x,n=e.y;let a,o=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>o&&(o=e,a=i.x<i.next.x?i:i.next,e===r))return a}i=i.next}while(i!==t);if(!a)return null;const s=a,l=a.x,c=a.y;let h=1/0;i=a;do{if(r>=i.x&&i.x>=l&&r!==i.x&&Nd(n<c?r:o,n,l,c,n<c?o:r,n,i.x,i.y)){const t=Math.abs(n-i.y)/(r-i.x);Hd(i,e)&&(t<h||t===h&&(i.x>a.x||i.x===a.x&&Fd(a,i)))&&(a=i,h=t)}i=i.next}while(i!==s);return a}(e,t);if(!i)return t;const r=Wd(i,e);return Md(r,r.next),Md(i,i.next)}function Fd(e,t){return jd(e.prev,e,t.prev)<0&&jd(t.next,e,e.next)<0}function Bd(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Od(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Nd(e,t,i,r,n,a,o,s){return(n-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(i-o)*(t-s)&&(i-o)*(a-s)>=(n-o)*(r-s)}function Vd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Gd(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Hd(e,t)&&Hd(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(jd(e.prev,e,t.prev)||jd(e,t.prev,t))||Ud(e,t)&&jd(e.prev,e,e.next)>0&&jd(t.prev,t,t.next)>0)}function jd(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Ud(e,t){return e.x===t.x&&e.y===t.y}function Gd(e,t,i,r){const n=qd(jd(e,t,i)),a=qd(jd(e,t,r)),o=qd(jd(i,r,e)),s=qd(jd(i,r,t));return n!==a&&o!==s||!(0!==n||!$d(e,i,t))||!(0!==a||!$d(e,r,t))||!(0!==o||!$d(i,e,r))||!(0!==s||!$d(i,t,r))}function $d(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function qd(e){return e>0?1:e<0?-1:0}function Hd(e,t){return jd(e.prev,e,e.next)<0?jd(e,t,e.next)>=0&&jd(e,e.prev,t)>=0:jd(e,t,e.prev)<0||jd(e,e.next,t)<0}function Wd(e,t){const i=Yd(e.i,e.x,e.y),r=Yd(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function Zd(e,t,i,r){const n=Yd(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Xd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yd(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jd(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,a;for(let o=0;o<i;o++){const t=gi(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===a&&(a=t<0),a===t<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}if(n&&r.push(n),t>1)for(let o=0;o<r.length;o++)r[o].length<=t||(Bn(r[o],t,1,r[o].length-1,Qd),r[o]=r[o].slice(0,t));return r}function Qd(e,t){return t.area-e.area}function Kd(e,t,i){const r=i.patternDependencies;let n=!1;for(const a of t){const t=a.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const i=t.constantOr(null);i&&(n=!0,r[i]=!0)}return n}function ep(e,t,i,r,n){const a=n.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r},i,{},n.availableImages);e=e&&e.name?e.name:e,a[e]=!0,i.patterns[o.id]=e}}return i}class tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fl,this.indexArray=new ec,this.indexArray2=new Xl,this.programConfigurations=new th(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Mc,this.segments2=new Mc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}updateFootprints(e,t){}populate(e,t,i,r){this.hasPattern=Kd("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Jh(o,e);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),h,i))continue;const u=n?n.evaluate(h,{},i,t.availableImages):void 0,d={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Yh(o,i,r),patterns:{},sortKey:u};a.push(d)}n&&a.sort(((e,t)=>e.sortKey-t.sortKey));for(const o of a){const{geometry:r,index:n,sourceLayerIndex:a}=o;if(this.hasPattern){const e=ep("fill",this.layers,o,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(o,r,n,i,{},t.availableImages,t.brightness);t.featureIndex.insert(e[n].feature,r,n,a,this.index)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,a){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Td),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;for(const s of Jd(t,500)){let e=0;for(const o of s)e+=o.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),i=t.vertexLength,r=[],n=[];for(const o of s){if(0===o.length)continue;o!==s[0]&&n.push(r.length/2);const e=this.segments2.prepareSegment(o.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(o[0].x,o[0].y),this.indexArray2.emplaceBack(t+o.length-1,t),r.push(o[0].x),r.push(o[0].y);for(let i=1;i<o.length;i++)this.layoutVertexArray.emplaceBack(o[i].x,o[i].y),this.indexArray2.emplaceBack(t+i-1,t+i),r.push(o[i].x),r.push(o[i].y);e.vertexLength+=o.length,e.primitiveLength+=o.length}const a=Cd(r,n);for(let o=0;o<a.length;o+=3)this.indexArray.emplaceBack(i+a[o],i+a[o+1],i+a[o+2]);t.vertexLength+=e,t.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,o)}}let ip,rp,np,ap;Ts(tp,"FillBucket",{omit:["layers","patternFeatures"]});class op{constructor(e,t,i,r){if(this.triangleCount=t.length/3,this.min=new jt(0,0),this.max=new jt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[n,a]=[e[0].clone(),e[0].clone()];for(let h=1;h<e.length;++h){const t=e[h];n.x=Math.min(n.x,t.x),n.y=Math.min(n.y,t.y),a.x=Math.max(a.x,t.x),a.y=Math.max(a.y,t.y)}if(r){const e=Math.ceil(Math.max(a.x-n.x,a.y-n.y)/r);i=Math.max(i,e)}if(0===i)return;this.min=n,this.max=a;const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const l=[];for(let h=0;h<this.triangleCount;h++){const i=e[t[3*h+0]].sub(this.min),r=e[t[3*h+1]].sub(this.min),n=e[t[3*h+2]].sub(this.min),a=sp(Math.floor(Math.min(i.x,r.x,n.x)),this.xScale,this.cellsX),o=sp(Math.floor(Math.max(i.x,r.x,n.x)),this.xScale,this.cellsX),c=sp(Math.floor(Math.min(i.y,r.y,n.y)),this.yScale,this.cellsY),u=sp(Math.floor(Math.max(i.y,r.y,n.y)),this.yScale,this.cellsY),d=new jt(0,0),p=new jt(0,0),f=new jt(0,0),m=new jt(0,0);for(let e=c;e<=u;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=a;t<=o;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(fu(i,r,n,d,p,m)||fu(i,r,n,d,m,f))&&l.push({cellIdx:e*this.cellsX+t,triIdx:h})}}if(0===l.length)return;l.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const i=sp(e.x-this.min.x,this.xScale,this.cellsX),r=sp(e.y-this.min.y,this.yScale,this.cellsY),n=this.cells[r*this.cellsX+i];if(n){this._lazyInitLookup();for(let e=0;e<n.len;e++){const i=this.payload[n.start+e],r=Math.floor(i/8),a=1<<i%8;if(!(this.lookup[r]&a)&&(this.lookup[r]|=a,t.push(i),t.length===this.triangleCount))return}}}query(e,t,i){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const r=sp(e.x-this.min.x,this.xScale,this.cellsX),n=sp(t.x-this.min.x,this.xScale,this.cellsX),a=sp(e.y-this.min.y,this.yScale,this.cellsY),o=sp(t.y-this.min.y,this.yScale,this.cellsY);for(let s=a;s<=o;s++)for(let e=r;e<=n;e++){const t=this.cells[s*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const r=this.payload[t.start+e],n=Math.floor(r/8),a=1<<r%8;if(!(this.lookup[n]&a)&&(this.lookup[n]|=a,i.push(r),i.length===this.triangleCount))return}}}}function sp(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}Ts(op,"TriangleGridIndex");class lp{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.footprints=[]}updateFootprints(e,t){for(const i of this.footprints)t.push({footprint:i,id:e})}populate(e,t,i,r){const n=[];for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Jh(a,e);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),t,i))continue;const c={id:o,properties:a.properties,type:a.type,sourceLayerIndex:l,index:s,geometry:e?t.geometry:Yh(a,i,r),patterns:{}};n.push(c)}for(const a of n){const{geometry:r,index:n,sourceLayerIndex:o}=a;this.addFeature(a,r,n,i,{},t.availableImages,t.brightness),t.featureIndex.insert(e[n].feature,r,n,o,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,i,r,n){}destroy(){}addFeature(e,t,i,r,n){for(const a of Jd(t,2)){const e=[],t=[],i=[],r=new jt(1/0,1/0),n=new jt(-1/0,-1/0);for(const l of a)if(0!==l.length){l!==a[0]&&i.push(t.length/2);for(let i=0;i<l.length;i++)t.push(l[i].x),t.push(l[i].y),e.push(l[i]),r.x=Math.min(r.x,l[i].x),r.y=Math.min(r.y,l[i].y),n.x=Math.max(n.x,l[i].x),n.y=Math.max(n.y,l[i].y)}const o=Cd(t,i),s=new op(e,o,8,256);this.footprints.push({vertices:e,indices:o,grid:s,min:r,max:n})}}}Ts(lp,"ClipBucket",{omit:["layers"]});const cp=zl([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hp=zl([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),up=zl([{name:"a_centroid_pos",components:2,type:"Uint16"}]),dp=zl([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),pp=zl([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fp=zl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mp}=cp;var gp={},_p=Nt,yp=xp;function xp(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(vp,this,t)}function vp(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function bp(e){for(var t,i,r=0,n=0,a=e.length,o=a-1;n<a;o=n++)r+=((i=e[o]).x-(t=e[n]).x)*(t.y+i.y);return r}xp.types=["Unknown","Point","LineString","Polygon"],xp.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,n=0,a=0,o=0,s=[];e.pos<i;){if(n<=0){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),1===r&&(t&&s.push(t),t=[]),t.push(new _p(a,o));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&s.push(t),s},xp.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var h=e.readVarint();i=7&h,r=h>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<o&&(o=n),n>s&&(s=n),(a+=e.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},xp.prototype.toGeoJSON=function(e,t,i){var r,n,a=this.extent*Math.pow(2,i),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=xp.types[this.type];function h(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var u=[];for(r=0;r<l.length;r++)u[r]=l[r][0];h(l=u);break;case 2:for(r=0;r<l.length;r++)h(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],a=0;a<t;a++){var o=bp(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[e[a]]):i.push(e[a]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)h(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var wp=yp,Sp=Ep;function Ep(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Tp,this,t),this.length=this._features.length}function Tp(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}Ep.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new wp(this._pbf,t,this.extent,this._keys,this._values)};var Cp=Sp;function kp(e,t,i){if(3===e){var r=new Cp(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}var Mp=gp.VectorTile=function(e,t){this.layers=e.readFields(kp,{},t)},Ap=gp.VectorTileFeature=yp;gp.VectorTileLayer=Sp;class Pp extends jt{constructor(e,t,i){super(e,t),this.z=i}}class Ip extends Pp{constructor(e,t,i,r){super(e,t,i),this.w=r}}function Dp(e,t,i,r){const n=[],a=0===r?(e,t,i,r,n,a)=>{e.push(new jt(a,i+(a-t)/(r-t)*(n-i)))}:(e,t,i,r,n,a)=>{e.push(new jt(t+(a-i)/(n-i)*(r-t),a))};for(const o of e){const e=[];for(const n of o){if(n.length<=2)continue;const o=[];for(let e=0;e<n.length-1;e++){const s=n[e].x,l=n[e].y,c=n[e+1].x,h=n[e+1].y,u=0===r?s:l,d=0===r?c:h;u<t?d>t&&a(o,s,l,c,h,t):u>i?d<i&&a(o,s,l,c,h,i):o.push(n[e]),d<t&&u>=t&&a(o,s,l,c,h,t),d>i&&u<=i&&a(o,s,l,c,h,i)}let s=n[n.length-1];const l=0===r?s.x:s.y;l>=t&&l<=i&&o.push(s),o.length&&(s=o[o.length-1],o[0].x===s.x&&o[0].y===s.y||o.push(o[0]),e.push(o))}e.length&&n.push(e)}return n}function Rp(e,t,i,r){const n="x"===i?"y":"x",a=(r-e[i])/(t[i]-e[i]);e[n]=e[n]+(t[n]-e[n])*a,e[i]=r,e.hasOwnProperty("z")&&(e.z=Hr(e.z,t.z,a)),e.hasOwnProperty("w")&&(e.w=Hr(e.w,t.w,a))}function zp(e,t,i,r){const n=i,a=r;for(const o of["x","y"]){let i=e,r=t;i[o]>=r[o]&&(i=t,r=e),i[o]<n&&r[o]>n&&Rp(i,r,o,n),i[o]<a&&r[o]>a&&Rp(r,i,o,a)}}const Lp=Number.MAX_SAFE_INTEGER;function Fp(e,t,i,r){return e.order<t||e.order===Lp||!(e.clipMask&i)||function(e,t){return 0!==t.length&&void 0===t.find((t=>t===e))}(r,e.clipScope)}function Bp(e,t){return e.x-t.x||e.y-t.y}function Op(e,t){return 0===Bp(e.min,t.min)&&0===Bp(e.max,t.max)}function Np(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Vp(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i].sourceId!==t[i].sourceId||!Op(e[i],t[i])||e[i].order!==t[i].order||e[i].clipMask!==t[i].clipMask||!Ut(e[i].clipScope,t[i].clipScope))return!1;return!0}function jp(e,t,i){const r=1/fa,n=1/(1<<i.canonical.z),a=(t.x*r+i.canonical.x)*n+i.wrap,o=(t.y*r+i.canonical.y)*n;return{min:new jt((e.x*r+i.canonical.x)*n+i.wrap,(e.y*r+i.canonical.y)*n),max:new jt(a,o)}}function Up(e,t,i){const r=1<<i.canonical.z,n=((t.x-i.wrap)*r-i.canonical.x)*fa,a=(t.y*r-i.canonical.y)*fa;return{min:new jt(((e.x-i.wrap)*r-i.canonical.x)*fa,(e.y*r-i.canonical.y)*fa),max:new jt(n,a)}}function Gp(e,t,i,r,n,a,o){const s=e.indices,l=e.vertices,c=[];for(let h=r;h<r+n;h+=3){const r=t[i[h+0]+a],n=t[i[h+1]+a],u=t[i[h+2]+a],d=Math.min(r.x,n.x,u.x),p=Math.max(r.x,n.x,u.x),f=Math.min(r.y,n.y,u.y),m=Math.max(r.y,n.y,u.y);c.length=0,e.grid.query(new jt(d,f),new jt(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(fu(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],r,n,u,o))return!0}}return!1}function $p(e,t,i,r){if(!e||!i)return!1;let n=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(i.vertices.length<e.vertices.length)return $p(i,r,e,t);const a=t.canonical,o=r.canonical,s=Math.pow(2,o.z-a.z);n=e.vertices.map((e=>new jt((e.x+a.x*fa)*s-o.x*fa,(e.y+a.y*fa)*s-o.y*fa)))}return Gp(i,n,e.indices,0,e.indices.length,0,0)}function qp(e,t,i,r){const n=Math.pow(2,r.z-i.z);return new jt((e+i.x*fa)*n-r.x*fa,(t+i.y*fa)*n-r.y*fa)}function Hp(e,t){const i=[];t.footprint.grid.queryPoint(e,i);const r=t.footprint.indices,n=t.footprint.vertices;for(let a=0;a<i.length;a++){const t=i[a];if(hu([n[r[3*t+0]],n[r[3*t+1]],n[r[3*t+2]]],e))return!0}return!1}class Wp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Zp(e,t,i,r){let n=0,a=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(r[o])<1e-15){if(i[o]<e[o]||i[o]>t[o])return null}else{const s=1/r[o];let l=(e[o]-i[o])*s,c=(t[o]-i[o])*s;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<a&&(a=c),n>a)return null}return n}function Xp(e,t,i,r,n,a,o,s,l,c,h){const u=r-e,d=n-t,p=a-i,f=o-e,m=s-t,g=l-i,_=h[1]*g-h[2]*m,y=h[2]*f-h[0]*g,x=h[0]*m-h[1]*f,v=u*_+d*y+p*x;if(Math.abs(v)<1e-15)return null;const b=1/v,w=c[0]-e,S=c[1]-t,E=c[2]-i,T=(w*_+S*y+E*x)*b;if(T<0||T>1)return null;const C=S*p-E*d,k=E*u-w*p,M=w*d-S*u,A=(h[0]*C+h[1]*k+h[2]*M)*b;return A<0||T+A>1?null:(f*C+m*k+g*M)*b}function Yp(e,t,i){return(e-t)/(i-t)}function Jp(e,t,i,r,n,a,o,s,l){const c=1<<i,h=a-r,u=o-n,d=(e+1)/c*h+r,p=(t+0)/c*u+n,f=(t+1)/c*u+n;s[0]=(e+0)/c*h+r,s[1]=p,l[0]=d,l[1]=f}class Qp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let r=Math.ceil(Math.pow(2,t));const n=1/r,a=(e,t,i,r,n)=>{const a=r?1:0,o=(e+1)*i-a,s=t*i,l=(t+1)*i-a;n[0]=e*i,n[1]=s,n[2]=o,n[3]=l};let o=new Wp(r);const s=[];for(let l=0;l<r*r;l++){a(l%r,Math.floor(l/r),n,!1,s);const t=ef(s[0],s[1],e),i=ef(s[2],s[1],e),c=ef(s[2],s[3],e),h=ef(s[0],s[3],e);o.minimums.push(Math.min(t,i,c,h)),o.maximums.push(Math.max(t,i,c,h)),o.leaves.push(1)}for(i.push(o),r/=2;r>=1;r/=2){const e=i[i.length-1];o=new Wp(r);for(let t=0;t<r*r;t++){a(t%r,Math.floor(t/r),2,!0,s);const i=e.getElevation(s[0],s[1]),n=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),h=e.isLeaf(s[0],s[1]),u=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=h&&u&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}i.push(o)}return i}(this.dem),i=t.length-1,r=t[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,r,n,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Zp([e,t,-100],[i,r,this.maximums[0]*o],n,a)}raycast(t,i,r,n,a,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const l=this.raycastRoot(t,i,r,n,a,o,s);if(null==l)return null;const c=[],h=[],u=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:g,depth:_}=p.pop();if(this.leaves[l]){Jp(m,g,_,t,i,r,n,u,d);const l=1<<_,c=(m+0)/l,h=(m+1)/l,p=(g+0)/l,y=(g+1)/l,x=ef(c,p,this.dem)*s,v=ef(h,p,this.dem)*s,b=ef(h,y,this.dem)*s,w=ef(c,y,this.dem)*s,S=Xp(u[0],u[1],x,d[0],u[1],v,d[0],d[1],b,a,o),E=Xp(d[0],d[1],b,u[0],d[1],w,u[0],u[1],x,a,o),T=Math.min(null!==S?S:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const t=e.$.scaleAndAdd([],a,o,f);if(Kp(x,v,w,b,Yp(t[0],u[0],d[0]),Yp(t[1],u[1],d[1]))>=t[2])return f}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){Jp((m<<1)+this._siblingOffset[e][0],(g<<1)+this._siblingOffset[e][1],_+1,t,i,r,n,u,d),u[2]=-100,d[2]=this.maximums[this.childOffsets[l]+e]*s;const p=Zp(u,d,a,o);if(null!=p){const t=p;c[e]=t;let i=!1;for(let r=0;r<y&&!i;r++)t>=c[h[r]]&&(h.splice(r,0,e),i=!0);i||(h[y]=e),y++}}for(let e=0;e<y;e++){const t=h[e];p.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:_+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,r,n){if(1===e[r].isLeaf(t,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const a=r-1,o=e[a];let s=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],r=2*i+this._siblingOffset[c][1],n=o.getElevation(e,r),a=o.isLeaf(e,r),h=this._addNode(n.min,n.max,a);a&&(s|=1<<c),l||(l=h)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*i+this._siblingOffset[c][1],a,l+c)}}function Kp(e,t,i,r,n,a){return Hr(Hr(e,i,a),Hr(t,r,a),n)}function ef(e,t,i){const r=i.dim,n=Jt(e*r-.5,0,r-1),a=Jt(t*r-.5,0,r-1),o=Math.floor(n),s=Math.floor(a),l=Math.min(o+1,r-1),c=Math.min(s+1,r-1);return Kp(i.get(o,s),i.get(l,s),i.get(o,c),i.get(l,c),n-o,a-s)}const tf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function rf(e,t,i){return(256*e*256+256*t+i)/10-1e4}function nf(e,t,i){return 256*e+t+i/256-32768}class af{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return fi(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const n=this.dim=t.height-2,a=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<n;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(n,e)]=a[this._idx(n-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,n)]=a[this._idx(e,n-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(n,-1)]=a[this._idx(n-1,0)],a[this._idx(-1,n)]=a[this._idx(0,n-1)],a[this._idx(n,n)]=a[this._idx(n-1,n-1)]}const o="terrarium"===i?nf:rf;for(let s=0;s<a.length;++s){const e=4*s;this.floatView[s]=o(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=zi.now()}_buildQuadTree(){this._tree=new Qp(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Jt(e,-1,this.dim),t=Jt(t,-1,this.dim));const i=this._idx(e,t);return this.floatView[i]}set(e,t,i){const r=this._idx(e,t),n=this.floatView[r];return this.floatView[r]=i,i-n}static getUnpackVector(e){return tf[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const i=[0,0,0,0],r=af.getUnpackVector(t);let n=Math.floor((e+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new yd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,a=i*this.dim,o=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:a=o-1;break;case 1:o=a+1}const s=-t*this.dim,l=-i*this.dim;for(let c=a;c<o;c++)for(let t=r;t<n;t++){const i=4*this._idx(t,c),r=4*this._idx(t+s,c+l);this.pixels[i+0]=e.pixels[r+0],this.pixels[i+1]=e.pixels[r+1],this.pixels[i+2]=e.pixels[r+2],this.pixels[i+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ts(af,"DEMData"),Ts(Qp,"DemMinMaxQuadTree",{omit:["dem"]});class of{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const r=i||e.findDEMTileFor(t);if(!r||!r.dem)return;const n=r.dem,a=r.tileID,o=1<<t.canonical.z-a.canonical.z;return new of(r,n.dim/fa/o,[(t.canonical.x/o-a.canonical.x)*n.dim,(t.canonical.y/o-a.canonical.y)*n.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),n=Math.floor(i);return new jt(r,n)}getElevationAt(e,t,i,r){const n=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(n),s=Math.floor(a),l=this._dem;return r=!!r,i?Hr(Hr(l.get(o,s,r),l.get(o,s+1,r),a-s),Hr(l.get(o+1,s,r),l.get(o+1,s+1,r),a-s),n-o):l.get(o,s,r)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Rh(1,e)*this._dem.stride}}const sf={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},lf=Ap.types,cf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],hf=["fill-extrusion-flood-light-ground-radius"],uf=Math.pow(2,13),df=Math.pow(2,15)-1,pf=new jt(0,1),ff=2147483648;function mf(e,t,i,r,n,a,o,s){e.emplaceBack((t<<1)+o,(i<<1)+a,(Math.floor(r*uf)<<1)+n,Math.round(s))}function gf(e,t,i,r){e.emplaceBack(t.x*fa,t.y*fa,i?0:1,r?1:0)}function _f(e,t,i,r,n,a){e.emplaceBack(t.x,t.y,(i.x<<1)+r,(i.y<<1)+n,a)}function yf(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class xf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class vf{constructor(){this.centroidXY=new jt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new jt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new jt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}}class bf{constructor(){this.acc=new jt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,i){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===fa)&&t.x===i.x)!=((0===t.y||t.y===fa)&&t.y===i.y)&&this.processBorderOverlap(t,i),r&&this.checkBorderIntersection(t,i)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Hr(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>fa!=e.x>fa&&this.addBorderIntersection(1,Hr(t.y,e.y,(fa-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Hr(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>fa!=e.y>fa&&this.addBorderIntersection(3,Hr(t.x,e.x,(fa-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new jt(0,0):new jt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function wf(e,t){const i=e.add(t)._unit(),r=Jt(e.x*i.x+e.y*i.y,-1,1);var n,a,o;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*df*((a=e).x*(o=t).y-a.y*o.x<0?-1:1)}const Sf=[e=>e.x<0,e=>e.x>fa,e=>e.y<0,e=>e.y>fa];function Ef(e,t,i,r){const n=[4];if(0===r)return n;i._mult(r);const a=e.sub(i),o=t.sub(i),s=[e,t,a,o];for(let l=0;l<4;l++)for(const e of s)if(Sf[l](e)){n.push(l);break}return n}class Tf{constructor(e){this.vertexArray=new Nl,this.indexArray=new ec,this.programConfigurations=new th(e.layers,{zoom:e.zoom,lut:e.lut},(e=>hf.includes(e))),this._segments=new Mc,this.hiddenByLandmarkVertexArray=new dc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Mc}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=e.length;if(n>2){let a=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[a].length);let s;a!==this._segments.get().length-1&&(a++,this._segmentToGroundQuads[a]=[],this._segmentToRegionTriCounts[a]=[0,0,0,0,0]);{const t=e[0],i=e[1];s=wf(t.sub(e[n-1])._perp()._unit(),i.sub(t)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,h=e[l],u=e[c],d=e[c===n-1?0:c+1],p=u.sub(h)._perp()._unit(),f=wf(p,d.sub(u)._perp()._unit()),m=s,g=f;if(Pf(h,u,t)||r&&If(h,t)&&If(u,t)){s=f;continue}const _=o.vertexLength;_f(this.vertexArray,h,u,1,1,m),_f(this.vertexArray,h,u,1,0,m),_f(this.vertexArray,h,u,0,1,g),_f(this.vertexArray,h,u,0,0,g),o.vertexLength+=4;const y=Ef(h,u,p,i);for(const e of y)this._segmentToGroundQuads[a].push({id:_,region:e}),this._segmentToRegionTriCounts[a][e]+=2,o.primitiveLength+=2;s=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let i=0;i<t;i++)this._segmentToGroundQuads[i].sort(((e,t)=>e.region-t.region));for(let i=0;i<t;i++){const t=this._segmentToGroundQuads[i],r=e[i],n=this._segmentToRegionTriCounts[i];n.reduce(((e,t)=>e+t),0);let a=0;for(let e=0;e<=4;e++){const t=n[e];if(0!==t){let i=this.regionSegments[e];i||(i=this.regionSegments[e]=new Mc);const n={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+a,vertexLength:r.vertexLength,primitiveLength:t};i.get().push(n)}a+=t}for(let e=0;e<t.length;e++){const i=t[e].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,i,r,n,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,i,r,n,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,i,r,n,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,i,r,n,a)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&ff?1:0;for(let r=e.groundVertexArrayOffset;r<t;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,pp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class Cf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ec,this.footprintVertices=new Fl,this.footprintSegments=[],this.layoutVertexArray=new Ol,this.centroidVertexArray=new Sc,this.wallVertexArray=new Tc,this.indexArray=new ec,this.programConfigurations=new th(e.layers,{zoom:e.zoom,lut:e.lut},(e=>cf.includes(e))),this.segments=new Mc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new Tf(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,t){}populate(e,t,i,r){this.features=[],this.hasPattern=Kd("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=jh(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:n,id:a,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Jh(n,e);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),l,i))continue;const c={id:a,sourceLayerIndex:s,index:o,geometry:e?l.geometry:Yh(n,i,r),properties:n.properties,type:n.type,patterns:{}},h=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(ep("fill-extrusion",this.layers,c,this.zoom,t));else if(this.wallMode)for(const n of c.geometry)this.addFeature(c,[n],o,i,{},t.availableImages,r,t.brightness);else this.addFeature(c,c.geometry,o,i,{},t.availableImages,r,t.brightness);t.featureIndex.insert(n,c.geometry,o,s,this.index,h)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,i,r,n,a){for(const o of this.features){const{geometry:e}=o;if(this.wallMode)for(const s of e)this.addFeature(o,[s],o.index,t,i,r,n,a);else this.addFeature(o,e,o.index,t,i,r,n,a)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,i,r,n){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.groundEffect.update(e,t,o,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,dp.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,fp.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,up.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n,a,o,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new jt(0,0),new jt(fa,fa)],h=o.projection,u="globe"===h.name,d=this.wallMode||"Polygon"===lf[e.type],p=new bf;p.centroidDataIndex=this.centroidData.length;const f=new vf,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},r)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},r);let _;if(f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ql),this.wallMode){if(u)return void fi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==t.length)return;_=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,i=function(e){let t=0;const i=e.length;for(let r=0;r<i;r++)t+=(e[(r+1)%i].x-e[r].x)*(e[(r+1)%i].y+e[r].y);return t>=0}(e);i||(e=e.reverse());const r={isPolygon:t,geometry:[],joinNormals:[]},n=[],a=[],o=[];let s=e.length;if(s<(t?3:2))return r;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l,c,h,u,d,p=0;for(;p<s-1&&e[p].equals(e[p+1]);)p++;t&&(l=e[s-2],d=e[p].sub(l)._unit()._perp());for(let f=p;f<s;f++){if(h=f===s-1?t?e[p+1]:void 0:e[f+1],h&&e[f].equals(h))continue;d&&(u=d),l&&(c=l),l=e[f],d=h?h.sub(l)._unit()._perp():u,u=u||d;const i=u.add(d);0===i.x&&0===i.y||i._unit();const r=i.x*d.x+i.y*d.y,m=0!==r?1/r:1/0,g=u.x*d.y-u.y*d.x>0;let _="miter";"miter"===_&&m>2&&(_="bevel");const y=(e,t,i,r)=>{const s=new jt(e.x,e.y),l=new jt(e.x,e.y);s.x-=t.x*r,s.y-=t.y*r,l.x-=t.x*Math.max(i,1),l.y-=t.y*Math.max(i,1),o.push(t),n.push(s),a.push(l)};if("miter"===_)i._mult(m),y(l,i,1,0);else{const e=-Math.sqrt(m*m-1),t=g?e:0,i=g?0:e;c&&y(l,u,t,i),h&&y(l,d,t,i)}}return r.geometry=[...n,...a.reverse(),n[0]],r.joinNormals=[...o,...o.reverse(),o[o.length-1]],r}(t[0]),t=[_.geometry]}const y=(e,t)=>e<(t.length-1)/2||e===t.length-1,x=this.wallMode?[t]:Jd(t,500);for(let T=x.length-1;T>=0;T--){const e=x[T];(0===e.length||(v=e[0]).every((e=>e.x<=0))||v.every((e=>e.x>=fa))||v.every((e=>e.y<=0))||v.every((e=>e.y>=fa)))&&x.splice(T,1)}var v;let b;if(u)b=Lf(x,c,r);else{b=[];for(const e of x)b.push({polygon:e,bounds:c})}const w=d?this.edgeRadius:0,S=w>0&&this.zoom<17,E=(e,t)=>{if(0===e.length)return!1;const i=e[e.length-1];return t.x===i.x&&t.y===i.y};for(const{polygon:T,bounds:C}of b){let e=0,t=0;for(const r of T)d&&!r[0].equals(r[r.length-1])&&r.push(r[0]),t+=d?r.length-1:r.length;const i=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new xf;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const t=[],n=[];e=i.vertexLength;for(let e=0;e<T.length;e++){const o=T[e];o.length&&0!==e&&n.push(t.length/2);const s=[];let c,d;c=o[1].sub(o[0])._perp()._unit(),a.ringIndices.push(o.length-1);for(let e=1;e<o.length;e++){const n=o[e],a=o[e===o.length-1?1:e+1],l=n.clone();if(w){d=a.sub(n)._perp()._unit();const e=c.add(d)._unit(),t=w*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}if(!m||0!==w&&!S||E(s,l)||s.push(l),mf(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),this.wallMode){const t=y(e,o);gf(this.wallVertexArray,_.joinNormals[e],t,_.isPolygon)}i.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),u&&yf(this.layoutVertexExtArray,h.projectTilePoint(l.x,l.y,r),h.upVector(r,l.x,l.y))}m&&(0===w||S)&&(0!==s.length&&E(s,s[0])&&s.pop(),this.groundEffect.addData(s,C,l))}const o=Cd(t,n);for(let r=0;r<o.length;r+=3)this.footprintIndices.emplaceBack(a.vertexOffset+o[r+0],a.vertexOffset+o[r+1],a.vertexOffset+o[r+2]),this.indexArray.emplaceBack(e+o[r],e+o[r+2],e+o[r+1]),i.primitiveLength++;a.indexCount+=o.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let o=0;o<T.length;o++){const t=T[o];p.startRing(f,t[0]);let n=t.length>4&&Df(t[t.length-2],t[0],t[1]),a=w?Mf(t[t.length-2],t[0],t[1],w):0;const s=[];let c,g,x;g=t[1].sub(t[0])._perp()._unit();let v=!0;for(let o=1,l=0;o<t.length;o++){let d=t[o-1],b=t[o];const S=t[o===t.length-1?1:o+1];if(p.appendEdge(f,b,d),Pf(b,d,C)){w&&(g=S.sub(b)._perp()._unit(),v=!v);continue}const T=b.sub(d)._perp(),k=T.x/(Math.abs(T.x)+Math.abs(T.y)),M=T.y>0?1:0,A=d.dist(b);if(l+A>32768&&(l=0),w){x=S.sub(b)._perp()._unit();let e=Af(d,b,S,kf(g,x),w);isNaN(e)&&(e=0);const t=b.sub(d)._unit();d=d.add(t.mult(a))._round(),b=b.add(t.mult(-e))._round(),a=e,g=x,m&&this.zoom>=17&&(E(s,d)||s.push(d),E(s,b)||s.push(b))}const P=i.vertexLength,I=t.length>4&&Df(d,b,S);let D=Rf(l,n,v);if(mf(this.layoutVertexArray,d.x,d.y,k,M,0,0,D),mf(this.layoutVertexArray,d.x,d.y,k,M,0,1,D),this.wallMode){const e=y(o-1,t),i=_.joinNormals[o-1];gf(this.wallVertexArray,i,!e,_.isPolygon),gf(this.wallVertexArray,i,!e,_.isPolygon)}if(l+=A,D=Rf(l,I,!v),n=I,mf(this.layoutVertexArray,b.x,b.y,k,M,0,0,D),mf(this.layoutVertexArray,b.x,b.y,k,M,0,1,D),this.wallMode){const e=y(o,t),i=_.joinNormals[o];gf(this.wallVertexArray,i,!e,_.isPolygon),gf(this.wallVertexArray,i,!e,_.isPolygon)}if(i.vertexLength+=4,this.indexArray.emplaceBack(P+0,P+1,P+2),this.indexArray.emplaceBack(P+1,P+3,P+2),i.primitiveLength+=2,w){const r=e+(1===o?t.length-2:o-2),n=1===o?e:r+1;if(this.indexArray.emplaceBack(P+1,r,P+3),this.indexArray.emplaceBack(r,n,P+3),i.primitiveLength+=2,void 0===c&&(c=P),!Pf(S,t[o],C)){const e=o===t.length-1?c:i.vertexLength;this.indexArray.emplaceBack(P+2,P+3,e),this.indexArray.emplaceBack(P+3,e+1,e),this.indexArray.emplaceBack(P+3,n,e+1),i.primitiveLength+=3}v=!v}if(u){const e=this.layoutVertexExtArray,t=h.projectTilePoint(d.x,d.y,r),i=h.projectTilePoint(b.x,b.y,r),n=h.upVector(r,d.x,d.y),a=h.upVector(r,b.x,b.y);yf(e,t,n),yf(e,t,n),yf(e,i,a),yf(e,i,a)}}d&&(e+=t.length-1),m&&w&&this.zoom>=17&&(0!==s.length&&E(s,s[0])&&s.pop(),this.groundEffect.addData(s,C,l,w>0))}this.footprintSegments.push(a),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?pf:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,s),this.groundEffect.addPaintPropertiesData(e,i,n,a,r,s),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}splitToSubtiles(){const e=[];for(let o=0;o<this.centroidData.length;o++){const t=this.centroidData[o],i=+(t.min.y+t.max.y>fa),r=2*i+(+(t.min.x+t.max.x>fa)^i);for(let n=0;n<t.polygonSegLen;n++){const i=t.polygonSegIdx+n;e.push({centroidIdx:o,subtile:r,polygonSegmentIdx:i,triangleSegmentIdx:this.polygonSegments[i].triangleSegIdx})}}const t=new ec;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let i=0,r=0,n=0;for(const o of e){if(o.triangleSegmentIdx!==i)break;n++}const a=e.length;for(;r!==e.length;){i=e[r].triangleSegmentIdx;let o=0,s=r,l=r;for(let t=s;t<n&&e[t].subtile===o;t++)l++;for(;s!==n;){const r=e[s];o=r.subtile;const a=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),h={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=s;i<l;i++){const r=e[i],n=this.polygonSegments[r.polygonSegmentIdx],o=this.centroidData[r.centroidIdx].min,s=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let e=n.triangleArrayOffset;e<n.triangleArrayOffset+n.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);h.primitiveLength+=n.triangleCount,a.x=Math.min(a.x,o.x),a.y=Math.min(a.y,o.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}h.primitiveLength>0&&this.triangleSubSegments.push({segment:h,min:a,max:c}),s=l;for(let t=s;t<n&&e[t].subtile===e[s].subtile;t++)l++}r=n;for(let t=r;t<a&&e[t].triangleSegmentIdx===e[r].triangleSegmentIdx;t++)n++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,i){const r=new Mc;if(this.wallMode){for(const e of this.triangleSubSegments)r.segments.push(e.segment);return r}let n=0,a=0;const o=1<<e.canonical.z;if(t){const i=t.getMinMaxForTile(e);i&&(n=i.min,a=i.max)}a+=this.maxHeight;const s=e.toUnwrapped();let l;const c=[s.canonical.x/o+s.wrap,s.canonical.y/o],h=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=(e,t,i)=>[e[0]*(1-i[0])+t[0]*i[0],e[1]*(1-i[1])+t[1]*i[1]],d=[],p=[];for(const f of this.triangleSubSegments){d[0]=f.min.x/fa,d[1]=f.min.y/fa,p[0]=f.max.x/fa,p[1]=f.max.y/fa;const e=u(c,h,d),t=u(c,h,p);if(0===new Mu([e[0],e[1],n],[t[0],t[1],a]).intersectsPrecise(i)){l&&(r.segments.push(l),l=void 0);continue}const o=f.segment;l&&l.vertexOffset!==o.vertexOffset&&(r.segments.push(l),l=void 0),l?(l.vertexLength+=o.vertexLength,l.primitiveLength+=o.primitiveLength):l={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&r.segments.push(l),r}encodeCentroid(e,t){const i=e.centroid(),r=t.span(),n=Math.min(7,Math.round(r.x*this.tileToMeter/10)),a=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new jt(Jt(i.x,1,fa-1)<<3|n,Jt(i.y,1,fa-1)<<3|a)}encodeBorderCentroid(e){if(!e.borders)return new jt(0,0);const t=e.borders,i=Number.MAX_VALUE;if(t[0][0]!==i||t[1][0]!==i){const e=t[0][0]!==i?0:1;return new jt(6|(t[0][0]!==i?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==i?2:3;return new jt((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==i?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=ff,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,r=e.flags&ff?pf:e.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||n!==r.x){for(let e=t;e<i;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,i){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(Vp(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const a of this.centroidData)a.flags&=2147483647;const n=[];for(const a of this.activeReplacements){if(a.order<i)continue;const t=Math.pow(2,a.footprintTileId.canonical.z-e.canonical.z);for(const i of this.centroidData)if(!(i.flags&ff||a.min.x>i.max.x||i.min.x>a.max.x||a.min.y>i.max.y||i.min.y>a.max.y))for(let r=0;r<i.footprintSegLen;r++){const o=this.footprintSegments[i.footprintSegIdx+r];if(n.length=0,Ff(this.footprintVertices,o.vertexOffset,o.vertexCount,a.footprintTileId.canonical,e.canonical,n),Gp(a.footprint,n,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-t)){i.flags|=ff;break}}}for(const a of this.centroidData)this.writeCentroidToBuffer(a);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,i){let r=!1;for(let n=0;n<i.footprintSegLen;n++){const a=this.footprintSegments[i.footprintSegIdx+n];let o=0;for(const i of a.ringIndices){for(let n=o,s=i+o-1;n<i+o;s=n++){const i=this.footprintVertices.int16[2*(n+a.vertexOffset)+0],o=this.footprintVertices.int16[2*(n+a.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+a.vertexOffset)+1];o>t!=l>t&&e<(this.footprintVertices.int16[2*(s+a.vertexOffset)+0]-i)*(t-o)/(l-o)+i&&(r=!r)}o=i}}return r}getHeightAtTileCoord(e,t){let i=Number.NEGATIVE_INFINITY,r=!0;const n=4*(e+fa)*fa+(t+fa);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&ff)}:void 0}for(const a of this.centroidData)e>a.max.x||a.min.x>e||t>a.max.y||a.min.y>t||this.footprintContainsPoint(e,t,a)&&a&&a.height>i&&(i=a.height,this.partLookup[n]=a,r=!!(a.flags&ff));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function kf(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function Mf(e,t,i,r){const n=t.sub(e)._perp()._unit(),a=i.sub(t)._perp()._unit();return Af(e,t,i,kf(n,a),r)}function Af(e,t,i,r,n){const a=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(i)/3,n*a/r)}function Pf(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function If(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function Df(e,t,i){if(e.x<0||e.x>=fa||t.x<0||t.x>=fa||i.x<0||i.x>=fa)return!1;const r=i.sub(t),n=r.perp(),a=e.sub(t);return(r.x*a.x+r.y*a.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(a.x*a.x+a.y*a.y))>-.866&&n.x*a.x+n.y*a.y<0}function Rf(e,t,i){const r=t?2|e:-3&e;return i?1|r:-2&r}function zf(){const e=Math.PI/32,t=Math.tan(e),i=_h;return i*Math.sqrt(1+2*t*t)-i}function Lf(e,t,i){const r=1<<i.z,n=zh(i.x/r),a=zh((i.x+1)/r),o=Lh(i.y/r),s=Lh((i.y+1)/r);return function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;const o=[];if(!e.length||!i||!r)return o;const s=(e,t)=>{for(const i of e)o.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),h=l-c,u=[];for(let f=0;f<Math.abs(h);f++)u.push(h>0?0:1);for(let f=0;f<Math.min(l,c);f++)u.push(0),u.push(1);let d=e;if(d=Dp(d,t[0].y-n,t[1].y+n,1),d=Dp(d,t[0].x-n,t[1].x+n,0),!d.length)return o;const p=[];for(u.length?p.push({polygons:d,bounds:t,depth:0}):s(d,t);p.length;){const e=p.pop(),t=e.depth,i=u[t],r=e.bounds[0],o=e.bounds[1],l=0===i?r.x:r.y,c=0===i?o.x:o.y,h=a?a(i,l,c):.5*(l+c),d=Dp(e.polygons,l-n,h+n,i),f=Dp(e.polygons,h-n,c+n,i);if(d.length){const e=[r,new jt(0===i?h:o.x,1===i?h:o.y)];u.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):s(d,e)}if(f.length){const e=[new jt(0===i?h:r.x,1===i?h:r.y),o];u.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):s(f,e)}}return o}(e,t,Math.ceil((a-n)/11.25),Math.ceil((o-s)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=Lh((i.y+t/fa)/r);return(Dh(.5*(Lh((i.y+n/fa)/r)+e))*r-i.y)*fa}}))}function Ff(e,t,i,r,n,a){const o=Math.pow(2,r.z-n.z);for(let s=0;s<i;s++){let i=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];i=(i+n.x*fa)*o-r.x*fa,l=(l+n.y*fa)*o-r.y*fa,a.push(new jt(i,l))}}let Bf,Of;function Nf(e,t){return e.x*t.x+e.y*t.y}function Vf(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const a=t[i],o=e[0],s=n.sub(r),l=a.sub(r),c=o.sub(r),h=Nf(s,s),u=Nf(s,l),d=Nf(l,l),p=Nf(c,s),f=Nf(c,l),m=h*d-u*u,g=(d*p-u*f)/m,_=(h*f-u*p)/m,y=r.z*(1-g-_)+n.z*g+a.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function jf(e,t,i,r,n,a,o,s){const l=o*n.getElevationAt(e,t,!0,!0),c=0!==a[0],h=c?0===a[1]?o*(a[0]/7-450):o*function(e,t,i){const r=Math.floor(t[0]/8),n=Math.floor(t[1]/8),a=10*(t[0]-8*r),o=10*(t[1]-8*n),s=e.getElevationAt(r,n,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(a*l-1)),h=Math.floor(.5*(o*l-1)),u=e.tileCoordToPixel(r,n),d=2*c+1,p=2*h+1,f=function(e,t,i,r,n){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+n,i,!0),e.getElevationAtPixel(t,i+n,!0),e.getElevationAtPixel(t+r,i+n,!0)]}(e,u.x-c,u.y-h,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),x=Math.min(.25,.5*l*_/p);return s+Math.max(y*a,x*o)}(n,a,s):l;return{base:l+(0===i)?-1:i,top:c?Math.max(h+r,l+i+2):l+r}}Ts(Cf,"FillExtrusionBucket",{omit:["layers","features"]}),Ts(vf,"PartData"),Ts(xf,"FootprintSegment"),Ts(bf,"BorderCentroidData"),Ts(Tf,"GroundEffect");const Uf=zl([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gf}=Uf,$f=zl([{name:"a_packed",components:4,type:"Float32"}]),{members:qf}=$f,Hf=zl([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Wf}=Hf,Zf=zl([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xf=zl([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Yf=zl([{name:"a_projected_pos",components:4,type:"Float32"}],4);zl([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jf=zl([{name:"a_z_offset",components:1,type:"Float32"}],4),Qf=zl([{name:"a_texb",components:2,type:"Uint16"}]),Kf=zl([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),em=zl([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);zl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tm=zl([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),im=zl([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zl([{name:"triangle",components:3,type:"Uint16"}]),zl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zl([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),zl([{type:"Float32",name:"offsetX"}]),zl([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class rm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new gd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=oi(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,a=e[0]*i,o=!0;r.push({left:n,right:a,isDash:o,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){o=!o;const t=e[l];n=s*i,s+=t,a=s*i,r.push({left:n,right:a,isDash:o,zeroLength:0===t})}return r}addRoundDash(e,t,i){const r=t/2;for(let n=-i;n<=i;n++){const t=this.width*(this.nextRow+i+n);let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),h=Math.min(l,c);let u;const d=n/i*(r+1);if(o.isDash){const e=r-Math.abs(d);u=Math.sqrt(h*h+e*e)}else u=r-Math.sqrt(h*h+d*d);this.image.data[t+s]=Math.max(0,Math.min(255,u+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],i=e[s+1];t.zeroLength?e.splice(s,1):i&&i.isDash===t.isDash&&(i.left=t.left,e.splice(s,1))}const i=e[0],r=e[e.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const i=Math.abs(s-o.left),r=Math.abs(s-o.right),l=Math.min(i,r);this.image.data[n+s]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const r="round"===t,n=r?7:0,a=2*n+1;if(this.nextRow+a>this.height)return fi("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(fi("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(0!==o){const i=this.width/o,a=this.getDashRanges(e,this.width,i);r?this.addRoundDash(a,i,n):this.addRegularDash(a,"square"===t?.5*i:0)}const s=this.nextRow+n;this.nextRow+=a;const l={tl:[s,n],br:[o,0]};return this.positions[i]=l,l}}Ts(rm,"LineAtlas");const nm=Ap.types,am=Math.cos(Math.PI/180*37.5),om=Math.cos(Math.PI/180*5);class sm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Vl,this.layoutVertexArray2=new jl,this.patternVertexArray=new Ul,this.indexArray=new ec,this.programConfigurations=new th(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Mc,this.maxLineLength=0,this.zOffsetVertexArray=new rc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:fa/64}updateFootprints(e,t){}populate(e,t,i,r){this.hasPattern=Kd("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),a=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!a.isConstant()||!!a.constantOr(0);const o=[];for(const{feature:h,id:u,index:d,sourceLayerIndex:p}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Jh(h,e);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),t,i))continue;const a=n?n.evaluate(t,{},i):void 0,s={id:u,properties:h.properties,type:h.type,sourceLayerIndex:p,index:d,geometry:e?t.geometry:Yh(h,i,r),patterns:{},sortKey:a};o.push(s)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:l}=t,c=this.addConstantDashes(s);for(const h of o){const{geometry:r,index:n,sourceLayerIndex:a}=h;if(c&&this.addFeatureDashes(h,s),this.hasPattern){const e=ep("line",this.layers,h,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(h,r,n,i,s.positions,t.availableImages,t.brightness);l.insert(e[n].feature,r,n,a,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)t=!0;else{const t=n.value,i=r.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,a=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===a.kind)continue;let o,s;if("constant"===n.kind){if(o=n.value,!o)continue}else o=n.evaluate({zoom:i},e);s="constant"===a.kind?a.value:a.evaluate({zoom:i},e),t.addDash(o,s),e.patterns[r.id]=t.getKey(o,s)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,a){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qf)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Wf)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Jf.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,a,o){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap").evaluate(e,{}),h=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,r,l,c,h,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,o)}addLine(e,t,i,r,n,a,o){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const s={zoom:this.zoom,lineProgress:void 0},l=this.layers[0].layout,c="none"===r;if(this.patternJoinNone=this.hasPattern&&c,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const h="Polygon"===nm[t.type];let u=e.length;for(;u>=2&&e[u-1].equals(e[u-2]);)u--;let d=0;for(;d<u-1&&e[d].equals(e[d+1]);)d++;if(u<(h?3:2))return;"bevel"===r&&(a=1.05);const p=this.overscaling<=16?15*fa/(512*this.overscaling):0,f=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);let m,g,_,y,x,v;this.e1=this.e2=-1,h&&(m=e[u-2],x=e[d].sub(m)._unit()._perp());for(let b=d;b<u;b++){if(_=b===u-1?h?e[d+1]:void 0:e[b+1],_&&e[b].equals(_))continue;if(x&&(y=x),m&&(g=m),m=e[b],this.hasZOffset){const e=l.get("line-z-offset").value;if("constant"===e.kind)v=e.value;else{if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);s.lineProgress=(e*this.lineClips.start+this.distance+(g?g.dist(m):0))/e}else fi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),s.lineProgress=0;v=e.evaluate(s,t)}v=v||0}x=_?_.sub(m)._unit()._perp():y,y=y||x;const i=g&&_;let w=i?r:h||c?"butt":n;const S=y.x*x.x+y.y*x.y;if(c){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,i=e.lineSoFar-e.segmentStart;for(let r=0;r<t;++r){const t=e.segmentPoints[2*r+1],n=Math.round(e.segmentPoints[2*r])+.5+.25*t;e.patternVertexArray.emplaceBack(n,i,e.segmentStart),e.patternVertexArray.emplaceBack(n,i,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(i&&S<om){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,f,v),e(this),this.addCurrentVertex(m,x,-1,-1,f,v);continue}if(g){if(!_){this.updateDistance(g,m),this.addCurrentVertex(m,y,1,1,f,v),e(this);continue}w="miter"}}let E=y.add(x);0===E.x&&0===E.y||E._unit();const T=E.x*x.x+E.y*x.y,C=0!==T?1/T:1/0,k=2*Math.sqrt(2-2*T),M=T<am&&g&&_,A=y.x*x.y-y.y*x.x>0;if(M&&b>d){const e=m.dist(g);if(e>2*p){const t=m.sub(m.sub(g)._mult(p/e)._round());this.updateDistance(g,t),this.addCurrentVertex(t,y,0,0,f,v),g=t}}if(i&&"round"===w&&(C<o?w="miter":C<=2&&(w="fakeround")),"miter"===w&&C>a&&(w="bevel"),"bevel"===w&&(C>2&&(w="flipbevel"),C<a&&(w="miter")),g&&this.updateDistance(g,m),"miter"===w)E._mult(C),this.addCurrentVertex(m,E,0,0,f,v);else if("flipbevel"===w){if(C>100)E=x.mult(-1);else{const e=C*y.add(x).mag()/y.sub(x).mag();E._perp()._mult(e*(A?-1:1))}this.addCurrentVertex(m,E,0,0,f,v),this.addCurrentVertex(m,E.mult(-1),0,0,f,v)}else if("bevel"===w||"fakeround"===w){const e=-Math.sqrt(C*C-1),t=A?e:0,i=A?0:e;if(g&&this.addCurrentVertex(m,y,t,i,f,v),"fakeround"===w){const e=Math.round(180*k/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+S*(S*(3.55645-1.43519*S)-3.2452))*e*e+(.848013+S*(.215638*S-1.06021)))}const r=x.sub(y)._mult(i)._add(y)._unit()._mult(A?-1:1);this.addHalfVertex(m,r.x,r.y,!1,A,0,f,v)}}_&&this.addCurrentVertex(m,x,-t,-i,f,v)}else"butt"===w?this.addCurrentVertex(m,E,0,0,f,v):"square"===w?(g||this.addCurrentVertex(m,E,-1,-1,f,v),this.addCurrentVertex(m,E,0,0,f,v),g&&this.addCurrentVertex(m,E,1,1,f,v)):"round"===w&&(g&&(this.addCurrentVertex(m,y,0,0,f,v),this.addCurrentVertex(m,y,1,1,f,v,!0)),_&&(this.addCurrentVertex(m,x,-1,-1,f,v,!0),this.addCurrentVertex(m,x,0,0,f,v)));if(M&&b<u-1){const e=m.dist(_);if(e>2*p){const t=m.add(_.sub(m)._mult(p/e)._round());this.updateDistance(m,t),this.addCurrentVertex(t,x,0,0,f,v),m=t}}}}addVerticesTo(e,t,i,r,n,a,o,s,l,c){const h=(t.w-e.w)/this.tessellationStep|0;if(h>1){this.lineSoFar=e.w;const u=(t.x-e.x)/h,d=(t.y-e.y)/h,p=(t.z-e.z)/h,f=(t.w-e.w)/h;for(let t=1;t<h;++t)e.x+=u,e.y+=d,e.z+=p,this.lineSoFar+=f,this.addHalfVertex(e,i,r,c,!1,o,l,e.z),this.addHalfVertex(e,n,a,c,!0,-s,l,e.z)}this.lineSoFar=t.w,this.addHalfVertex(t,i,r,c,!1,o,l,t.z),this.addHalfVertex(t,n,a,c,!0,-s,l,t.z)}addCurrentVertex(e,t,i,r,n,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const s=t.x+t.y*i,l=t.y-t.x*i,c=t.y*r-t.x,h=-t.y-t.x*r;if(null!=a){const t=-10,u=fa+10,d=a,p=new Ip(e.x,e.y,d,this.lineSoFar),f=lm(e,t,u),m=this.lineSoFar;if(this.currentVertex)if(f){const a=this.currentVertexIsOutside,p=this.currentVertex,f=new Ip(e.x,e.y,d,this.lineSoFar);zp(p,f,t,u),lm(f,t,u)||(a&&(this.e1=this.e2=-1,this.lineSoFar=p.w,this.addHalfVertex(p,s,l,o,!1,i,n,p.z),this.addHalfVertex(p,c,h,o,!0,-r,n,p.z)),this.addVerticesTo(p,f,s,l,c,h,i,r,n,o))}else{const e=this.currentVertex;this.currentVertexIsOutside&&(zp(e,p,t,u),this.e1=this.e2=-1,this.lineSoFar=e.w,this.addHalfVertex(e,s,l,o,!1,i,n,e.z),this.addHalfVertex(e,c,h,o,!0,-r,n,e.z)),this.addVerticesTo(e,p,s,l,c,h,i,r,n,o)}else f||(this.addHalfVertex(e,s,l,o,!1,i,n,a),this.addHalfVertex(e,c,h,o,!0,-r,n,a));this.currentVertex=p,this.currentVertexIsOutside=f,this.lineSoFar=m}else this.addHalfVertex(e,s,l,o,!1,i,n,a),this.addHalfVertex(e,c,h,o,!0,-r,n,a)}addHalfVertex(e,t,i,r,n,a,o,s){let{x:l,y:c}=e;this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),n||this.segmentPoints.push(this.lineSoFar-this.segmentStart,a)),this.layoutVertexArray.emplaceBack((l<<1)+(r?1:0),(c<<1)+(n?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const h=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,h),o.primitiveLength++),n?this.e2=h:this.e1=h,null!=s&&this.zOffsetVertexArray.emplaceBack(s)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}function lm(e,t,i){return e.x<t||e.x>i||e.y<t||e.y>i}let cm,hm;function um(e,t,i){return t*(fa/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function dm(e,t){return 1/um(e,1,t.tileZoom)}function pm(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}Ts(sm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const fm=e=>{const t=[];mm(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const r="none"===e.layout.get("line-join").constantOr("miter"),n=!!e.paint.get("line-pattern").constantOr(1);return r&&n&&t.push("LINE_JOIN_NONE"),t};function mm(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}class gm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var _m={read:function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,c=l>>1,h=-7,u=i?n-1:0,d=i?-1:1,p=e[t+u];for(u+=d,a=p&(1<<-h)-1,p>>=-h,h+=s;h>0;a=256*a+e[t+u],u+=d,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=r;h>0;o=256*o+e[t+u],u+=d,h-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,i,r,n,a){var o,s,l,c=8*a-n-1,h=(1<<c)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=h?(s=0,o=h):o+u>=1?(s=(t*l-1)*Math.pow(2,n),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[i+p]=255&s,p+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[i+p]=255&o,p+=f,o/=256,c-=8);e[i+p-f]|=128*m}},ym=vm,xm=_m;function vm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}vm.Varint=0,vm.Fixed64=1,vm.Bytes=2,vm.Fixed32=5;var bm=4294967296,wm=1/bm,Sm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Em(e){return e.type===vm.Bytes?e.readVarint()+e.pos:e.pos+1}function Tm(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Cm(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function km(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Mm(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Am(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Pm(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Im(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Dm(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Rm(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function zm(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Lm(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Fm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Bm(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Om(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}vm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,e(n,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Fm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Om(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Fm(this.buf,this.pos)+Fm(this.buf,this.pos+4)*bm;return this.pos+=8,e},readSFixed64:function(){var e=Fm(this.buf,this.pos)+Om(this.buf,this.pos+4)*bm;return this.pos+=8,e},readFloat:function(){var e=xm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=xm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,a=i.buf;if(r=(112&(n=a[i.pos++]))>>4,n<128)return Tm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<3,n<128)return Tm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<10,n<128)return Tm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<17,n<128)return Tm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<24,n<128)return Tm(e,r,t);if(r|=(1&(n=a[i.pos++]))<<31,n<128)return Tm(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Sm?function(e,t,i){return Sm.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var a,o,s,l=e[n],c=null,h=l>239?4:l>223?3:l>191?2:1;if(n+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(a=e[n+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===h?(o=e[n+2],128==(192&(a=e[n+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(o=e[n+2],s=e[n+3],128==(192&(a=e[n+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=h}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==vm.Bytes)return e.push(this.readVarint(t));var i=Em(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==vm.Bytes)return e.push(this.readSVarint());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==vm.Bytes)return e.push(this.readBoolean());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==vm.Bytes)return e.push(this.readFloat());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==vm.Bytes)return e.push(this.readDouble());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==vm.Bytes)return e.push(this.readFixed32());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==vm.Bytes)return e.push(this.readSFixed32());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==vm.Bytes)return e.push(this.readFixed64());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==vm.Bytes)return e.push(this.readSFixed64());var t=Em(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===vm.Varint)for(;this.buf[this.pos++]>127;);else if(t===vm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===vm.Fixed32)this.pos+=4;else{if(t!==vm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Bm(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Bm(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Bm(this.buf,-1&e,this.pos),Bm(this.buf,Math.floor(e*wm),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Bm(this.buf,-1&e,this.pos),Bm(this.buf,Math.floor(e*wm),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Cm(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),xm.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),xm.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&Cm(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,vm.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,km,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Mm,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Im,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Am,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Pm,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Dm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Rm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,zm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Lm,t)},writeBytesField:function(e,t){this.writeTag(e,vm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,vm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,vm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,vm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,vm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,vm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,vm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,vm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,vm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,vm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Nm=d(ym);const Vm=["id","tile","layer","source","sourceLayer","state"];class jm{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of Vm)void 0!==this[t]&&(e[t]=this[t]);return e}}class Um{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},ii(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const n in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][n]&&delete this.deletedStates[e][r][n]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),r=ii({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const e={};for(const t in this.stateChanges[r])this.state[r][t]||(this.state[r][t]={}),ii(this.state[r][t],this.stateChanges[r][t]),e[t]=this.state[r][t];i[r]=e}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const e={};if(null===this.deletedStates[r])for(const t in this.state[r])e[t]={},this.state[r][t]={};else for(const t in this.deletedStates[r]){if(null===this.deletedStates[r][t])this.state[r][t]={};else if(this.state[r][t])for(const e of Object.keys(this.deletedStates[r][t]))delete this.state[r][t][e];e[t]=this.state[r][t]}i[r]=i[r]||{},ii(i[r],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const r in e)e[r].setFeatureState(i,t)}}class Gm{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ss(fa,16,0),this.featureIndexArray=new wc,this.promoteId=t,this.is3DTile=!1}insert(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,a);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],i=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const r=e[t];i[0]=Math.min(i[0],r.x),i[1]=Math.min(i[1],r.y),i[2]=Math.max(i[2],r.x),i[3]=Math.max(i[3],r.y)}0!==o&&(i[0]-=o,i[1]-=o,i[2]+=o,i[3]+=o),i[0]<fa&&i[1]<fa&&i[2]>=0&&i[3]>=0&&l.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mp(new Nm(this.rawTileData)).layers,this.sourceLayerCoder=new gm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,r){var n=this;this.loadVTLayers();const a=e.params||{},o=fl(a.filter),s=e.tileResult,l=e.transform,c=s.bufferedTilespaceBounds,h=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,((e,t,i,r)=>uu(s.bufferedTilespaceGeometry,e,t,i,r)));h.sort(qm);let u=null;l.elevation&&h.length>0&&(u=of.create(l.elevation,this.tileID));const d={};let p;for(let f=0;f<h.length;f++){const c=h[f];if(c===p)continue;p=c;const m=this.featureIndexArray.get(c);let g=null;if(this.is3DTile){const e=this.bucketLayerIDs[0][0],i=t[e];if("model"!==i.type)continue;const{queryFeature:r,intersectionZ:n}=i.queryIntersectsMatchingFeature(s,m.featureIndex,o,l);r&&this.appendToResult(d,e,m.featureIndex,r,n)}else this.loadMatchingFeature(d,m,o,a.layers,a.availableImages,t,i,r,(function(t,i,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return g||(g=Yh(t,n.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(s,t,r,g,n.z,e.transform,e.pixelPosMatrix,u,a)}))}return d}loadMatchingFeature(e,t,i,r,n,a,o,s,l){const{featureIndex:c,bucketIndex:h,sourceLayerIndex:u,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[h];if(r&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(u),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=Jh(m,!0);if(!i.filter(new Js(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Js(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let _=0;_<p.length;_++){const t=p[_];if(r&&r.indexOf(t)<0)continue;const i=a[t];if(!i)continue;let h={};void 0!==g&&s&&(h=s.getState(i.sourceLayer||"_geojsonTileLayer",g));const u=!l||l(m,i,h,d);if(!u)continue;const f=new jm(m,this.z,this.x,this.y,g),y=ii({},o[t]);y.paint=$m(y.paint,i.paint,m,h,n),y.layout=$m(y.layout,i.layout,m,h,n),f.layer=y,this.appendToResult(e,t,c,f,u)}}appendToResult(e,t,i,r,n){let a=e[t];void 0===a&&(a=e[t]=[]),a.push({featureIndex:i,feature:r,intersectionZ:n})}lookupSymbolFeatures(e,t,i,r,n,a,o,s){const l={};this.loadVTLayers();const c=fl(n);for(const h of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:h,layoutVertexArrayOffset:0},c,a,o,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[t])return n[t];const a=this.vtLayers[r].feature(t);return n[t]=a,a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=r&&(i=e.properties[r]),"boolean"==typeof i&&(i=Number(i))}return i}}function $m(e,t,i,r,n){return hi(e,((e,a)=>{const o=t instanceof al?t.get(a):null;return o&&o.evaluate?o.evaluate(i,r,n):o}))}function qm(e,t){return t-e}Ts(Gm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Hm=24;const Wm=128;function Zm(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Js(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let a=n;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[n],s=t[a];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:r}:{kind:"camera",minZoom:o,maxZoom:s,minSize:i.evaluate(new Js(o)),maxSize:i.evaluate(new Js(s)),interpolationType:r}}}function Xm(e,t,i){let{uSize:r,uSizeT:n}=t,{lowerSize:a,upperSize:o}=i;return"source"===e.kind?a/Wm:"composite"===e.kind?Hr(a/Wm,o/Wm,n):r}function Ym(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:a,maxZoom:o}=e,s=n?Jt(So.interpolationFactor(n,t,a,o),0,1):0;"camera"===e.kind?r=Hr(e.minSize,e.maxSize,s):i=s}return{uSizeT:i,uSize:r}}var Jm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Wm,evaluateSizeForFeature:Xm,evaluateSizeForZoom:Ym,getSizeData:Zm});function Qm(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Ys.applyArabicShaping&&(e=Ys.applyArabicShaping(e)),e}(e.text,t,i)})),e}const Km={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function eg(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function tg(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const ig=3;function rg(e,t,i){t.glyphs=[],1===e&&i.readMessage(ng,t)}function ng(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:a,left:o,top:s,advance:l}=i.readMessage(ag,{});t.glyphs.push({id:e,bitmap:new gd({width:n+2*ig,height:a+2*ig},r),metrics:{width:n,height:a,left:o,top:s,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function ag(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const og=ig,sg={horizontal:1,vertical:2,horizontalOnly:3};class lg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new lg;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new lg;return t.imageName=e,t}}class cg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new cg;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r+1)||null,a=e.charCodeAt(r-1)||null;i+=!t&&(n&&Ls(n)&&!Km[e[r+1]]||a&&Ls(a)&&!Km[e[r-1]])||!Km[e[r]]?e[r]:Km[e[r]]}return i}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&ug[this.text.charCodeAt(i)];i++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&ug[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new cg;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(lg.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let r=0;r<e.text.length;++r)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void fi("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(lg.forImage(t)),this.sectionIndex.push(this.sections.length-1)):fi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hg(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f){const m=cg.fromFeature(e,n);u===sg.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,r,n,a){if(!e)return[];const o=[],s=function(e,t,i,r,n,a){let o=0;for(let s=0;s<e.length();s++){const i=e.getSection(s);o+=pg(e.getCodePoint(s),i,r,n,t,a)}return o/Math.max(1,Math.ceil(o/i))}(e,t,i,r,n,a),l=e.text.indexOf("\u200b")>=0;let c=0;for(let u=0;u<e.length();u++){const i=e.getSection(u),d=e.getCodePoint(u);if(ug[d]||(c+=pg(d,i,r,n,t,a)),u<e.length()-1){const t=!((h=d)<11904||!(Ps["Bopomofo Extended"](h)||Ps.Bopomofo(h)||Ps["CJK Compatibility Forms"](h)||Ps["CJK Compatibility Ideographs"](h)||Ps["CJK Compatibility"](h)||Ps["CJK Radicals Supplement"](h)||Ps["CJK Strokes"](h)||Ps["CJK Symbols and Punctuation"](h)||Ps["CJK Unified Ideographs Extension A"](h)||Ps["CJK Unified Ideographs"](h)||Ps["Enclosed CJK Letters and Months"](h)||Ps["Halfwidth and Fullwidth Forms"](h)||Ps.Hiragana(h)||Ps["Ideographic Description Characters"](h)||Ps["Kangxi Radicals"](h)||Ps["Katakana Phonetic Extensions"](h)||Ps.Katakana(h)||Ps["Vertical Forms"](h)||Ps["Yi Radicals"](h)||Ps["Yi Syllables"](h)));(dg[d]||t||i.imageName)&&o.push(gg(u+1,c,s,o,mg(d,e.getCodePoint(u+1),t&&l),!1))}}var h;return _g(gg(e.length(),c,s,o,0,!0))}(m,c,a,t,r,p),{processBidirectionalText:y,processStyledBidirectionalText:x}=Ys;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new cg;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(x){const e=x(m.text,m.sectionIndex,_);for(const t of e){const e=new cg;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],r=e.text;let n=0;for(const a of t)i.push(e.substring(n,a)),n=a;return n<r.length&&i.push(e.substring(n,r.length)),i}(m,_);const v=[],b={positionedLines:v,text:m.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:u,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,r,n,a,o,s,l,c,h,u){let d=0,p=0,f=0;const m="right"===s?1:"left"===s?0:.5;let g=!1;for(const w of n){const e=w.getSections();for(const i of e){if(i.imageName)continue;const e=t[i.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let _=0;for(const w of n){w.trim();const n=w.getMaxScale(),o=(n-1)*Hm,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=s;const x=s.positionedGlyphs;let v=0;if(!w.length()){p+=a,++_;continue}let b=0,S=0;for(let a=0;a<w.length();a++){const o=w.getSection(a),s=w.getSectionIndex(a),f=w.getCodePoint(a);let m=o.scale,_=null,E=null,T=null,C=Hm,k=0;const M=!(l===sg.horizontal||!h&&!zs(f)||h&&(ug[f]||(y=f,Ps.Arabic(y)||Ps["Arabic Supplement"](y)||Ps["Arabic Extended-A"](y)||Ps["Arabic Presentation Forms-A"](y)||Ps["Arabic Presentation Forms-B"](y))));if(o.imageName){const t=r[o.imageName];if(!t)continue;T=o.imageName,e.iconsInText=e.iconsInText||!0,E=t.paddedRect;const i=t.displaySize;m=m*Hm/u,_={width:i[0],height:i[1],left:0,top:-og,advance:M?i[1]:i[0],localGlyph:!1},k=g?-_.height*m:n*Hm-17-i[1]*m,C=_.advance;const a=(M?i[0]:i[1])*m-Hm*n;a>0&&a>v&&(v=a)}else{const e=i[o.fontStack];if(!e)continue;e[f]&&(E=e[f]);const r=t[o.fontStack];if(!r)continue;const a=r.glyphs[f];if(!a)continue;if(_=a.metrics,C=8203!==f?Hm:0,g){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,i=(e+t)*m;b<i&&(b=i,S=(e-t)/2*m),k=-e*m}else k=(n-m)*Hm-17}M?(e.verticalizable=!0,x.push({glyph:f,imageName:T,x:d,y:p+k,vertical:M,scale:m,localGlyph:_.localGlyph,fontStack:o.fontStack,sectionIndex:s,metrics:_,rect:E}),d+=C*m+c):(x.push({glyph:f,imageName:T,x:d,y:p+k,vertical:M,scale:m,localGlyph:_.localGlyph,fontStack:o.fontStack,sectionIndex:s,metrics:_,rect:E}),d+=_.advance*m+c)}0!==x.length&&(f=Math.max(d-c,f),g?xg(x,m,v,S,a*n/2):xg(x,m,v,0,a/2)),d=0;const E=a*n+v;s.lineOffset=Math.max(v,o),p+=E,++_}var y;const x=p,{horizontalAlign:v,verticalAlign:b}=yg(o);(function(e,t,i,r,n,a){const o=(t-i)*n,s=-a*r;for(const l of e)for(const e of l.positionedGlyphs)e.x+=o,e.y+=s})(e.positionedLines,m,v,b,f,x),e.top+=-b*x,e.bottom=e.top+x,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,r,g,o,s,l,u,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&b}const ug={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pg(e,t,i,r,n,a){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*Hm/a+n:0}{const r=i[t.fontStack],a=r&&r.glyphs[e];return a?a.metrics.advance*t.scale+n:0}}function fg(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function mg(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function gg(e,t,i,r,n,a){let o=null,s=fg(t,i,n,a);for(const l of r){const e=fg(t-l.x,i,n,a)+l.badness;e<=s&&(o=l,s=e)}return{index:e,x:t,priorBreak:o,badness:s}}function _g(e){return e?_g(e.priorBreak).concat(e.index):[]}function yg(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function xg(e,t,i,r,n){if(!(t||i||r||n))return;const a=e.length-1,o=e[a],s=(o.x+o.metrics.advance*o.scale)*t;for(let l=0;l<=a;l++)e[l].x-=s,e[l].y+=i+r+n}function vg(e,t,i,r){const{horizontalAlign:n,verticalAlign:a}=yg(r),o=i[0]-e.displaySize[0]*n,s=i[1]-e.displaySize[1]*a;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function bg(e,t,i,r,n,a){const o=e.imagePrimary;let s;if(o.content){const e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*a,c=t.right*a;let h,u,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],u=n[0]+c+r[1]):(p=n[0]+(l+c-o.displaySize[0])/2,u=p+o.displaySize[0]);const f=t.top*a,m=t.bottom*a;return"height"===i||"both"===i?(h=n[1]+f-r[0],d=n[1]+m+r[2]):(h=n[1]+(f+m-o.displaySize[1])/2,d=h+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:h,right:u,bottom:d,left:p,collisionPadding:s}}class wg extends jt{constructor(e,t,i,r,n){super(e,t),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new wg(this.x,this.y,this.z,this.angle,this.segment)}}function Sg(e,t,i,r,n){if(void 0===t.segment)return!0;let a=t,o=t.segment+1,s=0;for(;s>-i/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;s<i/2;){const t=e[o],i=e[o+1];if(!i)return!1;let a=e[o-1].angleTo(t)-t.angleTo(i);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;o++,s+=t.dist(i)}return!0}function Eg(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Tg(e,t,i){return e?.6*t*i:0}function Cg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function kg(e,t,i,r,n,a){const o=Tg(i,n,a),s=Cg(i,r)*a;let l=0;const c=Eg(e)/2;for(let h=0;h<e.length-1;h++){const i=e[h],r=e[h+1],n=i.dist(r);if(l+n>c){const a=(c-l)/n,u=Hr(i.x,r.x,a),d=Hr(i.y,r.y,a),p=new wg(u,d,0,r.angleTo(i),h);return!o||Sg(e,p,s,o,t)?p:void 0}l+=n}}function Mg(e,t,i,r,n,a,o,s,l){const c=Tg(r,a,o),h=Cg(r,n),u=h*o,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-u<t/4&&(t=u+t/4),Ag(e,d?t/2*s%t:(h/2+2*a)*o*s%t,t,c,i,u,d,!1,l)}function Ag(e,t,i,r,n,a,o,s,l){const c=a/2,h=Eg(e);let u=0,d=t-i,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],o=e[f+1],s=t.dist(o),m=o.angleTo(t);for(;d+i<u+s;){d+=i;const g=(d-u)/s,_=Hr(t.x,o.x,g),y=Hr(t.y,o.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=h){const t=new wg(_,y,0,m,f);r&&!Sg(e,t,a,r,n)||p.push(t)}}u+=s}return s||p.length||o||(p=Ag(e,u/2,i,r,n,a,o,!0,l)),p}function Pg(e,t,i,r,n){const a=[];for(let o=0;o<e.length;o++){const s=e[o];let l;for(let e=0;e<s.length-1;e++){let o=s[e],c=s[e+1];o.x<t&&c.x<t||(o.x<t?o=new jt(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x<t&&(c=new jt(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y<i&&c.y<i||(o.y<i?o=new jt(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round():c.y<i&&(c=new jt(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round()),o.x>=r&&c.x>=r||(o.x>=r?o=new jt(r,o.y+(r-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x>=r&&(c=new jt(r,o.y+(r-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y>=n&&c.y>=n||(o.y>=n?o=new jt(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round():c.y>=n&&(c=new jt(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round()),l&&o.equals(l[l.length-1])||(l=[o],a.push(l)),l.push(c)))))}}return a}function Ig(e){let t=0,i=0;for(const o of e)t+=o.w*o.h,i=Math.max(i,o.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,a=0;for(const o of e)for(let e=r.length-1;e>=0;e--){const t=r[e];if(!(o.w>t.w||o.h>t.h)){if(o.x=t.x,o.y=t.y,a=Math.max(a,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===t.w&&o.h===t.h){const t=r.pop();e<r.length&&(r[e]=t)}else o.h===t.h?(t.x+=o.w,t.w-=o.w):o.w===t.w?(t.y+=o.h,t.h-=o.h):(r.push({x:t.x+o.w,y:t.y,w:t.w-o.w,h:o.h}),t.y+=o.h,t.h-=o.h);break}}return{w:n,h:a,fill:t/(n*a)||0}}Ts(wg,"Anchor");const Dg=1;class Rg{constructor(e,t){let{pixelRatio:i,version:r,stretchX:n,stretchY:a,content:o}=t;this.paddedRect=e,this.pixelRatio=i,this.stretchX=n,this.stretchY=a,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+Dg,this.paddedRect.y+Dg]}get br(){return[this.paddedRect.x+this.paddedRect.w-Dg,this.paddedRect.y+this.paddedRect.h-Dg]}get displaySize(){return[(this.paddedRect.w-2*Dg)/this.pixelRatio,(this.paddedRect.h-2*Dg)/this.pixelRatio]}}class zg{constructor(e,t,i){const r={},n={};this.haveRenderCallbacks=[];const a=[];this.addImages(e,r,a),this.addImages(t,n,a);const{w:o,h:s}=Ig(a),l=new _d({width:o||1,height:s||1});for(const c in e){const t=e[c],n=r[c].paddedRect;_d.copy(t.data,l,{x:0,y:0},{x:n.x+Dg,y:n.y+Dg},t.data,i,t.sdf)}for(const c in t){const e=t[c],r=n[c].paddedRect,a=r.x+Dg,o=r.y+Dg,s=e.data.width,h=e.data.height;_d.copy(e.data,l,{x:0,y:0},{x:a,y:o},e.data,i),_d.copy(e.data,l,{x:0,y:h-1},{x:a,y:o-1},{width:s,height:1},i),_d.copy(e.data,l,{x:0,y:0},{x:a,y:o+h},{width:s,height:1},i),_d.copy(e.data,l,{x:s-1,y:0},{x:a-1,y:o},{width:1,height:h},i),_d.copy(e.data,l,{x:0,y:0},{x:a+s,y:o},{width:1,height:h},i)}this.image=l,this.iconPositions=r,this.patternPositions=n}addImages(e,t,i){for(const r in e){const n=e[r],a={x:0,y:0,w:n.data.width+2*Dg,h:n.data.height+2*Dg};i.push(a),t[r]=new Rg(a,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,i))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],e.getImage(r,i),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r,i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl,a=!!Object.keys(this.patternPositions).length;i.update(t.data,{useMipmap:a},{x:r,y:n})}}Ts(Rg,"ImagePosition"),Ts(zg,"ImageAtlas");const Lg=1e20;function Fg(e,t,i,r,n,a,o,s,l){for(let c=t;c<t+r;c++)Bg(e,i*a+c,a,n,o,s,l);for(let c=i;c<i+n;c++)Bg(e,c*a+t,1,r,o,s,l)}function Bg(e,t,i,r,n,a,o){a[0]=0,o[0]=-Lg,o[1]=Lg,n[0]=e[t];for(let s=1,l=0,c=0;s<r;s++){n[s]=e[t+s*i];const r=s*s;do{const e=a[l];c=(n[s]-n[e]+r-e*e)/(s-e)/2}while(c<=o[l]&&--l>-1);l++,a[l]=s,o[l]=c,o[l+1]=Lg}for(let s=0,l=0;s<r;s++){for(;o[l+1]<s;)l++;const r=a[l],c=s-r;e[t+s*i]=n[r]+c*c}}const Og=2,Ng={none:0,ideographs:1,all:2};class Vg{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,i){const n=[],a=this.urls[t]||r.GLYPHS_URL;for(const r in e)for(const t of e[r])n.push({stack:r,id:t});ei(n,((e,t)=>{let{stack:i,id:r}=e,n=this.entries[i];n||(n=this.entries[i]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let o=n.glyphs[r];if(void 0!==o)return void t(null,{stack:i,id:r,glyph:o});if(o=this._tinySDF(n,i,r),o)return n.glyphs[r]=o,void t(null,{stack:i,id:r,glyph:o});const s=Math.floor(r/256);if(256*s>65535)return void t(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void t(null,{stack:i,id:r,glyph:o});let l=n.requests[s];l||(l=n.requests[s]=[],Vg.loadGlyphRange(i,s,a,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[s]=!0}for(const i of l)i(e,t);delete n.requests[s]}))),l.push(((e,n)=>{e?t(e):n&&t(null,{stack:i,id:r,glyph:n.glyphs[r]||null})}))}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:n}of t)void 0===e[i]&&(e[i]={}),void 0===e[i].glyphs&&(e[i].glyphs={}),e[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[i].ascender=this.entries[i].ascender,e[i].descender=this.entries[i].descender;i(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ng.none&&(this.localGlyphMode===Ng.all?!!this.localFontFamily:!!this.localFontFamily&&(Ps["CJK Unified Ideographs"](e)||Ps["Hangul Syllables"](e)||Ps.Hiragana(e)||Ps.Katakana(e)||Ps["CJK Symbols and Punctuation"](e)||Ps["CJK Unified Ideographs Extension A"](e)||Ps["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=e.tinySDF;if(!n){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),n=e.tinySDF=new Vg.TinySDF({fontFamily:r,fontWeight:i,fontSize:24*Og,buffer:3*Og,radius:8*Og}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const a=String.fromCodePoint(i),{data:o,width:s,height:l,glyphWidth:c,glyphHeight:h,glyphLeft:u,glyphTop:d,glyphAdvance:p}=n.draw(a);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new gd({width:s,height:l},o),metrics:{width:c/Og,height:h/Og,left:u/Og,top:d/Og-27,advance:p/Og,localGlyph:!0}}}}Vg.loadGlyphRange=function(e,t,i,r,n){const a=256*t,o=a+255,s=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${a}-${o}`),Ki.Glyphs);rr(s,((e,t)=>{if(e)n(e);else if(t){const e={},i=function(e){return new Nm(e).readFields(rg,{})}(t);for(const t of i.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},Vg.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:a="normal",fontStyle:o="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=r,this.radius=i;const s=this.size=e+4*t,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${a} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:a}=this.ctx.measureText(e),o=Math.ceil(i),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-n))),l=Math.min(this.size-this.buffer,o+Math.ceil(r)),c=s+2*this.buffer,h=l+2*this.buffer,u=Math.max(c*h,0),d=new Uint8ClampedArray(u),p={data:d,width:c,height:h,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,s,l),f.fillText(e,m,m+o);const y=f.getImageData(m,m,s,l);_.fill(Lg,0,u),g.fill(0,0,u);for(let x=0;x<l;x++)for(let e=0;e<s;e++){const t=y.data[4*(x*s+e)+3]/255;if(0===t)continue;const i=(x+m)*c+e+m;if(1===t)_[i]=0,g[i]=Lg;else{const e=.5-t;_[i]=e>0?e*e:0,g[i]=e<0?e*e:0}}Fg(_,0,0,c,h,c,this.f,this.v,this.z),Fg(g,m,m,s,l,c,this.f,this.v,this.z);for(let x=0;x<u;x++){const e=Math.sqrt(_[x])-Math.sqrt(g[x]);d[x]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const jg=Dg;function Ug(e,t,i,r){const n=[],a=e.imagePrimary,o=a.pixelRatio,s=a.paddedRect.w-2*jg,l=a.paddedRect.h-2*jg,c=e.right-e.left,h=e.bottom-e.top,u=a.stretchX||[[0,s]],d=a.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=u.reduce(p,0),m=d.reduce(p,0),g=s-f,_=l-m;let y=0,x=f,v=0,b=m,w=0,S=g,E=0,T=_;if(a.content&&r){const e=a.content;y=Gg(u,0,e[0]),v=Gg(d,0,e[1]),x=Gg(u,e[0],e[2]),b=Gg(d,e[1],e[3]),w=e[0]-y,E=e[1]-v,S=e[2]-e[0]-x,T=e[3]-e[1]-b}const C=(r,n,s,l)=>{const u=qg(r.stretch-y,x,c,e.left),d=Hg(r.fixed-w,S,r.stretch,f),p=qg(n.stretch-v,b,h,e.top),g=Hg(n.fixed-E,T,n.stretch,m),_=qg(s.stretch-y,x,c,e.left),C=Hg(s.fixed-w,S,s.stretch,f),k=qg(l.stretch-v,b,h,e.top),M=Hg(l.fixed-E,T,l.stretch,m),A=new jt(u,p),P=new jt(_,p),I=new jt(_,k),D=new jt(u,k),R=new jt(d/o,g/o),z=new jt(C/o,M/o),L=t*Math.PI/180;if(L){const e=Math.sin(L),t=Math.cos(L),i=[t,-e,e,t];A._matMult(i),P._matMult(i),D._matMult(i),I._matMult(i)}const F=r.stretch+r.fixed,B=s.stretch+s.fixed,O=n.stretch+n.fixed,N=l.stretch+l.fixed,V=e.imageSecondary;return{tl:A,tr:P,bl:D,br:I,texPrimary:{x:a.paddedRect.x+jg+F,y:a.paddedRect.y+jg+O,w:B-F,h:N-O},texSecondary:V?{x:V.paddedRect.x+jg+F,y:V.paddedRect.y+jg+O,w:B-F,h:N-O}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:z,minFontScaleX:S/o/c,minFontScaleY:T/o/h,isSDF:i}};if(r&&(a.stretchX||a.stretchY)){const e=$g(u,g,f),t=$g(d,_,m);for(let i=0;i<e.length-1;i++){const r=e[i],a=e[i+1];for(let e=0;e<t.length-1;e++)n.push(C(r,t[e],a,t[e+1]))}}else n.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return n}function Gg(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function $g(e,t,i){const r=[{fixed:-jg,stretch:0}];for(const[n,a]of e){const e=r[r.length-1];r.push({fixed:n-e.stretch,stretch:e.stretch}),r.push({fixed:n-e.stretch,stretch:e.stretch+(a-n)})}return r.push({fixed:t+jg,stretch:i}),r}function qg(e,t,i,r){return e/t*i+r}function Hg(e,t,i,r){return e-t*i/r}function Wg(e,t,i,r){const n=t+e.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(t+e.positionedLines[r-1].lineOffset))/2}function Zg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=1/0,n=1/0,a=-1/0,o=-1/0;const s=e[0];for(let p=0;p<s.length;p++){const e=s[p];(!p||e.x<r)&&(r=e.x),(!p||e.y<n)&&(n=e.y),(!p||e.x>a)&&(a=e.x),(!p||e.y>o)&&(o=e.y)}const l=Math.min(a-r,o-n);let c=l/2;const h=new pa([],Xg);if(0===l)return new jt(r,n);for(let p=r;p<a;p+=l)for(let t=n;t<o;t+=l)h.push(new Yg(p+c,t+c,c,e));let u=function(e){let t=0,i=0,r=0;const n=e[0];for(let a=0,o=n.length,s=o-1;a<o;s=a++){const e=n[a],o=n[s],l=e.x*o.y-o.x*e.y;i+=(e.x+o.x)*l,r+=(e.y+o.y)*l,t+=3*l}return new Yg(i/t,r/t,0,e)}(e),d=h.length;for(;h.length;){const r=h.pop();(r.d>u.d||!u.d)&&(u=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-u.d<=t||(c=r.h/2,h.push(new Yg(r.p.x-c,r.p.y-c,c,e)),h.push(new Yg(r.p.x+c,r.p.y-c,c,e)),h.push(new Yg(r.p.x-c,r.p.y+c,c,e)),h.push(new Yg(r.p.x+c,r.p.y+c,c,e)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${u.d}`)),u.p}function Xg(e,t){return t.max-e.max}class Yg{constructor(e,t,i,r){this.p=new jt(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const a=t[n];for(let t=0,n=a.length,o=n-1;t<n;o=t++){const n=a[t],s=a[o];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(i=!i),r=Math.min(r,lu(e,n,s))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const Jg=Number.POSITIVE_INFINITY,Qg=Math.sqrt(2);function Kg(e,t){let[i,r]=t,n=0,a=0;if(r===Jg){i<0&&(i=0);const t=i/Qg;switch(e){case"top-right":case"top-left":a=t-7;break;case"bottom-right":case"bottom-left":a=7-t;break;case"bottom":a=7-i;break;case"top":a=i-7}switch(e){case"top-right":case"bottom-right":n=-t;break;case"top-left":case"bottom-left":n=t;break;case"left":n=i;break;case"right":n=-i}}else{switch(i=Math.abs(i),r=Math.abs(r),e){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-i;break;case"top-left":case"bottom-left":case"left":n=i}}return[n,a]}function e_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function t_(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f){let m=a.textMaxSize.evaluate(t,{},u);void 0===m&&(m=o);const g=e.layers[0].layout,_=g.get("icon-offset").evaluate(t,{},u),y=a_(i.horizontal)||i.vertical,x="globe"===d.name,v=Hm,b=o/v,w=e.tilePixelRatio*m/v,S=(I=e.overscaling,e.zoom>18&&I>2&&(I>>=1),Math.max(fa/(512*I),1)*g.get("symbol-spacing")),E=g.get("text-padding")*e.tilePixelRatio,T=g.get("icon-padding")*e.tilePixelRatio,C=qt(g.get("text-max-angle")),k="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),M="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),A=g.get("symbol-placement"),P=S/2;var I;const D=g.get("icon-text-fit").evaluate(t,{},u),R=g.get("icon-text-fit-padding").evaluate(t,{},u),z="none"!==D;let L;!1===e.hasAnyIconTextFit&&z&&(e.hasAnyIconTextFit=!0),r&&z&&(e.allowVerticalPlacement&&i.vertical&&(L=bg(r,i.vertical,D,R,_,b)),y&&(r=bg(r,y,D,R,_,b)));const F=(o,s,m)=>{if(s.x<0||s.x>=fa||s.y<0||s.y>=fa)return;let g=null;if(x){const{x:e,y:t,z:i}=d.projectTilePoint(s.x,s.y,m);g={anchor:new wg(e,t,i,0,void 0),up:d.upVector(m,s.x,s.y)}}!function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b,w,S,E,T,C){const k=e.addToLineVertexArray(t,r);let M,A,P,I,D,R,z,L=0,F=0,B=0,O=0,N=-1,V=-1;const j={};let U=Rr("");const G=i?i.anchor:t,$="none"!==l.layout.get("icon-text-fit").evaluate(v,{},E);let q=0,H=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[q,H]=l.layout.get("text-offset").evaluate(v,{},E).map((e=>e*Hm)):(q=l.layout.get("text-radial-offset").evaluate(v,{},E)*Hm,H=Jg),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(f)R=s_(e),s&&(z=s_(s));else{const i=l.layout.get("text-rotate").evaluate(v,{},E)+90;P=o_(c,G,t,h,u,d,e,p,i,m),s&&(I=o_(c,G,t,h,u,d,s,_,i))}}if(a){const r=l.layout.get("icon-rotate").evaluate(v,{},E),n=Ug(a,r,w,$),o=s?Ug(s,r,w,$):void 0;A=o_(c,G,t,h,u,d,a,_,r),L=4*n.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[Wm*l.layout.get("icon-size").evaluate(v,{},E)],f[0]>r_&&fi(`${e.layerIds[0]}: Value for "icon-size" is >= ${i_}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[Wm*b.compositeIconSizes[0].evaluate(v,{},E),Wm*b.compositeIconSizes[1].evaluate(v,{},E)],(f[0]>r_||f[1]>r_)&&fi(`${e.layerIds[0]}: Value for "icon-size" is >= ${i_}. Reduce your "icon-size".`)),e.addSymbols(e.icon,n,f,x,y,v,!1,i,t,k.lineStartIndex,k.lineLength,-1,S,E,T,C),N=e.icon.placedSymbolArray.length-1,o&&(F=4*o.length,e.addSymbols(e.icon,o,f,x,y,v,sg.vertical,i,t,k.lineStartIndex,k.lineLength,-1,S,E,T,C),V=e.icon.placedSymbolArray.length-1)}for(const Y in n.horizontal){const r=n.horizontal[Y];M||(U=Rr(r.text),f?D=s_(r):M=o_(c,G,t,h,u,d,r,p,l.layout.get("text-rotate").evaluate(v,{},E),m));const a=1===r.positionedLines.length;if(B+=n_(e,i,t,r,o,l,f,v,m,k,n.vertical?sg.horizontal:sg.horizontalOnly,a?Object.keys(n.horizontal):[Y],j,N,b,S,E,T),a)break}n.vertical&&(O+=n_(e,i,t,n.vertical,o,l,f,v,m,k,sg.vertical,["vertical"],j,V,b,S,E,T));let W=-1;const Z=(e,t)=>e?Math.max(e,t):t;W=Z(D,W),W=Z(R,W),W=Z(z,W);const X=W>-1?1:0;e.glyphOffsetArray.length>=65535&&fi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,N,V,U,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,I||e.collisionBoxArray.length,I?I+1:e.collisionBoxArray.length,h,B,O,L,F,X,0,q,H,W,0,$?1:0)}(e,s,g,o,i,r,n,L,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,E,k,l,0,T,M,_,t,a,c,h,u,p,f)};if("line"===A)for(const B of Pg(t.geometry,0,0,fa,fa)){const t=Mg(B,S,C,i.vertical||y,r,v,w,e.overscaling,fa);for(const i of t)y&&l_(e,y.text,P,i)||F(B,i,u)}else if("line-center"===A){for(const B of t.geometry)if(B.length>1){const e=kg(B,C,i.vertical||y,r,v,w);e&&F(B,e,u)}}else if("Polygon"===t.type)for(const B of Jd(t.geometry,0)){const e=Zg(B,16);F(B[0],new wg(e.x,e.y,0,0,void 0),u)}else if("LineString"===t.type)for(const B of t.geometry)F(B,new wg(B[0].x,B[0].y,0,0,void 0),u);else if("Point"===t.type)for(const B of t.geometry)for(const e of B)F([e],new wg(e.x,e.y,0,0,void 0),u)}const i_=255,r_=i_*Wm;function n_(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_){const y=function(e,t,i,r,n,a,o,s){const l=[];if(0===t.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,h=function(e){const t=e[0],i=e[1],r=t*i;return r>0?[t,-i]:r<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let u=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)u-=m.lineOffset;const d=t.positionedLines.length,p=u/d;let f=t.top-i[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=Wg(t,p,f,m);for(const r of e.positionedGlyphs){if(!r.rect)continue;const e=r.rect||{};let a=og+1,u=!0,d=1,p=0;if(r.imageName){const e=o[r.imageName];if(!e)continue;if(e.sdf){fi("SDF images are not supported in formatted text and will be ignored.");continue}u=!1,d=e.pixelRatio,a=Dg/d}const m=(n||s)&&r.vertical,g=r.metrics.advance*r.scale/2,_=r.metrics,y=r.rect;if(null===y)continue;s&&t.verticalizable&&(p=r.imageName?g-r.metrics.width*r.scale/2:0);const x=n?[r.x+g,r.y]:[0,0];let v=[0,0],b=[0,0],w=!1;n||(m?(b=[r.x+g+h[0],r.y+h[1]-p],w=!0):v=[r.x+g+i[0],r.y+i[1]-p]);const S=y.w*r.scale/(d*(r.localGlyph?Og:1)),E=y.h*r.scale/(d*(r.localGlyph?Og:1));let T,C,k,M;if(m){const e=r.y-f,t=new jt(-g,g-e),i=-Math.PI/2,n=new jt(...b);T=new jt(-g+v[0],v[1]),T._rotateAround(i,t)._add(n),T.x+=-e+g,T.y-=(_.left-a)*r.scale;const o=r.imageName?_.advance*r.scale:Hm*r.scale,s=String.fromCodePoint(r.glyph);eg(s)?T.x+=(1-a)*r.scale:tg(s)?T.x+=o-_.height*r.scale+(-a-1)*r.scale:T.x+=r.imageName||_.width+2*a===y.w&&_.height+2*a===y.h?(o-E)/2:(o-(_.height+2*a)*r.scale)/2,C=new jt(T.x,T.y-S),k=new jt(T.x+E,T.y),M=new jt(T.x+E,T.y-S)}else{const e=(_.left-a)*r.scale-g+v[0],t=(-_.top-a)*r.scale+v[1],i=e+S,n=t+E;T=new jt(e,t),C=new jt(i,t),k=new jt(e,n),M=new jt(i,n)}if(c){let e;e=n?new jt(0,0):w?new jt(h[0],h[1]):new jt(i[0],i[1]),T._rotateAround(c,e),C._rotateAround(c,e),k._rotateAround(c,e),M._rotateAround(c,e)}const A=new jt(0,0),P=new jt(0,0);l.push({tl:T,tr:C,bl:k,br:M,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:x,sectionIndex:r.sectionIndex,isSDF:u,pixelOffsetTL:A,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,a,o,s,n,e.allowVerticalPlacement),x=e.textSizeData;let v=null;"source"===x.kind?(v=[Wm*a.layout.get("text-size").evaluate(s,{},g)],v[0]>r_&&fi(`${e.layerIds[0]}: Value for "text-size" is >= ${i_}. Reduce your "text-size".`)):"composite"===x.kind&&(v=[Wm*f.compositeTextSizes[0].evaluate(s,{},g),Wm*f.compositeTextSizes[1].evaluate(s,{},g)],(v[0]>r_||v[1]>r_)&&fi(`${e.layerIds[0]}: Value for "text-size" is >= ${i_}. Reduce your "text-size".`)),e.addSymbols(e.text,y,v,l,o,s,h,t,i,c.lineStartIndex,c.lineLength,p,m,g,_,!1);for(const b of u)d[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function a_(e){for(const t in e)return e[t];return null}function o_(e,t,i,r,n,a,o,s,l,c){let h=o.top,u=o.bottom,d=o.left,p=o.right;const f=o.collisionPadding;if(f&&(d-=f[0],h-=f[1],p+=f[2],u+=f[3]),l){const e=new jt(d,h),t=new jt(p,h),i=new jt(d,u),r=new jt(p,u),n=qt(l);let a=new jt(0,0);c&&(a=new jt(c[0],c[1])),e._rotateAround(n,a),t._rotateAround(n,a),i._rotateAround(n,a),r._rotateAround(n,a),d=Math.min(e.x,t.x,i.x,r.x),p=Math.max(e.x,t.x,i.x,r.x),h=Math.min(e.y,t.y,i.y,r.y),u=Math.max(e.y,t.y,i.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,h,p,u,s,r,n,a),e.length-1}function s_(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function l_(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}function c_(e,t){const i=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),a=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),o=Math.sin(e._pitch)*a+n;return Math.min(1.01*o,n*(1/e._horizonShift))}function h_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),r=e.x*i,n=(e.x+1)*i,a=e.y*i,o=(e.y+1)*i,s=zh(r),l=zh(n),c=Lh(a),h=Lh(o),u=t.project(s,c),d=t.project(l,c),p=t.project(l,h),f=t.project(s,h);let m=Math.min(u.x,d.x,p.x,f.x),g=Math.min(u.y,d.y,p.y,f.y),_=Math.max(u.x,d.x,p.x,f.x),y=Math.max(u.y,d.y,p.y,f.y);const x=i/16;function v(e,i,r,n,a,o){const s=(r+a)/2,l=(n+o)/2,c=t.project(zh(s),Lh(l)),h=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),h>x&&(v(e,c,r,n,s,l),v(c,i,s,l,a,o))}v(u,d,r,a,n,a),v(d,p,n,a,n,o),v(p,f,n,o,r,o),v(f,u,r,o,r,a),m-=x,g-=x,_+=x,y+=x;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function u_(e,t){let{x:i,y:r}=t;return new jt(((i-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*fa,(r*e.scale-e.y)*fa)}const d_=e.ae.identity(new Float32Array(16));class p_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new xh(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return Rh(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return c_(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,r){const n=e.horizonLineFromTop(!1),a=new jt(t,Math.max(n,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,r))}pointCoordinate3D(e,t,i){const r=new jt(t,i);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return d_}createTileMatrix(t,i,r){let n,a,o;const s=r.canonical,l=e.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=h_(s,this);n=1,a=c.x+r.wrap*c.scale,o=c.y,e.ae.scale(l,l,[n/c.scale,n/c.scale,t.pixelsPerMeter/i])}else n=i/t.zoomScale(s.z),a=(s.x+Math.pow(2,s.z)*r.wrap)*n,o=s.y*n;return e.ae.translate(l,l,[a,o,0]),e.ae.scale(l,l,[n/fa,n/fa,1]),l}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class f_ extends p_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(qt(t));this.n=(r+Math.sin(qt(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:r,r0:n}=this,a=qt(e-this.center[0]),o=qt(t),s=Math.sqrt(r-2*i*Math.sin(o))/i;return{x:s*Math.sin(a*i),y:s*Math.cos(a*i)-n,z:0}}unproject(e,t){const{n:i,c:r,r0:n}=this,a=n+t;let o=Math.atan2(e,Math.abs(a))*Math.sign(a);a*i<0&&(o-=Math.PI*Math.sign(e)*Math.sign(a));const s=qt(this.center[0])*i;o=Kt(o,-Math.PI-s,Math.PI-s);const l=Jt(Ht(o/i)+this.center[0],-180,180),c=Math.asin(Jt((r-(e*e+a*a)*i*i)/(2*i),-1,1)),h=Jt(Ht(c),-Bh,Bh);return new xh(l,h)}}const m_=1.340264,g_=-.081106,__=893e-6,y_=.003796,x_=Math.sqrt(3)/2;class v_ extends p_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(x_*Math.sin(t)),r=i*i,n=r*r*r;return{x:.5*(e*Math.cos(i)/(x_*(m_+3*g_*r+n*(7*__+9*y_*r)))/Math.PI+.5),y:1-.5*(i*(m_+g_*r+n*(__+y_*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=i*i,n=r*r*r;for(let c,h,u,d=0;d<12&&(h=i*(m_+g_*r+n*(__+y_*r))-t,u=m_+3*g_*r+n*(7*__+9*y_*r),c=h/u,i=Jt(i-c,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(c)<1e-12));++d);const a=x_*e*(m_+3*g_*r+n*(7*__+9*y_*r))/Math.cos(i),o=Math.asin(Math.sin(i)/x_),s=Jt(180*a/Math.PI,-180,180),l=Jt(180*o/Math.PI,-Bh,Bh);return new xh(s,l)}}class b_ extends p_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),r=Jt(360*(.5-t),-Bh,Bh);return new xh(i,r)}}const w_=Math.PI/2;function S_(e){return Math.tan((w_+e)/2)}class E_ extends p_{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let r=qt(t),n=qt(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const a=Math.cos(r),o=S_(r);this.n=r===n?Math.sin(r):Math.log(a/Math.cos(n))/Math.log(S_(n)/o),this.f=a*Math.pow(S_(r),this.n)/this.n}project(e,t){t=qt(t),this.southernCenter&&(t=-t),e=qt(e-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?t<-w_+i&&(t=-w_+i):t>w_-i&&(t=w_-i);const a=n/Math.pow(S_(t),r);let o=a*Math.sin(r*e),s=n-a*Math.cos(r*e);return o=.5*(o/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:o,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:r}=this,n=r-t,a=Math.sign(n),o=Math.sign(i)*Math.sqrt(e*e+n*n);let s=Math.atan2(e,Math.abs(n))*a;n*i<0&&(s-=Math.PI*Math.sign(e)*a);const l=Jt(Ht(s/i)+this.center[0],-180,180),c=Jt(Ht(2*Math.atan(Math.pow(r/o,1/i))-w_),-Bh,Bh);return new xh(l,this.southernCenter?-c:c)}}class T_ extends p_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Ih(e),y:Dh(t),z:0}}unproject(e,t){const i=zh(e),r=Lh(t);return new xh(i,r)}}const C_=qt(Bh);class k_ extends p_{project(e,t){const i=(t=qt(t))*t,r=i*i;return{x:.5*((e=qt(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=25,n=0,a=i*i;do{a=i*i;const e=a*a;n=(i*(1.007226+a*(.015085+e*(.028874*a-.044475-.005916*e)))-t)/(1.007226+a*(.045255+e*(.259866*a-.311325-.005916*11*e))),i=Jt(i-n,-C_,C_)}while(Math.abs(n)>1e-6&&--r>0);a=i*i;const o=Jt(Ht(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),s=Ht(i);return new xh(o,s)}}const M_=qt(Bh);class A_ extends p_{project(e,t){t=qt(t),e=qt(e);const i=Math.cos(t),r=2/Math.PI,n=Math.acos(i*Math.cos(e/2)),a=Math.sin(n)/n,o=.5*(e*r+2*i*Math.sin(e/2)/a)||0,s=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,n=25;const a=1e-6;let o=0,s=0;do{const n=Math.cos(r),a=Math.sin(r),l=2*a*n,c=a*a,h=n*n,u=Math.cos(i/2),d=Math.sin(i/2),p=2*u*d,f=d*d,m=1-h*u*u,g=m?1/m:0,_=m?Math.acos(n*u)*Math.sqrt(1/m):0,y=.5*(2*_*n*d+2*i/Math.PI)-e,x=.5*(_*a+r)-t,v=.5*g*(h*f+_*n*u*c)+1/Math.PI,b=g*(p*l/4-_*a*d),w=.125*g*(l*d-_*a*h*p),S=.5*g*(c*u+_*f*n)+.5,E=b*w-S*v;o=(x*b-y*S)/E,s=(y*w-x*v)/E,i=Jt(i-o,-Math.PI,Math.PI),r=Jt(r-s,-M_,M_)}while((Math.abs(o)>a||Math.abs(s)>a)&&--n>0);return new xh(Ht(i),Ht(r))}}class P_ extends p_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:r}=this;return{x:qt(e)*r*i+.5,y:-Math.sin(qt(t))/r*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:r}=this,n=-(t-.5)/i,a=Jt(Ht((e-.5)/i)/r,-180,180),o=Math.asin(Jt(n*r,-1,1)),s=Jt(Ht(o),-Bh,Bh);return new xh(a,s)}}class I_ extends T_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,r){const n=qu(t,i,r),a=Zu(Ou(r));return e.$.transformMat4(n,n,a),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,i){const r=gh(i.lat,i.lng),n=e.$.normalize([],r),a=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,o=Rh(1,0)*fa*a;e.$.scaleAndAdd(r,r,n,o);const s=e.ae.identity(new Float64Array(16));return e.ae.multiply(s,t.pixelMatrix,t.globeMatrix),e.$.transformMat4(r,r,s),new jt(r[0],r[1])}pixelsPerMeter(e,t){return Rh(1,0)*t}pixelSpaceConversion(e,t,i){const r=Rh(1,e)*t,n=Hr(Rh(1,45)*t,r,i);return this.pixelsPerMeter(e,t)/n}createTileMatrix(t,i,r){const n=Xu(Ou(r.canonical));return e.ae.multiply(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,i){const{center:r}=t,n=Zu(Ou(i));return e.ae.rotateY(n,n,qt(r.lng)),e.ae.rotateX(n,n,qt(r.lat)),e.ae.scale(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,i,r){return Lu(e,t,i,!0)||new Uh(0,0)}pointCoordinate3D(e,t,i){const r=this.pointCoordinate(e,t,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!Lu(e,t.x,t.y,!1)}farthestPixelDistance(t){const i=function(t,i){const r=t.cameraToCenterDistance,n=t._centerAltitude*i,a=t._camera,o=t._camera.forward(),s=e.$.add([],e.$.scale([],o,-r),[0,0,n]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],h=t.width/t.height,u=Math.tan(t.fovAboveCenter),d=e.$.scale([],a.up(),u),p=e.$.scale([],a.right(),u*h),f=e.$.normalize([],e.$.add([],e.$.add([],o,d),p)),m=[];let g;if(new bu(s,f).closestPointOnSphere(c,l,m)){const i=e.$.add([],m,c),r=e.$.sub([],i,s);g=Math.cos(t.fovAboveCenter)*e.$.length(r)}else{const t=e.$.sub([],s,c),i=e.$.sub([],c,s);e.$.normalize(i,i);const r=e.$.length(t)-l;g=Math.sqrt(r*(r+2*l));const n=Math.acos(g/(l+r))-Math.acos(e.$.dot(o,i));g*=Math.cos(n)}return 1.01*g}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=Ku(t.zoom);if(r>0){const e=c_(t,Rh(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),a=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Hr(i,e+n*(1-Math.cos(a)),Math.pow(r,10))}return i}upVector(e,t,i){return qu(t,i,e,1)}upVectorScale(e){return{metersToTile:Ru(Hu(Ou(e)))}}}function D_(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new T_(e);case"equirectangular":return new b_(e);case"naturalEarth":return new k_(e);case"equalEarth":return new v_(e);case"winkelTripel":return new A_(e);case"albers":return i?new P_(e):new f_(e);case"lambertConformalConic":return i?new P_(e):new E_(e);case"globe":return new I_(e)}throw new Error(`Invalid projection name: ${e.name}`)}const R_=Ap.types,z_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function L_(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=s?Math.min(r_,Math.round(s[0])):0,f=s?Math.min(r_,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),a,o,(p<<1)+(l?1:0),f,16*c,16*h,256*u,256*d)}function F_(e,t,i){e.emplaceBack(t,i)}function B_(e,t,i,r,n,a,o){e.emplaceBack(t,i,r,n,a,o)}function O_(e,t,i,r,n){e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n)}function N_(e){for(const t of e.sections)if(Os(t.text))return!0;return!1}class V_{constructor(e){this.layoutVertexArray=new Hl,this.indexArray=new ec,this.programConfigurations=e,this.segments=new Mc,this.dynamicLayoutVertexArray=new jl,this.opacityVertexArray=new Zl,this.placedSymbolArray=new gc,this.iconTransitioningVertexArray=new Xl,this.globeExtVertexArray=new Wl,this.zOffsetVertexArray=new rc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,i,r,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Yf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,z_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Qf.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Xf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Jf.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ts(V_,"SymbolBuffers");class j_{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new Mc,this.collisionVertexArray=new Kl,this.collisionVertexArrayExt=new jl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Kf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ts(j_,"CollisionBuffers");class U_{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.ae.identity([]),this.placementViewportMatrix=e.ae.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zm(this.zoom,i["text-size"]),this.iconSizeData=Zm(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),a=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>sg[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new V_(new th(this.layers,{zoom:this.zoom,lut:this.lut},(e=>/^text/.test(e)))),this.icon=new V_(new th(this.layers,{zoom:this.zoom,lut:this.lut},(e=>/^icon/.test(e)))),this.glyphOffsetArray=new xc,this.lineVertexArray=new vc,this.symbolInstances=new yc}calculateGlyphDependencies(e,t,i,r,n){for(let a=0;a<e.length;a++){const i=e.codePointAt(a);if(void 0===i)break;if(t[i]=!0,r&&n&&i<=65535){const i=Km[e.charAt(a)];i&&(t[i.charCodeAt(0)]=!0)}}}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Vp(this.activeReplacements,i)&&(this.activeReplacements=i,!0)}populate(t,i,r,n){const a=this.layers[0],o=a.layout,s="globe"===this.projection.name,l=o.get("text-font"),c=o.get("text-field"),h=o.get("icon-image"),u=("constant"!==c.value.kind||c.value.value instanceof _n&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==h.value.kind||!!h.value.value||Object.keys(h.parameters).length>0,p=o.get("symbol-sort-key");if(this.features=[],!u&&!d)return;const f=i.iconDependencies,m=i.glyphDependencies,g=i.availableImages,_=new Js(this.zoom);for(const{feature:y,id:x,index:v,sourceLayerIndex:b}of t){const t=a._featureFilter.needGeometry,i=Jh(y,t);if(!a._featureFilter.filter(_,i,r))continue;if(t||(i.geometry=Yh(y,r,n)),s&&1!==y.type&&r.z<=5){const t=i.geometry,n=.98078528056,a=(t,i)=>{const a=qu(t.x,t.y,r,1),o=qu(i.x,i.y,r,1);return e.$.dot(a,o)<n};for(let e=0;e<t.length;e++)t[e]=Hh(t[e],a)}let c,h;if(u){const e=a.getValueAndResolveTokens("text-field",i,r,g),t=_n.factory(e);N_(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Zs()||this.hasRTLText&&Ys.isParsed())&&(c=Qm(t,a,i))}if(d){const e=a.getValueAndResolveTokens("icon-image",i,r,g);h=e instanceof yn?e:yn.fromString(e)}if(!c&&!h)continue;const w=this.sortFeaturesByKey?p.evaluate(i,{},r):void 0;if(this.features.push({id:x,text:c,icon:h,index:v,sourceLayerIndex:b,geometry:i.geometry,properties:y.properties,type:R_[y.type],sortKey:w}),h&&(f[h.namePrimary]=!0,h.nameSecondary&&(f[h.nameSecondary]=!0)),c){const e=l.evaluate(i,{},r).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sg.vertical)>=0;for(const i of c.sections)if(i.image)f[i.image.namePrimary]=!0;else{const r=Is(c.toString()),n=i.fontStack||e,a=m[n]=m[n]||{};this.calculateGlyphDependencies(i.text,a,t,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function a(t){r.push(e[t]),n++}function o(e,t,n){const a=i[e];return delete i[e],i[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(n[0]),a}function s(e,i,n){const a=t[i];return delete t[i],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=n[0].concat(r[a].geometry[0]),a}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const h=e[c],u=h.geometry,d=h.text?h.text.toString():null;if(!d){a(c);continue}const p=l(d,u),f=l(d,u,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,u),n=o(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?o(p,f,u):f in t?s(p,f,u):(a(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,r,n){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,o,i,r,n)}updateZOffset(){const e=(e,t,r)=>{i+=t,i>e.length&&e.resize(i);for(let n=-t;n<0;n++)e.emplace(n+i,r)},t=(e,t,i)=>{r+=t,r>e.length&&e.resize(r);for(let n=-t;n<0;n++)e.emplace(n+r,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:a,numIconVertices:o}=i,s=i.zOffset,l=o>0;if((r>0||a>0)&&(e(this.text.zOffsetVertexArray,r,s),e(this.text.zOffsetVertexArray,a,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:r}=i;e>=0&&t(this.icon.zOffsetVertexArray,o,s),r>=0&&t(this.icon.zOffsetVertexArray,i.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=D_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:r,y:n}of t)this.lineVertexArray.emplaceBack(r,n);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,x=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?a.sortKey:void 0),v=this.glyphOffsetArray.length,b=x.vertexLength,w=this.allowVerticalPlacement&&o===sg.vertical?Math.PI/2:0,S=a.text&&a.text.sections;for(let T=0;T<t.length;T++){const{tl:r,tr:n,bl:o,br:c,texPrimary:h,texSecondary:u,pixelOffsetTL:v,pixelOffsetBR:b,minFontScaleX:E,minFontScaleY:C,glyphOffset:k,isSDF:M,sectionIndex:A}=t[T],P=x.vertexLength,I=k[1];if(L_(_,l.x,l.y,r.x,I+r.y,h.x,h.y,i,M,v.x,v.y,E,C),L_(_,l.x,l.y,n.x,I+n.y,h.x+h.w,h.y,i,M,b.x,v.y,E,C),L_(_,l.x,l.y,o.x,I+o.y,h.x,h.y+h.h,i,M,v.x,b.y,E,C),L_(_,l.x,l.y,c.x,I+c.y,h.x+h.w,h.y+h.h,i,M,b.x,b.y,E,C),s){const{x:t,y:i,z:r}=s.anchor,[n,a,o]=s.up;B_(y,t,i,r,n,a,o),B_(y,t,i,r,n,a,o),B_(y,t,i,r,n,a,o),B_(y,t,i,r,n,a,o),O_(e.dynamicLayoutVertexArray,t,i,r,w)}else O_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=u||h;F_(e.iconTransitioningVertexArray,t.x,t.y),F_(e.iconTransitioningVertexArray,t.x+t.w,t.y),F_(e.iconTransitioningVertexArray,t.x,t.y+t.h),F_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),T!==t.length-1&&A===t[T+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,a,a.index,{},d,p,f,S&&S[A])}const E=s?s.anchor:l;e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,l.x,l.y,v,this.glyphOffsetArray.length-v,b,c,h,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,0,!1,0,u,0)}_commitLayoutVertex(e,t,i,r,n,a,o){e.emplaceBack(t,i,r,n,a,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,i,r,n,a,o){const s=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=s.vertexLength,c=o.tileAnchorX,h=o.tileAnchorY;for(let d=0;d<4;d++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,t,e.padding,o.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new jt(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new jt(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new jt(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new jt(e.x1,e.y2)),s.vertexLength+=4;const u=i.indexArray;u.emplaceBack(l,l+1),u.emplaceBack(l+1,l+2),u.emplaceBack(l+2,l+3),u.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new j_(Jl,tm.members,Xl),this.iconCollisionBox=new j_(Jl,tm.members,Xl);const i=Ym(this.iconSizeData,e),r=Ym(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,i,r){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),a=Xm(this.textSizeData,e,n)/Hm;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,i){const r=this.icon.placedSymbolArray.get(i),n=Xm(this.iconSizeData,e,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,i,r){e.emplaceBack(t,-i,-i,r),e.emplaceBack(t,i,-i,r),e.emplaceBack(t,i,i,r),e.emplaceBack(t,-i,i,r)}_updateTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding,a.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Ym(this.iconSizeData,e),r=Ym(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,a,o,s,l){const c={};if(t<i){const{x1:i,y1:r,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:r,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:t,y1:i,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(r);c.verticalTextBox={x1:t,y1:i,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(a<o){const{x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(a);c.iconBox={x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.iconFeatureIndex=p}if(s<l){const{x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(s);c.verticalIconBox={x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let n=i.vertexStartIndex;n<r;n+=4)e.indexArray.emplaceBack(n,n+1,n+2),e.indexArray.emplaceBack(n+1,n+2,n+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const e=this.symbolInstances.get(o);r.push(0|Math.round(t*e.tileAnchorX+i*e.tileAnchorY)),n.push(e.featureIndex)}return a.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:s}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ts(U_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),U_.addDynamicAttributes=O_;class G_{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,t,i){const{width:r,height:n}=e,{context:a}=this,{gl:o}=a;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),this.useMipmap=Boolean(t&&t.useMipmap),i||this.size&&this.size[0]===r&&this.size[1]===n){const{x:t,y:a}=i||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)o.texSubImage2D(o.TEXTURE_2D,0,t,a,o.RGBA,o.UNSIGNED_BYTE,e);else{let i=this.format,s=o.UNSIGNED_BYTE;this.format===o.R32F&&(i=o.RED,s=o.FLOAT),o.texSubImage2D(o.TEXTURE_2D,0,t,a,r,n,i,s,e.data)}}else if(this.size=[r,n],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===o.R8&&(t=o.RED),o.texImage2D(o.TEXTURE_2D,0,this.format,t,o.UNSIGNED_BYTE,e)}else{let t=this.format,i=this.format,a=o.UNSIGNED_BYTE,s=!1;this.format===o.DEPTH_COMPONENT&&(t=o.DEPTH_COMPONENT16,a=o.UNSIGNED_SHORT),this.format===o.DEPTH_STENCIL&&(t=o.DEPTH24_STENCIL8,a=o.UNSIGNED_INT_24_8,s=!0),this.format===o.R8&&(i=o.RED),this.format===o.R32F&&(a=o.FLOAT,i=o.RED),!this.useMipmap&&s?o.texStorage2D(o.TEXTURE_2D,1,t,r,n):o.texImage2D(o.TEXTURE_2D,0,t,r,n,0,i,a,e.data)}this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,i,r){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class $_{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}}const q_=32,H_=33,W_=new Uint16Array(8184);for(let Tb=0;Tb<2046;Tb++){let e=Tb+2,t=0,i=0,r=0,n=0,a=0,o=0;for(1&e?r=n=a=q_:t=i=o=q_;(e>>=1)>1;){const s=t+r>>1,l=i+n>>1;1&e?(r=t,n=i,t=a,i=o):(t=r,i=n,r=a,n=o),a=s,o=l}const s=4*Tb;W_[s+0]=t,W_[s+1]=i,W_[s+2]=r,W_[s+3]=n}const Z_=new Uint16Array(2178),X_=new Uint8Array(1089),Y_=new Uint16Array(1089);function J_(e){return 0===e?-.03125:32===e?.03125:0}var Q_=zl([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class K_{constructor(e,t,i,r){this.id=K_.uniqueIdxCounter,K_.uniqueIdxCounter++,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=K_.uniqueIdxCounter,K_.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}K_.uniqueIdxCounter=0;class ey{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}ey.ReadOnly=!1,ey.ReadWrite=!0,ey.disabled=new ey(519,ey.ReadOnly,[0,1]);const ty=7680;class iy{constructor(e,t,i,r,n,a){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=a}}iy.disabled=new iy({func:519,mask:0},0,0,ty,ty,ty);const ry=771;class ny{constructor(e,t,i,r){this.blendFunction=e,this.blendColor=t,this.mask=i,this.blendEquation=r}}ny.Replace=[1,0,1,0],ny.disabled=new ny(ny.Replace,$r.transparent,[!1,!1,!1,!1]),ny.unblended=new ny(ny.Replace,$r.transparent,[!0,!0,!0,!0]),ny.alphaBlended=new ny([1,ry,1,ry],$r.transparent,[!0,!0,!0,!0]),ny.alphaBlendedNonPremultiplied=new ny([770,ry,770,ry],$r.transparent,[!0,!0,!0,!0]),ny.multiply=new ny([774,0,774,0],$r.transparent,[!0,!0,!0,!0]);const ay=1029,oy=2305;class sy{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}sy.disabled=new sy(!1,ay,oy),sy.backCCW=new sy(!0,ay,oy),sy.backCW=new sy(!0,ay,2304),sy.frontCW=new sy(!0,1028,2304),sy.frontCCW=new sy(!0,1028,oy);var ly=zl([{name:"a_index",type:"Int16",components:1}]);const cy={type:2,extent:fa,loadGeometry:()=>[[new jt(0,0),new jt(fa+1,0),new jt(fa+1,fa+1),new jt(0,fa+1),new jt(0,0)]]};class hy{constructor(e,t,i,r,n){this.tileID=e,this.uid=ni(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<zi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=h_(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.fqid]=r}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof U_){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof U_&&t.hasRTLText){this.hasRTLText=!0,Ys.isLoading()||Ys.isLoaded()||"deferred"!==Zs()||Xs();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e],r=t.style.getOwnLayer(e);if(!r)continue;const n=r.queryRadius(i);this.queryPadding=Math.max(this.queryPadding,n)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new fc}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const r in this.buckets){const t=this.buckets[r];t.uploadPending()&&t.upload(e)}const t=e.gl,i=this.imageAtlas;if(i&&!i.uploaded){const r=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new G_(e,i.image,t.RGBA,{useMipmap:r}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new G_(e,this.glyphAtlasImage,t.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new G_(e,this.lineAtlas.image,t.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=t.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,i,r,n,a,o,s){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:o,transform:a,params:n,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),n=t?t.sourceLayer:"",a=r._geojsonTileLayer||r[n];if(!a)return;const o=fl(t&&t.filter),{z:s,x:l,y:c}=this.tileID.canonical,h={z:s,x:l,y:c};for(let u=0;u<a.length;u++){const t=a.feature(u);if(o.needGeometry){const e=Jh(t,!0);if(!o.filter(new Js(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new Js(this.tileID.overscaledZ),t))continue;const r=i.getId(t,n),d=new jm(t,s,l,c,r);d.tile=h,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=xi(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const r=this.expirationTime-t;r?this.expirationTime=e+Math.max(r,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages(),n=t.style.getBrightness();for(const a in this.buckets){if(!t.style.hasLayer(a))continue;const o=this.buckets[a],s=o.layers[0].sourceLayer||"_geojsonTileLayer",l=i[s];let c={};if(e&&(c=e[s],!l||!c||0===Object.keys(c).length))continue;if(o.update(c,l,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},n),o instanceof sm||o instanceof tp){const e=t.style.getOwnSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const h=t&&t.style&&t.style.getOwnLayer(a);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zi.now()+e}setTexture(e,t){const i=t.context,r=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof G_?this.texture.update(e,{useMipmap:!0}):(this.texture=new G_(i,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){const i={};for(const r of t)i[r]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const i=Yh(cy,this.tileID.canonical,this.tileTransform)[0],r=new Fl,n=new sc;for(let a=0;a<i.length;a++){const{x:e,y:t}=i[a];r.emplaceBack(e,t),n.emplaceBack(a)}n.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(n),this._tileDebugBuffer=e.createVertexBuffer(r,Du.members),this._tileDebugSegments=Mc.simpleSegment(0,0,r.length,n.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const i=Yh(cy,this.tileID.canonical,this.tileTransform)[0];let r,n;if(this.isRaster){const e=function(e,t){const i=h_(e,t),r=Math.pow(2,e.z);for(let c=0;c<H_;c++)for(let n=0;n<H_;n++){const a=zh((e.x+(n+J_(n))/q_)/r),o=Lh((e.y+(c+J_(c))/q_)/r),s=t.project(a,o),l=c*H_+n;Z_[2*l+0]=Math.round((s.x*i.scale-i.x)*fa),Z_[2*l+1]=Math.round((s.y*i.scale-i.y)*fa)}X_.fill(0),Y_.fill(0);for(let c=2045;c>=0;c--){const e=4*c,t=W_[e+0],i=W_[e+1],r=W_[e+2],n=W_[e+3],a=t+r>>1,o=i+n>>1,s=a+o-i,l=o+t-a,h=i*H_+t,u=n*H_+r,d=o*H_+a,p=Math.hypot((Z_[2*h+0]+Z_[2*u+0])/2-Z_[2*d+0],(Z_[2*h+1]+Z_[2*u+1])/2-Z_[2*d+1])>=16;X_[d]=X_[d]||(p?1:0),c<1022&&(X_[d]=X_[d]||X_[(i+l>>1)*H_+(t+s>>1)]||X_[(n+l>>1)*H_+(r+s>>1)])}const n=new Ol,a=new ec;let o=0;function s(e,t){const i=t*H_+e;return 0===Y_[i]&&(n.emplaceBack(Z_[2*i+0],Z_[2*i+1],e*fa/q_,t*fa/q_),Y_[i]=++o),Y_[i]-1}function l(e,t,i,r,n,o){const c=e+i>>1,h=t+r>>1;if(Math.abs(e-n)+Math.abs(t-o)>1&&X_[h*H_+c])l(n,o,e,t,c,h),l(i,r,n,o,c,h);else{const l=s(e,t),c=s(i,r),h=s(n,o);a.emplaceBack(l,c,h)}}return l(0,0,q_,q_,q_,0),l(q_,q_,0,0,0,q_),{vertices:n,indices:a}}(this.tileID.canonical,t);r=e.vertices,n=e.indices}else{r=new Ol,n=new ec;for(const{x:t,y:n}of i)r.emplaceBack(t,n,0,0);const e=Cd(r.int16,void 0,4);for(let t=0;t<e.length;t+=3)n.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,Q_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(n),this._tileBoundsSegments=Mc.simpleSegment(0,0,r.length,n.length)}_makeGlobeTileDebugBuffers(t,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const n=this.tileID.canonical,a=Zu(Vu(n,i)),o=Ku(i.zoom);let s;o>0&&(s=e.ae.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,i,a,s,o),this._makeGlobeTileDebugTextBuffer(t,n,i,a,s,o)}_globePoint(t,i,r,n,a,o,s){let l=qu(t,i,r);if(o){const a=1<<r.z,c=Ih(n.center.lng),h=Dh(n.center.lat),u=(r.x+.5)/a-c;let d=0;u>.5?d=-1:u<-.5&&(d=1);let p=(t/fa+r.x)/a+d,f=(i/fa+r.y)/a;p=(p-c)*n._pixelsPerMercatorPixel+c,f=(f-h)*n._pixelsPerMercatorPixel+h;const m=[p*n.worldSize,f*n.worldSize,0];e.$.transformMat4(m,m,o),l=Nu(l,m,s)}return e.$.transformMat4(l,l,a)}_makeGlobeTileDebugBorderBuffer(e,t,i,r,n,a){const o=new Fl,s=new sc,l=new Bl,c=(e,c,h,u,d)=>{const p=(h-e)/(d-1),f=(u-c)/(d-1),m=o.length;for(let g=0;g<d;g++){const h=e+g*p,u=c+g*f;o.emplaceBack(h,u);const d=this._globePoint(h,u,t,i,r,n,a);l.emplaceBack(d[0],d[1],d[2]),s.emplaceBack(m+g)}},h=fa;c(0,0,h,0,16),c(h,0,h,h,16),c(h,h,0,h,16),c(0,h,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(o,Du.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Iu.members),this._tileDebugSegments=Mc.simpleSegment(0,0,o.length,s.length)}_makeGlobeTileDebugTextBuffer(e,t,i,r,n,a){const o=fa/4,s=new Fl,l=new ec,c=new Bl,h=25;l.reserve(32),s.reserve(h),c.reserve(h);const u=(e,t)=>h*e+t;for(let d=0;d<h;d++){const e=d*o;for(let l=0;l<h;l++){const h=l*o;s.emplaceBack(h,e);const u=this._globePoint(h,e,t,i,r,n,a);c.emplaceBack(u[0],u[1],u[2])}}for(let d=0;d<4;d++)for(let e=0;e<4;e++){const t=u(d,e),i=u(d,e+1),r=u(d+1,e),n=u(d+1,e+1);l.emplaceBack(t,i,r),l.emplaceBack(r,i,n)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(s,Du.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,Iu.members),this._tileDebugTextSegments=Mc.simpleSegment(0,0,h,32)}destroy(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof G_&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function uy(e,t,i){1===e?t.header_length=i.readFixed32():2===e?t.x=i.readVarint():3===e?t.y=i.readVarint():4===e?t.z=i.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(gy,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)}(i,i.readVarint()+i.pos))}function dy(e,t,i){1===e?(t.delta_filter=function(e,t){return e.readFields(py,{block_size:0},t)}(i,i.readVarint()+i.pos),t.filter="delta_filter"):2===e?(i.readVarint(),t.filter="zigzag_filter"):3===e?(i.readVarint(),t.filter="bitshuffle_filter"):4===e&&(i.readVarint(),t.filter="byteshuffle_filter")}function py(e,t,i){1===e&&(t.block_size=i.readVarint())}function fy(e,t,i){1===e?(i.readVarint(),t.codec="gzip_data"):2===e?(i.readVarint(),t.codec="jpeg_image"):3===e?(i.readVarint(),t.codec="webp_image"):4===e&&(i.readVarint(),t.codec="png_image")}function my(e,t,i){1===e?t.first_byte=i.readFixed64():2===e?t.last_byte=i.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(dy,{},t)}(i,i.readVarint()+i.pos)):4===e?t.codec=function(e,t){return e.readFields(fy,{},t)}(i,i.readVarint()+i.pos):5===e?t.deprecated_offset=i.readFloat():6===e?t.deprecated_scale=i.readFloat():7===e?t.bands.push(i.readString()):8===e?t.offset=i.readDouble():9===e&&(t.scale=i.readDouble())}function gy(e,t,i){1===e?t.version=i.readVarint():2===e?t.name=i.readString():3===e?t.units=i.readString():4===e?t.tilesize=i.readVarint():5===e?t.buffer=i.readVarint():6===e?t.pixel_format=i.readVarint():7===e&&t.data_index.push(function(e,t){return e.readFields(my,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},t)}(i,i.readVarint()+i.pos))}function _y(e,t,i){if(2===e)!function(e,t,i){e.readFields(yy,i,t)}(i,i.readVarint()+i.pos,t);else if(3===e)throw new Error("Not implemented")}function yy(e,t,i){if(1===e){let e=0;const r=i.readVarint()+i.pos;for(;i.pos<r;)t[e++]=i.readVarint()}}class xy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}}function vy(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let r=2;r>=1;r--){const n=1===r?1:0,a=2===r?1:0;for(let r=0;r<t[0];r++){const o=t[1]*r;for(let r=n;r<t[1];r++){const n=t[2]*(r+o);for(let r=a;r<t[2];r++){const a=t[3]*(r+n);for(let r=0;r<t[3];r++){const t=a+r;e[t]+=e[t-i]}}}}i*=t[r]}return e}function by(e){for(let t=0,i=e.length;t<i;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function wy(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];e[t]=(240&i)>>4|(61440&i)>>8|(240&r)<<4|61440&r,e[t+1]=15&i|(3840&i)>>4|(15&r)<<8|(3840&r)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const i=e[t],r=e[t+1],n=e[t+2],a=e[t+3];e[t+0]=(192&i)>>6|(192&r)>>4|(192&n)>>2|192&a,e[t+1]=(48&i)>>4|(48&r)>>2|48&n|(48&a)<<2,e[t+2]=(12&i)>>2|12&r|(12&n)<<2|(12&a)<<4,e[t+3]=3&i|(3&r)<<2|(3&n)<<4|(3&a)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}var Sy=Uint8Array,Ey=Uint16Array,Ty=Int32Array,Cy=new Sy([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ky=new Sy([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),My=new Sy([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ay=function(e,t){for(var i=new Ey(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];var n=new Ty(i[30]);for(r=1;r<30;++r)for(var a=i[r];a<i[r+1];++a)n[a]=a-i[r]<<5|r;return{b:i,r:n}},Py=Ay(Cy,2),Iy=Py.b,Dy=Py.r;Iy[28]=258,Dy[258]=28;for(var Ry=Ay(ky,0).b,zy=new Ey(32768),Ly=0;Ly<32768;++Ly){var Fy=(43690&Ly)>>1|(21845&Ly)<<1;zy[Ly]=((65280&(Fy=(61680&(Fy=(52428&Fy)>>2|(13107&Fy)<<2))>>4|(3855&Fy)<<4))>>8|(255&Fy)<<8)>>1}var By=function(e,t,i){for(var r=e.length,n=0,a=new Ey(t);n<r;++n)e[n]&&++a[e[n]-1];var o,s=new Ey(t);for(n=1;n<t;++n)s[n]=s[n-1]+a[n-1]<<1;o=new Ey(1<<t);var l=15-t;for(n=0;n<r;++n)if(e[n])for(var c=n<<4|e[n],h=t-e[n],u=s[e[n]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)o[zy[u]>>l]=c;return o},Oy=new Sy(288);for(Ly=0;Ly<144;++Ly)Oy[Ly]=8;for(Ly=144;Ly<256;++Ly)Oy[Ly]=9;for(Ly=256;Ly<280;++Ly)Oy[Ly]=7;for(Ly=280;Ly<288;++Ly)Oy[Ly]=8;var Ny=new Sy(32);for(Ly=0;Ly<32;++Ly)Ny[Ly]=5;var Vy=By(Oy,9),jy=By(Ny,5),Uy=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},Gy=function(e,t,i){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&i},$y=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},qy=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hy=function(e,t,i){var r=new Error(t||qy[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Hy),!i)throw r;return r},Wy=new Sy(0),Zy="undefined"!=typeof TextDecoder&&new TextDecoder;try{Zy.decode(Wy,{stream:!0})}catch(e){}const Xy={gzip_data:"gzip"};class Yy extends Error{constructor(e){super(e),this.name="MRTError"}}const Jy={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Qy={uint32:1,uint16:2,uint8:4},Ky={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ex,tx;class ix{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new Yy(`Layer '${e}' not found`);return t}getHeaderLength(e){const t=new Uint8Array(e),i=new DataView(e);if(13!==t[0])throw new Yy("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),i=this.getHeaderLength(e);if(t.length<i)throw new Yy(`Expected header with length >= ${i} but got buffer of length ${t.length}`);const r=function(e){return e.readFields(uy,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new ex(t.subarray(0,i)));if(!isNaN(this.x)&&(this.x!==r.x||this.y!==r.y||this.z!==r.z))throw new Yy(`Invalid attempt to parse header ${r.z}/${r.x}/${r.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=r.x,this.y=r.y,this.z=r.z;for(const n of r.layers)this.layers[n.name]=new rx(n,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],i=this.getLayer(e.layerName);for(let r of e.blockIndices){const n=i.dataIndex[r],a=n.first_byte-e.firstByte,o=n.last_byte-e.firstByte;if(i._blocksInProgress.has(r))continue;const s={layerName:i.name,firstByte:a,lastByte:o,pixelFormat:i.pixelFormat,blockIndex:r,blockShape:[n.bands.length].concat(i.bandShape),buffer:i.buffer,codec:n.codec.codec,filters:n.filters.map((e=>e.filter))};i._blocksInProgress.add(r),t.push(s)}return new nx(t,(()=>{t.forEach((e=>i._blocksInProgress.delete(e.blockIndex)))}),((e,r)=>{if(t.forEach((e=>i._blocksInProgress.delete(e.blockIndex))),e)throw e;r.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class rx{constructor(e,t){let{version:i,name:r,units:n,tilesize:a,pixel_format:o,buffer:s,data_index:l}=e;if(this.version=i,1!==this.version)throw new Yy(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=r,this.units=n,this.tileSize=a,this.buffer=s,this.pixelFormat=Jy[o],this.dataIndex=l,this.bandShape=[a+2*s,a+2*s,Qy[this.pixelFormat]],this._decodedBlocks=new xy(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Qy[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((e=>{let{bands:t}=e;return t})).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[i,r]of this.dataIndex.entries()){for(const[n,a]of r.bands.entries())if(a===e)return{bandIndex:t+n,blockIndex:i,blockBandIndex:n};t+=r.bands.length}break;case"number":for(const[i,r]of this.dataIndex.entries()){if(e>=t&&e<t+r.bands.length)return{bandIndex:e,blockIndex:i,blockBandIndex:e-t};t+=r.bands.length}break;default:throw new Yy(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Yy(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let t=1/0,i=-1/0;const r=[],n=new Set;for(const a of e){const{blockIndex:e}=this.getBlockForBand(a);if(e<0)throw new Yy(`Invalid band: ${JSON.stringify(a)}`);const o=this.dataIndex[e];r.includes(e)||r.push(e),n.add(e),t=Math.min(t,o.first_byte),i=Math.max(i,o.last_byte)}if(n.size>this.cacheSize)throw new Yy(`Number of blocks to decode (${n.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:t,lastByte:i,blockIndices:r}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:i}=this.getBlockForBand(e),r=this._decodedBlocks.get(t.toString());if(!r)throw new Yy(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[t],a=this.bandShape.reduce(((e,t)=>e*t),1),o=i*a,s=r.subarray(o,o+a);return{data:s,bytes:new Uint8Array(s.buffer).subarray(s.byteOffset,s.byteOffset+s.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:0!==n.offset?n.offset:n.deprecated_offset,scale:0!==n.scale?n.scale:n.deprecated_scale}}}ix.setPbf=function(e){ex=e};class nx{constructor(e,t,i){this.tasks=e,this._onCancel=t,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}ix.performDecoding=function(e,t){const i=new Uint8Array(e);return Promise.all(t.tasks.map((e=>{const{layerName:t,firstByte:r,lastByte:n,pixelFormat:a,blockShape:o,blockIndex:s,filters:l,codec:c}=e,h=i.subarray(r,n+1),u=new Uint32Array(o[0]*o[1]*o[2]);let d;if("gzip_data"!==c)throw new Yy(`Unhandled codec: ${c}`);return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((a=function(e){31==e[0]&&139==e[1]&&8==e[2]||Hy(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[i++]);return i+(2&t)}(n=e))+8>n.length&&Hy(6,"invalid gzip data"),function(e,t,i){var r=e.length;if(!r||t.f&&!t.l)return i||new Sy(0);var n=!i,a=n||2!=t.i,o=t.i;n&&(i=new Sy(3*r));var s,l,c=function(e){var t=i.length;if(e>t){var r=new Sy(Math.max(2*t,e));r.set(i),i=r}},h=t.f||0,u=t.p||0,d=t.b||0,p=t.l,f=t.d,m=t.m,g=t.n,_=8*r;do{if(!p){h=Gy(e,u,1);var y=Gy(e,u+1,3);if(u+=3,!y){var x=e[(P=4+((u+7)/8|0))-4]|e[P-3]<<8,v=P+x;if(v>r){o&&Hy(0);break}a&&c(d+x),i.set(e.subarray(P,v),d),t.b=d+=x,t.p=u=8*v,t.f=h;continue}if(1==y)p=Vy,f=jy,m=9,g=5;else if(2==y){var b=Gy(e,u,31)+257,w=Gy(e,u+10,15)+4,S=b+Gy(e,u+5,31)+1;u+=14;for(var E=new Sy(S),T=new Sy(19),C=0;C<w;++C)T[My[C]]=Gy(e,u+3*C,7);u+=3*w;var k=Uy(T),M=(1<<k)-1,A=By(T,k);for(C=0;C<S;){var P,I=A[Gy(e,u,M)];if(u+=15&I,(P=I>>4)<16)E[C++]=P;else{var D=0,R=0;for(16==P?(R=3+Gy(e,u,3),u+=2,D=E[C-1]):17==P?(R=3+Gy(e,u,7),u+=3):18==P&&(R=11+Gy(e,u,127),u+=7);R--;)E[C++]=D}}var z=E.subarray(0,b),L=E.subarray(b);m=Uy(z),g=Uy(L),p=By(z,m),f=By(L,g)}else Hy(1);if(u>_){o&&Hy(0);break}}a&&c(d+131072);for(var F=(1<<m)-1,B=(1<<g)-1,O=u;;O=u){var N=(D=p[$y(e,u)&F])>>4;if((u+=15&D)>_){o&&Hy(0);break}if(D||Hy(2),N<256)i[d++]=N;else{if(256==N){O=u,p=null;break}var V=N-254;N>264&&(V=Gy(e,u,(1<<(G=Cy[C=N-257]))-1)+Iy[C],u+=G);var j=f[$y(e,u)&B],U=j>>4;if(j||Hy(3),u+=15&j,L=Ry[U],U>3){var G=ky[U];L+=$y(e,u)&(1<<G)-1,u+=G}if(u>_){o&&Hy(0);break}a&&c(d+131072);var $=d+V;if(d<L){var q=0-L,H=Math.min(L,$);for(q+d<0&&Hy(3);d<H;++d)i[d]=(void 0)[q+d]}for(;d<$;++d)i[d]=i[d-L]}}t.l=p,t.p=O,t.b=d,t.f=h,p&&(h=1,t.m=m,t.d=f,t.n=g)}while(!h);return d!=i.length&&n?(s=i,(null==(l=d)||l>s.length)&&(l=s.length),new Sy(s.subarray(0,l))):i.subarray(0,d)}(n.subarray(a,-8),{i:2},new Sy(((i=n)[(r=i.length)-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0))));var i,r,n,a;const o=Xy[t];if(!o)throw new Error(`Unhandled codec: ${t}`);const s=new globalThis.DecompressionStream(o);return new Response(new Blob([e]).stream().pipeThrough(s)).arrayBuffer().then((e=>new Uint8Array(e)))}(h,c).then((e=>(function(e,t){e.readFields(_y,t)}(new ex(e),u),new(0,Ky[a])(u.buffer)))),d.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":vy(e,o);break;case"zigzag_filter":by(e);break;case"bitshuffle_filter":wy(e,a);break;default:throw new Yy(`Unhandled filter "${l[t]}"`)}return{layerName:t,blockIndex:s,data:e}})).catch((e=>{throw e}))})))},ix.setPbf(Nm);class ax extends hy{constructor(e,t,i,r,n){super(e,t,i,r,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,t){const i=t.context,r=i.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture&&this.texture instanceof G_?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new G_(i,e,r.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,t=arguments.length>1?arguments[1]:void 0;const i=this._mrt=new ix(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=rr(r,((r,n,a,o)=>{if(r)t(r);else try{const r=i.getHeaderLength(n);if(r>e)return void(this.request=this.fetchHeader(r,t));i.parseHeader(n),this._isHeaderLoaded=!0;let s=0;for(const e of Object.values(i.layers))s=Math.max(s,e.dataIndex[e.dataIndex.length-1].last_byte);n.byteLength>=s&&(this.entireBuffer=n),t(null,this.entireBuffer||n,a,o)}catch(e){t(e)}})),this.request}fetchBand(e,t,i){const r=this._mrt;if(!this._isHeaderLoaded||!r)return void i(new Error("Tile header is not ready"));const n=this.actor;if(!n)return void i(new Error("Can't fetch tile band without an actor"));let a;const o=(r,n)=>{a.complete(r,n),r?i(r):(this.updateTextureDescriptor(e,t),i(null,this.textureDescriptor&&this.textureDescriptor.img))},s=(e,t)=>{if(e)return i(e);const r=n.send("decodeRasterArray",{buffer:t,task:a},o,void 0,!0);this._workQueue.push((()=>{r&&r.cancel(),a.cancel()}))},l=r.getLayer(e);if(!l)return void i(new Error(`Unknown sourceLayer "${e}"`));if(l.hasDataForBand(t))return this.updateTextureDescriptor(e,t),void i(null,this.textureDescriptor?this.textureDescriptor.img:null);const c=l.getDataRange([t]);if(a=r.createDecodingTask(c),!a||a.tasks.length)if(this.flushQueues(),this.entireBuffer)s(null,this.entireBuffer.slice(c.firstByte,c.lastByte+1));else{const e=Object.assign({},this.requestParams,{headers:{Range:`bytes=${c.firstByte}-${c.lastByte}`}}),t=rr(e,s);this._fetchQueue.push((()=>{t.cancel(),a.cancel()}))}else i(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(e,t){if(!this._mrt)return;const i=this._mrt.getLayer(e);if(!i||!i.hasBand(t)||!i.hasDataForBand(t))return;const{bytes:r,tileSize:n,buffer:a,offset:o,scale:s}=i.getBandView(t),l=n+2*a,c={data:r,width:l,height:l},h=this.texture;h&&h instanceof G_&&h.update(c,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:t,img:c,buffer:a,offset:o,tileSize:n,format:i.pixelFormat,mix:[s,256*s,65536*s,16777216*s]}}}class ox{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const i of t)this.remove(i.value.tileID,i)}}class sx extends Or{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new ox(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Um,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ti(this._tiles).map((e=>e.tileID)).sort(lx).map((e=>e.key))}getRenderableIds(e,t){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e,t)&&i.push(this._tiles[r]);return e?i.sort(((e,t)=>{const i=e.tileID,r=t.tileID,n=new jt(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),a=new jt(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||a.y-n.y||a.x-n.x})).map((e=>e.tileID.key)):i.map((e=>e.tileID)).sort(lx).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,r){if(r)if(e.state="errored",404!==r.status)this._source.fire(new Lr(r,{tile:e}));else{if(this._source.fire(new zr("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:e})),!(e.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=zi.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new zr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let a=this._tiles[n];if(r[n]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>i)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){r[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,n=Math.floor(i*r*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,t,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const n="batched-model"===this._source.type;let a;if(this.used||this.usedForTerrain){if(this._source.tileID)a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Th(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)));else if(0!==this.tileCoverLift){const r=e.clone();r.tileCoverLift=this.tileCoverLift,a=r.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:n}),this._source.minzoom<=1&&"globe"===e.projection.name&&(a.push(new Th(1,0,1,0,0)),a.push(new Th(1,0,1,1,0)),a.push(new Th(1,0,1,0,1)),a.push(new Th(1,0,1,1,1)))}else if(a=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:n}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);a=a.filter((t=>e(t)))}}else a=[];if(a.length>0&&this.castsShadows&&r&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!cx(this._source.type)){const o=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),s=Math.min(o,this._source.maxzoom);if(n){const t=e.extendTileCover(a,s);for(const e of t)a.push(e)}else{const t=e.extendTileCover(a,s,r);for(const e of t)this._shadowCasterTiles[e.key]=!0,a.push(e)}}const o=this._updateRetainedTiles(a);if(cx(this._source.type)&&0!==a.length){const e={},t={},i=Object.keys(o);for(const n of i){const i=o[n],r=this._tiles[n];if(!r||r.fadeEndTime&&r.fadeEndTime<=zi.now())continue;const a=this.findLoadedParent(i,Math.max(i.overscaledZ-sx.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),t[n]=i}const r=a[a.length-1].overscaledZ;for(const n in this._tiles){const e=this._tiles[n];if(o[n]||!e.hasData())continue;let i=e.tileID;for(;i.overscaledZ>r;){i=i.scaledTo(i.overscaledZ-1);const r=this._tiles[i.key];if(r&&r.hasData()&&t[i.key]){o[n]=e.tileID;break}}}for(const n in e)o[n]||(this._coveredTiles[n]=!0,o[n]=e[n])}for(const l in o)this._tiles[l].clearFadeHold();const s=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i}(this._tiles,o);for(const l of s){const e=this._tiles[l];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+l)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,a=Math.max(n-sx.maxOverzooming,this._source.minzoom),o=Math.max(n+sx.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||r<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,r,o,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let n=l.overscaledZ-1;n>=a;--n){const a=l.scaledTo(n);if(i[a.key])break;if(i[a.key]=!0,e=this.getTile(a),!e&&r&&(e=this._addTile(a)),e&&(t[a.key]=a,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);if(!i){const i=this.map?this.map.painter:null,r=this._source.tileSize*e.overscaleFactor();t="raster-array"===this._source.type?new ax(e,r,this.transform.tileZoom,i,this._isRaster):new hy(e,r,this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new zr("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,i){const r=[],n=this.transform;if(!n)return r;const a="globe"===n.projection.name,o=Ih(n.center.lng);for(const s in this._tiles){const l=this._tiles[s];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(a){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(Jt(o,...hx(e,-1))-o),Math.abs(Jt(o,...hx(e,1))-o)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(Jt(o,...hx(e,-1))-o),Math.abs(Jt(o,...hx(e,0))-o),Math.abs(Jt(o,...hx(e,1))-o)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const i of c){const a=e.containsTile(l,n,t,i);a&&r.push(a)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const i=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),r="globe"===this.transform.projection.name;for(const n of i)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped()),n.expandedProjMatrix=r?this.transform.calculateProjMatrix(n.toUnwrapped(),!1,!0):n.projMatrix;return i}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const a of t){const e=1/(1<<a.canonical.z);n[a.key]=((a.canonical.x+.5)*e+a.wrap-i[0])*r[0]+((a.canonical.y+.5)*e-i[1])*r[1]-i[2]*r[2]}return t.sort(((e,t)=>n[e.key]-n[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(cx(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=zi.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const i=()=>{this._sourceLoaded&&(this._source.off("data",i),this._preloadTiles(e,t))};return void this._source.on("data",i)}const i=new Map,r=Array.isArray(e)?e:[e],n=this.map.painter.terrain,a=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const o of r){const e=o.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)i.set(t.key,t);this.usedForTerrain&&o.updateElevation(!1)}ei(Array.from(i.values()),((e,t)=>{const i=new hy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),t)}}function lx(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function cx(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function hx(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}sx.maxOverzooming=10,sx.maxUnderzooming=3;const ux=()=>tx||(tx={layout:cm||(cm=new cl({"line-cap":new sl(hl.layout_line["line-cap"]),"line-join":new sl(hl.layout_line["line-join"]),"line-miter-limit":new ol(hl.layout_line["line-miter-limit"]),"line-round-limit":new ol(hl.layout_line["line-round-limit"]),"line-sort-key":new sl(hl.layout_line["line-sort-key"]),"line-z-offset":new sl(hl.layout_line["line-z-offset"]),visibility:new ol(hl.layout_line.visibility)})),paint:hm||(hm=new cl({"line-opacity":new sl(hl.paint_line["line-opacity"]),"line-color":new sl(hl.paint_line["line-color"]),"line-translate":new ol(hl.paint_line["line-translate"]),"line-translate-anchor":new ol(hl.paint_line["line-translate-anchor"]),"line-width":new sl(hl.paint_line["line-width"]),"line-gap-width":new sl(hl.paint_line["line-gap-width"]),"line-offset":new sl(hl.paint_line["line-offset"]),"line-blur":new sl(hl.paint_line["line-blur"]),"line-dasharray":new sl(hl.paint_line["line-dasharray"]),"line-pattern":new sl(hl.paint_line["line-pattern"]),"line-gradient":new ll(hl.paint_line["line-gradient"]),"line-trim-offset":new ol(hl.paint_line["line-trim-offset"]),"line-trim-fade-range":new ol(hl.paint_line["line-trim-fade-range"]),"line-trim-color":new ol(hl.paint_line["line-trim-color"]),"line-emissive-strength":new ol(hl.paint_line["line-emissive-strength"]),"line-border-width":new sl(hl.paint_line["line-border-width"]),"line-border-color":new sl(hl.paint_line["line-border-color"]),"line-occlusion-opacity":new ol(hl.paint_line["line-occlusion-opacity"])}))},tx);class dx extends sl{possiblyEvaluate(e,t){return t=new Js(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=ii({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}let px,fx,mx,gx;function _x(e,t){return t>0?t+2*e:e}class yx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Qr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ts(yx,"FormatSectionOverride",{omit:["defaultValue"]});const xx=()=>gx||(gx={layout:fx||(fx=new cl({"symbol-placement":new ol(hl.layout_symbol["symbol-placement"]),"symbol-spacing":new ol(hl.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ol(hl.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sl(hl.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ol(hl.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ol(hl.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ol(hl.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ol(hl.layout_symbol["icon-ignore-placement"]),"icon-optional":new ol(hl.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ol(hl.layout_symbol["icon-rotation-alignment"]),"icon-size":new sl(hl.layout_symbol["icon-size"]),"icon-text-fit":new sl(hl.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sl(hl.layout_symbol["icon-text-fit-padding"]),"icon-image":new sl(hl.layout_symbol["icon-image"]),"icon-rotate":new sl(hl.layout_symbol["icon-rotate"]),"icon-padding":new ol(hl.layout_symbol["icon-padding"]),"icon-keep-upright":new ol(hl.layout_symbol["icon-keep-upright"]),"icon-offset":new sl(hl.layout_symbol["icon-offset"]),"icon-anchor":new sl(hl.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ol(hl.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ol(hl.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ol(hl.layout_symbol["text-rotation-alignment"]),"text-field":new sl(hl.layout_symbol["text-field"]),"text-font":new sl(hl.layout_symbol["text-font"]),"text-size":new sl(hl.layout_symbol["text-size"]),"text-max-width":new sl(hl.layout_symbol["text-max-width"]),"text-line-height":new sl(hl.layout_symbol["text-line-height"]),"text-letter-spacing":new sl(hl.layout_symbol["text-letter-spacing"]),"text-justify":new sl(hl.layout_symbol["text-justify"]),"text-radial-offset":new sl(hl.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ol(hl.layout_symbol["text-variable-anchor"]),"text-anchor":new sl(hl.layout_symbol["text-anchor"]),"text-max-angle":new ol(hl.layout_symbol["text-max-angle"]),"text-writing-mode":new ol(hl.layout_symbol["text-writing-mode"]),"text-rotate":new sl(hl.layout_symbol["text-rotate"]),"text-padding":new ol(hl.layout_symbol["text-padding"]),"text-keep-upright":new ol(hl.layout_symbol["text-keep-upright"]),"text-transform":new sl(hl.layout_symbol["text-transform"]),"text-offset":new sl(hl.layout_symbol["text-offset"]),"text-allow-overlap":new ol(hl.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ol(hl.layout_symbol["text-ignore-placement"]),"text-optional":new ol(hl.layout_symbol["text-optional"]),visibility:new ol(hl.layout_symbol.visibility)})),paint:mx||(mx=new cl({"icon-opacity":new sl(hl.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new sl(hl.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new sl(hl.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new sl(hl.paint_symbol["text-emissive-strength"]),"icon-color":new sl(hl.paint_symbol["icon-color"]),"icon-halo-color":new sl(hl.paint_symbol["icon-halo-color"]),"icon-halo-width":new sl(hl.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sl(hl.paint_symbol["icon-halo-blur"]),"icon-translate":new ol(hl.paint_symbol["icon-translate"]),"icon-translate-anchor":new ol(hl.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new sl(hl.paint_symbol["icon-image-cross-fade"]),"text-opacity":new sl(hl.paint_symbol["text-opacity"]),"text-occlusion-opacity":new sl(hl.paint_symbol["text-occlusion-opacity"]),"text-color":new sl(hl.paint_symbol["text-color"],{runtimeType:rn,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new sl(hl.paint_symbol["text-halo-color"]),"text-halo-width":new sl(hl.paint_symbol["text-halo-width"]),"text-halo-blur":new sl(hl.paint_symbol["text-halo-blur"]),"text-translate":new ol(hl.paint_symbol["text-translate"]),"text-translate-anchor":new ol(hl.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ol(hl.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ol(hl.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ol(hl.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ol(hl.paint_symbol["icon-color-brightness-max"])}))},gx);class vx extends Pl{constructor(t,i,r,n){super(t,xx(),i,r,n),this._colorAdjustmentMatrix=e.ae.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==t.paint&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,i,r,n){return this._saturation===t&&this._contrast===i&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(t,i,r,n){t=Di(t),i=Ii(i);const a=e.ae.create(),o=t/3,s=1-2*o,l=[s,o,o,0,o,s,o,0,o,o,s,0,0,0,0,1],c=.5-.5*i,h=n-r;return e.ae.multiply(a,[h,0,0,0,0,h,0,0,0,0,h,0,r,r,r,1],[i,0,0,0,0,i,0,0,0,0,i,0,c,c,c,1]),e.ae.multiply(a,a,l),a}(t,i,r,n),this._saturation=t,this._contrast=i,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||ps(a.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new U_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xx().paint.overridableProperties){if(!vx.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new yx(t),r=new ds(i,t.property.specification,this.scope,this.options);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new ms("source",r):new gs("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new nl(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&vx.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=xx().paint.properties[t];let n=!1;const a=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof _n)a(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof Sn&&bn(t.value)===sn?a(t.value.sections):t instanceof kn?a(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),t&&i.push("symbolSDF"),i}getDefaultProgramParams(e,t,i){return{config:new eh(this,{zoom:t,lut:i}),overrideFog:!1}}}let bx,wx,Sx,Ex;function Tx(t,i,r,n,a,o,s,l){const c=[t,i,1,r,n,1,a,o,1],h=[s,l,1],u=e.bE.adjoint([],c),[d,p,f]=e.$.transformMat3(h,h,u);return e.bE.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function Cx(t,i,r,n,a,o,s,l){const c=function(t,i,r,n,a,o,s,l){const c=Tx(0,0,1,0,1,1,0,1),h=Tx(t,i,r,n,a,o,s,l),u=e.bE.adjoint([],c);return e.bE.multiply(h,h,u)}(t,i,r,n,a,o,s,l);return[c[2]/c[8]/fa,c[5]/c[8]/fa]}function kx(e){return[e[0],Math.min(Math.max(e[1],-Bh),Bh)]}class Mx extends Or{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new zr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=lr(this.map._requestManager.transformRequest(this.url,Ki.Image),((t,i)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new Lr(t)):i&&(this.image=i instanceof HTMLImageElement?zi.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new $_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof $_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],i=e[0][1];for(const n of e)n[1]>i&&(i=n[1]),n[1]<t&&(t=n[1]);const r=(i+t)/2;if(r>Bh?this.onNorthPole=!0:r<-Bh&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Uh.fromLngLat);this.tileID=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const c of e)t=Math.min(t,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),n=Math.max(n,c.y);const a=Math.max(r-t,n-i),o=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),s=Math.pow(2,o);let l=Math.floor((t+r)/2*s);return l>1&&(l-=1),new Sh(o,l,Math.floor((i+n)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=h_(new Sh(0,0,0),this.map.transform.projection),r=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,i=e[1].y-e[0].y,r=e[2].x-e[1].x,n=e[2].y-e[1].y,a=e[3].x-e[2].x,o=e[3].y-e[2].y,s=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*n-r*i,h=r*o-a*n,u=a*l-s*o,d=s*i-t*l;return c>0&&h>0&&u>0&&d>0||c<0&&h<0&&u<0&&d<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=h_(this.tileID,this.map.transform.projection),[a,o,s,l]=this.coordinates.map((e=>{const t=n.projection.project(e[0],e[1]);return u_(n,t)._round()}));this.perspectiveTransform=Cx(a.x,a.y,o.x,o.y,s.x,s.y,l.x,l.y);const c=this._boundsArray=new Ol;c.emplaceBack(a.x,a.y,0,0),c.emplaceBack(o.x,o.y,fa,0),c.emplaceBack(l.x,l.y,0,fa),c.emplaceBack(s.x,s.y,fa,fa),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,Q_.members),this.boundsSegments=Mc.simpleSegment(0,0,4,2);const h=[],u=function(e){return[kx(e[0]),kx(e[1]),kx(e[2]),kx(e[3])]}(this.coordinates),[d,p,f,m]=function(e){let t=e[0][0],i=t,r=e[0][1],n=r;for(let a=1;a<e.length;a++)e[a][0]<t?t=e[a][0]:e[a][0]>i&&(i=e[a][0]),e[a][1]<r?r=e[a][1]:e[a][1]>n&&(n=e[a][1]);return[t,r,i-t,n-r]}(u);{const n=new Ol,[a,o,s,l]=function(e){let t=e[0].x,i=t,r=e[0].y,n=r;for(let a=1;a<e.length;a++)e[a].x<t?t=e[a].x:e[a].x>i&&(i=e[a].x),e[a].y<r?r=e[a].y:e[a].y>n&&(n=e[a].y);return[t,r,i-t,n-r]}(r),c=e=>[(e.x-a)/s,(e.y-o)/l],[u,g,_,y]=r.map(c),x=function(t,i,r,n,a,o,s,l){const c=Tx(0,0,1,0,1,1,0,1),h=Tx(t,i,r,n,a,o,s,l),u=e.bE.adjoint([],h);return e.bE.multiply(c,c,u)}(u[0],u[1],g[0],g[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=Cx(u[0],u[1],g[0],g[1],_[0],_[1],y[0],y[1]);const v=(t,i)=>{h.push(t.lng);const r=Math.round((t.lng-d)/f*fa),a=Math.round((t.lat-p)/m*fa),o=c(i),s=e.$.transformMat3([],[o[0],o[1],1],x),l=Math.round(s[0]/s[2]*fa),u=Math.round(s[1]/s[2]*fa);n.emplaceBack(r,a,l,u)},b=r[3].x-r[0].x,w=r[3].y-r[0].y,S=r[2].x-r[1].x,E=r[2].y-r[1].y;for(let e=0;e<65;e++){const t=e/64,n=[r[0].x+t*b,r[0].y+t*w],a=[r[1].x+t*S,r[1].y+t*E],o=a[0]-n[0],s=a[1]-n[1];for(let e=0;e<65;e++){const t=e/64,r={x:n[0]+o*t,y:n[1]+s*t,z:0};v(i.projection.unproject(r.x,r.y),r)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,Q_.members)}{this.maxLongitudeTriangleSize=0;let e=[],i=new ec;const r=(t,r,n)=>{i.emplaceBack(t,r,n);const a=h[t],o=h[r],s=h[n],l=Math.min(Math.min(a,o),s),c=Math.max(Math.max(a,o),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,n=i+1,a=i+65,o=a+1;r(i,a,n),r(n,a,o)}[e,i]=function(e,t){const i=Array.from({length:e.length},((e,t)=>t));i.sort(((t,i)=>e[t]-e[i]));const r=[],n=new ec;for(let a=0;a<i.length;a++){const o=i[a];r.push(e[o]);const s=3*o,l=s+1;n.emplaceBack(t.uint16[s],t.uint16[l],t.uint16[l+1])}return[r,n]}(e,i),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(i)}this.elevatedGlobeSegments=Mc.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,f/fa,0,m/fa,0,0,p,d,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,i=t.gl;!this._dirty||this.texture instanceof $_||(this.texture?this.texture.update(this.image):(this.texture=new G_(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let r=(n=e+180)+360*Math.round((i[0]-n)/360);var n;const a=new Mc,o=(e,i)=>{a.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-r)<=s){const e=Pi(i,0,i.length,r+s);return e===i.length||o(e,Ai(i,e+1,i.length,r+360-s)-e),a}r<i[0]&&(r+=360);const l=Ai(i,0,i.length,r-s);if(l===i.length)return o(0,i.length),a;o(0,l-0);const c=Pi(i,l+1,i.length,r+s);return c!==i.length&&o(c,i.length-c),a}}const Ax=(Math.pow(256,2)-1)/16907520;class Px extends Pl{constructor(e,t,i,r){super(e,{layout:Sx||(Sx=new cl({visibility:new ol(hl.layout_raster.visibility)})),paint:Ex||(Ex=new cl({"raster-opacity":new ol(hl.paint_raster["raster-opacity"]),"raster-color":new ll(hl.paint_raster["raster-color"]),"raster-color-mix":new ol(hl.paint_raster["raster-color-mix"]),"raster-color-range":new ol(hl.paint_raster["raster-color-range"]),"raster-hue-rotate":new ol(hl.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ol(hl.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ol(hl.paint_raster["raster-brightness-max"]),"raster-saturation":new ol(hl.paint_raster["raster-saturation"]),"raster-contrast":new ol(hl.paint_raster["raster-contrast"]),"raster-resampling":new ol(hl.paint_raster["raster-resampling"]),"raster-fade-duration":new ol(hl.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ol(hl.paint_raster["raster-emissive-strength"]),"raster-array-band":new ol(hl.paint_raster["raster-array-band"]),"raster-elevation":new ol(hl.paint_raster["raster-elevation"])}))},t,i,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Mx&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[i,r]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(r)||i===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=Sd({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,r])}}let Ix,Dx,Rx,zx,Lx;class Fx extends Pl{constructor(e,t,i,r){super(e,{layout:Ix||(Ix=new cl({visibility:new ol(hl["layout_raster-particle"].visibility)})),paint:Dx||(Dx=new cl({"raster-particle-array-band":new ol(hl["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ol(hl["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ll(hl["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ol(hl["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ol(hl["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ol(hl["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ol(hl["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ol(hl["paint_raster-particle"]["raster-particle-elevation"])}))},t,i,r),this._updateColorRamp(),this.lastInvalidatedAt=zi.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Sd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=zi.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Bx extends Pl{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Ox(t,i,r){const n=[0,0,1],a=e.aw.identity([]);return e.aw.rotateY(a,a,r?-qt(t)+Math.PI:qt(t)),e.aw.rotateX(a,a,-qt(i)),e.$.transformQuat(n,n,a),e.$.normalize(n,n)}function Nx(t,i){const r=jx(t.projection,t.zoom,t.width,t.height),n=function(t,i,r,n,a){const o=new xh(r.lng-180*Ux,r.lat),s=new xh(r.lng+180*Ux,r.lat),l=t.project(o.lng,o.lat),c=t.project(s.lng,s.lat),h=-Math.atan2(c.y-l.y,c.x-l.x),u=Uh.fromLngLat(r);u.y=Jt(u.y,-1+Ux,1-Ux);const d=u.toLngLat(),p=t.project(d.lng,d.lat),f=Uh.fromLngLat(d);f.x+=Ux;const m=f.toLngLat(),g=t.project(m.lng,m.lat),_=$x(g.x-p.x,g.y-p.y,h),y=Uh.fromLngLat(d);y.y+=Ux;const x=y.toLngLat(),v=t.project(x.lng,x.lat),b=$x(v.x-p.x,v.y-p.y,h),w=Math.abs(_.x)/Math.abs(b.y),S=e.ae.identity([]);e.ae.rotateZ(S,S,-h*(1-(a?0:n)));const E=e.ae.identity([]);return e.ae.scale(E,E,[1,1-(1-w)*n,1]),E[4]=-b.x/b.y*n,e.ae.rotateZ(E,E,h),e.ae.multiply(E,S,E),E}(t.projection,0,t.center,r,i),a=Vx(t);return e.ae.scale(n,n,[a,a,1]),n}function Vx(e){const t=e.projection,i=jx(e.projection,e.zoom,e.width,e.height),r=Gx(t,e.center),n=Gx(t,xh.convert(t.center));return Math.pow(2,r*i+(1-i)*n)}function jx(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=e.range;if(!a)return 0;const o=Math.min(n,Math.max(i,r)),s=Math.log(o/1024)/Math.LN2;return Qt(a[0]+s,a[1]+s,t)}const Ux=1/4e4;function Gx(e,t){const i=Jt(t.lat,-Bh,Bh),r=new xh(t.lng-180*Ux,i),n=new xh(t.lng+180*Ux,i),a=e.project(r.lng,i),o=e.project(n.lng,i),s=Uh.fromLngLat(r),l=Uh.fromLngLat(n),c=o.x-a.x,h=o.y-a.y,u=l.x-s.x,d=l.y-s.y,p=Math.sqrt((u*u+d*d)/(c*c+h*h));return Math.log(p)/Math.LN2}function $x(e,t,i){const r=Math.cos(i),n=Math.sin(i);return{x:e*r-t*n,y:e*n+t*r}}function qx(t,i,r){e.ae.identity(t),e.ae.rotateZ(t,t,qt(i[2])),e.ae.rotateX(t,t,qt(i[0])),e.ae.rotateY(t,t,qt(i[1])),e.ae.scale(t,t,r),e.ae.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Hx(t,i,r,n,a,o,s,l){const c=[r[0]-i[0],r[1]-i[1],0],h=[n[0]-i[0],n[1]-i[1],0];if(e.$.length(c)<1e-12||e.$.length(h)<1e-12)return e.aw.identity(t);const u=e.$.cross([],c,h);e.$.normalize(u,u),e.$.subtract(h,n,i),c[2]=(o-a)*l,h[2]=(s-a)*l;const d=c;return e.$.cross(d,c,h),e.$.normalize(d,d),e.aw.rotationTo(t,u,d)}function Wx(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Ku(i.zoom),a=function(t,i,r){const n=i.worldSize,a=[t[12],t[13],t[14]],o=Lh(a[1]/n),s=zh(a[0]/n),l=e.ae.identity([]),c=Rh(1,o)*n,h=Rh(1,0)*n*Nh(o,i.zoom),u=1/Yu(n);let d=h*u;if(r){const e=jx(i.projection,i.zoom,i.width,i.height,1024);d=u*i.projection.pixelSpaceConversion(i.center.lat,n,e)}const p=gh(o,s);e.$.add(p,p,e.$.scale([],e.$.normalize([],p),c*d*a[2]));const f=function(t){const i=[t[0],t[1],t[2]];let r=[0,1,0];const n=e.$.cross([],r,i);return e.$.cross(r,i,n),0===e.$.squaredLength(r)&&(r=[0,1,0],e.$.cross(n,i,r)),e.$.normalize(n,n),e.$.normalize(r,r),e.$.normalize(i,i),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],1]}(p);e.ae.scale(l,l,[d,d,d*c]),e.ae.translate(l,l,[-a[0],-a[1],-a[2]]);const m=e.ae.multiply([],i.globeMatrix,f);return e.ae.multiply(m,m,l),e.ae.multiply(m,m,t),m}(t,i,r);if(n>0){const r=function(t,i){const r=i.worldSize,n=Rh(1,0)*r*Nh(i.center.lat,i.zoom)/Yu(r),a=Rh(1,i.center.lat)*r,o=e.ae.identity([]);return e.ae.rotateY(o,o,qt(i.center.lng)),e.ae.rotateX(o,o,qt(i.center.lat)),e.ae.translate(o,o,[0,0,sh]),e.ae.scale(o,o,[n,n,n*a]),e.ae.translate(o,o,[i.point.x-.5*r,i.point.y-.5*r,0]),e.ae.multiply(o,o,t),e.ae.multiply(o,i.globeMatrix,o)}(t,i);return function(t,i,r){const n=(t,i,r)=>{const n=e.$.length(t),a=e.$.length(i),o=Nu(t,i,r);return e.$.scale(o,o,1/e.$.length(o)*Hr(n,a,r))},a=n([t[0],t[1],t[2]],[i[0],i[1],i[2]],r),o=n([t[4],t[5],t[6]],[i[4],i[5],i[6]],r),s=n([t[8],t[9],t[10]],[i[8],i[9],i[10]],r),l=Nu([t[12],t[13],t[14]],[i[12],i[13],i[14]],r);return[a[0],a[1],a[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(a,r,n)}return a}function Zx(e,t,i,r){const n=Mu.projectAabbCorners(r,i);let a=Number.MAX_VALUE,o=-1;for(let c=0;c<n.length;++c){const e=n[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<a&&(o=c,a=e[2])}const s=e=>new jt(n[e][0],n[e][1]);let l;switch(o){case 0:case 6:l=[s(1),s(5),s(4),s(7),s(3),s(2),s(1)];break;case 1:case 7:l=[s(0),s(4),s(5),s(6),s(2),s(3),s(0)];break;case 3:case 5:l=[s(1),s(0),s(4),s(7),s(6),s(2),s(1)];break;default:l=[s(1),s(5),s(6),s(7),s(3),s(0),s(1)]}if(tu(e,l))return a}const Xx=zl([{name:"a_pos_3f",components:3,type:"Float32"}]),Yx=zl([{name:"a_color_3f",components:3,type:"Float32"}]),Jx=zl([{name:"a_color_4f",components:4,type:"Float32"}]),Qx=zl([{name:"a_uv_2f",components:2,type:"Float32"}]),Kx=zl([{name:"a_normal_3f",components:3,type:"Float32"}]),ev=zl([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),tv=zl([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class iv{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function rv(e,t){const i=-1===e.indexOf("://");try{return new URL(e,i&&t?"http://example.com":void 0),!0}catch(e){return!1}}class nv{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class av{constructor(){this.instancedDataArray=new cc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ov{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,t){}populate(e,t,i,r){this.tileToMeter=jh(i);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=null!=o?o:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0,c=Jh(a,n);if(!this.layers[0]._featureFilter.filter(new Js(this.zoom),c,i))continue;const h={id:e,sourceLayerIndex:l,index:s,geometry:n?c.geometry:Yh(a,i,r),properties:a.properties,type:a.type,patterns:{}},u=this.addFeature(h,h.geometry,c);u&&t.featureIndex.insert(a,h.geometry,s,l,this.index,this.instancesPerModel[u].instancedDataArray.length,fa/32)}this.lookup=null}update(e,t,i,r){for(const n in this.instancesPerModel){const t=this.instancesPerModel[n];for(const i in e)t.idToFeaturesIndex.hasOwnProperty(i)&&(this.evaluate(t.features[t.idToFeaturesIndex[i]],e[i],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const i of r.features){const n=this.layers[0],a=i.feature,o=this.canonical,s=n.paint.get("model-rotation").evaluate(a,{},o),l=n.paint.get("model-scale").evaluate(a,{},o),c=n.paint.get("model-translation").evaluate(a,{},o);e.$.exactEquals(i.rotation,s)&&e.$.exactEquals(i.scale,l)&&e.$.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,r,!0),t=!0)}}return t}updateReplacement(e,t,i,r){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Vp(this.activeReplacements,n))return!1;this.activeReplacements=n;let a=!1;for(const o in this.instancesPerModel){const t=this.instancesPerModel[o],n=t.instancedDataArray;for(const o of t.features){const t=o.instancedDataOffset,s=o.instancedDataCount;for(let o=0;o<s;o++){const s=16*(o+t);let l=n.float32[s+0];l=l>fa?l-fa:l;const c=Math.floor(l),h=n.float32[s+1];let u=!1;for(const t of this.activeReplacements)if(!Fp(t,i,sf.Model,r)&&!(t.min.x>c||c>t.max.x||t.min.y>h||h>t.max.y)&&(u=Hp(qp(c,h,e.canonical,t.footprintTileId.canonical),t),u))break;n.float32[s]=u?l+fa:l,a=a||u}}}return a}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,ev.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const t of this.modelUris)e.removeModel(t,"")}addFeature(e,t,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!n)return fi(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),n;rv(n,!1)&&(this.modelUris.includes(n)||this.modelUris.push(n)),this.instancesPerModel[n]||(this.instancesPerModel[n]=new av);const a=this.instancesPerModel[n],o=a.instancedDataArray,s=new nv(i,o.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=fa||e.y<0||e.y>=fa)continue;const t=(this.lookupDim-1)/fa,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=o.length;o.resize(r+1),a.instancesEvaluatedElevation.push(0),o.float32[16*r]=e.x,o.float32[16*r+1]=e.y}return s.instancedDataCount=a.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(s),this.evaluate(s,{},a,!1)),n}getModelUris(){return this.modelUris}evaluate(e,t,i,r){const n=this.layers[0],a=e.feature,o=this.canonical,s=e.rotation=n.paint.get("model-rotation").evaluate(a,t,o),l=e.scale=n.paint.get("model-scale").evaluate(a,t,o),c=e.translation=n.paint.get("model-translation").evaluate(a,t,o),h=n.paint.get("model-color").evaluate(a,t,o);h.a=n.paint.get("model-color-mix-intensity").evaluate(a,t,o);const u=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),qx(u,s,l);const d=Math.round(100*h.a)+h.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,n=16*t,a=i.instancedDataArray.float32;let s=0;r&&(s=a[n+6]-i.instancesEvaluatedElevation[t]);const l=0|a[n+1];a[n]=(0|a[n])+h.r/1.05,a[n+1]=l+h.g/1.05,a[n+2]=d,a[n+3]=1/(o.z>10?this.tileToMeter:jh(o,l)),a[n+4]=c[0],a[n+5]=c[1],a[n+6]=c[2]+s,a[n+7]=u[0],a[n+8]=u[1],a[n+9]=u[2],a[n+10]=u[4],a[n+11]=u[5],a[n+12]=u[6],a[n+13]=u[8],a[n+14]=u[9],a[n+15]=u[10],i.instancesEvaluatedElevation[t]=c[2]}}}let sv,lv;Ts(ov,"ModelBucket",{omit:["layers"]}),Ts(av,"PerModelAttributes"),Ts(nv,"ModelFeature");const cv=64,hv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function uv(t,i,r,n,a,o,s,l,c){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=r.zoom,d=r.project(n),p=Nh(n.lat,u),f=1/p;e.ae.identity(t),e.ae.translate(t,t,[d.x+s[0]*f,d.y+s[1]*f,s[2]]);let m=1,g=1;const _=r.worldSize;if(h){if("mercator"===r.projection.name){let t=0;r.elevation&&(t=r.elevation.getAtPointOrZero(new Uh(d.x/_,d.y/_),0));const i=e.aB.transformMat4([],[d.x,d.y,t,1],r.projMatrix)[3]/r.cameraToCenterDistance;m=i,g=i*Nh(r.center.lat,u)}else if("globe"===r.projection.name){const i=Wx(t,r),a=e.ae.multiply([],r.projMatrix,i),o=[0,0,0,1];e.aB.transformMat4(o,o,a);const s=o[3]/r.cameraToCenterDistance,l=Ku(u),c=r.projection.pixelsPerMeter(n.lat,_)*Nh(n.lat,u),h=r.projection.pixelsPerMeter(r.center.lat,_)*Nh(r.center.lat,u);m=s/Hr(c,Oh(r.center.lat),l),g=s*p/c,m*=h,g*=h}}else m=f;e.ae.scale(t,t,[m,m,g]);const y=[...t],x=i.orientation,v=[];if(qx(v,[x[0]+a[0],x[1]+a[1],x[2]+a[2]],o),e.ae.multiply(t,y,v),l&&r.elevation){let a=0;const o=[];if(c&&r.elevation){a=function(t,i,r,n,a){const o=i.elevation;if(!o)return 0;const s=Mu.projectAabbCorners(r,n),l=Rh(1,a.lat)*i.worldSize,c=function(t,i){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const a of n){const n=t[a.corners[0]],o=t[a.corners[1]],s=t[a.corners[2]],l=[o[0]-n[0],o[1]-n[1],i*(o[2]-n[2])],c=e.$.cross(l,l,[s[0]-n[0],s[1]-n[1],i*(s[2]-n[2])]);e.$.normalize(c,c),a.dotProductWithUp=e.$.dot(c,r)}return n.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),n[0].corners}(s,l),h=s[c[0]],u=s[c[1]],d=s[c[2]],p=s[c[3]],f=o.getAtPointOrZero(new Uh(h[0]/i.worldSize,h[1]/i.worldSize),0),m=o.getAtPointOrZero(new Uh(u[0]/i.worldSize,u[1]/i.worldSize),0),g=o.getAtPointOrZero(new Uh(d[0]/i.worldSize,d[1]/i.worldSize),0),_=o.getAtPointOrZero(new Uh(p[0]/i.worldSize,p[1]/i.worldSize),0),y=(f+_)/2,x=(m+g)/2;return y>x?m<g?Hx(t,u,p,h,m,_,f,l):Hx(t,d,h,p,g,f,_,l):f<_?Hx(t,h,u,d,f,m,g,l):Hx(t,p,d,u,_,g,m,l),Math.max(y,x)}(o,r,i.aabb,t,n);const s=e.ae.fromQuat([],o),l=e.ae.multiply([],s,v);e.ae.multiply(t,y,l)}else a=r.elevation.getAtPointOrZero(new Uh(d.x/_,d.y/_),0);0!==a&&(t[14]+=a)}}function dv(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new G_(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function pv(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Xx.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Kx.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Qx.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Yx:Jx).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,tv.members,!0)),e.segments=Mc.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&dv(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&dv(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&dv(r.normalTexture,t),r.occlusionTexture&&dv(r.occlusionTexture,t,i),r.emissionTexture&&dv(r.emissionTexture,t)}function fv(e,t,i){if(e.meshes)for(const r of e.meshes)pv(r,t,i);if(e.children)for(const r of e.children)fv(r,t,i)}function mv(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)mv(t)}function gv(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const i of e.children)gv(i)}class _v{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yv{constructor(){this.tasks={},this.taskQueue=[],li(["process"],this),this.invoker=new _v(this.process),this.nextId=0}add(e,t){const i=this.nextId++,r=function(e){let{type:t,isSymbolTile:i,zoom:r}=e;return r=r||0,"message"===t?0:"maybePrepare"!==t||i?"parseTile"!==t||i?"parseTile"===t&&i?300-r:"maybePrepare"===t&&i?400-r:500:200-r:100-r}(t);if(0===r){try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const i=this.tasks[this.taskQueue[r]];i.priority<t&&(t=i.priority,e=r)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class xv{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},li(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new yv}send(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=a,this.callbacks[o]=i);const s=new Set;return this.target.postMessage({id:o,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Ms(t,s)},s),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||yi()){const e=this.callbacks[i],r=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"});r&&(this.cancelCallbacks[i]=r)}else this.processTask(i,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(As(t.error)):i(null,As(t.data)))}else{const i=new Set,r=t.hasCallback?(t,r)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Ms(t):null,data:Ms(r,i)},i)}:e=>{},n=As(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source,n.scope)[e[1]](n,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class vv{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ni();const i=this.workerPool.acquire(this.id);for(let r=0;r<i.length;r++){const e=new vv.Actor(i[r],t,this.id);e.name=`Worker ${r}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,i){ei(this.actors,((i,r)=>{i.send(e,t,r)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}vv.Actor=xv;var bv={workerUrl:"",workerClass:null,workerParams:void 0};function wv(){return null!=bv.workerClass?new bv.workerClass:new self.Worker(bv.workerUrl,bv.workerParams)}const Sv="mapboxgl_preloaded_worker_pool";class Ev{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ev.workerCount;)this.workers.push(new wv);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Sv]}numActive(){return Object.keys(this.active).length}}let Tv;function Cv(){return Tv||(Tv=new Ev),Tv}Ev.workerCount=2;let kv,Mv,Av,Pv,Iv,Dv=null;function Rv(){return yi()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Mv||r.DRACO_URL}function zv(){if(yi()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Pv)return Pv;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Pv=WebAssembly.validate(e)?r.MESHOPT_SIMD_URL:r.MESHOPT_URL,Pv}const Lv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Fv={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Bv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ov(e,t,i){const r=i.json.bufferViews.length,n=i.buffers.length;t.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:e.byteLength},i.buffers[n]=e}const Nv="KHR_draco_mesh_compression";function Vv(e,t){const i=e.extensions&&e.extensions[Nv];if(!i)return;const r=new Av.Decoder,n=Wv(t,i.bufferView),a=new Av.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,a))throw new Error("Failed to decode Draco mesh");const o=t.json.accessors[e.indices],s=Lv[o.componentType],l=o.count*s.BYTES_PER_ELEMENT,c=Av._malloc(l);s===Uint16Array?r.GetTrianglesUInt16Array(a,l,c):r.GetTrianglesUInt32Array(a,l,c),Ov(Av.memory.buffer.slice(c,c+l),o,t),Av._free(c);for(const h of Object.keys(i.attributes)){const n=r.GetAttributeByUniqueId(a,i.attributes[h]),o=t.json.accessors[e.attributes[h]],s=Fv[o.componentType],l=o.count*Bv[o.type]*Lv[o.componentType].BYTES_PER_ELEMENT,c=Av._malloc(l);r.GetAttributeDataArrayForAllPoints(a,n,Av[s],l,c),Ov(Av.memory.buffer.slice(c,c+l),o,t),Av._free(c)}r.destroy(),a.destroy(),delete e.extensions[Nv]}const jv="EXT_meshopt_compression";function Uv(e,t){if(!e.extensions||!e.extensions[jv])return;const i=e.extensions[jv],r=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),n=new Uint8Array(i.count*i.byteStride);Iv.decodeGltfBuffer(n,i.count,i.byteStride,r,i.mode,i.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=n.buffer,delete e.extensions[jv]}const Gv=1179937895,$v=new TextDecoder("utf8");function qv(e,t){return new URL(e,t).href}function Hv(e,t,i,r){return fetch(qv(e.uri,r)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[i]=e}))}function Wv(e,t){const i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Zv(e,t,i,r){if(e.uri){const n=qv(e.uri,r);return fetch(n).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[i]=e}))}if(void 0!==e.bufferView){const r=Wv(t,e.bufferView),n=new Blob([r],{type:e.mimeType});return createImageBitmap(n).then((e=>{t.images[i]=e}))}}function Xv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===Gv){const i=new Uint32Array(e,t);let n=2;const a=(i[n++]>>2)-3,o=i[n++]>>2;if(n++,r.json=JSON.parse($v.decode(i.subarray(n,n+o))),n+=o,n<a){const a=i[n++];n++;const o=t+(n<<2);r.buffers[0]=e.slice(o,o+a)}}else r.json=JSON.parse($v.decode(new Uint8Array(e,t)));const{buffers:n,images:a,meshes:o,extensionsUsed:s,bufferViews:l}=r.json;let c=Promise.resolve();if(n){const e=[];for(let t=0;t<n.length;t++){const a=n[t];a.uri?e.push(Hv(a,r,t,i)):r.buffers[t]||(r.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=s&&s.includes(Nv),n=s&&s.includes(jv);if(t&&e.push(function(){if(!Av)return kv||(kv=function(e){let t,i=null;function r(){t=new Uint8Array(i.buffer)}function n(){throw new Error("Unexpected Draco error.")}const a={a:{a:n,d:function(e,i,r){return t.copyWithin(e,i,i+r)},c:function(e){const n=t.length,a=Math.max(e>>>0,Math.ceil(1.2*n)),o=Math.ceil((a-n)/65536);try{return i.grow(o),r(),!0}catch(e){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,a):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,a)))).then((e=>{const{Rb:n,Qb:a,P:o,T:s,X:l,Ja:c,La:h,Qa:u,Va:d,Wa:p,eb:f,jb:m,f:g,e:_,yb:y,zb:x,Ab:v,Bb:b,Db:w,Gb:S}=e.instance.exports;i=_;const E=(()=>{let e=0,i=0,r=0,o=0;return s=>{r&&(n(o),n(e),i+=r,r=e=0),e||(i+=128,e=a(i));const l=s.length+7&-8;let c=e;l>=i&&(r=l,c=o=a(l));for(let e=0;e<s.length;e++)t[c+e]=s[e];return c}})();return r(),g(),{memory:_,_free:n,_malloc:a,Mesh:class{constructor(){this.ptr=o()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,i){const r=E(e),n=h(this.ptr,r,t,i.ptr);return!!l(n)}GetAttributeByUniqueId(e,t){return{ptr:u(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,i){d(this.ptr,e.ptr,t,i)}GetTrianglesUInt32Array(e,t,i){p(this.ptr,e.ptr,t,i)}GetAttributeDataArrayForAllPoints(e,t,i,r,n){f(this.ptr,e.ptr,t.ptr,i,r,n)}},DT_INT8:y(),DT_UINT8:x(),DT_INT16:v(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}}))}(fetch(Rv())),kv.then((e=>{Av=e,kv=void 0})))}()),n&&e.push(function(){if(Iv)return;const e=function(e){let t;const i=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(e,i,a,o,s,l){!function(e,t,i,r,n,a,o){const s=e.exports.sbrk,l=r+3&-4,c=s(l*n),h=s(a.length),u=new Uint8Array(e.exports.memory.buffer);u.set(a,h);const d=t(c,r,n,h,a.length);if(0===d&&o&&o(c,l,n),i.set(u.subarray(c,c+r*n)),s(c-s(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(t,t.exports[n[s]],e,i,a,o,t.exports[r[l]])}}}(fetch(zv()));return e.ready.then((()=>{Iv=e}))}()),a)for(let o=0;o<a.length;o++)e.push(Zv(a[o],r,o,i));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&o)for(const{primitives:e}of o)for(const t of e)Vv(t,r);if(n&&o&&l)for(const e of l)Uv(e,r);return r}))}))}function Yv(e,t){const i=e.json.bufferViews[t.bufferView],r=Lv[t.componentType];return new r(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==Bv[t.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:Bv[t.type]))}function Jv(e,t,i,r){const n=Lv[t.componentType],a=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),o=e.json.bufferViews[t.bufferView],s=o.byteStride?o.byteStride/n.BYTES_PER_ELEMENT:Bv[t.type],l=i.float32,c=l.length/i.capacity;for(let h=0,u=0;h<t.count*s;h+=s,u+=c)for(let e=0;e<c;e++)l[u+e]=r[h+e]*a;i._trim()}function Qv(e,t,i){const r=e.indices,n=e.attributes,a={};a.indexArray=new ec;const o=t.json.accessors[r],s=o.count/3;a.indexArray.reserve(s);const l=Yv(t,o);for(let d=0;d<s;d++)a.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);a.indexArray._trim(),a.vertexArray=new Ul;const c=t.json.accessors[n.POSITION];a.vertexArray.reserve(c.count);const h=Yv(t,c);for(let d=0;d<c.count;d++)a.vertexArray.emplaceBack(h[3*d],h[3*d+1],h[3*d+2]);if(a.vertexArray._trim(),a.aabb=new Mu(c.min,c.max),a.centroid=function(e,t){const i=[0,0,0],r=e.length;if(r>0){for(let n=0;n<r;n++){const r=3*e[n];i[0]+=t[r],i[1]+=t[r+1],i[2]+=t[r+2]}i[0]/=r,i[1]/=r,i[2]/=r}return i}(l,h),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],i=Bv[e.type],r=Yv(t,e);a.colorArray=3===i?new Ul:new jl,a.colorArray.resize(e.count),Jv(t,e,a.colorArray,r)}if(void 0!==n.NORMAL){a.normalArray=new Ul;const e=t.json.accessors[n.NORMAL];a.normalArray.resize(e.count);const i=Yv(t,e);Jv(t,e,a.normalArray,i)}if(void 0!==n.TEXCOORD_0&&i.length>0){a.texcoordArray=new lc;const e=t.json.accessors[n.TEXCOORD_0];a.texcoordArray.resize(e.count);const i=Yv(t,e);Jv(t,e,a.texcoordArray,i)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=Yv(t,e))}void 0!==n._FEATURE_RGBA4444&&(a.featureData=new Uint32Array(Yv(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer));const u=e.material;return a.material=function(e,t){const{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:a,occlusionTexture:o,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:h=1,roughnessFactor:u=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=o?t[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&f){const e=o.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new $r(...c),metallicFactor:h,roughnessFactor:u,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:a?t[a.index]:void 0,occlusionTexture:f,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==u?t.json.materials[u]:{defined:!1},i),a}function Kv(t,i,r){const{matrix:n,rotation:a,translation:o,scale:s,mesh:l,extras:c,children:h}=t,u={};if(u.matrix=n||e.ae.fromRotationTranslationScale([],a||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==l){u.meshes=r[l];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:i,max:r}=t.aabb;e[0]+=i[0]+r[0],e[1]+=i[1]+r[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(c&&(c.id&&(u.id=c.id),c.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.codePointAt(r);return i}(e),i=[],r=t.length/24,n=new Uint16Array(t.buffer),a=new Float32Array(t.buffer);for(let o=0;o<r;o++){const e=n[2*o*6]/30,t=n[2*o*6+1]/30,r=n[2*o*6+10]/100,s=a[6*o+1],l=a[6*o+2],c=a[6*o+3],h=a[6*o+4],u=c-s,d=h-l,p=Math.hypot(u,d);i.push({pos:[s+.5*u,l+.5*d,t],normal:[d/p,-u/p,0],width:p,height:e,depth:r,points:[s,l,c,h]})}return i}(c.lights))),h){const e=[];for(const t of h)e.push(Kv(i.json.nodes[t],i,r));u.children=e}return u}function eb(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new op(e.vertices,e.indices,8,256),[i,r]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:i,max:r}}function tb(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const i=t[0];if(!i||!Array.isArray(i)||0===i.length)return null;const r=[];for(const o of i){if(!Array.isArray(o)||2!==o.length)continue;const e=o[0],t=o[1];"number"==typeof e&&"number"==typeof t&&r.push(new jt(e,t))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let o=0;o<r.length;o++){const e=r[o],t=r[(o+1)%r.length],i=r[(o+2)%r.length];n+=(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)}n>0&&r.reverse();const a=Cd(r.flatMap((e=>[e.x,e.y])),[]);return 0===a.length?null:{vertices:r,indices:a}}function ib(t,i){const r=[],n=[];let a=0;const o=[];for(const s of t){a=r.length;const t=s.vertexArray.float32,l=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)o[0]=t[3*n+0],o[1]=t[3*n+1],o[2]=t[3*n+2],e.$.transformMat4(o,o,i),r.push(new jt(o[0],o[1]));for(let e=0;e<3*s.indexArray.length;e++)n.push(l[e]+a)}if(n.length%3!=0)return null;for(let e=0;e<n.length;e+=3){const t=r[n[e+0]],i=r[n[e+1]],a=r[n[e+2]];(t.x-i.x)*(a.y-i.y)-(a.x-i.x)*(t.y-i.y)>0&&([n[e+1],n[e+2]]=[n[e+2],n[e+1]])}return{vertices:r,indices:n}}function rb(e){const t=function(e,t){const i=[],r=WebGL2RenderingContext;if(e.json.textures)for(const n of e.json.textures){const a={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==n.sampler&&Object.assign(a,e.json.samplers[n.sampler]),i.push({image:t[n.source],sampler:a,uploaded:!1})}return i}(e,e.images),i=function(e,t){const i=[];for(const r of e.json.meshes){const n=[];for(const i of r.primitives)n.push(Qv(i,e,t));i.push(n)}return i}(e,t),{scenes:r,scene:n,nodes:a}=e.json,o=r?r[n||0].nodes:a,s=[];for(const l of o)s.push(Kv(a[l],e,i));return function(e,t,i){const r={},n=new Set;for(let a=0;a<e.length;a++){const e=i[t[a]];if(!e.extras)continue;const o=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(o||s)&&n.add(a),"1.0.0"===o&&s&&(r[s]=a)}for(let a=0;a<e.length;a++){if(n.has(a))continue;const o=e[a],s=i[t[a]];if(!s.extras)continue;let l=null;o.id in r&&(l=ib(e[r[o.id]].meshes,o.matrix)),l||(l=tb(s)),l&&(o.footprint=eb(l))}if(n.size>0){const t=Array.from(n.values()).sort(((e,t)=>e-t));for(let i=t.length-1;i>=0;i--)e.splice(t[i],1)}}(s,o,e.json.nodes),s}function nb(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,i=e.aabb.min[0]-1,r=e.aabb.min[1]-1,n=cv/(e.aabb.max[0]-i+2),a=cv/(e.aabb.max[1]-r+2);for(let o=0;o<t.length;o+=3){const s=t[o+2],l=(t[o+0]-i)*n|0,c=(t[o+1]-r)*a|0;s>e.heightmap[c*cv+l]&&(e.heightmap[c*cv+l]=s)}}function ab(t,i){const r={};r.indexArray=new ec,r.indexArray.reserve(4*t.length),r.vertexArray=new Ul,r.vertexArray.reserve(10*t.length),r.colorArray=new jl,r.vertexArray.reserve(10*t.length);let n=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*i,a=[-s.normal[1],s.normal[0],0],o=Math.min(.29,.1*s.width/s.depth),l=s.width-2*s.depth*i*(o+.01),c=e.$.scaleAndAdd([],s.pos,a,l/2),h=e.$.scaleAndAdd([],s.pos,a,-l/2),u=[c[0],c[1],c[2]+s.height],d=[h[0],h[1],h[2]+s.height],p=e.$.scaleAndAdd([],s.normal,a,o);e.$.scale(p,p,t);const f=e.$.scaleAndAdd([],s.normal,a,-o);e.$.scale(f,f,t),e.$.add(p,c,p),e.$.add(f,h,f),c[2]+=.1,h[2]+=.1,r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/t/2;r.colorArray.emplaceBack(-m-o,-1,m,.8),r.colorArray.emplaceBack(m+o,-1,m,.8),r.colorArray.emplaceBack(-m,0,m,1.3),r.colorArray.emplaceBack(m,0,m,1.3),r.colorArray.emplaceBack(m+o,-.8,m,.7),r.colorArray.emplaceBack(m+o,-.8,m,.7),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(m+o,-1.2,m,.8),r.colorArray.emplaceBack(m+o,-1.2,m,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=$r.white,a.pbrMetallicRoughness=o,r.material=a,r.aabb=new Mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const ob=new Float32Array(262144),sb=new Uint8Array(262144);function lb(e){let t=0;if(e.meshes)for(const i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(const i of e.children)t=Math.max(t,lb(i));return t}function cb(e,t,i){if(e.meshes)for(const r of e.meshes)r.aabb.min[0]!==1/0&&i.insert(t,r.aabb.min[0],r.aabb.min[1],r.aabb.max[0],r.aabb.max[1]);if(e.children)for(const r of e.children)cb(r,t,i)}const hb=["","wall","door","roof","window","lamp","logo"];class ub{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:lb(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==e&&(i.transformedAabb=Mu.applyTransformFast(i.aabb,this.node.matrix),t.encapsulate(i.transformedAabb)),e++;this.aabb=t}return this.aabb}}class db{constructor(e,t,i,r,n,a){this.id=t,this.modelTraits|=hv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=hv.HasMapboxMeshFeatures),r&&(this.modelTraits|=hv.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const o of e)this.nodesInfo.push(new ub(o)),cb(o,a.featureIndexArray.length,a.grid),a.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,a.bucketLayerIDs.length-1,0)}updateFootprints(e,t){for(const i of this.getNodesInfo()){const r=i.node;r.footprint&&t.push({footprint:r.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const i of t){const t=i.node;this.uploaded?this.updatePbrBuffer(t):fv(t,e,!0)}for(const i of t)mv(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),t=!0);return t}needsReEvaluation(e,t,i){const r=e.transform.projectionOptions,n=e.style.getBrightness(),a=this.brightness!==n;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||pb(i.paint.get("model-color").value,a)||pb(i.paint.get("model-color-mix-intensity").value,a)||pb(i.paint.get("model-roughness").value,a)||pb(i.paint.get("model-emissive-strength").value,a)||pb(i.paint.get("model-height-based-emissive-strength-multiplier").value,a))&&(this.projection=r,this.brightness=n,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const n of i){const e=n.feature;n.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},r)}}evaluate(e){const t=this.getNodesInfo();for(const i of t){if(!i.node.meshes)continue;const t=i.feature,r=i.node.meshes&&i.node.meshes[0].featureData,n=i.evaluatedColor[2],a=i.evaluatedRMEA[2],o=this.id.canonical;if(i.hasTranslucentParts=!1,r){for(let r=0;r<hb.length;r++){const n=hb[r];n.length&&(t.properties.part=n);const a=e.paint.get("model-color").evaluate(t,{},o).toRenderColor(null),s=e.paint.get("model-color-mix-intensity").evaluate(t,{},o);i.evaluatedColor[r]=[a.r,a.g,a.b,s],i.evaluatedRMEA[r][0]=e.paint.get("model-roughness").evaluate(t,{},o),i.evaluatedRMEA[r][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o),i.evaluatedRMEA[r][3]=a.a,i.emissionHeightBasedParams[r]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},o),!i.hasTranslucentParts&&a.a<1&&(i.hasTranslucentParts=!0)}delete t.properties.part,mb(i,n!==i.evaluatedColor[2]||a!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o);i.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},o),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,i,r){const n=e.findDEMTileFor(i);if(n&&(n.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const t=of.create(e,i,n);if(!t)return;this.modelTraits&hv.HasMapboxMeshFeatures&&this.updateDEM(e,t,i,r);for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const r=i.footprint.vertices;let n=t.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)n=Math.min(n,t.getElevationAt(r[e].x,r[e].y,!0,!0));i.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,i,r){let n=t._dem._modifiedForSources[r];if(void 0===n&&(t._dem._modifiedForSources[r]=[],n=t._dem._modifiedForSources[r]),n.includes(i.canonical))return;const a=t._dem.dim;n.push(i.canonical);let o=!1;for(const s of this.getNodesInfo()){const e=s.node;if(!e.footprint||!e.footprint.grid)continue;const i=e.footprint.grid,r=t.tileCoordToPixel(i.min.x,i.min.y),n=t.tileCoordToPixel(i.max.x,i.max.y),l=Math.min(Math.min(a-n.y,r.x),Math.min(r.y,a-n.x));if(l<0)continue;const c=Jt(l,2,5);let h=Math.max(0,r.x-c),u=Math.max(0,r.y-c),d=Math.min(n.x+c,a-1),p=Math.min(n.y+c,a-1);for(let t=u;t<=p;++t)for(let e=h;e<=d;++e)sb[t*a+e]=255;let f=0,m=0;for(let o=0;o<i.cellsY;++o)for(let e=0;e<i.cellsX;++e){if(!i.cells[o*i.cellsX+e])continue;const r=t.tileCoordToPixel(i.min.x+e/i.xScale,i.min.y+o/i.yScale),n=t.tileCoordToPixel(i.min.x+(e+1)/i.xScale,i.min.y+(o+1)/i.yScale);for(let e=r.y;e<=Math.min(n.y+1,a-1);++e)for(let i=r.x;i<=Math.min(n.x+1,a-1);++i)255===sb[e*a+i]&&(sb[e*a+i]=0,f+=t.getElevationAtPixel(i,e),m++)}const g=f/m;h=Math.max(1,r.x-c),u=Math.max(1,r.y-c),d=Math.min(n.x+c,a-2),p=Math.min(n.y+c,a-2),o=!0;for(let o=u;o<=p;++o)for(let e=h;e<=d;++e)0===sb[o*a+e]&&(ob[o*a+e]=t._dem.set(e,o,g));for(let o=1;o<c;++o){h=Math.max(1,r.x-o),u=Math.max(1,r.y-o),d=Math.min(n.x+o,a-2),p=Math.min(n.y+o,a-2);for(let e=u;e<=p;++e)for(let i=h;i<=d;++i){const r=e*a+i;if(255===sb[r]){let n=0,s=0,l=-1,h=-1;for(let t=-1;t<=1;++t)for(let r=-1;r<=1;++r){const c=(e+t)*a+i+r;if(sb[c]>=o)continue;const u=ob[c],d=Math.abs(u);d>s&&(n=u,s=d,l=r,h=t)}if(s>.1){const a=1-(o+.5*Math.abs(l*h))/c;let s=t._dem.get(i,e)+n*a;const u=t._dem.get(i+l,e+h),d=t._dem.get(i-l,e-h,!0);(s-u)*(s-d)>0&&(s=(u+d)/2),ob[r]=t._dem.set(i,e,s),sb[r]=o}}}}}o&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=zi.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)mv(t.node),gv(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let n=0;n<this.nodesInfo.length;n++){const e=r[n].node;r[n].hiddenByReplacement=!!e.footprint&&!i.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(t,i){const r=this.getNodesInfo(),n=[],a=[0,0,0],o=e.ae.identity([]);for(let s=0;s<this.nodesInfo.length;s++){const l=r[s],c=l.node.meshes[0],h=c.transformedAabb;if(t<h.min[0]||i<h.min[1]||t>h.max[0]||i>h.max[1])continue;if(!0===l.node.hidden)return{height:0,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]};e.ae.invert(o,l.node.matrix),a[0]=t,a[1]=i,e.$.transformMat4(a,a,o);const u=(a[0]-c.aabb.min[0])/(c.aabb.max[0]-c.aabb.min[0])*cv|0,d=Math.min(63,(a[1]-c.aabb.min[1])/(c.aabb.max[1]-c.aabb.min[1])*cv|0)*cv+Math.min(63,u),p=c.heightmap[d];if(!(p<0&&l.node.footprint)){if(l.hiddenByReplacement)return;return{height:p,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]}}if(l.node.footprint.grid.query(new jt(t,i),new jt(t,i),n),n.length>0)return{height:void 0,maxHeight:l.feature.properties.height,hidden:l.hiddenByReplacement,verticalScale:l.evaluatedScale[2]}}}}function pb(e,t){return!e.isLightConstant&&t}function fb(e,t,i,r,n,a,o,s){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,h=240&t|(240&t)>>4;i[3]>0&&(l=Hr(l,255*i[0],i[3]),c=Hr(c,255*i[1],i[3]),h=Hr(h,255*i[2],i[3]));const u=l<<8|c,d=h<<8|Math.floor(255*r[3]),p=function(e){const t=Jt(e,0,2);return Math.min(Math.round(.5*t*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=Jt(n[0],0,1),m=Jt(n[1],0,1),g=Jt(n[2],0,1),_=Jt(n[3],0,1);let y,x,v,b;if(f!==m&&o!==a&&m!==f){const e=o-a;x=1/(e*(m-f)),v=-(a+e*f)/(e*(m-f));const t=Jt(n[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,x=0,v=1,b=1;if(e.emplaceBack(u,d,p,y,x,v,b),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(u,d,p,y,x,v,b)}}function mb(e,t,i){const r=e.node;let n=0;const a=i&hv.HasMeshoptCompression;for(const o of r.meshes){if(r.lights&&r.lightMeshIndex===n)continue;if(!o.featureData)continue;o.featureArray=new hc,o.featureArray.reserve(o.featureData.length);let i=t;for(const t of o.featureData){const n=a?65535&t:t>>16&65535,s=a?t>>16&65535:65535&t,l=(15&s)<8?15&s:0,c=e.evaluatedRMEA[l],h=e.evaluatedColor[l],u=e.emissionHeightBasedParams[l];let d;if(i&&2===l&&r.lights&&(d=new hc,d.resize(10*r.lights.length)),fb(o.featureArray,n,h,c,u,o.aabb.min[2],o.aabb.max[2],d),d&&i){i=!1;const e=r.meshes[r.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}o.featureArray._trim(),n++}}function gb(e,t,i,r){const n=1<<e.z;t.lat=Lh((r/fa+e.y)/n),t.lng=zh((i/fa+e.x)/n)}Ts(db,"Tiled3dModelBucket",{omit:["layers"]}),Ts(ub,"Tiled3dModelFeature");const _b={circle:class extends Pl{constructor(e,t,i,r){super(e,{layout:xu||(xu=new cl({"circle-sort-key":new sl(hl.layout_circle["circle-sort-key"]),visibility:new ol(hl.layout_circle.visibility)})),paint:vu||(vu=new cl({"circle-radius":new sl(hl.paint_circle["circle-radius"]),"circle-color":new sl(hl.paint_circle["circle-color"]),"circle-blur":new sl(hl.paint_circle["circle-blur"]),"circle-opacity":new sl(hl.paint_circle["circle-opacity"]),"circle-translate":new ol(hl.paint_circle["circle-translate"]),"circle-translate-anchor":new ol(hl.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ol(hl.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ol(hl.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sl(hl.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sl(hl.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sl(hl.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ol(hl.paint_circle["circle-emissive-strength"])}))},t,i,r)}createBucket(e){return new eu(e)}queryRadius(e){const t=e;return mu("circle-radius",this,t)+mu("circle-stroke-width",this,t)+gu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,a,o,s){const l=yu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return sd(e,r,a,o,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,i){const r=od(this);return{config:new eh(this,{zoom:t,lut:i}),defines:r,overrideFog:!1}}},heatmap:class extends Pl{createBucket(e){return new dd(e)}constructor(e,t,i,r){super(e,{layout:xd||(xd=new cl({visibility:new ol(hl.layout_heatmap.visibility)})),paint:vd||(vd=new cl({"heatmap-radius":new sl(hl.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sl(hl.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ol(hl.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ll(hl.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ol(hl.paint_heatmap["heatmap-opacity"])}))},t,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return mu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,n,a,o,s){const l=this.paint.get("heatmap-radius").evaluate(t,i);return sd(e,r,a,o,s,!0,!0,new jt(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,i){return"heatmap"===e?{config:new eh(this,{zoom:t,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Pl{constructor(e,t,i,r){super(e,{layout:bd||(bd=new cl({visibility:new ol(hl.layout_hillshade.visibility)})),paint:wd||(wd=new cl({"hillshade-illumination-direction":new ol(hl.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ol(hl.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ol(hl.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ol(hl.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ol(hl.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ol(hl.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ol(hl.paint_hillshade["hillshade-emissive-strength"])}))},t,i,r)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,i){return{overrideFog:!1}}},fill:class extends Pl{constructor(e,t,i,r){super(e,{layout:ip||(ip=new cl({"fill-sort-key":new sl(hl.layout_fill["fill-sort-key"]),visibility:new ol(hl.layout_fill.visibility)})),paint:rp||(rp=new cl({"fill-antialias":new ol(hl.paint_fill["fill-antialias"]),"fill-opacity":new sl(hl.paint_fill["fill-opacity"]),"fill-color":new sl(hl.paint_fill["fill-color"]),"fill-outline-color":new sl(hl.paint_fill["fill-outline-color"]),"fill-translate":new ol(hl.paint_fill["fill-translate"]),"fill-translate-anchor":new ol(hl.paint_fill["fill-translate-anchor"]),"fill-pattern":new sl(hl.paint_fill["fill-pattern"]),"fill-emissive-strength":new ol(hl.paint_fill["fill-emissive-strength"])}))},t,i,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t,i){return{config:new eh(this,{zoom:t,lut:i}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new tp(e)}queryRadius(){return gu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,a){return!e.queryGeometry.isAboveHorizon&&ru(_u(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Pl{constructor(e,t,i,r){super(e,{layout:Bf||(Bf=new cl({visibility:new ol(hl["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ol(hl["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Of||(Of=new cl({"fill-extrusion-opacity":new ol(hl["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sl(hl["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ol(hl["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ol(hl["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sl(hl["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sl(hl["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sl(hl["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ol(hl["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ol(hl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ol(hl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ol(hl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ol(hl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ol(hl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ol(hl["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ol(hl["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new sl(hl["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new sl(hl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ol(hl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ol(hl["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ol(hl["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ol(hl["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ol(hl["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new sl(hl["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new ol(hl["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},t,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Cf(e)}queryRadius(){return gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,i,r,n,a,o,s,l,c){const h=yu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(i,r),d=this.paint.get("fill-extrusion-base").evaluate(i,r),p=[0,0],f=l&&o.elevation,m=o.elevation?o.elevation.exaggeration():1,g=t.tile.getBucket(this);if(f&&g instanceof Cf){const e=g.centroidVertexArray,t=c+1;t<e.length&&(p[0]=e.geta_centroid_pos0(t),p[1]=e.geta_centroid_pos1(t))}if(0===p[0]&&1===p[1])return!1;"globe"===o.projection.name&&(n=Lf([n],[new jt(0,0),new jt(fa,fa)],t.tileID.canonical).map((e=>e.polygon)).flat());const _=f?l:null,[y,x]=function(t,i,r,n,a,o,s,l,c,h,u){return"globe"===t.projection.name?function(t,i,r,n,a,o,s,l,c,h,u){const d=[],p=[],f=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(e,t,i,r)=>{e[0]=t,e[1]=i,e[2]=r,e[3]=1},y=zf();r>0&&(r+=y),n+=y;for(const x of i){const i=[],y=[];for(const d of x){const p=d.x+a.x,x=d.y+a.y,v=t.projection.projectTilePoint(p,x,u),b=t.projection.upVector(u,d.x,d.y);let w=r,S=n;if(s){const e=jf(p,x,r,n,s,l,c,h);w+=e.base,S+=e.top}0!==r?_(m,v.x+b[0]*f*w,v.y+b[1]*f*w,v.z+b[2]*f*w):_(m,v.x,v.y,v.z),_(g,v.x+b[0]*f*S,v.y+b[1]*f*S,v.z+b[2]*f*S),e.$.transformMat4(m,m,o),e.$.transformMat4(g,g,o),i.push(new Pp(m[0],m[1],m[2])),y.push(new Pp(g[0],g[1],g[2]))}d.push(i),p.push(y)}return[d,p]}(t,i,r,n,a,o,s,l,c,h,u):s?function(t,i,r,n,a,o,s,l,c){const h=[],u=[],d=[0,0,0,1];for(const p of t){const t=[],f=[];for(const h of p){const u=h.x+n.x,p=h.y+n.y,m=jf(u,p,i,r,o,s,l,c);d[0]=u,d[1]=p,d[2]=m.base,d[3]=1,e.aB.transformMat4(d,d,a),d[3]=Math.max(d[3],1e-5);const g=new Pp(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=u,d[1]=p,d[2]=m.top,d[3]=1,e.aB.transformMat4(d,d,a),d[3]=Math.max(d[3],1e-5);const _=new Pp(d[0]/d[3],d[1]/d[3],d[2]/d[3]);t.push(g),f.push(_)}h.push(t),u.push(f)}return[h,u]}(i,r,n,a,o,s,l,c,h):function(e,t,i,r,n){const a=[],o=[],s=n[8]*t,l=n[9]*t,c=n[10]*t,h=n[11]*t,u=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const m of e){const e=[],t=[];for(const i of m){const a=i.x+r.x,o=i.y+r.y,m=n[0]*a+n[4]*o+n[12],g=n[1]*a+n[5]*o+n[13],_=n[2]*a+n[6]*o+n[14],y=n[3]*a+n[7]*o+n[15],x=m+s,v=g+l,b=_+c,w=Math.max(y+h,1e-5),S=m+u,E=g+d,T=_+p,C=Math.max(y+f,1e-5);e.push(new Pp(x/w,v/w,b/w)),t.push(new Pp(S/C,E/C,T/C))}a.push(e),o.push(t)}return[a,o]}(i,r,n,a,o)}(o,n,d,u,h,s,_,p,m,o.center.lat,t.tileID.canonical),v=t.queryGeometry;return function(e,t,i){let r=1/0;ru(i,t)&&(r=Vf(i,t[0]));for(let n=0;n<t.length;n++){const a=t[n],o=e[n];for(let e=0;e<a.length-1;e++){const t=a[e],n=[t,a[e+1],o[e+1],o[e],t];tu(i,n)&&(r=Math.min(r,Vf(i,n)))}}return r!==1/0&&r}(y,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends Pl{constructor(e,t,i,r){const n=ux();super(e,n,t,i,r),n.layout&&(this.layout=new al(n.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ro,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(px)return px;const e=ux();return px=new dx(e.paint.properties["line-width"].specification),px.useIntegerZoom=!0,px})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new sm(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,i){const r=fm(this);return{config:new eh(this,{zoom:t,lut:i}),defines:r,overrideFog:!1}}queryRadius(e){const t=e,i=_x(mu("line-width",this,t),mu("line-gap-width",this,t)),r=mu("line-offset",this,t);return i/2+Math.abs(r)+gu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,n,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=_u(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*_x(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(r=function(e,t){const i=[],r=new jt(0,0);for(let n=0;n<e.length;n++){const a=e[n],o=[];for(let e=0;e<a.length;e++){const i=a[e],n=a[e+1],s=0===e?r:i.sub(a[e-1])._unit()._perp(),l=e===a.length-1?r:n.sub(i)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),o.push(c._mult(t)._add(i))}i.push(o)}return i}(r,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(hu(e,n[t]))return!0;if(nu(e,n,i))return!0}return!1}(o,r,s)}isTileClipped(){return!0}isDraped(e){const t=this.layout.get("line-z-offset");return t.isConstant()&&!t.constantOr(0)}},symbol:vx,background:class extends Pl{constructor(e,t,i,r){super(e,{layout:bx||(bx=new cl({visibility:new ol(hl.layout_background.visibility)})),paint:wx||(wx=new cl({"background-color":new ol(hl.paint_background["background-color"]),"background-pattern":new ol(hl.paint_background["background-pattern"]),"background-opacity":new ol(hl.paint_background["background-opacity"]),"background-emissive-strength":new ol(hl.paint_background["background-emissive-strength"])}))},t,i,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,i){return{overrideFog:!1}}},raster:Px,"raster-particle":Fx,sky:class extends Pl{constructor(e,t,i,r){super(e,{layout:Rx||(Rx=new cl({visibility:new ol(hl.layout_sky.visibility)})),paint:zx||(zx=new cl({"sky-type":new ol(hl.paint_sky["sky-type"]),"sky-atmosphere-sun":new ol(hl.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ol(hl.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ol(hl.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ol(hl.paint_sky["sky-gradient-radius"]),"sky-gradient":new ll(hl.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ol(hl.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ol(hl.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ol(hl.paint_sky["sky-opacity"])}))},t,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,a=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&fi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?Ox(a.azimuthal,90-a.polar,t):Ox(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return Ox(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Pl{constructor(e,t,i,r){super(e,{paint:Lx||(Lx=new cl({}))},t,null)}},model:class extends Pl{constructor(e,t,i,r){super(e,{layout:sv||(sv=new cl({visibility:new ol(hl.layout_model.visibility),"model-id":new sl(hl.layout_model["model-id"])})),paint:lv||(lv=new cl({"model-opacity":new ol(hl.paint_model["model-opacity"]),"model-rotation":new sl(hl.paint_model["model-rotation"]),"model-scale":new sl(hl.paint_model["model-scale"]),"model-translation":new sl(hl.paint_model["model-translation"]),"model-color":new sl(hl.paint_model["model-color"]),"model-color-mix-intensity":new sl(hl.paint_model["model-color-mix-intensity"]),"model-type":new ol(hl.paint_model["model-type"]),"model-cast-shadows":new ol(hl.paint_model["model-cast-shadows"]),"model-receive-shadows":new ol(hl.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ol(hl.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new sl(hl.paint_model["model-emissive-strength"]),"model-roughness":new sl(hl.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new sl(hl.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ol(hl.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ol(hl.paint_model["model-front-cutoff"])}))},t,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new ov(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof db?fa-1:0}queryIntersectsFeature(t,i,r,n,a,o){if(!this.modelManager)return!1;const s=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof ov))return!1;const c=l;for(const h in c.instancesPerModel){const r=c.instancesPerModel[h],n=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(r.idToFeaturesIndex.hasOwnProperty(n)){const i=r.features[r.idToFeaturesIndex[n]],a=s.getModel(h,this.scope);if(!a)return!1;let l=e.ae.create();const u=new xh(0,0),d=c.canonical;let p=Number.MAX_VALUE;for(let n=0;n<i.instancedDataCount;++n){const s=16*(i.instancedDataOffset+n),c=r.instancedDataArray.float32,h=[c[s+4],c[s+5],c[s+6]];gb(d,u,c[s],0|c[s+1]),uv(l,a,o,u,i.rotation,i.scale,h,!1,!1,!1),"globe"===o.projection.name&&(l=Wx(l,o));const f=e.ae.multiply([],o.projMatrix,l),m=t.queryGeometry,g=Zx(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,f,a.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof gs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,i,r,n){const a=t.tile,o=a.getBucket(this);let s=null,l=Number.MAX_VALUE;if(!(o&&o instanceof db))return{queryFeature:s,intersectionZ:l};const c=o.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!r.filter(new Js(a.tileID.overscaledZ),c.feature,a.tileID.canonical))return{queryFeature:s,intersectionZ:l};const h=c.node,u=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),d=c.evaluatedScale;let p=0;n.elevation&&h.elevation&&(p=h.elevation*n.elevation.exaggeration()),e.ae.translate(u,u,[(h.anchor?h.anchor[0]:0)*(d[0]-1),(h.anchor?h.anchor[1]:0)*(d[1]-1),p]),e.ae.scale(u,u,d),e.ae.multiply(u,u,h.matrix);const f=t.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,g=function(t){const i=e.ae.multiply([],u,t.matrix),r=e.ae.multiply(i,n.expandedFarZProjMatrix,i);for(let e=0;e<t.meshes.length;++e){const i=t.meshes[e];if(e===t.lightMeshIndex)continue;const a=Zx(m,n,r,i.aabb);null!=a&&(l=Math.min(a,l))}if(t.children)for(const e of t.children)g(e)};if(g(h),l===Number.MAX_VALUE)return{queryFeature:s,intersectionZ:l};const _=new xh(0,0);return gb(a.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),s={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:s,intersectionZ:l}}},clip:class extends Pl{constructor(e,t,i,r){super(e,{layout:np||(np=new cl({"clip-layer-types":new ol(hl.layout_clip["clip-layer-types"]),"clip-layer-scope":new ol(hl.layout_clip["clip-layer-scope"])})),paint:ap||(ap=new cl({}))},t,i,r)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new lp(e)}isTileClipped(){return!0}is3D(){return!0}}};Ts(nx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const yb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=yb[15&i];if(!n)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new xb(o,a,n,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=yb.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return vb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:a,nodeSize:o}=this,s=[0,n.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,h=s.pop()||0,u=s.pop()||0;if(h-u<=o){for(let o=u;o<=h;o++){const s=a[2*o],c=a[2*o+1];s>=e&&s<=i&&c>=t&&c<=r&&l.push(n[o])}continue}const d=u+h>>1,p=a[2*d],f=a[2*d+1];p>=e&&p<=i&&f>=t&&f<=r&&l.push(n[d]),(0===c?e<=p:t<=f)&&(s.push(u),s.push(d-1),s.push(1-c)),(0===c?i>=p:r>=f)&&(s.push(d+1),s.push(h),s.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:a}=this,o=[0,r.length-1,0],s=[],l=i*i;for(;o.length;){const c=o.pop()||0,h=o.pop()||0,u=o.pop()||0;if(h-u<=a){for(let i=u;i<=h;i++)Eb(n[2*i],n[2*i+1],e,t)<=l&&s.push(r[i]);continue}const d=u+h>>1,p=n[2*d],f=n[2*d+1];Eb(p,f,e,t)<=l&&s.push(r[d]),(0===c?e-i<=p:t-i<=f)&&(o.push(u),o.push(d-1),o.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(o.push(d+1),o.push(h),o.push(1-c))}return s}}function vb(e,t,i,r,n,a){if(n-r<=i)return;const o=r+n>>1;bb(e,t,o,r,n,a),vb(e,t,i,r,o-1,1-a),vb(e,t,i,o+1,n,1-a)}function bb(e,t,i,r,n,a){for(;n>r;){if(n-r>600){const o=n-r+1,s=i-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);bb(e,t,i,Math.max(r,Math.floor(i-s*c/o+h)),Math.min(n,Math.floor(i+(o-s)*c/o+h)),a)}const o=t[2*i+a];let s=r,l=n;for(wb(e,t,r,i),t[2*n+a]>o&&wb(e,t,r,n);s<l;){for(wb(e,t,s,l),s++,l--;t[2*s+a]<o;)s++;for(;t[2*l+a]>o;)l--}t[2*r+a]===o?wb(e,t,r,l):(l++,wb(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function wb(e,t,i,r){Sb(e,i,r),Sb(t,2*i,2*r),Sb(t,2*i+1,2*r+1)}function Sb(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Eb(e,t,i,r){const n=e-i,a=t-r;return n*n+a*a}e.A=Xa,e.B=Ja,e.C=$r,e.D=Za,e.E=Or,e.F=zn,e.H=pl,e.I=K_,e.J=ns,e.K=ts,e.L=function(e){const t=e.value;let i=[];if(!t)return i;const r=An(t);return"string"!==r?(i=i.concat([new iv(e.key,t,`string expected, "${r}" found`)]),i):(rv(t,!0)||(i=i.concat([new iv(e.key,t,`invalid url "${t}"`)])),i)},e.M=class{constructor(e,t,i,r){this.id=e,this.position=null!=t?new xh(t[0],t[1]):new xh(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(e.ae.multiply(t.matrix,i,t.matrix),t.meshes)for(const e of t.meshes){const i=Mu.applyTransformFast(e.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.ae.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(e,t,i,r,n,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];uv(this.matrix,this,e.transform,this.position,t,i,r,n,a,o)}upload(e){if(!this.uploaded){for(const t of this.nodes)fv(t,e);for(const e of this.nodes)mv(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)gv(e)}},e.N=hl,e.O=el,e.P=jt,e.Q=ii,e.R=Ki,e.S=uc,e.T=G_,e.U=cl,e.V=iv,e.W=ol,e.X=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return _i(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Hr(e.x,t.x,i),y:Hr(e.y,t.y,i),z:Hr(e.z,t.z,i),azimuthal:Hr(e.azimuthal,t.azimuthal,i),polar:Hr(e.polar,t.polar,i)}}},e.Y=Js,e.Z=gs,e._=Uh,e.a=ny,e.a$=wu,e.a0=Qt,e.a1=al,e.a2=Ku,e.a3=Hr,e.a4=fa,e.a5=Wr,e.a6=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,i]=e;const r=_i([1,t,i]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Hr(e.x,t.x,i),y:Hr(e.y,t.y,i),z:Hr(e.z,t.z,i)}}},e.a7=$c,e.a8=Bc,e.a9=Nc,e.aA=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.aC=function(t,i){const{x:r,y:n}=t.point,a=Qu(r,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.ae.multiply(a,a,Xu(Ou(i)))},e.aE=Ym,e.aF=sg,e.aG=Xm,e.aH=function(e,t,i,r,n){const a=5*t+2;e.float32[a+0]=i,e.float32[a+1]=r,e.float32[a+2]=n},e.aI=O_,e.aJ=xh,e.aK=D_,e.aL=Eh,e.aM=ku,e.aN=Vx,e.aO=Sh,e.aP=Uu,e.aQ=Th,e.aR=function(e,t,i,r,n,a,o,s,l){if("globe"===l.name)return Uu(e,t,new Sh(i,r,n),!1);const c=h_({z:i,x:r,y:n},l);return new Mu([(a+c.x/c.scale)*t,t*(c.y/c.scale),o],[(a+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.aS=function(e,t,i){let r=0;for(let n=0;n<2;++n){const i=0;e[n]>i&&(r+=(e[n]-i)*(e[n]-i)),t[n]<i&&(r+=(i-t[n])*(i-t[n]))}return r},e.aT=Bh,e.aU=bu,e.aV=ch,e.aW=function(t){const i=e.ae.identity(new Float64Array(16));e.ae.multiply(i,t.pixelMatrix,t.globeMatrix);const r=[0,ph,0],n=[0,fh,0];return e.$.transformMat4(r,r,i),e.$.transformMat4(n,n,i),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!td(t,new xh(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!td(t,new xh(t.center.lat,-90))]},e.aX=function(t,i){const{scale:r}=t.tileTransform,n=r*fa/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.aD.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[n,n])},e.aY=jx,e.aZ=Nx,e.a_=function(t){const i=Nx(t,!0);return e.aD.invert([],[i[0],i[1],i[4],i[5]])},e.aa=Uc,e.ab=Oc,e.ac=qt,e.ad=function(e,t,i){const r=Math.sqrt(e*e+t*t+i*i),n=r>0?Math.acos(i/r)*$t:0;let a=0!==e||0!==t?Math.atan2(-t,-e)*$t+90:0;return a<0&&(a+=360),[r,a,n]},e.af=ey,e.ag=sy,e.ah=iy,e.ai=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.aj=vh,e.ak=Ih,e.al=Dh,e.am=kl,e.an=function(e){qi++,qi>Ni&&(e.getActor().send("enforceCacheSizeLimit",Oi),qi=0)},e.ao=yr,e.ap=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,r){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(e,i)}),t):r(e,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,r)}),t):e(i,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==r)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}},e.aq=function(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=rr(e.request,((e,r,n,a)=>{e?t(e):r&&t(null,{vectorTile:i?void 0:new Mp(new Nm(r)),rawData:r,cacheControl:n,expires:a})}));return()=>{r.cancel(),t()}}),t)},e.ar=Vc,e.as=class extends Fc{constructor(e){super(e),this.current=qc}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.at=jc,e.au=Jt,e.av=Kt,e.ax=Mi,e.ay=Rh,e.az=Lh,e.b=Mc,e.b$=kh,e.b0=function(e){const{x:t,y:i}=e.point,{lng:r,lat:n}=e._center;return Qu(t,i,e.worldSize,r,n)},e.b1=Ht,e.b2=Ch,e.b3=lh,e.b4=function(e){const t=Math.round((e+45+360)%360/90)%4;return Wt[t]},e.b5=45,e.b6=Ph,e.b7=jh,e.b8=Mu,e.b9=_i,e.bA=hy,e.bB=yd,e.bC=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.bD=um,e.bF=Ju,e.bG=Di,e.bH=Ii,e.bI=256,e.bJ=function(t,i){const r=[0,0,0],n=Zu(Ou(i.canonical));return e.$.transformMat4(r,r,n),e.$.transformMat4(r,r,t),r},e.bK=e=>({u_camera_to_center_distance:new Oc(e),u_extrude_scale:new Wc(e),u_device_pixel_ratio:new Oc(e),u_matrix:new $c(e),u_inv_rot_matrix:new $c(e),u_merc_center:new Nc(e),u_tile_id:new Vc(e),u_zoom_transition:new Oc(e),u_up_dir:new Vc(e),u_emissive_strength:new Oc(e)}),e.bL=e=>({u_matrix:new $c(e),u_pixels_to_tile_units:new Wc(e),u_device_pixel_ratio:new Oc(e),u_units_to_pixels:new Nc(e),u_dash_image:new Bc(e),u_gradient_image:new Bc(e),u_image_height:new Oc(e),u_texsize:new Nc(e),u_tile_units_to_pixels:new Oc(e),u_alpha_discard_threshold:new Oc(e),u_trim_offset:new Nc(e),u_trim_fade_range:new Nc(e),u_trim_color:new jc(e),u_emissive_strength:new Oc(e)}),e.bM=e=>({u_matrix:new $c(e),u_texsize:new Nc(e),u_pixels_to_tile_units:new Wc(e),u_device_pixel_ratio:new Oc(e),u_image:new Bc(e),u_units_to_pixels:new Nc(e),u_tile_units_to_pixels:new Oc(e),u_alpha_discard_threshold:new Oc(e),u_trim_offset:new Nc(e)}),e.bN=Ql,e.bO=im,e.bP=Hm,e.bQ=Jm,e.bR=Kg,e.bS=yg,e.bT=od,e.bU=(e,t,i,r,n,a)=>{const o=e.transform,s="globe"===o.projection.name;let l;if("map"===a.paint.get("circle-pitch-alignment"))if(s){const e=Ju(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=o.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:zi.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:ad,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=r,c.u_merc_center=n,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Ku(o.zoom);const e=n[0]*fa,i=n[1]*fa;c.u_up_dir=o.projection.upVector(new Sh(0,0,0),e,i)}return c},e.bV=fm,e.bW=(e,t,i,r,n,a)=>{const o=e.transform;return{u_matrix:pm(e,t,i,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:dm(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a}},e.bX=(e,t,i,r,n,a,o)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:pm(e,t,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:a,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:mm(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:dm(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},e.bY=oi,e.bZ=Sd,e.b_=zf,e.ba=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.bb=Zt,e.bc=function(e,t,i){const r=Ku(i.zoom),n=e.style.map._antialias,a=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!n&&!a},e.bd=function(t){const i=t.pixelsPerMeter,r=i/Rh(1,t.center.lat),n=e.ae.identity(new Float64Array(16));return e.ae.translate(n,n,[t.point.x,t.point.y,0]),e.ae.scale(n,n,[r,r,i]),Float32Array.from(n)},e.be=Gu,e.bf=function(e){const t=Bh-5;e=Jt(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(qt(e))),3);return Math.round(i*(dh.length-1))},e.bg=function(t,i,r,n){const a=i.getNorth(),o=i.getSouth(),s=i.getWest(),l=i.getEast(),c=1<<t.z,h=l-s,u=a-o,d=h/uh,p=-u/dh[r],f=[0,d,0,p,0,0,a,s,0];if(t.z>0){const t=180/n;e.bE.multiply(f,f,[t/h+1,0,0,0,t/u+1,0,-.5*t/d,.5*t/p,1])}return f[2]=c,f[5]=t.x,f[8]=t.y,f},e.bh=Zu,e.bi=Ou,e.bj=function(t,i,r){const n=e.ae.identity(new Float64Array(16)),a=(i/(1<<t)-.5)*Math.PI*2;return e.ae.rotateY(n,r.globeMatrix,a),Float32Array.from(n)},e.bk=Ri,e.bl=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.bm=Px,e.bn=Fx,e.bo=Mx,e.bp=function(e,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let r=0;r<e.length;r++){const t=document.createElement("source");nr(e[r])||(i.crossOrigin="Anonymous"),t.src=e[r],i.appendChild(t)}return{cancel:()=>{}}},e.bq=$_,e.br=li,e.bs=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,r=1<<i,n=Math.floor(e.x),a=Math.floor((e.x-n)*r),o=Math.floor(e.y*r),s=this.findDEMTileFor(new Th(i,n,i,a,o));return!(!s||!s.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const n=r.getSource().maxzoom,a=1<<n,o=Math.floor(e.x),s=e.x-o,l=new Th(n,o,n,Math.floor(s*a),Math.floor(e.y*a)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const h=c.dem,u=1<<c.tileID.canonical.z,d=(s*u-c.tileID.canonical.x)*h.dim,p=(e.y*u-c.tileID.canonical.y)*h.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*Hr(Hr(h.get(f,m),h.get(f,m+1),p-m),Hr(h.get(f+1,m),h.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const r=1<<e.canonical.z;return this.getAtPointOrZero(new Uh(e.wrap+(e.canonical.x+t/fa)/r,(e.canonical.y+i/fa)/r))}getAtTileOffsetFunc(t,i,r,n){return a=>{const o=this.getAtTileOffset(t,a.x,a.y),s=n.upVector(t.canonical,a.x,a.y),l=n.upVectorScale(t.canonical,i,r).metersToTile;return e.$.scale(s,s,o*l),s}}getForTilePoints(e,t,i,r){if(this.isUsingMockSource())return!1;const n=of.create(this,e,r);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,r=t.tileID,n=1<<e.canonical.z-r.canonical.z;let a=e.canonical.x/n-r.canonical.x,o=e.canonical.y/n-r.canonical.y,s=0;for(let l=0;l<e.canonical.z-r.canonical.z&&!i.leaves[s];l++){a*=2,o*=2;const e=2*Math.floor(o)+Math.floor(a);s=i.childOffsets[s]+e,a%=1,o%=1}return{min:this.exaggeration()*i.minimums[s],max:this.exaggeration()*i.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(i=Math.min(i,e.min),r=Math.max(r,e.max),t=!0)}return t?{min:i,max:r}:null}},e.bt=Du,e.bu=Ru,e.bv=Fl,e.bw=ec,e.bx=sx,e.by=vv,e.bz=Cv,e.c=rb,e.c$=function(e,t,i,r){return"custom"===e.type?new Bx(e,t):new _b[e.type](e,t,i,r)},e.c0=Cf,e.c1=ff,e.c2=450,e.c3=7,e.c4=Ax,e.c5=ax,e.c6=256,e.c7=Vu,e.c8=Xu,e.c9=zl,e.cA=uu,e.cB=function(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.$.fromValues(((i.x-r)*t.scale-t.x)*fa,(i.y*t.scale-t.y)*fa,Fh(i.z,i.y))},e.cC=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const a of e)t=Math.min(t,a.x),i=Math.min(i,a.y),r=Math.max(r,a.x),n=Math.max(n,a.y);return{min:new jt(t,i),max:new jt(r,n)}},e.cD=hu,e.cE=$h,e.cF=sh,e.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.cH=Pg,e.cI=tu,e.cJ=Fp,e.cK=qp,e.cL=Hp,e.cM=e_,e.cN=xb,e.cO=function(e){return e({pluginStatus:Gs,pluginURL:$s}),Ws.on("pluginStateChange",e),e},e.cP=Vg,e.cQ=Ng,e.cR=tr,e.cS=qs,e.cT=a,e.cU=Fi,e.cV=Rr,e.cW=di,e.cX=function(e){const t=e.indexOf(Cl);return t>=0?e.slice(0,t):e},e.cY=function(e){return e.indexOf(Cl)>=0},e.cZ=function(e){const t=e.indexOf(Cl);return t>=0?e.slice(t+1):""},e.c_=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.ca=Ul,e.cb=nc,e.cc=1,e.cd=ry,e.ce=0,e.cf=ac,e.cg=function(e,t,i,r,n){return Jt((e-t)/(i-t)*(n-r)+r,r,n)},e.ch=$o,e.ci=Nh,e.cj=class{constructor(e,t,i,r){this.context=e,this.format=r,this.size=i,this.texture=e.gl.createTexture();const[n,a,o]=this.size,{gl:s}=e;s.bindTexture(s.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1);let l=this.format,c=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(l=s.DEPTH_COMPONENT16,c=s.UNSIGNED_SHORT),this.format===s.R8&&(r=s.RED),this.format===s.R32F&&(c=s.FLOAT,r=s.RED),s.texImage3D(s.TEXTURE_3D,0,l,n,a,o,0,r,c,t.data)}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_3D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.ck=Wx,e.cl=[1,1,1],e.cm=of,e.cn=hv,e.co=Xl,e.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new jt(1/0,1/0),max:new jt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=jp(new jt(0,0),new jt(fa,fa),e),r=[];if(t&&!Np(i,this._globalClipBounds))return r;for(const n of this._activeRegions){if(n.hiddenByOverlap)continue;if(!Np(i,n))continue;const t=Up(n.min,n.max,e);r.push({min:t.min,max:t.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId,order:n.order,clipMask:n.clipMask,clipScope:n.clipScope})}return r}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const i of e.cache.getVisibleCoordinates()){const r=e.cache.getTile(i).buckets[e.layer];r&&r.updateFootprints(i.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const i=e.getOrder(),r=e.getClipMask(),n=e.getClipScope();for(const a of t){if(!a.footprint)continue;const e=jp(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:r,clipScope:n})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Bp(e.min,t.min)||Bp(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const i=(e,t)=>e+t;return e.length-t.length||e.reduce(i,"").localeCompare(t.reduce(i,""))}(e.clipScope,t.clipScope)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],r=this._prevRegions[t];e=i.priority!==r.priority||!Op(i,r)||i.order!==r.order||i.clipMask!==r.clipMask||!Ut(i.clipScope,r.clipScope),++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Lp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const i=t[e].priority;for(;e<t.length&&t[e].priority===i;)++e;return e};if(this._sourceIds.length>1){let t=0,i=e(t);for(;t!==i;){let r=t;const n=t;for(;r!==i;){const e=this._activeRegions[r];e.hiddenByOverlap=!1;for(let t=0;t<n;t++){const i=this._activeRegions[t];if(!i.hiddenByOverlap&&e.order===Lp&&Np(e,i)&&(e.hiddenByOverlap=$p(e.footprint,e.tileId,i.footprint,i.tileId),e.hiddenByOverlap))break}++r}t=i,i=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.cq=Ol,e.cr=Q_,e.cs=sc,e.ct=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const i=new Fl,r=new ec,n=[],a=e+1+2,o=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,i)=>{let r=e===a-1?e-2:0===e?e:e-1;return r+=i?24575:0,[r,t]};for(let c=0;c<a;++c)i.emplaceBack(...l(c,0,!0));for(let c=0;c<o;++c)for(let e=0;e<a;++e)i.emplaceBack(...l(e,c,(0===e||e===a-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<a;++t)i.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=r.length,o=t[c]+1+2,l=new ec;for(let i=0;i<o-1;i++){const e=i===o-2,n=e?a*(s-t.length+c-i):a;for(let t=0;t<a-1;t++){const o=i*a+t;0===i||e||0===t||t===a-2?(l.emplaceBack(o+1,o,o+n),l.emplaceBack(o+n,o+n+1,o+1)):(r.emplaceBack(o+1,o,o+n),r.emplaceBack(o+n,o+n+1,o+1))}}const h=Mc.simpleSegment(0,e,i.length,r.length-e);for(let t=0;t<l.uint16.length;t+=3)r.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const u=Mc.simpleSegment(0,e,i.length,r.length-e);n.push({withoutSkirts:h,withSkirts:u})}return{vertices:i,indices:r,segments:n}}_createGrid(e){const t=this._fillGridMeshWithLods(uh,dh);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Du.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new ec;for(let o=0;o<=uh;o++)t.emplaceBack(0,o+1,o+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new nc,r=new nc,n=new nc,a=new nc;this._poleSegments=[];for(let o=0,s=0;o<lh;o++){const e=360/(1<<o);i.emplaceBack(0,-sh,0,.5,0),r.emplaceBack(0,-sh,0,.5,1),n.emplaceBack(0,-sh,0,.5,.5),a.emplaceBack(0,-sh,0,.5,.5);for(let t=0;t<=uh;t++){let o=t/uh,s=0;const l=Hr(0,e,o),[c,h,u]=mh(rd,nd,l,sh);i.emplaceBack(c,h,u,o,s),r.emplaceBack(c,h,u,o,1-s);const d=qt(l);o=.5+.5*Math.sin(d),s=.5+.5*Math.cos(d),n.emplaceBack(c,h,u,o,s),a.emplaceBack(c,h,u,o,1-s)}this._poleSegments.push(Mc.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Pu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,Pu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,Pu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,Pu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.cu=function(e){return kr.has(e)},e.cv=Lp,e.cw=sf,e.cx=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=new jt(i,i),a=e.sub(n),o=t.add(n),s=[a,new jt(o.x,a.y),o,new jt(a.x,o.y)];return r&&s.push(a.clone()),s},e.cy=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=Kt(r-1,-1,e.length-1),a=Kt(r+1,-1,e.length-1),o=e[r],s=e[a],l=e[n].sub(o).unit(),c=s.sub(o).unit(),h=c.angleWithSep(l.x,l.y),u=l.add(c).unit().mult(-1*t/Math.sin(h/2));i.push(o.add(u))}return i},e.cz=u_,e.d=Ut,e.d$=ix,e.d0=ui,e.d1=Ws,e.d2=ir,e.d3=Xt,e.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.d5=Yt,e.d6=Vh,e.d7=gh,e.d8=function(e){let[t,i,r]=e;const n=Math.hypot(t,i,r),a=Math.atan2(t,r),o=.5*Math.PI-Math.acos(-i/n);return new xh(Ht(a),Ht(o))},e.d9=zh,e.dA=function(){Cv().acquire(Sv)},e.dB=function(){const e=Tv;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Sv),Tv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.dC=Ev,e.dD=function(e){const t=Gi();if(!t)return;const i=t.delete(Bi);e&&i.catch(e).then((()=>e()))},e.dE=bv,e.dF=Rv,e.dG=function(e){Mv=zi.resolveURL(e),Dv||(Dv=new vv(Cv(),new Or)),Dv.broadcast("setDracoUrl",Mv)},e.dH=zv,e.dI=function(e){Pv=zi.resolveURL(e),Dv||(Dv=new vv(Cv(),new Or)),Dv.broadcast("setMeshoptUrl",Pv)},e.dJ=ti,e.dK=Ts,e.dL=gd,e.dM=Og,e.dN=h_,e.dO=fc,e.dP=gm,e.dQ=Gm,e.dR=rm,e.dS=hi,e.dT=zg,e.dU=U_,e.dV=function(e,t,i,r,n,a,o,s,l,c,h){e.createArrays(),e.tilePixelRatio=fa/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Js(t),s),d["text-size"].possiblyEvaluate(new Js(i),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Js(t),s),d["icon-size"].possiblyEvaluate(new Js(i),s)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new Js(l+1),s),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new Js(l+1),s),p.textMaxSize=d["text-size"].possiblyEvaluate(new Js(18),s);const f="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),m=u.get("text-size");let g=!1;for(const _ of e.features)if(_.icon&&_.icon.nameSecondary){g=!0;break}for(const _ of e.features){const a=u.get("text-font").evaluate(_,{},s).join(","),l=m.evaluate(_,{},s),d=p.layoutTextSize.evaluate(_,{},s),y=(p.layoutIconSize.evaluate(_,{},s),{horizontal:{},vertical:void 0}),x=_.text;let v,b=[0,0];if(x){const r=x.toString(),o=u.get("text-letter-spacing").evaluate(_,{},s)*Hm,c=u.get("text-line-height").evaluate(_,{},s)*Hm,h=Ds(r)?o:0,p=u.get("text-anchor").evaluate(_,{},s),m=u.get("text-variable-anchor");if(!m){const e=u.get("text-radial-offset").evaluate(_,{},s);b=e?Kg(p,[e*Hm,Jg]):u.get("text-offset").evaluate(_,{},s).map((e=>e*Hm))}let g=f?"center":u.get("text-justify").evaluate(_,{},s);const v="point"===u.get("symbol-placement"),w=v?u.get("text-max-width").evaluate(_,{},s)*Hm:1/0,S=o=>{e.allowVerticalPlacement&&Is(r)&&(y.vertical=hg(x,t,i,n,a,w,c,p,o,h,b,sg.vertical,!0,d,l))};if(!f&&m){const e="auto"===g?m.map((e=>e_(e))):[g];let r=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!y.horizontal[s])if(r)y.horizontal[s]=y.horizontal[0];else{const e=hg(x,t,i,n,a,w,c,"center",s,h,b,sg.horizontal,!1,d,l);e&&(y.horizontal[s]=e,r=1===e.positionedLines.length)}}S("left")}else{if("auto"===g&&(g=e_(p)),v||u.get("text-writing-mode").indexOf("horizontal")>=0||!Is(r)){const e=hg(x,t,i,n,a,w,c,p,g,h,b,sg.horizontal,!1,d,l);e&&(y.horizontal[g]=e)}S(v?"left":g)}}let w=!1;if(_.icon&&_.icon.namePrimary){const t=r[_.icon.namePrimary];t&&(v=vg(n[_.icon.namePrimary],_.icon.nameSecondary?n[_.icon.nameSecondary]:void 0,u.get("icon-offset").evaluate(_,{},s),u.get("icon-anchor").evaluate(_,{},s)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&fi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const S=a_(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!S&&S.iconsInText),(S||v)&&t_(e,_,y,v,r,p,d,0,b,w,o,s,c,h,g)}a&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)},e.dW=sm,e.dX=tp,e.dY=Mp,e.dZ=Nm,e.d_=af,e.da=_h,e.db=r,e.dc=td,e.dd=ed,e.de=function(t){const i=[0,0,0],r=e.ae.identity(new Float64Array(16));return e.ae.multiply(r,t.pixelMatrix,t.globeMatrix),e.$.transformMat4(i,i,r),new jt(i[0],i[1])},e.df=h,e.dg=c,e.dh=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Ci){const t=e.navigator?e.navigator.userAgent:null;Ci=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ci}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.di=ni,e.dj=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",cr,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,i){if(!a(e))return e;const r=dr(e);return r.params.push(`sdk=js-${t}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(e,t){if(!a(e))return e;const i=dr(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeModelURL(e,t){if(!a(e))return e;const i=dr(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,r){if(!a(e))return e;const n=dr(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push(`language=${i}`),r&&n.params.push(`worldview=${r}`),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,r){const n=dr(e);return a(e)?(n.path=`/styles/v1${n.path}/sprite${t}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${t}${i}`,pr(n))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!a(e))return e;const n=dr(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==n.authority&&512===i?"@2x":""}${Hi.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${r.RASTER_URL_PREFIX}${n.path}`:"rasterarrays"===n.authority?n.path=`/${r.RASTERARRAYS_URL_PREFIX}${n.path}`:"3dtiles"===n.authority?n.path=`/${r.TILES3D_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${r.TILE_URL_VERSION}${n.path}`);const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||r.ACCESS_TOKEN;return r.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,o)}canonicalizeTileURL(e,t){const i=dr(e);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${r.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${i.path.replace(`/${r.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${r.TILE_URL_VERSION}/`,"")}`;let a=i.params;return t&&(a=a.filter((e=>!e.match(/^access_token=/)))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(e,t){const i=!!t&&a(t),r=[];for(const a of e.tiles||[])n(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a);return r}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=dr(r.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!r.REQUIRE_ACCESS_TOKEN)return pr(e);if(t=t||r.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),pr(e)}},e.dk=function(e,t){t?kr.add(e):kr.delete(e)},e.dl=Hi,e.dm=Er,e.dn=Cr,e.dp=hr,e.dq=vr,e.dr=wr,e.ds=function(e){kr.delete(e)},e.dt=Tr,e.du=xr,e.dv=ei,e.dw=t,e.dx=function(e,t){Oi=e,Ni=t},e.dy=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Gs===Ns||Gs===Vs||Gs===js)throw new Error("setRTLTextPlugin cannot be called multiple times.");$s=zi.resolveURL(e),Gs=Ns,Us=t,Hs(),i||Xs()},e.dz=Zs,e.e=zi,e.e0=Ap,e.e1=gp,e.e2=Nt,e.e3=ym,e.e4=d,e.e5=rr,e.e6=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==Gv){const i=new Uint32Array(e,0,7),[,,r,n,a,o]=i;t=i.byteLength+n+a+o+a,(r!==e.byteLength||t>=e.byteLength)&&fi("Invalid b3dm header information.")}return Xv(e,t)},e.e7=function(e,t){const i=rb(e);for(const r of i){for(const e of r.meshes)nb(e);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(ab(r.lights,t)))}return i},e.e8=db,e.e9=xv,e.ea=Ys,e.eb=function(e){$i(),ji&&ji.then((t=>{t.keys().then((i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.f=Lr,e.g=zr,e.h=function(e,t){return ir(ii(e,{type:"json"}),t)},e.i=lr,e.j=_d,e.k=Ig,e.l=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>Xv(t,0,e)))},e.m=Rg,e.n=class extends iv{},e.o=An,e.p=ly,e.q=Xr,e.r=es,e.s=rs,e.t=is,e.u=ul,e.v=ps,e.w=fi,e.x=dl,e.y=_s,e.z=fs})),r(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function i(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+=`${i(r)},`;return`${t}]`}let t="{";for(const r of Object.keys(e).sort())t+=`${r}:${i(e[r])},`;return`${t}}`}function r(t){let r="";for(const n of e.cG)r+=`/${i(t[n])}`;return r}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,n){this._options=n;for(const r of t)this._layerConfigs[r.id]=r,(this._layers[r.id]=e.c$(r,this.scope,null,this._options)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const a=function(e,t){const i={};for(let a=0;a<e.length;a++){const n=t&&t[e[a].id]||r(e[a]);t&&(t[e[a].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(e[a])}const n=[];for(const r in i)n.push(i[r]);return n}(e.dJ(this._layerConfigs),this.keyCache);for(const e of a){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const a=i.sourceLayer||"_geojsonTileLayer";let o=n[a];o||(o=n[a]=[]),o.push(t)}}}const a=1*e.dM;class o{constructor(t){const i={},r=[];for(const e in t){const n=t[e],o=i[e]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i=t.metrics.localGlyph?a:1,s={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};r.push(s),o[e]=s}}const{w:n,h:o}=e.k(r),s=new e.dL({width:n||1,height:o||1});for(const l in t){const r=t[l];for(const t in r.glyphs){const n=r.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const o=i[l][t],c=n.metrics.localGlyph?a:1;e.dL.copy(n.bitmap,s,{x:0,y:0},{x:o.x+c,y:o.y+c},n.bitmap)}}this.image=s,this.positions=i}}e.dK(o,"GlyphAtlas");class s{constructor(t){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.dN(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep}parse(t,i,r,n,a){this.status="parsing",this.data=t,this.collisionBoxArray=new e.dO;const s=new e.dP(Object.keys(t.layers).sort()),c=new e.dQ(this.tileID,this.promoteId);c.bucketLayerIDs=[];const h={},u=new e.dR(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:u,availableImages:r,brightness:this.brightness},p=i.familiesBySource[this.source];for(const o in p){const i=t.layers[o];if(!i)continue;let n=!1,a=!1,u=!1;for(const e of p[o])"symbol"===e[0].type?n=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(u=!0);if(this.extraShadowCaster&&!u)continue;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!a)continue;1===i.version&&e.w(`Vector tile source "${this.source}" layer "${o}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=s.encode(o),m=[];for(let e=0;e<i.length;e++){const t=i.feature(e),r=c.getId(t,o);m.push({feature:t,id:r,index:e,sourceLayerIndex:f})}for(const e of p[o]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(l(e,this.zoom,d.brightness,r),(h[t.id]=t.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>e.id)))))}}let f,m,g,_;u.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},x=()=>{if(f)return this.status="done",a(f);if(this.extraShadowCaster)this.status="done",a(null,{buckets:e.dJ(h).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){const t=new o(m),i=new e.dT(g,_,this.lut);for(const n in h){const a=h[n];a instanceof e.dU?(l(a.layers,this.zoom,d.brightness,r),e.dV(a,m,t.positions,g,i.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):a.hasPattern&&(a instanceof e.dW||a instanceof e.dX||a instanceof e.c0)&&(l(a.layers,this.zoom,d.brightness,r),a.addFeatures(d,this.tileID.canonical,i.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",a(null,{buckets:e.dJ(h).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:u,imageAtlas:i,brightness:d.brightness})}};if(!this.extraShadowCaster){const t=e.dS(d.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{f||(f=e,m=t,x())}),void 0,!1,y):m={};const i=Object.keys(d.iconDependencies);i.length?n.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{f||(f=e,g=t,x())}),void 0,!1,y):g={};const r=Object.keys(d.patternDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{f||(f=e,_=t,x())}),void 0,!1,y):_={}}x()}}function l(t,i,r,n){const a=new e.Y(i,{brightness:r});for(const e of t)e.recalculate(a,n)}class c extends e.E{constructor(t,i,r,n,a,o){super(),this.actor=t,this.layerIndex=i,this.availableImages=r,this.loadVectorData=a||e.aq,this.loading={},this.loaded={},this.deduped=new e.ap(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=o}loadTile(i,r){const n=i.uid,a=i&&i.request,o=a&&a.collectResourceTiming,l=this.loading[n]=new s(i);l.abort=this.loadVectorData(i,((s,c)=>{const h=!this.loading[n];if(delete this.loading[n],h||s||!c)return l.status="done",h||(this.loaded[n]=l),r(s);const u=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.dY(new e.dZ(u));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,n)=>{if(i||!n)return r(i);const s={};if(o){const e=t(a);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}r(null,e.Q({rawTileData:u.slice(0)},n,d,s))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(t,i){const r=this.loaded,n=t.uid;if(r&&r[n]){const a=r[n];a.showCollisionBoxes=t.showCollisionBoxes,a.projection=t.projection,a.brightness=t.brightness,a.tileTransform=e.dN(t.tileID.canonical,t.projection),a.extraShadowCaster=t.extraShadowCaster,a.lut=t.lut;const o=(e,t)=>{const r=a.reloadCallback;r&&(delete a.reloadCallback,a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,r)),i(e,t)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}else i(null,void 0)}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class h{loadTile(t,i){const{uid:r,encoding:n,rawImageData:a,padding:o}=t,s=ImageBitmap&&a instanceof ImageBitmap?this.getImageData(a,o):a;i(null,new e.d_(r,s,n,o<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}e.d$.setPbf(e.dZ);class u{decodeRasterArray(t,i){let{task:r,buffer:n}=t;e.d$.performDecoding(n,r).then((e=>{i(null,e)}),(e=>{i(e)}))}}const d=e.e0.prototype.toGeoJSON;let p=class{constructor(t){this._feature=t,this.extent=e.a4,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return d.call(this,e,t,i)}},f=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.a4,this.length=t.length,this._features=t}feature(e){return new p(this._features[e])}};const m=64/4096,g=128;class _{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const i of e){const e=i.id;if(null==e)continue;let r=this.features.get(e);r&&this.updateCache(r,t),i.geometry?(r=x(i),this.updateCache(r,t),this.features.set(e,r)):this.features.delete(e),this.updateCache(r,t)}}updateCache(e,t){for(const{canonical:i,uid:r}of Object.values(t)){const{z:n,x:a,y:o}=i;y(e,Math.pow(2,n),a,o)&&delete t[r]}}getTile(e,t,i){const r=Math.pow(2,e),n=[];for(const a of this.features.values())y(a,r,t,i)&&n.push(S(a,r,t,i));return{features:n}}getFeatures(){return[...this.features.values()]}}function y(e,t,i,r){let{minX:n,minY:a,maxX:o,maxY:s}=e;return n<(i+1+m)/t&&a<(r+1+m)/t&&o>(i-m)/t&&s>(r-m)/t}function x(e){const{id:t,geometry:i,properties:r}=e;if(!i)return;if("GeometryCollection"===i.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:n,coordinates:a}=i,o={id:t,type:1,geometry:[],tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},s=o.geometry;if("Point"===n)v(a,s,o);else if("MultiPoint"===n)for(const l of a)v(l,s,o);else if("LineString"===n)o.type=2,b(a,s,o);else if("MultiLineString"===n)o.type=2,w(a,s,o);else if("Polygon"===n)o.type=3,w(a,s,o,!0);else{if("MultiPolygon"!==n)throw new Error("Input data is not a valid GeoJSON object.");o.type=3;for(const e of a)w(e,s,o,!0)}return o}function v(t,i,r){let[n,a]=t;const o=e.ak(n);let s=e.al(a);s=s<0?0:s>1?1:s,i.push(o,s),r.minX=Math.min(r.minX,o),r.minY=Math.min(r.minY,s),r.maxX=Math.max(r.maxX,o),r.maxY=Math.max(r.maxY,s)}function b(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=[];for(const o of e)v(o,a,i);t.push(a),r&&function(e,t){let i=0;for(let r=0,n=e.length,a=n-2;r<n;a=r,r+=2)i+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(i>0===t)for(let r=0,n=e.length;r<n/2;r+=2){const t=e[r],i=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=t,e[n-1-r]=i}}(a,n)}function w(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let n=0;n<e.length;n++)b(e[n],t,i,r,0===n)}function S(t,i,r,n){const{id:a,type:o,geometry:s,tags:l}=t,c=[];if(1===o)!function(t,i,r,n,a){for(let o=0;o<t.length;o+=2){const s=Math.round(e.a4*(t[o+0]*i-r)),l=Math.round(e.a4*(t[o+1]*i-n));a.push([s,l])}}(s,i,r,n,c);else for(const e of s)E(e,i,r,n,c);return{id:a,type:o,geometry:c,tags:l}}function E(t,i,r,n,a){const o=-g,s=e.a4+g;let l;for(let c=0;c<t.length-2;c+=2){let h=Math.round(e.a4*(t[c+0]*i-r)),u=Math.round(e.a4*(t[c+1]*i-n)),d=Math.round(e.a4*(t[c+2]*i-r)),p=Math.round(e.a4*(t[c+3]*i-n));const f=d-h,m=p-u;h<o&&d<o||(h<o?(u+=Math.round(m*((o-h)/f)),h=o):d<o&&(p=u+Math.round(m*((o-h)/f)),d=o),u<o&&p<o||(u<o?(h+=Math.round(f*((o-u)/m)),u=o):p<o&&(d=h+Math.round(f*((o-u)/m)),p=o),h>=s&&d>=s||(h>=s?(u+=Math.round(m*((s-h)/f)),h=s):d>=s&&(p=u+Math.round(m*((s-h)/f)),d=s),u>=s&&p>=s||(u>=s?(h+=Math.round(f*((s-u)/m)),u=s):p>=s&&(d=h+Math.round(f*((s-u)/m)),p=s),l&&h===l[l.length-1][0]&&u===l[l.length-1][1]||(l=[[h,u]],a.push(l)),l.push([d,p])))))}}var T={exports:{}},C=e.e2,k=e.e1.VectorTileFeature,M=A;function A(e,t){this.options=t||{},this.features=e,this.length=e.length}function P(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}A.prototype.feature=function(e){return new P(this.features[e],this.options.extent)},P.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],r=[],n=0;n<i.length;n++)r.push(new C(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},P.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},P.prototype.toGeoJSON=k.prototype.toGeoJSON;var I=e.e3,D=M;function R(e){var t=new I;return function(e,t){for(var i in e.layers)t.writeMessage(3,z,e.layers[i])}(e,t),t.finish()}function z(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,L,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,V,a[i])}function L(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,F,e),t.writeVarintField(3,i.type),t.writeMessage(4,N,i)}function F(e,t){var i=e.feature,r=e.keys,n=e.values,a=e.keycache,o=e.valuecache;for(var s in i.properties){var l=i.properties[s],c=a[s];if(null!==l){void 0===c&&(r.push(s),a[s]=c=r.length-1),t.writeVarint(c);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var u=h+":"+l,d=o[u];void 0===d&&(n.push(l),o[u]=d=n.length-1),t.writeVarint(d)}}}function B(e,t){return(t<<3)+(7&e)}function O(e){return e<<1^e>>31}function N(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,a=0,o=i.length,s=0;s<o;s++){var l=i[s],c=1;1===r&&(c=l.length),t.writeVarint(B(1,c));for(var h=3===r?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==r&&t.writeVarint(B(2,h-1));var d=l[u].x-n,p=l[u].y-a;t.writeVarint(O(d)),t.writeVarint(O(p)),n+=d,a+=p}3===r&&t.writeVarint(B(7,1))}}function V(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}T.exports=R,T.exports.fromVectorTileJs=R,T.exports.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new D(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return R({layers:i})},T.exports.GeoJSONWrapper=D;var j=e.e4(T.exports);const U={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},G=Math.fround||($=new Float32Array(1),e=>($[0]=+e,$[0]));var $;const q=3,H=5,W=6;class Z{constructor(e){this.options=Object.assign(Object.create(U),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:r}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const a=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[i,r]=t.geometry.coordinates,n=G(J(i)),o=G(Q(r));a.push(n,o,1/0,s,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[r+1]=this._createTree(a);t&&console.timeEnd(n);for(let s=r;s>=i;s--){const e=+Date.now();o=this.trees[s]=this._createTree(this._cluster(o,s)),t&&console.log("z%d: %d clusters in %dms",s,o.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,a],t),o=this.getClusters([-180,r,n,a],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],s=o.range(J(i),Q(a),J(n),Q(r)),l=o.data,c=[];for(const h of s){const e=this.stride*h;c.push(l[e+H]>1?X(l,e,this.clusterProps):this.points[l[e+q]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const a=n.data;if(t*this.stride>=a.length)throw new Error(r);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=n.within(a[t*this.stride],a[t*this.stride+1],o),l=[];for(const c of s){const t=c*this.stride;a[t+4]===e&&l.push(a[t+H]>1?X(a,t,this.clusterProps):this.points[a[t+q]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:a,radius:o}=this.options,s=o/a,l=(i-s)/n,c=(i+1+s)/n,h={features:[]};return this._addTileFeatures(r.range((t-s)/n,l,(t+1+s)/n,c),r.data,t,i,n,h),0===t&&this._addTileFeatures(r.range(1-s/n,l,1,c),r.data,n,i,n,h),t===n-1&&this._addTileFeatures(r.range(0,l,s/n,c),r.data,-1,i,n,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const a=this.getChildren(t);for(const o of a){const t=o.properties;if(t&&t.cluster?n+t.point_count<=r?n+=t.point_count:n=this._appendLeaves(e,t.cluster_id,i,r,n):n<r?n++:e.push(o),e.length===i)break}return n}_createTree(t){const i=new e.cN(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,r,n,a){for(const o of e){const e=o*this.stride,s=t[e+H]>1;let l,c,h;if(s)l=Y(t,e,this.clusterProps),c=t[e],h=t[e+1];else{const i=this.points[t[e+q]];l=i.properties;const[r,n]=i.geometry.coordinates;c=J(r),h=Q(n)}const u={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(h*n-r))]],tags:l};let d;d=s||this.options.generateId?t[e+q]:this.points[t[e+q]].id,void 0!==d&&(u.id=d),a.features.push(u)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:r,reduce:n,minPoints:a}=this.options,o=i/(r*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let h=0;h<s.length;h+=c){if(s[h+2]<=t)continue;s[h+2]=t;const i=s[h],r=s[h+1],u=e.within(s[h],s[h+1],o),d=s[h+H];let p=d;for(const e of u){const i=e*c;s[i+2]>t&&(p+=s[i+H])}if(p>d&&p>=a){let e,a=i*d,o=r*d,f=-1;const m=(h/c<<5)+(t+1)+this.points.length;for(const i of u){const r=i*c;if(s[r+2]<=t)continue;s[r+2]=t;const l=s[r+H];a+=s[r]*l,o+=s[r+1]*l,s[r+4]=m,n&&(e||(e=this._map(s,h,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(s,r)))}s[h+4]=m,l.push(a/p,o/p,1/0,m,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(s[h+e]);if(p>1)for(const e of u){const i=e*c;if(!(s[i+2]<=t)){s[i+2]=t;for(let e=0;e<c;e++)l.push(s[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+H]>1){const r=this.clusterProps[e[t+W]];return i?Object.assign({},r):r}const r=this.points[e[t+q]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function X(e,t,i){return{type:"Feature",id:e[t+q],properties:Y(e,t,i),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),K(e[t+1])]}};var r}function Y(e,t,i){const r=e[t+H],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,a=e[t+W],o=-1===a?{}:Object.assign({},i[a]);return Object.assign(o,{cluster:!0,cluster_id:e[t+q],point_count:r,point_count_abbreviated:n})}function J(e){return e/360+.5}function Q(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function K(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function ee(e,t,i,r){let n=r;const a=t+(i-t>>1);let o,s=i-t;const l=e[t],c=e[t+1],h=e[i],u=e[i+1];for(let d=t+3;d<i;d+=3){const t=te(e[d],e[d+1],l,c,h,u);if(t>n)o=d,n=t;else if(t===n){const e=Math.abs(d-a);e<s&&(o=d,s=e)}}n>r&&(o-t>3&&ee(e,t,o,r),e[o+2]=n,i-o>3&&ee(e,o,i,r))}function te(e,t,i,r,n,a){let o=n-i,s=a-r;if(0!==o||0!==s){const l=((e-i)*o+(t-r)*s)/(o*o+s*s);l>1?(i=n,r=a):l>0&&(i+=o*l,r+=s*l)}return o=e-i,s=t-r,o*o+s*s}function ie(e,t,i,r){const n={id:e??null,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)re(n,i);else if("Polygon"===t)re(n,i[0]);else if("MultiLineString"===t)for(const a of i)re(n,a);else if("MultiPolygon"===t)for(const a of i)re(n,a[0]);return n}function re(e,t){for(let i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function ne(e,t,i,r){if(!t.geometry)return;const n=t.geometry.coordinates;if(n&&0===n.length)return;const a=t.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let s=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===a)ae(n,s);else if("MultiPoint"===a)for(const c of n)ae(c,s);else if("LineString"===a)oe(n,s,o,!1);else if("MultiLineString"===a){if(i.lineMetrics){for(const i of n)s=[],oe(i,s,o,!1),e.push(ie(l,"LineString",s,t.properties));return}se(n,s,o,!1)}else if("Polygon"===a)se(n,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(const n of t.geometry.geometries)ne(e,{id:l,geometry:n,properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of n){const t=[];se(e,t,o,!0),s.push(t)}}e.push(ie(l,a,s,t.properties))}function ae(e,t){t.push(le(e[0]),ce(e[1]),0)}function oe(e,t,i,r){let n,a,o=0;for(let l=0;l<e.length;l++){const i=le(e[l][0]),s=ce(e[l][1]);t.push(i,s,0),l>0&&(o+=r?(n*s-i*a)/2:Math.sqrt(Math.pow(i-n,2)+Math.pow(s-a,2))),n=i,a=s}const s=t.length-3;t[2]=1,ee(t,0,s,i),t[s+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function se(e,t,i,r){for(let n=0;n<e.length;n++){const a=[];oe(e[n],a,i,r),t.push(a)}}function le(e){return e/360+.5}function ce(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function he(e,t,i,r,n,a,o,s){if(r/=t,a>=(i/=t)&&o<r)return e;if(o<i||a>=r)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const a=0===n?c.minX:c.minY,o=0===n?c.maxX:c.maxY;if(a>=i&&o<r){l.push(c);continue}if(o<i||a>=r)continue;let h=[];if("Point"===t||"MultiPoint"===t)ue(e,h,i,r,n);else if("LineString"===t)de(e,h,i,r,n,!1,s.lineMetrics);else if("MultiLineString"===t)fe(e,h,i,r,n,!1);else if("Polygon"===t)fe(e,h,i,r,n,!0);else if("MultiPolygon"===t)for(const s of e){const e=[];fe(s,e,i,r,n,!0),e.length&&h.push(e)}if(h.length){if(s.lineMetrics&&"LineString"===t){for(const e of h)l.push(ie(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===h.length?(t="LineString",h=h[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===h.length?"Point":"MultiPoint"),l.push(ie(c.id,t,h,c.tags))}}return l.length?l:null}function ue(e,t,i,r,n){for(let a=0;a<e.length;a+=3){const o=e[a+n];o>=i&&o<=r&&me(t,e[a],e[a+1],e[a+2])}}function de(e,t,i,r,n,a,o){let s=pe(e);const l=0===n?ge:_e;let c,h,u=e.start;for(let g=0;g<e.length-3;g+=3){const d=e[g],p=e[g+1],f=e[g+2],m=e[g+3],_=e[g+4],y=0===n?d:p,x=0===n?m:_;let v=!1;o&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-_,2))),y<i?x>i&&(h=l(s,d,p,m,_,i),o&&(s.start=u+c*h)):y>r?x<r&&(h=l(s,d,p,m,_,r),o&&(s.start=u+c*h)):me(s,d,p,f),x<i&&y>=i&&(h=l(s,d,p,m,_,i),v=!0),x>r&&y<=r&&(h=l(s,d,p,m,_,r),v=!0),!a&&v&&(o&&(s.end=u+c*h),t.push(s),s=pe(e)),o&&(u+=c)}let d=e.length-3;const p=e[d],f=e[d+1],m=0===n?p:f;m>=i&&m<=r&&me(s,p,f,e[d+2]),d=s.length-3,a&&d>=3&&(s[d]!==s[0]||s[d+1]!==s[1])&&me(s,s[0],s[1],s[2]),s.length&&t.push(s)}function pe(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function fe(e,t,i,r,n,a){for(const o of e)de(o,t,i,r,n,a,!1)}function me(e,t,i,r){e.push(t,i,r)}function ge(e,t,i,r,n,a){const o=(a-t)/(r-t);return me(e,a,i+(n-i)*o,1),o}function _e(e,t,i,r,n,a){const o=(a-i)/(n-i);return me(e,t+(r-t)*o,a,1),o}function ye(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],a=n.type;let o;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=xe(n.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(const e of n.geometry)o.push(xe(e,t))}else if("MultiPolygon"===a){o=[];for(const e of n.geometry){const i=[];for(const r of e)i.push(xe(r,t));o.push(i)}}i.push(ie(n.id,a,o,n.tags))}return i}function xe(e,t){const i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(let r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function ve(e,t){if(e.transformed)return e;const i=1<<e.z,r=e.x,n=e.y;for(const a of e.features){const e=a.geometry,o=a.type;if(a.geometry=[],1===o)for(let s=0;s<e.length;s+=2)a.geometry.push(be(e[s],e[s+1],t,i,r,n));else for(let s=0;s<e.length;s++){const o=[];for(let a=0;a<e[s].length;a+=2)o.push(be(e[s][a],e[s][a+1],t,i,r,n));a.geometry.push(o)}}return e.transformed=!0,e}function be(e,t,i,r,n,a){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-a))]}function we(e,t,i,r,n){const a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const s of e)Se(o,s,a,n);return o}function Se(e,t,i,r){const n=t.geometry,a=t.type,o=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===a||"MultiPoint"===a)for(let s=0;s<n.length;s+=3)o.push(n[s],n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)Ee(o,n,e,i,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(let s=0;s<n.length;s++)Ee(o,n[s],e,i,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(let s=0;s<n.length;s++){const t=n[s];for(let r=0;r<t.length;r++)Ee(o,t[r],e,i,!0,0===r)}if(o.length){let i=t.tags||null;if("LineString"===a&&r.lineMetrics){i={};for(const e in t.tags)i[e]=t.tags[e];i.mapbox_clip_start=n.start/n.size,i.mapbox_clip_end=n.end/n.size}const s={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:i};null!==t.id&&(s.id=t.id),e.features.push(s)}}function Ee(e,t,i,r,n,a){const o=r*r;if(r>0&&t.size<(n?o:r))return void(i.numPoints+=t.length/3);const s=[];for(let l=0;l<t.length;l+=3)(0===r||t[l+2]>o)&&(i.numSimplified++,s.push(t[l],t[l+1])),i.numPoints++;n&&function(e,t){let i=0;for(let r=0,n=e.length,a=n-2;r<n;a=r,r+=2)i+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(i>0===t)for(let r=0,n=e.length;r<n/2;r+=2){const t=e[r],i=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=t,e[n-1-r]=i}}(s,a),e.push(s)}const Te={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ce{constructor(e,t){const i=(t=this.options=function(e,t){for(const i in t)e[i]=t[i];return e}(Object.create(Te),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const i=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)ne(i,e.features[r],t,r);else ne(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const i=t.buffer/t.extent;let r=e;const n=he(e,1,-1-i,i,0,-1,2,t),a=he(e,1,1-i,2+i,0,-1,2,t);return(n||a)&&(r=he(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=ye(n,1).concat(r)),a&&(r=r.concat(ye(a,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,i,r,n,a,o){const s=[e,t,i,r],l=this.options,c=l.debug;for(;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();const h=1<<t,u=ke(t,i,r);let d=this.tiles[u];if(!d&&(c>1&&console.time("creation"),d=this.tiles[u]=we(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==n){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===n)continue;if(null!=n){const e=n-t;if(i!==a>>e||r!==o>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let _=null,y=null,x=null,v=null,b=he(e,h,i-p,i+m,0,d.minX,d.maxX,l),w=he(e,h,i+f,i+g,0,d.minX,d.maxX,l);e=null,b&&(_=he(b,h,r-p,r+m,1,d.minY,d.maxY,l),y=he(b,h,r+f,r+g,1,d.minY,d.maxY,l),b=null),w&&(x=he(w,h,r-p,r+m,1,d.minY,d.maxY,l),v=he(w,h,r+f,r+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(_||[],t+1,2*i,2*r),s.push(y||[],t+1,2*i,2*r+1),s.push(x||[],t+1,2*i+1,2*r),s.push(v||[],t+1,2*i+1,2*r+1)}}getTile(e,t,i){e=+e,t=+t,i=+i;const r=this.options,{extent:n,debug:a}=r;if(e<0||e>24)return null;const o=1<<e,s=ke(e,t=t+o&o-1,i);if(this.tiles[s])return ve(this.tiles[s],n);a>1&&console.log("drilling down to z%d-%d-%d",e,t,i);let l,c=e,h=t,u=i;for(;!l&&c>0;)c--,h>>=1,u>>=1,l=this.tiles[ke(c,h,u)];return l&&l.source?(a>1&&(console.log("found parent tile z%d-%d-%d",c,h,u),console.time("drilling down")),this.splitTile(l.source,c,h,u,e,t,i),a>1&&console.timeEnd("drilling down"),this.tiles[s]?ve(this.tiles[s],n):null):null}}function ke(e,t,i){return 32*((1<<e)*i+t)+e}function Me(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);const n=new f(r.features);let a=j(n);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:n,rawData:a.buffer})}class Ae extends c{constructor(e,t,i,r,n,a){super(e,t,i,r,Me,a),n&&(this.loadGeoJSON=n),this._dynamicIndex=new _}loadData(i,r){const n=i&&i.request,a=n&&n.collectResourceTiming;this.loadGeoJSON(i,((o,s)=>{if(o||!s)return r(o);if("object"!=typeof s)return r(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{try{if(i.filter){const t=e.z(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s.features=s.features.filter((e=>t.value.evaluate({zoom:0},e)))}i.dynamic?("Feature"===s.type&&(s={type:"FeatureCollection",features:[s]}),i.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(s.features,this.loaded),i.cluster&&(s.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=i.cluster?new Z(function(t){let{superclusterOptions:i,clusterProperties:r}=t;if(!r||!i)return i;const n={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r);for(const c of l){const[t,i]=r[c],o=e.z(i),s=e.z("string"==typeof t?[t,["accumulated"],["get",c]]:t);n[c]=o.value,a[c]=s.value}return i.map=e=>{s.properties=e;const t={};for(const i of l)t[i]=n[i].evaluate(o,s);return t},i.reduce=(e,t)=>{s.properties=t;for(const i of l)o.accumulated=e[i],e[i]=a[i].evaluate(o,s)},i}(i)).load(s.features):i.dynamic?this._dynamicIndex:function(e,t){return new Ce(e,t)}(s,i.geojsonVtOptions)}catch(e){return r(e)}const o={};if(a){const e=t(n);e&&(o.resourceTiming={},o.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)))}r(null,o)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.h(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Pe{constructor(t,i){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=i}parse(t,i,r,n){this.status="parsing";const a=new e.aQ(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),o={},s=i.familiesBySource[r.source],l=new e.dQ(a,r.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.e6(t).then((t=>{if(!t)return n(new Error("Could not parse tile"));const i=e.e7(t,1/e.b7(r.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,h=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.Y(this.zoom,{brightness:this.brightness});for(const r in s)for(const t of s[r]){const r=t[0];l.bucketLayerIDs.push(t.map((e=>e.id))),r.recalculate(u,[]);const n=new e.e8(i,a,c,h,this.brightness,l);c||(n.needsUpload=!0),o[r.fqid]=n,n.evaluate(r)}this.status="done",n(null,{buckets:o,featureIndex:l})})).catch((e=>n(new Error(e.message))))}}class Ie{constructor(e,t,i,r,n,a){this.actor=e,this.layerIndex=t,this.brightness=a,this.loading={},this.loaded={}}loadTile(t,i){const r=t.uid,n=this.loading[r]=new Pe(t,this.brightness);e.e5(t.request,((e,a)=>{const o=!this.loading[r];return delete this.loading[r],o||e?(n.status="done",o||(this.loaded[r]=n),i(e)):a&&0!==a.byteLength?void n.parse(a,this.layerIndex,t,((e,t)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[r]=n,e||!t?i(e):i(null,t)})):(n.status="done",this.loaded[r]=n,i())}))}reloadTile(e,t){const i=this.loaded,r=e.uid;if(i&&i[r]){const n=i[r];n.projection=e.projection,n.brightness=e.brightness;const a=(i,r)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(e,t)),t(i,r)};"parsing"===n.status?n.reloadCallback=a:"done"===n.status&&this.loadTile(e,t)}}abortTile(e,t){const i=e.uid;this.loading[i]&&delete this.loading[i],t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class De{constructor(t){this.self=t,this.actor=new e.e9(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.aK({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:Ae,"batched-model":Ie},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.ea.isParsed())throw new Error("RTL text plugin already registered.");e.ea.applyArabicShaping=t.applyArabicShaping,e.ea.processBidirectionalText=t.processBidirectionalText,e.ea.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){let{scope:r,isLoaded:n}=i;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][r]=n,this.workerSources[t]&&this.workerSources[t][r])for(const a in this.workerSources[t][r]){const i=this.workerSources[t][r][a];for(const t in i){const r=i[t];r instanceof c&&(r.isSpriteLoaded=n,r.fire(new e.g("isSpriteLoaded")))}}}setImages(e,t,i){let{scope:r,images:n}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][r]=n,this.workerSources[e]&&this.workerSources[e][r]){for(const t in this.workerSources[e][r]){const i=this.workerSources[e][r][t];for(const e in i)i[e].availableImages=n}i()}else i()}setProjection(t,i){this.projections[t]=e.aK(i)}setBrightness(e,t,i){this.brightness=t,i()}setLayers(e,t,i){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),i()}updateLayers(e,t,i){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),i()}loadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,i)}loadDEMTile(e,t,i){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,i)}decodeRasterArray(e,t,i){this.getRasterArrayWorkerSource().decodeRasterArray(t,i)}reloadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,i)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,i)}removeSource(e,t,i){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const r=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,r){try{e.ea.setState(i);const t=e.ea.getPluginURL();if(e.ea.isLoaded()&&!e.ea.isParsed()&&null!=t){this.self.importScripts(t);const i=e.ea.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){r(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let i=this.availableImages[e][t];return i||(i=[]),i}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let i=this.layerIndexes[e][t];return i||(i=this.layerIndexes[e][t]=new n,i.scope=t),i}getWorkerSource(e,t,i,r){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),this.workerSources[e][r][t]||(this.workerSources[e][r][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.workerSources[e][r][t][i]||(this.workerSources[e][r][t][i]=new this.workerSourceTypes[t]({send:(t,i,r,n,a,o)=>{this.actor.send(t,i,r,e,a,o)},scheduler:this.actor.scheduler},this.getLayerIndex(e,r),this.getAvailableImages(e,r),this.isSpriteLoaded[e][r],void 0,this.brightness)),this.workerSources[e][r][t][i]}getDEMWorkerSource(e,t,i){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][i]||(this.demWorkerSources[e][i]={}),this.demWorkerSources[e][i][t]||(this.demWorkerSources[e][i][t]=new h),this.demWorkerSources[e][i][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new u),this.rasterArrayWorkerSource}enforceCacheSizeLimit(t,i){e.eb(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new De(self)),De})),r(["./shared"],(function(e){var t=i;function i(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(i.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var r={};function n(e,t,i){const r=document.createElement(e);return null!=t&&(r.className=t),i&&i.appendChild(r),r}function a(e,t,i){const r=document.createElementNS("http://www.w3.org/2000/svg",e);for(const n of Object.keys(t))r.setAttributeNS(null,n,String(t[n]));return i&&i.appendChild(r),r}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const o="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,s=o&&void 0!==o.userSelect?"userSelect":"WebkitUserSelect";let l;function c(){o&&s&&(l=o[s],o[s]="none")}function h(){o&&s&&(o[s]=l)}function u(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",u,!0)}function d(){window.addEventListener("click",u,!0),window.setTimeout((()=>{window.removeEventListener("click",u,!0)}),0)}function p(e,t){const i=e.getBoundingClientRect();return g(e,i,t)}function f(e,t){const i=e.getBoundingClientRect(),r=[];for(let n=0;n<t.length;n++)r.push(g(e,i,t[n]));return r}function m(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function g(t,i,r){const n=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.P((r.clientX-i.left)*n,(r.clientY-i.top)*n)}class _{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const y={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class x{constructor(e,t,i,r,n,a){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=a,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],a=t.attributes[n.name];void 0!==a&&e.vertexAttribPointer(a,n.components,e[y[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=t.attributes[this.attributes[r].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(n,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class v{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class b extends v{getDefault(){return e.C.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class w extends v{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class S extends v{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class E extends v{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class T extends v{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class C extends v{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class k extends v{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class M extends v{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class A extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class P extends v{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class I extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class D extends v{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class R extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class z extends v{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class L extends v{getDefault(){return e.C.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class F extends v{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class B extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class O extends v{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class N extends v{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let V=class extends v{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class j extends v{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class U extends v{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class G extends v{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class $ extends v{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class q extends v{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class H extends v{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class W extends v{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Z extends v{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class X extends v{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Y extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class J extends v{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Q extends v{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class K extends Q{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ee extends Q{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class te extends Q{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ie extends ee{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class re{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;const a=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new K(e,a)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new ee(e,a):new te(e,a))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class ne{constructor(e,t){this.gl=e,this.clearColor=new b(this),this.clearDepth=new w(this),this.clearStencil=new S(this),this.colorMask=new E(this),this.depthMask=new T(this),this.stencilMask=new C(this),this.stencilFunc=new k(this),this.stencilOp=new M(this),this.stencilTest=new A(this),this.depthRange=new P(this),this.depthTest=new I(this),this.depthFunc=new D(this),this.blend=new R(this),this.blendFunc=new z(this),this.blendColor=new L(this),this.blendEquation=new F(this),this.cullFace=new B(this),this.cullFaceSide=new O(this),this.frontFace=new N(this),this.program=new V(this),this.activeTexture=new j(this),this.viewport=new U(this),this.bindFramebuffer=new G(this),this.bindRenderbuffer=new $(this),this.bindTexture=new q(this),this.bindVertexBuffer=new H(this),this.bindElementBuffer=new W(this),this.bindVertexArrayOES=new Z(this),this.pixelStoreUnpack=new X(this),this.pixelStoreUnpackPremultiplyAlpha=new Y(this),this.pixelStoreUnpackFlipY=new J(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,r){return new e.I(this,t,i,r)}createVertexBuffer(e,t,i,r,n){return new x(this,e,t,i,r,n)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new re(this,e,t,i,r)}clear(e){let{color:t,depth:i,stencil:r,colorMask:n}=e;const a=this.gl;let o=0;t&&(o|=a.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==i&&(o|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),void 0!==r&&(o|=a.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),a.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.d(t.blendFunction,e.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ae{constructor(t,i,r,n){const a={width:r[0],height:r[1],data:null},o=t.gl;this.targetColorTexture=new e.T(t,a,o.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,a,o.RGBA,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,n),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const r=this.context.gl,n=i.width*i.height;this.particleTexture0=new e.T(this.context,i,r.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,i,r.RGBA,{premultiply:!1,useMipmap:!1});const a=new e.S;a.reserve(n);for(let e=0;e<n;e++)a.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(a,e.p.members,!0),this.particleSegment=e.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class oe extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return e.l(this.requestManager.transformRequest(i,e.R.Model).url).then((i=>{if(!i)return;const r=e.c(i),n=new e.M(t,void 0,void 0,r);return n.computeBoundsAndApplyParent(),n})).catch((r=>{if(r&&404===r.status)return null;this.fire(new e.f(new Error(`Could not load model ${t} from ${i}: ${r.message}`)))}))}load(t,i){this.models[i]||(this.models[i]={});const r=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const n=[];for(const e of r)n.push(this.loadModel(e,t[e]));Promise.allSettled(n).then((t=>{for(let e=0;e<t.length;e++){const{status:n,value:a}=t[e];"fulfilled"===n&&a&&(this.models[i][r[e]]={model:a,numReferences:1})}this.numModelsLoading[i]-=r.length,this.fire(new e.g("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.f(new Error(`Could not load models: ${t.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.models[i][e].numReferences++,this.load({[e]:this.requestManager.normalizeModelURL(t)},i)}addModels(e,t){this.models[t]||(this.models[t]={});const i={};for(const r in e)this.models[t][r]={},i[r]=this.requestManager.normalizeModelURL(e[r]);this.load(i,t)}addModelsFromBucket(e,t){this.models[t]||(this.models[t]={});const i={};for(const r of e)this.hasModel(r,t)?this.models[t][r].numReferences++:i[r]=this.requestManager.normalizeModelURL(r);this.load(i,t)}removeModel(e,t){if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences)){const i=this.models[t][e].model;delete this.models[t][e],i.destroy()}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].model&&this.models[t][i].model.upload(e.context)}}function se(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class le extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.j({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,i){this._validate(e,i)&&(this.images[t][e]=i)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.f(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.f(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.f(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,i){i.version=this.images[t][e].version+1,this.images[t][e]=i,this.updatedImages[t][e]=!0}removeImage(e,t){const i=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,i){let r=!0;const n=!!this.loaded[t];if(!n)for(const a of e)this.images[t][a]||(r=!1);n||r?this._notify(e,t,i):this.requestors.push({ids:e,scope:t,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,i,r){const n={};for(const a of t){this.images[i][a]||this.fire(new e.g("styleimagemissing",{id:a}));const t=this.images[i][a];t?n[a]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(e){const{width:t,height:i}=this.atlasImage[e];return{width:t,height:i}}getPattern(t,i,r){const n=this.patterns[i][t],a=this.getImage(t,i);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const r={w:a.data.width+2,h:a.data.height+2,x:0,y:0},n=new e.m(r,a);this.patterns[i][t]={bin:r,position:n}}return this._updatePatternAtlas(i,r),this.patterns[i][t].position}bind(t,i){const r=t.gl;let n=this.atlasTexture[i];n?this.dirty&&(n.update(this.atlasImage[i]),this.dirty=!1):(n=new e.T(t,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){const r=[];for(const e in this.patterns[t])r.push(this.patterns[t][e].bin);const{w:n,h:a}=e.k(r),o=this.atlasImage[t];o.resize({width:n||1,height:a||1});for(const s in this.patterns[t]){const{bin:r}=this.patterns[t][s],n=r.x+1,a=r.y+1,l=this.images[t][s].data,c=l.width,h=l.height;e.j.copy(l,o,{x:0,y:0},{x:n,y:a},{width:c,height:h},i),e.j.copy(l,o,{x:0,y:h-1},{x:n,y:a-1},{width:c,height:1},i),e.j.copy(l,o,{x:0,y:0},{x:n,y:a+h},{width:c,height:1},i),e.j.copy(l,o,{x:c-1,y:0},{x:n-1,y:a},{width:1,height:h},i),e.j.copy(l,o,{x:0,y:0},{x:n+c,y:a},{width:1,height:h},i)}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const i of e){if(this.callbackDispatchedThisFrame[t][i])continue;this.callbackDispatchedThisFrame[t][i]=!0;const e=this.images[t][i];se(e)&&this.updateImage(i,t,e)}}}function ce(t){const i=t.key,r=t.value,n=t.valueSpec||{},a=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let l=[];const c=e.o(r);if("object"!==c)return[new e.V(i,r,`object expected, ${c} found`)];for(const h in r){const t=h.split(".")[0];let c;a[t]?c=a[t]:n[t]?c=Ie:a["*"]?c=a["*"]:n["*"]&&(c=Ie),c?l=l.concat(c({key:(i?`${i}.`:i)+h,value:r[h],valueSpec:n[t]||n["*"],style:o,styleSpec:s,object:r,objectKey:h},r)):l.push(new e.n(i,r[h],`unknown property "${h}"`))}for(const h in n)a[h]||n[h].required&&void 0===n[h].default&&void 0===r[h]&&l.push(new e.V(i,r,`missing required property "${h}"`));return l}function he(t){const i=t.value,r=t.valueSpec,n=t.style,a=t.styleSpec,o=t.key,s=t.arrayElementValidator||Ie;if("array"!==e.o(i))return[new e.V(o,i,`array expected, ${e.o(i)} found`)];if(r.length&&i.length!==r.length)return[new e.V(o,i,`array length ${r.length} expected, length ${i.length} found`)];if(r["min-length"]&&i.length<r["min-length"])return[new e.V(o,i,`array length at least ${r["min-length"]} expected, length ${i.length} found`)];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};a.$version<7&&(l.function=r.function),"object"===e.o(r.value)&&(l=r.value);let c=[];for(let e=0;e<i.length;e++)c=c.concat(s({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:n,styleSpec:a,key:`${o}[${e}]`},!0));return c}function ue(t){const i=t.key,r=t.value,n=t.valueSpec;let a=e.o(r);if("number"===a&&r!=r&&(a="NaN"),"number"!==a)return[new e.V(i,r,`number expected, ${a} found`)];if("minimum"in n){let a=n.minimum;if("array"===e.o(n.minimum)&&(a=n.minimum[t.arrayIndex]),r<a)return[new e.V(i,r,`${r} is less than the minimum value ${a}`)]}if("maximum"in n){let a=n.maximum;if("array"===e.o(n.maximum)&&(a=n.maximum[t.arrayIndex]),r>a)return[new e.V(i,r,`${r} is greater than the maximum value ${a}`)]}return[]}function de(t){const i=t.valueSpec,r=e.u(t.value.type);let n,a,o,s={};const l="categorical"!==r&&void 0===t.value.property,c=!l,h="array"===e.o(t.value.stops)&&"array"===e.o(t.value.stops[0])&&"object"===e.o(t.value.stops[0][0]),u=ce({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===r)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let i=[];const n=t.value;return i=i.concat(he({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.o(n)&&0===n.length&&i.push(new e.V(t.key,n,"array must have at least one stop")),i},default:function(e){return Ie({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&l&&u.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||u.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!e.s(t.valueSpec)&&u.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.r(t.valueSpec)?u.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.t(t.valueSpec)&&u.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!h||void 0!==t.value.property||u.push(new e.V(t.key,t.value,'"property" property is required')),u;function d(t){let r=[];const n=t.value,l=t.key;if("array"!==e.o(n))return[new e.V(l,n,`array expected, ${e.o(n)} found`)];if(2!==n.length)return[new e.V(l,n,`array length 2 expected, length ${n.length} found`)];if(h){if("object"!==e.o(n[0]))return[new e.V(l,n,`object expected, ${e.o(n[0])} found`)];if(void 0===n[0].zoom)return[new e.V(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new e.V(l,n,"object stop key must have value")];const i=e.u(n[0].zoom);if("number"!=typeof i)return[new e.V(l,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>i)return[new e.V(l,n[0].zoom,"stop zoom values must appear in ascending order")];i!==o&&(o=i,a=void 0,s={}),r=r.concat(ce({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ue,value:p}}))}else r=r.concat(p({key:`${l}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.v(e.x(n[1]))?r.concat([new e.V(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(Ie({key:`${l}[1]`,value:n[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const l=e.o(t.value),c=e.u(t.value),h=null!==t.value?t.value:o;if(n){if(l!==n)return[new e.V(t.key,h,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,h,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==r){let n=`number expected, ${l} found`;return e.r(i)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,h,n)]}return"categorical"!==r||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==r&&"number"===l&&"number"==typeof c&&"number"==typeof a&&void 0!==a&&c<a?[new e.V(t.key,h,"stop domain values must appear in ascending order")]:(a=c,"categorical"===r&&c in s?[new e.V(t.key,h,"stop domain values must be unique")]:(s[c]=!0,[])):[new e.V(t.key,h,`integer expected, found ${String(c)}`)]}}function pe(t){const i=("property"===t.expressionContext?e.y:e.z)(e.x(t.value),t.valueSpec);if("error"===i.result)return i.value.map((i=>new e.V(`${t.key}${i.key}`,t.value,i.message)));const r=i.value.expression||i.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new e.V(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.A(r))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return fe(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.B(r,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.D(r))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fe(t,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const e of i.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return t instanceof e.F&&r.has(t.name)?[new e.V(i.key,i.value,`["${t.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(t.eachChild((e=>{n.push(...fe(e,i))})),n)}function me(t){const i=t.key,r=t.value,n=t.valueSpec,a=[];return Array.isArray(n.values)?-1===n.values.indexOf(e.u(r))&&a.push(new e.V(i,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(e.u(r))&&a.push(new e.V(i,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function ge(t){return e.H(e.x(t.value))?pe(e.q({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):_e(t)}function _e(t){const i=t.value,r=t.key;if("array"!==e.o(i))return[new e.V(r,i,`array expected, ${e.o(i)} found`)];const n=t.styleSpec;let a,o=[];if(i.length<1)return[new e.V(r,i,"filter array must have at least 1 element")];switch(o=o.concat(me({key:`${r}[0]`,value:i[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===e.u(i[1])&&o.push(new e.V(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new e.V(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(a=e.o(i[1]),"string"!==a&&o.push(new e.V(`${r}[1]`,i[1],`string expected, ${a} found`)));for(let s=2;s<i.length;s++)a=e.o(i[s]),"$type"===e.u(i[1])?o=o.concat(me({key:`${r}[${s}]`,value:i[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&o.push(new e.V(`${r}[${s}]`,i[s],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)o=o.concat(_e({key:`${r}[${e}]`,value:i[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=e.o(i[1]),2!==i.length?o.push(new e.V(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==a&&o.push(new e.V(`${r}[1]`,i[1],`string expected, ${a} found`))}return o}function ye(t,i){const r=t.key,n=t.style,a=t.layer,o=t.styleSpec,s=t.value,l=t.objectKey,c=o[`${i}_${t.layerType}`];if(!c)return[];const h=l.match(/^(.*)-transition$/);if("paint"===i&&h&&c[h[1]]&&c[h[1]].transition)return Ie({key:r,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=t.valueSpec||c[l];if(!u)return[new e.n(r,s,`unknown property "${l}"`)];let d;if("string"===e.o(s)&&e.r(u)&&!u.tokens&&(d=/^{([^}]+)}$/.exec(s))){const t=`\`{ "type": "identity", "property": ${d?JSON.stringify(d[1]):'"_"'} }\``;return[new e.V(r,s,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!n||n.glyphs||n.imports||p.push(new e.V(r,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.J(e.x(s))&&"identity"===e.u(s.type)&&p.push(new e.V(r,s,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===i&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&e.r(u)&&(e.K(u)||e.t(u))){const t=e.y(e.x(s),u),i=t.value.expression||t.value._styleExpression.expression;i&&!e.B(i,["measure-light"])&&("model-emissive-strength"===l&&e.D(i)&&e.A(i)||p.push(new e.V(r,s,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return p.concat(Ie({key:t.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:i,propertyKey:l}))}function xe(e){return ye(e,"paint")}function ve(e){return ye(e,"layout")}function be(t){let i=[];const r=t.value,n=t.key,a=t.style,o=t.styleSpec;r.type||r.ref||i.push(new e.V(n,r,'either "type" or "ref" is required'));let s=e.u(r.type);const l=e.u(r.ref);if(r.id){const o=e.u(r.id);for(let s=0;s<t.arrayIndex;s++){const t=a.layers[s];e.u(t.id)===o&&i.push(new e.V(n,r.id,`duplicate layer id "${r.id}", previously used at line ${t.id.__line__}`))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in r&&i.push(new e.V(n,r[t],`"${t}" is prohibited for ref layers`))})),a.layers.forEach((i=>{e.u(i.id)===l&&(t=i)})),t?t.ref?i.push(new e.V(n,r.ref,"ref cannot reference another ref layer")):s=e.u(t.type):"string"==typeof l&&i.push(new e.V(n,r.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(r.source){const t=a.sources&&a.sources[r.source],o=t&&e.u(t.type);t?"vector"===o&&"raster"===s?i.push(new e.V(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===o&&"raster"!==s?i.push(new e.V(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==o||r["source-layer"]?"raster-dem"===o&&"hillshade"!==s?i.push(new e.V(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==o||["raster","raster-particle"].includes(s)?"line"!==s||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics?"raster-particle"===s&&"raster-array"!==o&&i.push(new e.V(n,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):i.push(new e.V(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new e.V(n,r.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new e.V(n,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new e.V(n,r.source,`source "${r.source}" not found`))}else i.push(new e.V(n,r,'missing required property "source"'));return i=i.concat(ce({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ie({key:`${n}.type`,value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:t=>ge(e.q({layerType:s},t)),layout:t=>ce({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ve(e.q({layerType:s},t))}}),paint:t=>ce({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>xe(e.q({layerType:s,layer:r},t))}})}})),i}function we(t){const i=t.value,r=t.key,n=e.o(i);return"string"!==n?[new e.V(r,i,`string expected, ${n} found`)]:[]}const Se={promoteId:function(t){let{key:i,value:r}=t;if("string"===e.o(r))return we({key:i,value:r});{const e=[];for(const t in r)e.push(...we({key:`${i}.${t}`,value:r[t]}));return e}}};function Ee(t){const i=t.value,r=t.key,n=t.styleSpec,a=t.style;if(!i.type)return[new e.V(r,i,'"type" is required')];const o=e.u(i.type);let s=[];switch(["vector","raster","raster-dem","raster-array"].includes(o)&&(i.url||i.tiles||s.push(new e.n(r,i,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(ce({key:r,value:i,valueSpec:n[`source_${o.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Se})),s;case"geojson":if(s=ce({key:r,value:i,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:Se}),i.cluster)for(const e in i.clusterProperties){const[t,n]=i.clusterProperties[e],a="string"==typeof t?[t,["accumulated"],["get",e]]:t;s.push(...pe({key:`${r}.${e}.map`,value:n,expressionContext:"cluster-map"})),s.push(...pe({key:`${r}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return ce({key:r,value:i,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return ce({key:r,value:i,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new e.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return me({key:`${r}.type`,value:i.type,valueSpec:{values:Te(n)},style:a,styleSpec:n})}}function Te(e){return e.source.reduce(((t,i)=>{const r=e[i];return"enum"===r.type.type&&(t=t.concat(Object.keys(r.type.values))),t}),[])}function Ce(t){const i=t.value,r=t.styleSpec,n=r.light,a=t.style;let o=[];const s=e.o(i);if(void 0===i)return o;if("object"!==s)return o=o.concat([new e.V("light",i,`object expected, ${s} found`)]),o;for(const l in i){const t=l.match(/^(.*)-transition$/);o=o.concat(t&&n[t[1]]&&n[t[1]].transition?Ie({key:l,value:i[l],valueSpec:r.transition,style:a,styleSpec:r}):n[l]?Ie({key:l,value:i[l],valueSpec:n[l],style:a,styleSpec:r}):[new e.V(l,i[l],`unknown property "${l}"`)])}return o}function ke(t){const i=t.value;let r=[];if(!i)return r;const n=e.o(i);if("object"!==n)return r=r.concat([new e.V("light-3d",i,`object expected, ${n} found`)]),r;const a=t.styleSpec,o=a["light-3d"],s=t.key,l=t.style,c=t.style.lights;for(const d of["type","id"])if(!(d in i))return r=r.concat([new e.V("light-3d",i,`missing property ${d} on light`)]),r;if(i.type&&c)for(let d=0;d<t.arrayIndex;d++){const t=e.u(i.type),n=c[d];e.u(n.type)===t&&r.push(new e.V(s,i.id,`duplicate light type "${i.type}", previously defined at line ${n.id.__line__}`))}const h=`properties_light_${i.type}`;if(!(h in a))return r=r.concat([new e.V("light-3d",i,`Invalid light type ${i.type}`)]),r;const u=a[h];for(const d in i)if("properties"===d){const n=i[d],o=e.o(n);if("object"!==o)return r=r.concat([new e.V("properties",n,`object expected, ${o} found`)]),r;for(const i in n)r=r.concat(u[i]?Ie({key:i,value:n[i],valueSpec:u[i],style:l,styleSpec:a}):[new e.n(t.key,n[i],`unknown property "${i}"`)])}else{const t=d.match(/^(.*)-transition$/);r=r.concat(t&&o[t[1]]&&o[t[1]].transition?Ie({key:d,value:i[d],valueSpec:a.transition,style:l,styleSpec:a}):o[d]?Ie({key:d,value:i[d],valueSpec:o[d],style:l,styleSpec:a}):[new e.n(d,i[d],`unknown property "${d}"`)])}return r}function Me(t){const i=t.value,r=t.key,n=t.style,a=t.styleSpec,o=a.terrain;let s=[];const l=e.o(i);if(void 0===i)return s;if("null"===l)return s;if("object"!==l)return s=s.concat([new e.V("terrain",i,`object expected, ${l} found`)]),s;for(const c in i){const t=c.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?Ie({key:c,value:i[c],valueSpec:a.transition,style:n,styleSpec:a}):o[c]?Ie({key:c,value:i[c],valueSpec:o[c],style:n,styleSpec:a}):[new e.n(c,i[c],`unknown property "${c}"`)])}if(i.source){const t=n.sources&&n.sources[i.source],a=t&&e.u(t.type);t?"raster-dem"!==a&&s.push(new e.V(r,i.source,`terrain cannot be used with a source of type ${String(a)}, it only be used with a "raster-dem" source type`)):s.push(new e.V(r,i.source,`source "${i.source}" not found`))}else s.push(new e.V(r,i,'terrain is missing required property "source"'));return s}function Ae(t){const i=t.value,r=t.style,n=t.styleSpec,a=n.fog;let o=[];const s=e.o(i);if(void 0===i)return o;if("object"!==s)return o=o.concat([new e.V("fog",i,`object expected, ${s} found`)]),o;for(const l in i){const t=l.match(/^(.*)-transition$/);o=o.concat(t&&a[t[1]]&&a[t[1]].transition?Ie({key:l,value:i[l],valueSpec:n.transition,style:r,styleSpec:n}):a[l]?Ie({key:l,value:i[l],valueSpec:a[l],style:r,styleSpec:n}):[new e.n(l,i[l],`unknown property "${l}"`)])}return o}const Pe={"*":()=>[],array:he,boolean:function(t){const i=t.value,r=t.key,n=e.o(i);return"boolean"!==n?[new e.V(r,i,`boolean expected, ${n} found`)]:[]},number:ue,color:function(t){const i=t.key,r=t.value,n=e.o(r);return"string"!==n?[new e.V(i,r,`color expected, ${n} found`)]:null===e.G(r)?[new e.V(i,r,`color expected, "${r}" found`)]:[]},enum:me,filter:ge,function:de,layer:be,object:ce,source:Ee,model:e.L,light:Ce,"light-3d":ke,terrain:Me,fog:Ae,string:we,formatted:function(e){return 0===we(e).length?[]:pe(e)},resolvedImage:function(e){return 0===we(e).length?[]:pe(e)},projection:function(t){const i=t.value,r=t.styleSpec,n=r.projection,a=t.style;let o=[];const s=e.o(i);if("object"===s)for(const e in i)o=o.concat(Ie({key:e,value:i[e],valueSpec:n[e],style:a,styleSpec:r}));else"string"!==s&&(o=o.concat([new e.V("projection",i,`object or string expected, ${s} found`)]));return o},import:function(t){const{value:i,styleSpec:r}=t,{data:n,...a}=i;Object.defineProperty(a,"__line__",{value:i.__line__,enumerable:!1});let o=ce(e.q({},t,{value:a,valueSpec:r.import}));return""===e.u(a.id)&&o.push(new e.V(`${t.key}.id`,a,"import id can't be an empty string")),n&&(o=o.concat(Re(n,r,{key:`${t.key}.data`}))),o}};function Ie(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t.value,n=t.valueSpec,a=t.styleSpec;if(n.expression&&e.J(e.u(r)))return de(t);if(n.expression&&e.v(e.x(r)))return pe(t);if(n.type&&Pe[n.type]){const r=Pe[n.type](t);return!0===i&&r.length>0&&"array"===e.o(t.value)?pe(t):r}return ce(e.q({},t,{valueSpec:n.type?a[n.type]:n}))}function De(t){const i=t.value,r=t.key,n=we(t);return n.length||(-1===i.indexOf("{fontstack}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{range}" token'))),n}function Re(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.N;return Ie({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:i.$root,styleSpec:i,style:t,objectElementValidators:{glyphs:De,"*":()=>[]}})}function ze(t){return qe(Re(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.N))}const Le=e=>qe(Ee(e)),Fe=e=>qe(Ce(e)),Be=e=>qe(ke(e)),Oe=e=>qe(Me(e)),Ne=e=>qe(Ae(e)),Ve=e=>qe(be(e)),je=e=>qe(ge(e)),Ue=e=>qe(xe(e)),Ge=e=>qe(ve(e)),$e=t=>qe(e.L(t));function qe(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function He(t,i){let r=!1;if(i&&i.length)for(const n of i)n instanceof e.n?e.w(n.message):(t.fire(new e.f(new Error(n.message))),r=!0);return r}let We;class Ze extends e.E{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.O(We||(We=new e.U({anchor:new e.W(e.N.light.anchor),position:new e.X(e.N.light.position),color:new e.W(e.N.light.color),intensity:new e.W(e.N.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(Fe,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&He(this,t.call(ze,e.Q({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.N})))}}const Xe=new e.U({source:new e.W(e.N.terrain.source),exaggeration:new e.W(e.N.terrain.exaggeration)});let Ye=class extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._transitionable=new e.O(Xe,r,n),this._transitionable.setTransitionOrValue(t,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.Y(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.Z}};const Je=45,Qe=65,Ke=.05;function et(t,i,r,n){const a=e.a0(Je,Qe,r),[o,s]=tt(t,n);let l=1-Math.min(1,Math.exp((i-o)/(s-o)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*a*t.alpha}function tt(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function it(t,i,r,n,a){const o=e.$.transformMat4([],[i,r,n],a.mercatorFogMatrix);return et(t,e.$.length(o),a.pitch,a._fov)}function rt(t,i,r,n,a,o,s){const l=[[r,n,0],[a,n,0],[a,o,0],[r,o,0]];let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(const u of l){const t=e.$.transformMat4([],u,i),r=e.$.length(t);c=Math.min(c,r),h=Math.max(h,r)}return[et(t,c,s.pitch,s._fov),et(t,h,s.pitch,s._fov)]}const nt=new e.U({range:new e.W(e.N.fog.range),color:new e.W(e.N.fog.color),"high-color":new e.W(e.N.fog["high-color"]),"space-color":new e.W(e.N.fog["space-color"]),"horizon-blend":new e.W(e.N.fog["horizon-blend"]),"star-intensity":new e.W(e.N.fog["star-intensity"]),"vertical-range":new e.W(e.N.fog["vertical-range"])});class at extends e.E{constructor(t,i,r,n){super(),this._transitionable=new e.O(nt,r,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new e.a1(nt),this.scope=r}get state(){const t=this._transform,i="globe"===t.projection.name,r=e.a2(t.zoom),n=this.properties.get("range"),a=[.5,3];return{range:i?[e.a3(a[0],n[0],r),e.a3(a[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ne,t,r))return;const n=e.Q({},t);for(const a of Object.keys(e.N.fog))void 0===n[a]&&(n[a]=e.N.fog[a].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.a0(Je,Qe,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,r){const n=e._.fromLngLat(i),a=r.elevation?r.elevation.getAtPointOrZero(n):0;return it(t,n.x,n.y,a,r)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return rt(this.state,i,0,0,e.a4,e.a4,this._transform)}getOpacityForBounds(e,t,i,r,n){return this._transform.projection.supportsFog?rt(this.state,e,t,i,r,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?tt(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const i=t.points[r];let n;if(i[2]>=0)n=i;else{const a=t.points[r-4];n=e.a5(a,i,a[2]/(a[2]-i[2]))}if(it(this.state,n[0],n[1],0,this._transform)>=Ke)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&He(this,t.call(ze,e.Q({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.N})))}}class ot extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._options=t,this.properties=new e.a1(i),this._transitionable=new e.O(i,r,new Map(n)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let st,lt;var ct="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",ht="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",ut="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",dt="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",pt="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",ft="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",mt="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",gt="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",_t="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",yt="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",xt="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const vt=[];Ct(ct,vt),Ct(ut,vt),Ct(ht,vt);const bt={"_prelude_fog.vertex.glsl":ft,"_prelude_terrain.vertex.glsl":pt,"_prelude_shadow.vertex.glsl":yt,"_prelude_fog.fragment.glsl":mt,"_prelude_shadow.fragment.glsl":xt,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":gt,"_prelude_raster_particle.glsl":_t},wt={};kt("",pt),kt(mt,ft),kt(xt,yt),kt(gt,""),kt(_t,"");const St=kt(ht,ut),Et=ct;var Tt={background:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:kt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kt('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:kt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:kt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:kt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:kt('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:kt("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:kt("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:kt("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:kt("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:kt('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:kt('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:kt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:kt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:kt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:kt('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',dt),skyboxGradient:kt('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',dt),skyboxCapture:kt("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:kt('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:kt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:kt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:kt("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:kt("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Ct(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let r of i)if(r=r.trim(),"#"===r[0]&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=r.split(" ");for(const i of e)t.includes(i)||t.push(i)}}function kt(e,t){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((e=>{const t=e.split(" ");return t[t.length-1]})),n=[...new Set(n)]);const a={},o=[],s=[];if(e=e.replace(i,((e,t)=>(s.push(t),""))),(t=t.replace(i,((e,t)=>(o.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...vt];Ct(e,l),Ct(t,l);for(const c of[...o,...s])bt[c]||console.error(`Undefined include: ${c}`),wt[c]||(wt[c]=[],Ct(bt[c],wt[c])),l=[...l,...wt[c]];return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(a[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const o="float"===r?"vec2":r,s=n.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${i} ${r} a_${n};\n#endif\n`:a[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===t?"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} a_${n};\n    out ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"define-instanced"===t?"mat4"===s?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${i} ${r} ${n} = a_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:o,fragmentIncludes:s}}class Mt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,r,n,a,o,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let h=0;!l&&h<r.length;h++)this.boundPaintVertexBuffers[h]!==r[h]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==o.length;for(let h=0;!c&&h<o.length;h++)this.boundDynamicVertexBuffers[h]!==o[h]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==a)this.freshBind(t,i,r,n,a,o,s);else{e.bindVertexArrayOES.set(this.vao);for(const i of o)i&&(i.bind(),s&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,s));n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,i,r,n,a,o){const s=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=a,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const h of i)h.enableAttributes(c,e),h.bind(),h.setVertexAttribPointers(c,e,n);for(const h of a)h&&(h.enableAttributes(c,e),h.bind(),h.setVertexAttribPointers(c,e,n),o&&h.instanceCount&&h.setVertexAttribDivisor(c,e,o));r&&r.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function At(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e._(0,n/r).toLngLat().lat,new e._(0,(n+1)/r).toLngLat().lat]}function Pt(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=r.hillshadeFBO;if(!h)return;t.prepareDrawTile();const u=t.isTileAffectedByFog(i),d=t.getOrCreateProgram("hillshade",{overrideFog:u});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get());const p=((t,i,r,n)=>{const a=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),s=r.paint.get("hillshade-accent-color"),l=r.paint.get("hillshade-emissive-strength");let c=e.ac(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const i=t.style.directionalLight.properties.get("direction"),r=e.ad(i.x,i.y,i.z);c=e.ac(r[1])}const h=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:At(0,i.tileID),u_light:[r.paint.get("hillshade-exaggeration"),c],u_shadow:a.toRenderColor(r.lut),u_highlight:o.toRenderColor(r.lut),u_emissive_strength:l,u_accent:s.toRenderColor(r.lut)}})(t,r,n,t.terrain?i.projMatrix:null);t.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(r);d.draw(t,c.TRIANGLES,a,o,s,e.ag.disabled,p,n.id,f,m,g)}function It(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,a=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const o=r.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new e.T(n,o,a.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Dt(t,i,r){const n=t.context,a=n.gl;if(!i.dem)return;const o=i.dem;if(n.activeTexture.set(a.TEXTURE1),It(t,i,o),!i.demTexture)return;i.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const s=o.dim;n.activeTexture.set(a.TEXTURE0);let l=i.hillshadeFBO;if(!l){const t=new e.T(n,{width:s,height:s,data:null},a.RGBA);t.bind(a.LINEAR,a.CLAMP_TO_EDGE),l=i.hillshadeFBO=n.createFramebuffer(s,s,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:h,tileBoundsSegments:u}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,a.TRIANGLES,e.af.disabled,e.ah.disabled,e.a.unblended,e.ag.disabled,((t,i)=>{const r=i.stride,n=e.ae.create();return e.ae.ortho(n,0,e.a4,-e.a4,0,0,1),e.ae.translate(n,n,[0,-e.a4,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ}})(i.tileID,o),r.id,c,h,u),i.needsHillshadePrepare=!1}function Rt(t,i,r,n,a){const o=function(r,n){if(r)return a(r);if(n){if(t.url&&n.tiles&&t.tiles&&delete t.tiles,n.variants){if(!Array.isArray(n.variants))return a(new Error("variants must be an array"));for(const t of n.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return a(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return a(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){n=e.Q(n,t);break}}}const r=e.ai(e.Q(n,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),n.raster_layers&&(r.rasterLayers=n.raster_layers,r.rasterLayerIds=r.rasterLayers.map((e=>e.id))),r.tiles=i.canonicalizeTileset(r,t.url),a(null,r)}},s=function(e,t,i){if(!e)return null;if(!t&&!i)return e;i=i||e.worldview_default;const r=Object.values(e.language||{});if(0===r.length)return null;const n=Object.values(e.worldview||{});if(0===n.length)return null;const a=r.every((e=>e===t)),o=n.every((e=>e===i));return a&&o?e:t in(e.language_options||{})||i in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,r,n);return s?e.e.frame((()=>o(null,s))):t.url?e.h(i.transformRequest(i.normalizeSourceURL(t.url,null,r,n),e.R.Source),o):e.e.frame((()=>{const{data:e,...i}=t;o(null,i)}))}class zt{constructor(t,i,r){this.bounds=e.aj.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.ak(this.bounds.getWest())*i),n=Math.floor(e.al(this.bounds.getNorth())*i),a=Math.ceil(e.ak(this.bounds.getEast())*i),o=Math.ceil(e.al(this.bounds.getSouth())*i);return t.x>=r&&t.x<a&&t.y>=n&&t.y<o}}class Lt extends e.E{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.Q({type:"raster"},i),e.Q(this,e.ai(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.g("dataloading",{dataType:"source"})),this._tileJSONRequest=Rt(this._options,this.map._requestManager,null,null,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.f(i)):r&&(e.Q(this,r),r.bounds&&(this.tileBounds=new zt(r.bounds,this.minzoom,this.maxzoom)),e.ao(r.tiles),this.fire(new e.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.g("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.am(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.Q({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.e.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.i(this.map._requestManager.transformRequest(n,e.R.Tile),((r,n,a,o)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):r?(t.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:o}),t.setTexture(n,this.map.painter),t.state="loaded",e.an(this.dispatcher),void i(null)):i(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,i){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ft extends e.E{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.Q(this,e.ai(i,["url","scheme","tileSize","promoteId"])),this._options=e.Q({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.ap}load(t){this._loaded=!1,this.fire(new e.g("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Rt(this._options,this.map._requestManager,i,r,((n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.f(n))):a&&(e.Q(this,a),a.bounds&&(this.tileBounds=new zt(a.bounds,this.minzoom,this.maxzoom)),e.ao(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.g("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.am(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.Q({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n=this.map._requestManager.transformRequest(r,e.R.Tile),a=this.map.style?this.map.style.getLut(this.scope):null,o={request:n,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,lut:a?{image:a.image.clone()}:null,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(o.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",o,s.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",o,s.bind(this),void 0,!0);else{const i=e.aq.call({deduped:this._deduped},o,((e,i)=>{e||!i?s.call(this,e):(o.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",o,s.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function s(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.an(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Bt=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Ot=(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:a,u_image0:0,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:h,u_globe_radius:u,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});class Nt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.a3(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.a3(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.a3(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.a3(t.right,i.right,r)),this}getCenter(t,i){const r=e.au((this.left+t-this.right)/2,0,t),n=e.au((this.top+i-this.bottom)/2,0,i);return new e.P(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Nt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vt(t,i){const r=e.ax(t,3);e.ae.fromQuat(t,i),e.aA(t,3,r)}function jt(t,i){const r=e.aw.identity([]);return e.aw.rotateZ(r,r,-i),e.aw.rotateX(r,r,-t),r}function Ut(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.$.length(r)>=1e-15){const t=e.$.normalize([],r);e.$.scale(n,t,e.$.dot(n,t)),i[0]=n[0],i[1]=n[1]}const a=e.$.cross([],i,t);if(e.$.len(a)<1e-15)return null;const o=Math.atan2(-a[1],a[0]);return jt(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class Gt{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e._?t:new e._(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.av(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(e._.fromLngLat(t)):0,a=e._.fromLngLat(t,n),o=[a.x-r.x,a.y-r.y,a.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Ut(o,i)}setPitchBearing(t,i){this.orientation=jt(e.ac(t),e.ac(-i))}}class $t{constructor(t,i){this._transform=e.ae.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e._(t[0],t[1],t[2])}get position(){const t=e.ax(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.aA(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.aw.identity([]),t&&Vt(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=jt(e,t),Vt(this._transform,this._orientation)}forward(){const t=e.ax(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.ax(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.ax(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.ae.invert(r,this.getWorldToCamera(t,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,r){const n=this.position;e.$.scale(n,n,-t);const a=new Float64Array(16);return e.ae.fromScaling(a,[r,r,r]),e.ae.translate(a,a,n),a[10]*=i,a}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),a=this.position;return e.aw.conjugate(n,this._orientation),e.$.scale(a,a,-t),e.ae.fromQuat(r,n),e.ae.translate(r,r,a),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const a=new Float64Array(16);return e.ae.perspective(a,t,i,r,n),a}getCameraToClipOrthographic(t,i,r,n,a,o){const s=new Float64Array(16);return e.ae.ortho(s,t,i,r,n,a,o),s}getDistanceToElevation(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=0===t?0:e.ay(t,i?e.az(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new $t([...this.position],[...this.orientation])}}const qt={unknown:0,flipRequired:1,flipNotRequired:2},Ht=Math.tan(85*Math.PI/180);function Wt(t,i,r,n,a,o,s){const l=e.ae.create();if(r)if("globe"===o.name){const t=e.aC(a,i);e.ae.multiply(l,l,t)}else{const t=e.aD.invert([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.ae.rotateZ(l,l,a.angle)}else e.ae.multiply(l,a.labelPlaneMatrix,t);return l}function Zt(e,t,i,r,n,a,o){const s=Wt(e,t,i,r,n,a,o);return"globe"===a.name&&i||(s[2]=s[6]=s[10]=s[14]=0),s}function Xt(t,i,r,n,a,o,s){if(r){if("globe"===o.name){const l=Wt(t,i,r,n,a,o,s);return e.ae.invert(l,l),e.ae.multiply(l,t,l),l}{const i=e.ae.clone(t),r=e.ae.identity([]);return r[0]=s[0],r[1]=s[1],r[4]=s[2],r[5]=s[3],e.ae.multiply(i,i,r),n||e.ae.rotateZ(i,i,-a.angle),i}}return a.glCoordMatrix}function Yt(t,i,r,n){const a=[t,i,r,1];r?e.aB.transformMat4(a,a,n):si(a,a,n);const o=a[3];return a[0]/=o,a[1]/=o,a[2]/=o,a}function Jt(e,t){return Math.min(.5+e/t*.5,1.5)}function Qt(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function Kt(t,i,r,n,a,o,s,l,c,h){const u=r.transform,d=n?t.textSizeData:t.iconSizeData,p=e.aE(d,r.transform.zoom),f="globe"===u.projection.name,m=[256/r.width*2+1,256/r.height*2+1],g=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,x=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=r.transform.width/r.transform.height;let b,w=!1;for(let S=0;S<x.length;S++){const n=x.get(S),{numGlyphs:f,writingMode:E}=n;if(E!==e.aF.vertical||w||b===e.aF.horizontal||(w=!0),b=E,(n.hidden||E===e.aF.vertical)&&!w){oi(f,g);continue}w=!1;const T=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:C,y:k,z:M}=u.projection.projectTilePoint(T.x,T.y,h.canonical);if(c){const[e,t,i]=c(T);C+=e,k+=t,M+=i}const A=[C,k,M,1];if(e.aB.transformMat4(A,A,i),!Qt(A,m)){oi(f,g);continue}const P=A[3],I=Jt(r.transform.getCameraToCenterDistance(u.projection),P),D=e.aG(d,p,n),R=s?D/I:D*I,z=Yt(C,k,M,a);if(z[3]<=0){oi(f,g);continue}let L={};const F=s?null:c,B=ii(n,R,!1,l,i,a,o,t.glyphOffsetArray,y,g,_,z,T,L,v,F,u.projection,h,s);w=B.useVertical,F&&B.needsFlipping&&(L={}),(B.notEnoughRoom||w||B.needsFlipping&&ii(n,R,!0,l,i,a,o,t.glyphOffsetArray,y,g,_,z,T,L,v,F,u.projection,h,s).notEnoughRoom)&&oi(f,g)}n?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function ei(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,x=_+s.numGlyphs,v=g+s.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(x-1),S=ai(e*b,i,r,n,a,o,y,g,v,l,c,h,u,d,!0,p,f,m);if(!S)return null;const E=ai(e*w,i,r,n,a,o,y,g,v,l,c,h,u,d,!0,p,f,m);return E?{first:S,last:E}:null}function ti(t,i,r,n){return t===e.aF.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:t===e.aF.vertical?n>0?{needsFlipping:!0}:null:i!==qt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Ht}(r,n)?i===qt.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function ii(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x){const v=i/24,b=t.lineOffsetX*v,w=t.lineOffsetY*v,{lineStartIndex:S,glyphStartIndex:E,numGlyphs:T,segment:C,writingMode:k,flipState:M}=t,A=S+t.lineLength,P=t=>{if(u){const[i,r,n]=t.up,a=h.length;e.aH(u,a+0,i,r,n),e.aH(u,a+1,i,r,n),e.aH(u,a+2,i,r,n),e.aH(u,a+3,i,r,n)}const[i,r,n]=t.point;e.aI(h,i,r,n,t.angle)};if(T>1){const e=ei(v,l,b,w,r,d,p,t,c,o,f,g,!1,_,y,x);if(!e)return{notEnoughRoom:!0};if(n&&!r){let[i,r,n]=e.first.point,[a,o,l]=e.last.point;[i,r]=Yt(i,r,n,s),[a,o]=Yt(a,o,l,s);const c=ti(k,M,(a-i)*m,o-r);if(t.flipState=c&&c.needsFlipping?qt.flipRequired:qt.flipNotRequired,c)return c}P(e.first);for(let t=E+1;t<E+T-1;t++){const e=ai(v*l.getoffsetX(t),b,w,r,d,p,C,S,A,c,o,f,g,!1,!1,_,y,x);if(!e)return h.length-=4*(t-E),{notEnoughRoom:!0};P(e)}P(e.last)}else{if(n&&!r){const i=Yt(p.x,p.y,0,a),r=S+C+1,n=new e.P(c.getx(r),c.gety(r)),o=Yt(n.x,n.y,0,a),s=o[3]>0?o:ni(p,n,i,1,a,void 0,_,y.canonical),l=ti(k,M,(s[0]-i[0])*m,s[1]-i[1]);if(t.flipState=l&&l.needsFlipping?qt.flipRequired:qt.flipNotRequired,l)return l}const i=ai(v*l.getoffsetX(E),b,w,r,d,p,C,S,A,c,o,f,g,!1,!1,_,y,x);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function ri(e,t,i,r,n){const{x:a,y:o,z:s}=r.projectTilePoint(e.x,e.y,t);if(!n)return Yt(a,o,s,i);const[l,c,h]=n(e);return Yt(a+l,o+c,s+h,i)}function ni(t,i,r,n,a,o,s,l){const c=ri(t.sub(i)._unit()._add(t),l,a,s,o);return e.$.sub(c,r,c),e.$.normalize(c,c),e.$.scaleAndAdd(c,r,c,n)}function ai(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y){const x=n?t-i:t+i;let v=x>0?1:-1,b=0;n&&(v*=-1,b=Math.PI),v<0&&(b+=Math.PI);let w=l+s+(v>0?0:1)|0,S=a,E=a,T=0,C=0;const k=Math.abs(x),M=[],A=[];let P=o,I=P;const D=()=>ni(I,P,E,k-T+1,u,p,g,_.canonical);for(;T+C<=k;){if(w+=v,w<l||w>=c)return null;if(E=S,I=P,M.push(E),f&&A.push(I),P=new e.P(h.getx(w),h.gety(w)),S=d[w],!S){const e=ri(P,_.canonical,u,g,p);S=e[3]>0?d[w]=e:D()}T+=C,C=e.$.distance(E,S)}m&&p&&(d[w]&&(S=D(),C=e.$.distance(E,S)),d[w]=S);const R=(k-T)/C,z=P.sub(I)._mult(R)._add(I),L=e.$.sub([],S,E),F=e.$.scaleAndAdd([],E,L,R);let B=[0,0,1],O=L[0],N=L[1];if(y&&(B=g.upVector(_.canonical,z.x,z.y),0!==B[0]||0!==B[1]||1!==B[2])){const t=[B[2],0,-B[0]],i=e.$.cross([],B,t);e.$.normalize(t,t),e.$.normalize(i,i),O=e.$.dot(L,t),N=e.$.dot(L,i)}if(r){const t=e.$.cross([],B,L);e.$.normalize(t,t),e.$.scaleAndAdd(F,F,t,r*v)}const V=b+Math.atan2(N,O);return M.push(F),f&&A.push(z),{point:F,angle:V,path:M,tilePath:A,up:B}}function oi(e,t){const i=t.length,r=i+4*e;t.resize(r),t.float32.fill(-1/0,4*i,4*r)}function si(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const li=(e,t,i)=>(1-i)*e+i*t,ci=e=>e*e*e*e*e;class hi{constructor(t,i,r,n,a,o,s){this.tileSize=512,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=r??0,this._maxPitch=n??60,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new $t,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new hi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.ai(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=e.aK(this.projectionOptions);const r=this.getProjection(),n=!e.d(i,r);return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.aK({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.av(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.aD.create(),e.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.au(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.ac(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,a=0;for(let o=0;o<i.length;o++){const s=new e.P(i[o][0]*this.width,r+i[o][1]*(this.height-r)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,a+=c}return 0===a?NaN:n/a}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),a=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.$.length(e.$.sub([],this._camera.position,r));return e.au(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.aw.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.$.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Gt;return i.position=new e._(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.aw.length(t))return!1;e.aw.normalize(t,t);const i=e.$.transformQuat([],[0,0,-1],t),r=e.$.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=Ut(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.au(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.aL(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),a=this.pointCoordinate(new e.P(this.width,this.height)),o=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(r.x,n.x,a.x,o.x)),l=Math.floor(Math.max(r.x,n.x,a.x,o.x)),c=1;for(let h=s-c;h<=l+c;h++)0!==h&&i.push(new e.aL(h,t))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,r){let n=[];const a=void 0!==r,o=!a;if(o&&this.zoom<i)return n;if(a&&0===r[0]&&0===r[1])return n;const s=new Set,l=(t,i,r,a,o)=>{const l=e.b2(i,t,r,a,o);s.has(l)||(n.push(new e.aQ(t,i,r,a,o)),s.add(l))};for(let e=0;e<t.length;e++){const n=t[e];if(o&&n.canonical.z!==i)continue;const s=n.canonical,c=n.overscaledZ,h=n.wrap,u=1<<s.z,d=s.x+1<u,p=s.x>0,f=s.y+1<u,m=s.y>0,g=n.wrap-(p?0:1),_=n.wrap+(d?0:1),y=p?s.x-1:u-1,x=d?s.x+1:0;if(a)r[0]<0?(l(c,_,s.z,x,s.y),r[1]<0&&f&&(l(c,h,s.z,s.x,s.y+1),l(c,_,s.z,x,s.y+1)),r[1]>0&&m&&(l(c,h,s.z,s.x,s.y-1),l(c,_,s.z,x,s.y-1))):r[0]>0?(l(c,g,s.z,y,s.y),r[1]<0&&f&&(l(c,h,s.z,s.x,s.y+1),l(c,g,s.z,y,s.y+1)),r[1]>0&&m&&(l(c,h,s.z,s.x,s.y-1),l(c,g,s.z,y,s.y-1))):r[1]<0&&f?l(c,h,s.z,s.x,s.y+1):m&&l(c,h,s.z,s.x,s.y-1);else{const e=n.visibleQuadrants;1&e&&(l(c,g,s.z,y,s.y),m&&(l(c,h,s.z,s.x,s.y-1),l(c,g,s.z,y,s.y-1))),2&e&&(l(c,_,s.z,x,s.y),m&&(l(c,h,s.z,s.x,s.y-1),l(c,_,s.z,x,s.y-1))),4&e&&(l(c,g,s.z,y,s.y),f&&(l(c,h,s.z,s.x,s.y+1),l(c,g,s.z,y,s.y+1))),8&e&&(l(c,_,s.z,x,s.y),f&&(l(c,h,s.z,s.x,s.y+1),l(c,_,s.z,x,s.y+1)))}}const c=[];for(const e of n)n.some((t=>e.isChildOf(t)))||c.push(e);if(n=c.filter((e=>!t.some((t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),o){const e=1<<i,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),r=[e*t.x,e*t.y],a=4,o=a*a;n=n.filter((e=>{const t=e.canonical.x+.5-r[0],i=e.canonical.y+.5-r[1];return t*t+i*i<o}))}return n}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=this.elevation&&this.elevation.exaggeration(),a=n&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,h=[c*s.x,c*s.y,0],u="globe"===this.projection.name,d=!u,p=e.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),f=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.ay(1,this.center.lat),g=this._camera.position[2]/e.ay(1,this.center.lat),_=[c*f.x,c*f.y,g*(d?1:m)],y=u||n,x=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),v=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,S=this.projection.isReprojectedInTileSpace?e.aN(this):1,E=t=>{const i=1/4e4,r=new e._(t.x+i,t.y,t.z),n=new e._(t.x,t.y+i,t.z),a=t.toLngLat(),o=r.toLngLat(),s=n.toLngLat(),l=this.locationCoordinate(a),c=this.locationCoordinate(o),h=this.locationCoordinate(s),u=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(h.x-l.x,h.y-l.y);return Math.sqrt(u*d)*S/i},T=t=>{const i=b,r=w;return{aabb:e.aR(this,c,0,0,0,t,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},C=[];let k=[];const M=i,A=t.reparseOverscaled?r:i,P=(g-this._centerAltitude)*m,I=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=R(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},D=(e,t)=>{if(.707*t<e)return 1;const i=t/e;return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)},R=t=>{if(t.zoom<v)return!0;if(t.zoom===M)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(_),n=t.aabb.distanceY(_);let s=P,c=1;if(u){s=t.aabb.distanceZ(_);const i=Math.pow(2,t.zoom),r=e.az((t.y+1)/i),n=e.az(t.y/i),a=Math.min(Math.max(l,r),n),o=e.b6(a)/e.b6(l);if(c=a===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=e.b3&&t.zoom===M-1&&o>=.9)return!0}else if(a&&(s=t.aabb.distanceZ(_)*m),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,t.zoom),r=E(new e._((t.x+.5)/i,(t.y+.5)/i));c=r>.85?1:r}if(!o){const e=Math.sqrt(i*i+n*n+s*s);let r=(1<<M-t.zoom)*x*c;return r*=D(Math.max(s,P),e),e<r}let d=Number.MAX_VALUE,p=0;const f=t.aabb.getCorners(),g=[];for(const r of f){e.$.sub(g,r,_),u||(a?g[2]*=m:g[2]=P);const t=e.$.dot(g,this._camera.forward());t<d&&(d=t,p=Math.abs(g[2]))}let y=(1<<M-t.zoom)*x*c;if(y*=D(Math.max(p,P),d),d<y)return!0;const b=t.aabb.closestPoint(h);return b[0]===h[0]&&b[1]===h[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)C.push(T(-e)),C.push(T(e));for(C.push(T(0));C.length>0;){const r=C.pop(),n=r.x,s=r.y;let l=r.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!l){let t=y?r.aabb.intersects(p):r.aabb.intersectsFlat(p);if(0===t&&d()){const i=new e.aO(r.zoom,n,s);t=e.aP(this,c,i,!0).intersects(p)}if(0===t)continue;l=2===t}if(r.zoom!==M&&R(r))for(let t=0;t<4;t++){const i=(n<<1)+t%2,h=(s<<1)+(t>>1),d={aabb:o?r.aabb.quadrant(t):e.aR(this,c,r.zoom+1,i,h,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:h,wrap:r.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};a&&!u&&(d.tileID=new e.aQ(r.zoom+1===M?A:r.zoom+1,r.wrap,r.zoom+1,i,h),I(d)),C.push(d)}else{const a=r.zoom===M?A:r.zoom;if(t.minzoom&&t.minzoom>a)continue;let o=0;if(!l){let i=y?r.aabb.intersectsPrecise(p):r.aabb.intersectsPreciseFlat(p);if(0===i&&d()){const t=new e.aO(r.zoom,n,s);i=e.aP(this,c,t,!0).intersectsPrecise(p)}if(0===i)continue;if(t.calculateQuadrantVisibility)if(p.containsPoint(r.aabb.center))o=15;else for(let e=0;e<4;e++)0!==r.aabb.quadrant(e).intersects(p)&&(o|=1<<e)}const u=h[0]-(.5+n+(r.wrap<<r.zoom))*(1<<i-r.zoom),f=h[1]-.5-s,m=r.tileID?r.tileID:new e.aQ(a,r.wrap,r.zoom,n,s);t.calculateQuadrantVisibility&&(m.visibleQuadrants=o),k.push({tileID:m,distanceSq:u*u+f*f})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();k=k.filter((n=>{const a=[0,0,0,1],o=[e.a4,e.a4,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.aB.transformMat4(a,a,s),e.aB.transformMat4(o,o,s);const l=e.aB.min([],a,o),c=e.aB.max([],a,o),h=e.aS(l,c);if(0===h)return!0;let u=!1;const d=this._elevation;if(d&&h>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let a;t.isTerrainDEM||(a=d.getMinMaxForTile(n.tileID)),a||(a={min:w,max:b});const o=e.b4(this.rotation),s=[o[0]*e.a4,o[1]*e.a4,a.max];e.$.transformMat4(s,s,i),u=(1-s[1])*this.height*.5<r}return h<i||u}))}return k.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.au(t.lat,-e.aT,e.aT),r=this.projection.project(t.lng,i);return new e.P(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let r,n;const a=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(i.x-a.x)/e,n=(i.y-a.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(a);r=e.x-t.x,n=e.y-t.y}const o=this.locationCoordinate(t);this.setLocation(new e._(o.x-r,o.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const r=i?e.ay(i,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e._(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.aB.transformMat4(n,n,this.pixelMatrixInverse),e.aB.transformMat4(a,a,this.pixelMatrixInverse);const o=a[3];e.aB.scale(n,n,1/n[3]),e.aB.scale(a,a,1/o);const s=n[2],l=a[2];return{p0:n,p1:a,t:s===l?0:(r-s)/(l-s)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.aB.transformMat4(i,i,this.pixelMatrixInverse),e.aB.transformMat4(r,r,this.pixelMatrixInverse),e.aB.scale(i,i,1/i[3]),e.aB.scale(r,r,1/r[3]),i[2]=e.ay(i[2],this._center.lat)*this.worldSize,r[2]=e.ay(r[2],this._center.lat)*this.worldSize,e.aB.scale(i,i,1/this.worldSize),e.aB.scale(r,r,1/this.worldSize),new e.aU([i[0],i[1],i[2]],e.$.normalize([],e.$.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,a=e.ay(i[2],this._center.lat),o=e.ay(r[2],this._center.lat);return new e._(e.a3(i[0],r[0],n)/this.worldSize,e.a3(i[1],r[1],n)/this.worldSize,e.a3(a,o,n))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e._(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const a=.02*n,o=t.clone();for(let s=0;s<10&&n-r>a;s++){o.y=e.a3(r,n,.66);const t=this.projection.pointCoordinate3D(this,o.x,o.y);t?(n=o.y,i=t):r=o.y}return i?new e._(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.aV)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.aB.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.P(n[0]/n[3],n[1]/n[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,a=this.pointLocation3D(new e.P(i,t)),o=this.pointLocation3D(new e.P(n,t)),s=this.pointLocation3D(new e.P(n,r)),l=this.pointLocation3D(new e.P(i,r));let c=Math.min(a.lng,o.lng,s.lng,l.lng),h=Math.max(a.lng,o.lng,s.lng,l.lng),u=Math.min(a.lat,o.lat,s.lat,l.lat),d=Math.max(a.lat,o.lat,s.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,i,r,n,a)=>{const o=(t+r)/2,s=(i+n)/2,l=new e.P(o,s),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,u-_,g-h,_-d);c=Math.min(c,g),h=Math.max(h,g),u=Math.min(u,_),d=Math.max(d,_),(a<f||y>p)&&(m(t,i,o,s,a+1),m(o,s,r,n,a+1))};if(m(i,t,n,t,1),m(n,t,n,r,1),m(n,r,i,r,1),m(i,r,i,t,1),"globe"===this.projection.name){const[t,i]=e.aW(this);t?(d=90,h=180,c=-180):i&&(u=-90,h=180,c=-180)}return new e.aj(new e.aJ(c,u),new e.aJ(h,d))}_getBoundsRectangular(t,i){const{top:r,left:n}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new e.P(n,r),l=new e.P(o,r),c=new e.P(o,a),h=new e.P(n,a);let u=this.pointCoordinate(s,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(h,i),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&d.y>=0?u=new e._((1-f.y)/m(f,u)+f.x,1):u.y<0&&d.y<=1&&(u=new e._(-f.y/m(f,u)+f.x,0)),d.y>1&&u.y>=0?d=new e._((1-p.y)/m(p,d)+p.x,1):d.y<0&&u.y<=1&&(d=new e._(-p.y/m(p,d)+p.x,0)),(new e.aj).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.aT,this.maxLat=e.aT,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.ak(this.minLng)*this.tileSize,this.worldMaxX=e.ak(this.maxLng)*this.tileSize,this.worldMinY=e.al(this.maxLat)*this.tileSize,this.worldMaxY=e.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=t.canonical,a=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*t.wrap)*s,c=n.y*s,h=this.point;h.x*=o/this.worldSize,h.y*=o/this.worldSize;const u=this.angle,d=Math.sin(-u),p=-Math.cos(-u);return r[i]={bearing:[d,p],center:[(h.x-l)*a,(h.y-c)*a],scale:s/e.a4*a},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.ae.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.key;let a;if(a=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,a[n])return a[n];const o=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,e.ae.multiply(o,s,o),a[n]=new Float32Array(o),a[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=e.aX(t,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.ae.fromScaling([],[t,t,t]);return e.ae.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.ay(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),a=e.ay(1,this._center.lat);r[2]/=a,n[2]/=a,e.$.normalize(n,n);const o=t.raycast(r,n,t.exaggeration());if(o){const t=e.$.scaleAndAdd([],r,n,o),i=new e._(t[0],t[1],e.ay(t[2],e.az(t[1]))),s=(i.z+e.$.length([i.x-r[0],i.y-r[1],i.z-r[2]*a]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const i=this._elevation,r=e.ay(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),a=i.getAtPointOrZero(new e._(...n)),o=this.pixelsPerMeter/this.worldSize*a,s=this._minimumHeightOverTerrain(),l=n[2]-o;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[n[0],n[1],t.z-n[2]],r=e.$.length(i);i[2]-=(s-l)/this._pixelsPerMercatorPixel;const a=e.$.length(i);if(0===a)return;e.$.scale(i,i,r/a*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.au(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.au(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let a=0,o=r,s=n;const l=this.width/2,c=this.height/2,h=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(n-c<h&&(s=h+c),n+c>u&&(s=u-c),u-h<this.height&&(a=Math.max(a,this.height/(u-h)),s=(u+h)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;o=(r+i+this.worldSize)%this.worldSize-i,o-l<e&&(o=e+l),o+l>t&&(o=t-l),t-e<this.width&&(a=Math.max(a,this.width/(t-e)),o=(t+e)/2)}o===r&&s===n||(this.center=this.unproject(new e.P(o,s))),a&&(this.zoom+=this.scaleZoom(a)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.ay(1,this.center.lat)/e.ay(1,e.b5));const n=e.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const a="meters"===this.projection.zAxisUnit?r:1,o=this._camera.getWorldToCamera(this.worldSize,a);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=e*this.aspect,r=-i,n=-e;i-=t.x,r-=t.x,e+=t.y,n+=t.y,s=this._camera.getCameraToClipOrthographic(r,i,n,e,this._nearZ,this._farZ),((e,t,i,r)=>{for(let n=0;n<16;n++)e[n]=li(t[n],i[n],r)})(s,s,l,ci(this.pitch>=15?1:this.pitch/15))}else s=l;const c=e.ae.mul([],l,o);let h=e.ae.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.ae.identity([]);e.ae.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.ae.multiply(i,i,e.aZ(this)),e.ae.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.ae.multiply(h,h,i),e.ae.multiply(c,c,i),this.inverseAdjustmentMatrix=e.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.ae.scale([],h,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=h,this.invProjMatrix=e.ae.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.ae.mul([],i,o)}else this.expandedFarZProjMatrix=this.projMatrix;const u=e.ae.invert([],s);this.frustumCorners=e.a$.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);e.ae.identity(d),e.ae.scale(d,d,[1,-1,1]),e.ae.rotateX(d,d,this._pitch),e.ae.rotateZ(d,d,this.angle);const p=e.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.ae.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.ae.multiply(d,p,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,x=this.height%2/2,v=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+v*y+b*x,S=_-Math.round(_)+v*x+b*y,E=new Float64Array(h);if(e.ae.translate(E,E,[w>.5?w-1:w,S>.5?S-1:S,0]),this.alignedProjMatrix=E,h=e.ae.create(),e.ae.scale(h,h,[this.width/2,-this.height/2,1]),e.ae.translate(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=e.ae.create(),e.ae.scale(h,h,[1,-1,1]),e.ae.translate(h,h,[-1,-1,0]),e.ae.scale(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h,this.pixelMatrix=e.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},h=e.ae.invert(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=h,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.b0(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.$.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=h;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,a=[t,t,i];e.$.scale(a,a,n),e.$.scale(r,r,-1),e.$.multiply(r,r,a);const o=e.ae.create();e.ae.translate(o,o,r),e.ae.scale(o,o,a),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,e/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=t[2];let a=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(a=Math.min((i-r)/n,1)),this._camera.position=e.$.scaleAndAdd([],this._camera.position,t,a),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),a=e.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.ac(this._maxPitch)),s=Math.max((t[2]-a)/Math.cos(r),o),l=this._zoomFromMercatorZ(s);e.$.scaleAndAdd(t,t,i,s),this._pitch=e.au(r,e.ac(this.minPitch),e.ac(this.maxPitch)),this.angle=e.av(n,-Math.PI,Math.PI),this._setZoom(e.au(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e._(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,r=e.aV,n=0,a=1/0;for(;r-i>1e-6&&r>i;){const e=i+.5*(r-i),o=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,o),l=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(e-l);c<a&&(a=c,n=e),e<l?i=e:r=e}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),a=Math.min(t.y,i.y),o=Math.max(t.y,i.y);if(a<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.P(r,a),new e.P(n,o),new e.P(r,o),new e.P(n,a)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.$.length(e.$.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,i){let[r,n,a]=t;const o=[r,n,a,1];e.aB.transformMat4(o,o,i);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const n=e.aY(t,i,this.width,this.height,1024),a=t.pixelSpaceConversion(this.center.lat,r,n);let o=.5/Math.tan(.5*this._fov)*this.height*a;return this.isOrthographic&&(o=li(1,o,ci(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.ae.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const ui={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},di=(t,i)=>{if(i>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),i<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=t.transform,n=Math.max(Math.abs(r._zoom-(t.minCutoffZoom-1)),1),a=r.isLODDisabled(!1)?e.a0(60,45,r.pitch):e.a0(30,15,r.pitch),o=r._farZ-r._nearZ,s=i*r.height,l=((1-(c=a))*r.cameraToCenterDistance+c*(r._farZ+s))*n;var c;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(l-r._nearZ)/o,(l-s-r._nearZ)/o]}}},pi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class fi{constructor(e,t){this.aabb=e,this.lastCascade=t}}class mi{add(e,t){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new fi(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,i,r){const n=e.b8.fromPoints(t.points);let a=0;for(const o in this.receivers){const t=this.receivers[o];if(!t)continue;if(!n.intersectsAabb(t.aabb))continue;t.aabb.min=n.closestPoint(t.aabb.min),t.aabb.max=n.closestPoint(t.aabb.max);const s=t.aabb.getCorners();for(let n=0;n<r.length;n++){let o=!0;for(const t of s){const a=[t[0]*i,t[1]*i,t[2]];if(e.$.transformMat4(a,a,r[n].matrix),a[0]<-1||a[0]>1||a[1]<-1||a[1]>1){o=!1;break}}if(t.lastCascade=n,a=Math.max(a,n),o)break}}return a+1}}class gi{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new mi,this._depthMode=new e.af(t.context.gl.LEQUAL,e.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(pi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(pi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(pi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=r.style.order.reduce(((e,i)=>{const n=r.style._mergedLayers[i];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const a=r.context,o=pi.shadowMapResolution,s=pi.shadowMapResolution;if(0===this._cascades.length||pi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<pi.cascadeCount;++t){const t=r._shadowMapDebug,i=a.gl,n=a.createFramebuffer(o,s,t,"texture"),l=new e.T(a,{width:o,height:s,data:null},i.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),t){const t=new e.T(a,{width:o,height:s,data:null},i.RGBA);n.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.aM,scale:0})}}this.shadowDirection=yi(i);let l=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;i[0]=Math.min(i[0],t.minimums[0]),i[1]=Math.max(i[1],t.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,h=3*c,u=new Float64Array(16);for(let f=0;f<this._cascades.length;++f){const i=this._cascades[f];let r=t.height/50,n=1;1===pi.cascadeCount?n=h:0===f?n=c:(r=c,n=h);const[a,o]=vi(t,this.shadowDirection,r,n,pi.shadowMapResolution,l);i.scale=t.scale,i.matrix=a,i.boundingSphereRadius=o,e.ae.invert(u,i.matrix),i.frustum=e.aM.fromInvProjectionMatrix(u,1,0,!0),i.far=n}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/pi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=pi.shadowMapResolution,this._uniformValues.u_shadowmap_0=ui.ShadowMap0,this._uniformValues.u_shadowmap_1=ui.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=r.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const i=p.getMinMaxForTile(e);i&&(t=i)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,i){if(!this.enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,pi.shadowMapResolution,pi.shadowMapResolution]);for(let a=0;a<this._numCascadesToRender;++a){r.currentShadowCascade=a,n.bindFramebuffer.set(this._cascades[a].framebuffer.framebuffer),n.clear({color:e.C.white,depth:1});for(const e of t.order){const n=t._mergedLayers[e];if(!n.hasShadowPass()||n.isHidden(r.transform.zoom))continue;const a=t.getLayerSourceCache(n),o=a?i[a.id]:void 0;("model"===n.type||o&&o.length)&&r.renderLayer(r,a,n,o)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,i=t.style,r=t.context,n=i.directionalLight,a=i.ambientLight;if(!n||!a)return;const o=[],s=di(t,t.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const l=xi(i,n,a),c=new e.af(r.gl.LEQUAL,e.af.ReadOnly,t.depthRangeFor3D);for(const h of this._groundShadowTiles){const i=h.toUnwrapped(),n=t.isTileAffectedByFog(h),a=t.getOrCreateProgram("groundShadow",{defines:o,overrideFog:n});this.setupShadows(i,a),t.uploadCommonUniforms(r,a,i,null,s);const u={u_matrix:t.transform.calculateProjMatrix(i),u_ground_shadow_factor:l};a.draw(t,r.gl.TRIANGLES,c,e.ah.disabled,e.a.multiply,e.ag.disabled,u,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?e.a.unblended:e.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,r=i.calculatePosMatrix(t,i.worldSize);return e.ae.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return e.ae.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.enabled)return;const a=this.painter.transform,o=this.painter.context,s=o.gl,l=this._uniformValues,c=new Float64Array(16),h=a.calculatePosMatrix(t,a.worldSize);for(let u=0;u<this._cascades.length;u++)e.ae.multiply(c,this._cascades[u].matrix,h),l[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),o.activeTexture.set(s.TEXTURE0+ui.ShadowMap0+u),this._cascades[u].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const i=e.b7(t.canonical),o=2/a.tileSize*e.a4/pi.shadowMapResolution,s=o*this._cascades[0].boundingSphereRadius,c=o*this._cascades[this._cascades.length-1].boundingSphereRadius,h=("vector-tile"===r?1:3)/Math.pow(2,n-t.canonical.z-(1-a.zoom+Math.floor(a.zoom)));l.u_shadow_normal_offset=[i,s*h,c*h],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,l)}setupShadowsFromMatrix(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const n=this.painter.context,a=n.gl,o=this._uniformValues,s=new Float64Array(16);for(let l=0;l<pi.cascadeCount;l++)e.ae.multiply(s,this._cascades[l].matrix,t),o[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),n.activeTexture.set(a.TEXTURE0+ui.ShadowMap0+l),this._cascades[l].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=r,r){const e=pi.normalOffset;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(n,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,r,n){if(n[2]>=0)return{};const a=function(t,i,r){const n=r/(1<<t.canonical.z);return new e.b8([t.canonical.x*n+t.wrap*r,t.canonical.y*n+t.wrap*r,0],[(t.canonical.x+1)*n+t.wrap*r,(t.canonical.y+1)*n+t.wrap*r,i])}(t,i,r).getCorners(),o=i/-n[2];n[0]<0?(e.$.add(a[0],a[0],[n[0]*o,0,0]),e.$.add(a[3],a[3],[n[0]*o,0,0])):n[0]>0&&(e.$.add(a[1],a[1],[n[0]*o,0,0]),e.$.add(a[2],a[2],[n[0]*o,0,0])),n[1]<0?(e.$.add(a[0],a[0],[0,n[1]*o,0]),e.$.add(a[1],a[1],[0,n[1]*o,0])):n[1]>0&&(e.$.add(a[2],a[2],[0,n[1]*o,0]),e.$.add(a[3],a[3],[0,n[1]*o,0]));const s={};return s.vertices=a,s.planes=[_i(a[1],a[0],a[4]),_i(a[2],a[1],a[5]),_i(a[3],a[2],a[6]),_i(a[0],a[3],a[7])],s}addShadowReceiver(t,i,r){this._receivers.add(t,e.b8.fromTileIdAndHeight(t,i,r))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function _i(t,i,r){const n=e.$.sub([],r,i),a=e.$.sub([],t,i),o=e.$.cross([],n,a),s=e.$.length(o);return 0===s?[0,0,1,0]:(e.$.scale(o,o,1/s),[o[0],o[1],o[2],-e.$.dot(o,i)])}function yi(t){const i=t.properties.get("direction"),r=e.ad(i.x,i.y,i.z);r[2]=e.au(r[2],0,75);const n=e.b9([r[0],r[1],r[2]]);return e.$.fromValues(n.x,n.y,n.z)}function xi(t,i,r){const n=i.properties.get("color"),a=i.properties.get("intensity"),o=i.properties.get("direction"),s=[o.x,o.y,o.z],l=r.properties.get("color"),c=r.properties.get("intensity"),h=Math.max(e.$.dot([0,0,1],s),0),u=[0,0,0];e.$.scale(u,l.toRenderColor(t.getLut(i.scope)).toArray01Linear().slice(0,3),c);const d=[0,0,0];return e.$.scale(d,n.toRenderColor(t.getLut(r.scope)).toArray01Linear().slice(0,3),h*a),e.ba([u[0]>0?u[0]/(u[0]+d[0]):0,u[1]>0?u[1]/(u[1]+d[1]):0,u[2]>0?u[2]/(u[2]+d[2]):0])}function vi(t,i,r,n,a,o){const s=t.zoom,l=t.scale,c=t.worldSize,h=1/c,u=t.aspect,d=Math.sqrt(1+u*u)*Math.tan(.5*t.fovX),p=d*d,f=n-r,m=n+r;let g,_;p>f/m?(g=n,_=n*d):(g=.5*m*(1+p),_=.5*Math.sqrt(f*f+2*(n*n+r*r)*p+m*m*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),x=t._camera.getCameraToWorldMercator(),v=[0,0,-g*h];e.$.transformMat4(v,v,x);let b=_*h;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const i=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),a=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,r,n);a[8]=2*-t.centerOffset.x/t.width,a[9]=2*t.centerOffset.y/t.height;const o=new Float64Array(16);e.ae.mul(o,a,i);const h=new Float64Array(16);e.ae.invert(h,o);const u=e.aM.fromInvProjectionMatrix(h,c,s,!0);for(const r of u.points){const i=((S=r)[0]/=l,S[1]/=l,S[2]=e.ay(S[2],t._center.lat),S);b=Math.max(b,e.$.len(e.$.subtract([],v,i)))}}var S;b*=a/(a-1);const E=Math.acos(i[2]),T=Math.atan2(-i[0],-i[1]),C=new $t;C.position=v,C.setPitchBearing(E,T);const k=C.getWorldToCamera(c,y),M=b*c,A=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*M),P=C.getCameraToClipOrthographic(-M,M,-M,M,A,(M+o*y)/i[2]),I=new Float64Array(16);e.ae.multiply(I,P,k);const D=e.$.fromValues(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),R=.5*a,z=[0,0,0];e.$.transformMat4(z,D,I),e.$.scale(z,z,R);const L=[Math.floor(z[0]),Math.floor(z[1]),Math.floor(z[2])],F=[0,0,0];e.$.sub(F,z,L),e.$.scale(F,F,-1/R);const B=new Float64Array(16);return e.ae.identity(B),e.ae.translate(B,B,F),e.ae.multiply(I,B,I),[I,M]}function bi(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const wi=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Si={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ei(e,t,i){if(0===t)return 0;const r=t<1&&514===i?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function Ti(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const Ci=e=>({u_matrix:e});function ki(t,i,r,n,a){if(a>0){const o=e.e.now(),s=(o-t.timeAdded)/a,l=i?(o-i.timeAdded)/a:-1,c=r.getSource(),h=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),u=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=u&&t.refreshedUponExpiration?1:e.au(u?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Mi extends Lt{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-array",this.maxzoom=22,this._options=e.Q({type:"raster-array"},i)}triggerRepaint(e){const t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint()}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(r,e.R.Tile);t.requestParams=n,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,((e,r,n,a)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(e){if(20===e.code)return;return t.state="errored",i(e)}this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:a}),t.state="empty",i(null)}))}unloadTile(t,i){const r=t.texture;r&&r instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(r)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(i,r,((i,r)=>{if(i)return t.state="errored",this.fire(new e.f(i)),void this.triggerRepaint(t);r&&(t.setTexture(r,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((t=>{let{id:i}=t;return i===e})),i=t&&t.fields,r=i&&i.bands&&i.bands;return r?r[0]:0}getTextureDescriptor(t,i,r){if(!t)return;const n=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let a=null;i instanceof e.bm?a=i.paint.get("raster-array-band"):i instanceof e.bn&&(a=i.paint.get("raster-particle-array-band"));const o=a||this.getInitialBand(n);if(null!=o)if(t.textureDescriptor){if(!t.updateNeeded(n,o)||r)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,o)}}const Ai={vector:Ft,raster:Lt,"raster-dem":class extends Lt{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.Q({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.i(this.map._requestManager.transformRequest(r,e.R.Tile),function(r,a,o,s){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s});const i=ImageBitmap&&a instanceof ImageBitmap&&e.bk(),r=1-(a.width-e.bl(a.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?a:e.e.getImageData(a,r),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,a=0===i.x?t.wrap-1:t.wrap,o=(i.x+1+r)%r,s=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.aQ(t.overscaledZ,a,i.z,n,i.y).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new e.aQ(t.overscaledZ,a,i.z,n,i.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.aQ(t.overscaledZ,a,i.z,n,i.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,i.z,o,i.y+1).key]={backfilled:!1}),l}},"raster-array":Mi,geojson:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.Q({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const a=e.a4/this.tileSize;this.workerOptions=e.Q({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*a,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*a,extent:e.a4,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.a4,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*a,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const i of t.features)e.set(i.id,i);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.g("dataloading",{dataType:"source"})),this._loaded=!1;const i=e.Q({append:t},this.workerOptions);i.scope=this.scope;const r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(e.e.resolveURL(r),e.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new e.f(i));else{const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(i.resourceTiming=r.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.g("data",i)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const n=this.map.style?this.map.style.getLut(this.scope):null,a=this._partialReload,o={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:n?{image:n.image.clone()}:null,scope:this.scope,pixelRatio:e.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:a};t.request=this.actor.send(r,o,((e,n)=>a&&!n?(t.state="loaded",i(null)):(delete t.request,t.destroy(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.bo{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.R.Source).url);e.bp(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.f(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.f(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.bo,model:class extends e.E{constructor(e,t,i,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const i in this._options.models){const r=this._options.models[i],n=e.l(this.map._requestManager.transformRequest(r.uri,e.R.Model).url).then((t=>{if(!t)return;const n=e.c(t),a=new e.M(i,r.position,r.orientation,n);a.computeBoundsAndApplyParent(),this.models.push(a)})).catch((t=>{this.fire(new e.f(new Error(`Could not load model ${i} from ${r.uri}: ${t.message}`)))}));t.push(n)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.g("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.f(new Error(`Could not load models: ${t.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,i,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.g("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Rt(this._options,this.map._requestManager,i,r,((n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.f(n))):a&&(e.Q(this,a),a.bounds&&(this.tileBounds=new zt(a.bounds,this.minzoom,this.maxzoom)),e.ao(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.g("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=i;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",n,a.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,a.bind(this),void 0,!0);function a(e,r){return t.aborted?i(null):e&&404!==e.status?i(e):(r&&(r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.buckets={...t.buckets,...r.buckets},r.featureIndex&&(t.latestFeatureIndex=r.featureIndex)),t.state="loaded",void i(null))}}serialize(){return e.Q({},this._options)}},canvas:class extends e.bo{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.f(new e.V(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.f(new e.V(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.f(new e.V(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.f(new e.V(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.f(new e.V(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.Q(this,e.ai(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:r,z:n}=e.tileID.canonical,a=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:a.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===i?(e.state="errored",t(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(e.state="errored",t(i))})),e.request.cancel=()=>a.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,i){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:r})}i&&i()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.am(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.g("data",{dataType:"source",sourceDataType:"content"}))}}},Pi=function(t,i,r,n){const a=new Ai[i.type](t,i,r,n);if(a.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${a.id}`);return e.br(["load","abort","unload","serialize","prepare"],a),a};class Ii extends e.bx{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new e.by(e.bz(),null),n=Pi("mock-dem",i,r,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Di extends e.bx{constructor(t){const i=Pi("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.by(e.bz(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,r){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){const i=new e.bA(r,this._source.tileSize*r.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ri extends e.aQ{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class zi extends e.bs{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,a]=function(){const t=new e.bv,i=new e.bw,r=131;t.reserve(17161),i.reserve(33800);const n=e.a4/128,a=e.a4+n/2,o=a+n;for(let l=-n;l<o;l+=n)for(let i=-n;i<o;i+=n){const r=i<0||i>a||l<0||l>a?24575:0,n=e.au(Math.round(i),0,e.a4),o=e.au(Math.round(l),0,e.a4);t.emplaceBack(n+r,o)}const s=(e,t)=>{const n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)s(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)})),[t,i,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(r,e.bt.members),this.gridIndexBuffer=o.createIndexBuffer(n),this.gridSegments=e.b.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.b.simpleSegment(0,0,r.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Di(i.map),this.orthoMatrix=e.ae.create(),e.ae.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.a4,0,e.a4,0,1);const s=o.gl;this._overlapStencilMode=new e.ah({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ii(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const n=t.terrain.properties,a=0===t.terrain.drapeRenderMode,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.e.now();const s=t.terrain&&t.terrain.scope,l=n.get("source"),c=a?this._mockSourceCache:t.getSourceCache(l,s);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=o?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const h=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,h(),this._initializing=!0),h(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){const i=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const n=null!=i?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const a=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(a);let s=a-this._previousZoom;const l=this._previousUpdateTimestamp;let c=a;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(a-c)>.5&&(s=.5*(a-c+s)),s*n<0&&(c+=s)),this._evaluationZoom=c;const h=o.getExaggeration(c),u=h===o.getExaggeration(Math.max(0,c-.1));if(u&&Math.abs(h-this._exaggeration)<.01)return h;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(u||h<.1||Math.abs(s)<1e-4)&&(d=Math.min(.2,4*d)),e.a3(this._exaggeration,h,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e._.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.P(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=n.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(r)-o.distSqr(a)}))}(n,this.painter);const a=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const e in o){const i=o[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],a),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((e=>new Ri(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(a),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in s||(this._visibleDemTiles.push(t),s[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),It(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-n.z),o=r||"";return i[`u_dem_tl${o}`]=[n.x*a%1,n.y*a%1],i[`u_dem_scale${o}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,a]=(()=>{const t=new e.bB({width:1,height:1},new Float32Array([r]));return[i.R32F,t]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(a,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,a,n,{premultiply:!1}),o}setupElevationDraw(t,i,r){const n=this.painter.context,a=n.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};o.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;c=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(l=e),this._prepareDemTileUniforms(t,i,o)&&(s=i))}const h=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?a.LINEAR:a.NEAREST;let u=null;var d;if(this.enabled?l&&s?(u=s.demTexture,n.activeTexture.set(a.TEXTURE4),l.demTexture.bind(h(l),a.CLAMP_TO_EDGE),o.u_dem_lerp=c):(s=this.terrainTileForTile[t.tileID.key],u=this._prepareDemTileUniforms(t,s,o)?s.demTexture:this.emptyDEMTexture):u=this.emptyDEMTexture,n.activeTexture.set(a.TEXTURE2),u&&(o.u_dem_size=1===(d=u).size[0]?1:d.size[0]-2,u.bind(h(s),a.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(r&&r.useDepthForOcclusion,i,o),r&&r.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*e.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}if(r&&r.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,o),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,e)}}globeUniformValues(t,i,r){const n=t.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,e.a4,0),u_tile_br_up:n.upVector(i,e.a4,e.a4),u_tile_bl_up:n.upVector(i,0,e.a4),u_tile_up_scale:r?e.bu(1):n.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,r,n,a){if("globe"===t.transform.projection.name)!function(t,i,r,n,a){const o=t.context,s=o.gl;let l,c;const h=t.transform,u=e.bc(t,o,h),d=(e,i)=>{if(c===i)return;const r=[Si[i],"PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:r,overrideFog:n}),c=i},p=t.colorModeForRenderPass(),f=new e.af(s.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D);wi.update(a);const m=e.bd(h),g=[e.ak(h.center.lng),e.al(h.center.lat)],_=t.globeSharedBuffers,y=[h.width*e.e.devicePixelRatio,h.height*e.e.devicePixelRatio],x=Float32Array.from(h.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const h=t.transform,u=Ei(h.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const b=s.TRIANGLES;for(const c of n){const n=r.getTile(c),w=e.ah.disabled,S=i.prevTerrainTileForTile[c.key],E=i.terrainTileForTile[c.key];bi(S,E)&&wi.newMorphing(c.key,S,E,a,250),o.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=wi.getMorphValuesForProxy(c.key),C=T?1:0;T&&e.q(v,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.bb(T.phase)}});const k=e.be(c.canonical),M=e.bf(k.getCenter().lat),A=e.bg(c.canonical,k,M,h.worldSize/h._pixelsPerMercatorPixel),P=e.bh(e.bi(c.canonical)),I=Ot(h.expandedFarZProjMatrix,x,m,P,e.a2(h.zoom),g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,y,u,h._farZ,A);if(d(c,C),l&&(i.setupElevationDraw(n,l,v),t.uploadCommonUniforms(o,l,c.toUnwrapped()),_)){const[i,r,n]=_.getGridBuffers(M,0!==u);l.draw(t,b,f,w,p,e.ag.backCCW,I,"globe_raster",i,r,n)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const a=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&a.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:a});for(const c of n){const{x:n,y:a,z:u}=c.canonical,d=0===a,m=a===(1<<u)-1,[x,b,w,S]=_.getPoleBuffers(u,!1);if(S&&(d||m)){const a=r.getTile(c);o.activeTexture.set(s.TEXTURE0),a.texture&&a.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=e.bj(u,n,h);const E=e.bh(e.bi(c.canonical)),T=(i,r)=>i.draw(t,s.TRIANGLES,f,e.ah.disabled,p,e.ag.disabled,Ot(h.expandedFarZProjMatrix,_,_,E,0,g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,y,0,h._farZ),"globe_pole_raster",r,w,S);i.setupElevationDraw(a,l,v),t.uploadCommonUniforms(o,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&T(l,x),m&&t.renderDefaultSouthPole&&(_=e.ae.scale(e.ae.create(),_,[1,-1,1]),T(l,b))}}}}(t,i,r,n,a);else{const o=t.context,s=o.gl;let l,c;const h=t.shadowRenderer,u=di(t,t.longestCutoffRange),d=e=>{if(c===e)return;const i=[];i.push(Si[e]),u.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:i}),c=e},p=t.colorModeForRenderPass(),f=new e.af(s.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D);wi.update(a);const m=t.transform,g=Ei(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let _=[0,0,0];if(h){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(_=xi(t.style,e,i))}{c=-1;const y=s.TRIANGLES,[x,v]=[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),b=e.ah.disabled,w=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];bi(w,S)&&wi.newMorphing(c.key,w,S,a,250),o.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const E=wi.getMorphValuesForProxy(c.key),T=E?1:0;let C;E&&(C={morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.bb(E.phase)}});const k=Bt(c.projMatrix,Ti(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(T),!l)continue;i.setupElevationDraw(n,l,C);const M=c.toUnwrapped();h&&h.setupShadows(M,l),t.uploadCommonUniforms(o,l,M,null,u),l.draw(t,y,f,b,p,e.ag.backCCW,k,"terrain_raster",i.gridBuffer,x,v)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,a=this.proxiedCoords[n.id],o=this._drapedRenderBatches.shift(),s=i.style.order,l=[];let c=0;for(const h of a){const a=n.getTileByID(h.proxyTileKey),u=n.proxyCachedFBO[h.key]?n.proxyCachedFBO[h.key][t]:void 0,d=void 0!==u?n.renderCache[u]:this.pool[c++],p=void 0!==u;if(a.texture=d.tex,p&&!d.dirty){l.push(a.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:e.C.transparent,stencil:0}),d.dirty=!1);for(let e=o.start;e<=o.end;++e){const t=i.style._mergedLayers[s[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),a=n?this.proxyToSource[h.key][n.id]:[h];if(!a)continue;const o=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,a,t,n),f=n?n.id:null),i.renderLayer(i,n,t,o)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=i.style._mergedLayers[s[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),a=n?this.proxyToSource[h.key][n.id]:[h];if(!a)continue;const o=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,a,t,n),f=n?n.id:null),i.renderLayer(i,n,t,o)}this.renderedToTile?(d.dirty=!0,l.push(a.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let i=-1,r=t;for(let n=0;n<t;++n)this._style.isLayerDraped(e._mergedLayers[e.order[n]])?i=Math.max(i,n):r=Math.min(r,n);return r>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,a=1<<n.overscaledZ,{x:o,y:s}=n.canonical,l=o/a,c=(o+1)/a,h=s/a,u=(s+1)/a;return{minx:l,miny:h,maxx:c,maxy:u,t:r.dem.tree.raycastRoot(l,h,c,u,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.T(t,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const a=t.createFramebuffer(r[0],r[1],!0,null);return a.colorAttachment.set(n.texture),a.depthAttachment=new ie(t,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],i=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Ft){t=!0;break}if(!t)return;const i={};for(let r=0;r<this._style.order.length;++r){const t=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(t);if(n&&!i[n.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.Z){i[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof Lt){e=!0;break}if(!e)return;const t={};for(let i=0;i<this._style.order.length;++i){const e=this._style._mergedLayers[this._style.order[i]],r=this._style.getLayerSourceCache(e);if(!r||t[r.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const n=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=ki(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,i=t.length;if(0===i)return;const r=[];this._pendingGroundEffectLayers=[];let n,a=0,o=this._style._mergedLayers[t[a]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++a<i;)o=this._style._mergedLayers[t[a]];for(;a<i;++a){const e=this._style._mergedLayers[t[a]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=a):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(a),void 0!==n&&(r.push({start:n,end:a-1}),n=void 0)))}if(void 0!==n&&r.push({start:n,end:a-1}),0!==r.length){const t=r[r.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const r=Object.values(e[i]);t.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let a=i.length-1;a>=0;a--){const n=i[a];if(t.getTileByID(n.key),void 0!==t.proxyCachedFBO[n.key]){const i=e[n.key],a=this.proxyToSource[n.key];let o=0;for(const e in a){const t=a[e],n=i[e];if(!n||n.length!==t.length||t.some(((t,i)=>t!==n[i]||r[e]&&r[e].hasOwnProperty(t.key)))){o=-1;break}++o}for(const e in t.proxyCachedFBO[n.key])t.renderCache[t.proxyCachedFBO[n.key][e]].dirty=o<0||o!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const a of n)for(const e of i){if(t.proxyCachedFBO[e.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][a.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,a=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let o;if(i.isTileClipped())o=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.ah.disabled}_renderTileClippingMasks(t,i){const r=this.painter,n=this.painter.context,a=n.gl;r._tileClippingMaskIDs={},n.setColorMode(e.a.disabled),n.setDepthMode(e.af.disabled);const o=r.getOrCreateProgram("clippingMask");for(const s of t){const t=r._tileClippingMaskIDs[s.key]=--i;o.draw(r,a.TRIANGLES,e.af.disabled,new e.ah({func:a.ALWAYS,mask:0},t,255,a.KEEP,a.KEEP,a.REPLACE),e.a.disabled,e.ag.disabled,Ci(s.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.aB.transformMat4(r,r,i.pixelMatrixInverse),e.aB.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,a=e.ay(1,i.center.lat),o=[n[0],n[1],n[2]/a,0],s=e.$.subtract([],r.slice(0,3),o);e.$.normalize(s,s);const l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.$.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}_setupProxiedCoordsForOrtho(t,i,r){if(t.getSource()instanceof e.bo)return this._setupProxiedCoordsForImageSource(t,i,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords;for(let e=0;e<a.length;e++){const i=a[e],o=this._findTileCoveringTileID(i,t);if(o){const e=this._createProxiedId(i,o,r[i.key]&&r[i.key][t.id]);n.push(e),this.proxyToSource[i.key][t.id]=[e]}}let o=!1;const s=new Set;for(let e=0;e<i.length;e++){const a=t.getTile(i[e]);if(!a||!a.hasData())continue;const l=this._findTileCoveringTileID(a.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==a.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,a,r[l.tileID.key]&&r[l.tileID.key][t.id]);e?e.splice(e.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];const c=this.proxyToSource[l.tileID.key][t.id];s.has(c)||s.add(c),n.push(i),o=!0}}if(this._sourceTilesOverlap[t.id]=o,o&&this._debugParams.sortTilesHiZFirst)for(const e of s)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=o.tileID;if(!s)return;const l=new e.P(s.x,s.y)._div(1<<s.z),c=o.coordinates.map(e._.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),h=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),a=e.a4/(1<<t.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),s=i.canonical.y/(1<<i.canonical.z);return r+a<o+c.min.x||r>o+c.max.x||n+a<s+c.min.y||n>s+c.max.y};for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<i.length;e++){const a=t.getTile(i[e]);if(!a||!a.hasData())continue;if(h(o,a.tileID))continue;const s=this._createProxiedId(o,a,r[o.key]&&r[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(s):this.proxyToSource[o.key][t.id]=[s],n.push(s)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let a,o,s;n=e.ae.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(a=e.a4>>r,o=a*((i.tileID.canonical.x<<r)-t.canonical.x+l),s=a*((i.tileID.canonical.y<<r)-t.canonical.y)):(a=e.a4<<-r,o=e.a4*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),s=e.a4*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.ae.ortho(n,0,a,0,a,0,1),e.ae.translate(n,n,[o,s,0])}return new Ri(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],a=n[t.key];if(r=a?i.getTileByID(a):null,r&&r.hasData()||null===a)return r;let o=r?r.tileID:t,s=o.overscaledZ;const l=i.getSource().minzoom,c=[];if(!a){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,i.transform.tileZoom),o=new e.aQ(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(s=n,o=new e.aQ(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}o.key!==t.key&&(c.push(o.key),r=i.getTile(o))}const h=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&h(r.tileID.key);const e=o.calculateScaledKey(s);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):r=i.getTileByID(t)}return h(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}}function Li(t,i,r){const n=function(t,i,r){const n=e.$.dot(i,t),a=e.$.dot(r,[.2126,.7152,.0722]),o=(e,t,i)=>(1-i)*e+i*t,s=o(1-.3*Math.min(a,1),1,Math.min(n+1,1));return o(.92,1,Math.asin(e.au(i[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],i),a=[0,0,0];e.$.scale(a,r.slice(0,3),n);const o=[0,0,0];e.$.scale(o,i.slice(0,3),t[2]);const s=[0,0,0];return e.$.add(s,a,o),e.ba(s)}const Fi=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Bi=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Oi{static cacheKey(e,t,i,r){let n=`${t}${r?r.cacheKey:""}`;for(const a of i)e.usedDefines.includes(a)&&(n+=`/${a}`);return n}constructor(t,i,r,n,a,o){const s=t.gl;this.program=s.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...o];const l=n?n.getBinderAttributes():[],c=(r.staticAttributes||[]).concat(l);let h=n?n.defines():[];h=h.concat(o.map((e=>`#define ${e}`)));const u="#version 300 es\n";let d=u+h.concat("precision mediump float;",Et,St.fragmentSource).join("\n");for(const e of r.fragmentIncludes)d+=`\n${bt[e]}`;d+=`\n${r.fragmentSource}`;let p=u+h.concat("precision highp float;",Et,St.vertexSource).join("\n");for(const e of r.vertexIncludes)p+=`\n${bt[e]}`;p+=`\n${r.vertexSource}`;const f=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f);const m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(f),this.fixedUniforms=a(t),this.binderUniforms=n?n.getUniforms(t):[],(o.includes("TERRAIN")||-1!==i.indexOf("symbol")||-1!==i.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.a8(t),u_dem_prev:new e.a8(t),u_dem_tl:new e.a9(t),u_dem_scale:new e.ab(t),u_dem_tl_prev:new e.a9(t),u_dem_scale_prev:new e.ab(t),u_dem_size:new e.ab(t),u_dem_lerp:new e.ab(t),u_exaggeration:new e.ab(t),u_depth:new e.a8(t),u_depth_size_inv:new e.a9(t),u_depth_range_unpack:new e.a9(t),u_occluder_half_size:new e.ab(t),u_occlusion_depth_offset:new e.ab(t),u_meter_to_dem:new e.ab(t),u_label_plane_matrix_inv:new e.a7(t)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ar(t),u_tile_tr_up:new e.ar(t),u_tile_br_up:new e.ar(t),u_tile_bl_up:new e.ar(t),u_tile_up_scale:new e.ab(t)}))(t)),o.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.a7(t),u_fog_range:new e.a9(t),u_fog_color:new e.at(t),u_fog_horizon_blend:new e.ab(t),u_fog_vertical_limit:new e.a9(t),u_fog_temporal_offset:new e.ab(t),u_frustum_tl:new e.ar(t),u_frustum_tr:new e.ar(t),u_frustum_br:new e.ar(t),u_frustum_bl:new e.ar(t),u_globe_pos:new e.ar(t),u_globe_radius:new e.ab(t),u_globe_transition:new e.ab(t),u_is_globe:new e.a8(t),u_viewport:new e.a9(t)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.at(t)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ar(t),u_lighting_directional_dir:new e.ar(t),u_lighting_directional_color:new e.ar(t),u_ground_radiance:new e.ar(t)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.a7(t),u_light_matrix_1:new e.a7(t),u_fade_range:new e.a9(t),u_shadow_normal_offset:new e.ar(t),u_shadow_intensity:new e.ab(t),u_shadow_texel_size:new e.ab(t),u_shadow_map_resolution:new e.ab(t),u_shadow_direction:new e.ar(t),u_shadow_bias:new e.ar(t),u_shadowmap_0:new e.a8(t),u_shadowmap_1:new e.a8(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const r in t)i[r].set(this.program,r,t[r])}_drawDebugWireframe(t,i,r,n,a,o,s,l,c,h){const u=t.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const d=t.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||t._terrain&&t._terrain.renderingToTexture||!Fi.includes(this.name))||!(!u.layers3D||!Bi.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,a,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(e,t,i)=>{if(t[e]&&i[e])for(const r in t[e])i[e][r]&&i[e][r].set(i.program,r,t[e][r].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,s,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),f.bind(),d.setColorMode(new e.a([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.C.transparent,[!0,!0,!0,!1])),d.setDepthMode(new e.af(i.func===p.LESS?p.LEQUAL:i.func,e.af.ReadOnly,i.range)),d.setStencilMode(e.ah.disabled);const y=3*o.primitiveLength*2,x=3*o.primitiveOffset*2*2;h&&h>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,x,h):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,x),a.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(r),d.setColorMode(n)}draw(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(i),g.setStencilMode(r),g.setColorMode(n),g.setCullFace(a);for(const v of Object.keys(this.fixedUniforms))this.fixedUniforms[v].set(this.program,v,o[v]);p&&p.setUniforms(this.program,g,this.binderUniforms,u,{zoom:d});const y={[_.POINTS]:1,[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t],x=m&&m>0?1:void 0;for(const v of h.get()){const a=v.vaos||(v.vaos={});(a[s]||(a[s]=new Mt)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,v.vertexOffset,f||[],x),m&&m>1?_.drawElementsInstanced(t,v.primitiveLength*y,_.UNSIGNED_SHORT,v.primitiveOffset*y*2,m):c?_.drawElements(t,v.primitiveLength*y,_.UNSIGNED_SHORT,v.primitiveOffset*y*2):_.drawArrays(t,v.vertexOffset,v.vertexLength),t===_.TRIANGLES&&c&&this._drawDebugWireframe(e,i,r,n,c,v,u,d,p,m)}}}function Ni(t,i){const r=Math.pow(2,i.tileID.overscaledZ),n=i.tileSize*Math.pow(2,t.transform.tileZoom)/r,a=n*(i.tileID.canonical.x+i.tileID.wrap*r),o=n*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.bD(i,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,o>>16],u_pixel_coord_lower:[65535&a,65535&o]}}const Vi=e.ae.create(),ji=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y)=>{const x=i.style.light,v=x.properties.get("position"),b=[v.x,v.y,v.z],w=e.bE.create();"viewport"===x.properties.get("anchor")&&(e.bE.fromRotation(w,-i.transform.angle),e.$.transformMat3(b,b,w));const S=x.properties.get("color"),E=i.transform,T={u_matrix:t,u_lightpos:b,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:o,u_alignment:s,u_width_scale:l,u_flood_light_color:f,u_vertical_scale:m,u_flood_light_intensity:g,u_ground_shadow_factor:_,u_emissive_strength:y};return"globe"===E.projection.name&&(T.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],T.u_zoom_transition=u,T.u_inv_rot_matrix=p,T.u_merc_center=d,T.u_up_dir=E.projection.upVector(new e.aO(0,0,0),d[0]*e.a4,d[1]*e.a4),T.u_height_lift=h),T},Ui=(e,t,i,r,n)=>({u_matrix:e,u_edge_radius:t,u_alignment:i,u_width_scale:r,u_vertical_scale:n}),Gi=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g)=>{const _=ji(t,i,r,n,a,o,s,l,c,u,d,p,f,m,g,1,[0,0,0],0),y={u_height_factor:-Math.pow(2,c.overscaledZ)/h.tileSize/8};return e.Q(_,Ni(i,h),y)},$i=(e,t)=>({u_matrix:e,u_emissive_strength:t}),qi=(t,i,r,n)=>e.Q($i(t,i),Ni(r,n)),Hi=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),Wi=(t,i,r,n,a)=>e.Q(qi(t,i,r,n),{u_world:a}),Zi=(t,i,r,n)=>{const a=e.a4/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/a,i.pixelsToGLUnits[1]/a]}},Xi=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return{u_matrix:e,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:i}},Yi=e.ae.create(),Ji=(t,i,r,n,a,o,s)=>{const l=t.transform,c="globe"===l.projection.name,h=c?e.bF(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:e.bD(r,1,o),u={u_matrix:i.projMatrix,u_extrude_scale:h,u_intensity:s,u_inv_rot_matrix:Yi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){u.u_inv_rot_matrix=n,u.u_merc_center=a,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.a2(l.zoom);const t=a[0]*e.a4,r=a[1]*e.a4;u.u_up_dir=l.projection.upVector(new e.aO(0,0,0),t,r)}return u};function Qi(e,t,i){let[r,n,a,o]=t,[s,l]=i;if(s===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-s));return[r*c,n*c,a*c,o*c]}function Ki(e,t,i){let[r,n]=i;return r===n?0:.5/e+(t-r)*(e-1)/(e*(n-r))}const er=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x,v,b)=>({u_matrix:t,u_normalize_matrix:i,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:a,u_tl_parent:o,u_scale_parent:h,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:e.bG(d.paint.get("raster-saturation")),u_contrast_factor:e.bH(d.paint.get("raster-contrast")),u_spin_weights:tr(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Qi(e.bI,g,y),u_colorization_offset:Ki(e.bI,_,y),u_color_ramp:m,u_texture_offset:[v/(x+2*v),x/(x+2*v)],u_texture_res:[x+2*v,x+2*v],u_emissive_strength:b});function tr(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const ir=.05,rr=(e,t,i,r,n,a,o,s,l,c,h,u)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:a,u_scale_parent:c,u_fade_t:h.mix,u_opacity:h.opacity,u_image0:0,u_image1:1,u_raster_elevation:u,u_zoom_transition:o,u_merc_center:s,u_cutoff_params:l}),nr=(e,t,i,r,n,a,o,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:r,u_color_ramp:a,u_velocity_res:n,u_max_speed:o,u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[ir,ir]}),ar=(e,t,i,r,n,a,o,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:r,u_max_speed:n,u_speed_factor:a,u_reset_rate:o,u_rand_seed:Math.random(),u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[ir,ir]}),or=e.ae.create(),sr=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y)=>{const x=a.transform,v={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:x.getCameraToCenterDistance(g),u_rotate_symbol:+r,u_aspect_ratio:x.width/x.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:h,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:or,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:or,u_up_vector:[0,-1,0],u_color_adj_mat:_,u_icon_transition:y||0};return"globe"===g.name&&(v.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],v.u_zoom_transition=d,v.u_inv_rot_matrix=f,v.u_merc_center=p,v.u_camera_forward=x._camera.forward(),v.u_ecef_origin=e.bJ(x.globeMatrix,u.toUnwrapped()),v.u_tile_matrix=Float32Array.from(x.globeMatrix),v.u_up_vector=m),v},lr=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_)=>e.Q(sr(t,i,r,n,a,o,s,l,c,h,d,p,f,m,g,_),{u_gamma_scale:n?a.transform.getCameraToCenterDistance(_)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:e.e.devicePixelRatio,u_is_halo:+u,undefined:void 0}),cr=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g)=>e.Q(lr(t,i,r,n,a,o,s,l,!0,c,!0,u,d,p,f,m,g),{u_texsize_icon:h,u_texture_icon:1}),hr=(e,t,i,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:r}),ur=(t,i,r,n,a,o,s,l)=>e.Q(function(t,i,r,n,a){const{width:o,height:s}=n.imageManager.getPixelSize(i),l=Math.pow(2,a.tileID.overscaledZ),c=a.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(a.tileID.canonical.x+a.tileID.wrap*l),u=c*a.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[o,s],u_pattern_size:r.displaySize,u_tile_units_to_pixels:1/e.bD(a,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,u>>16],u_pixel_coord_lower:[65535&h,65535&u]}}(0,o,s,n,l),{u_matrix:t,u_emissive_strength:i,u_opacity:r}),dr=new Float32Array(e.ae.identity([])),pr=function(t,i,r,n,a,o,s,l,c,h,u,d,p){let f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],m=arguments.length>14?arguments[14]:void 0;const g=a.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],x=e.bE.create();"viewport"===g.properties.get("anchor")&&(e.bE.fromRotation(x,-a.transform.angle),e.$.transformMat3(y,y,x));const v="MASK"===u.alphaMode,b=g.properties.get("color").toRenderColor(null),w=p.paint.get("model-ambient-occlusion-intensity"),S=p.paint.get("model-color").constantOr(e.C.white).toRenderColor(null),E=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:i,u_normal_matrix:r,u_node_matrix:n||dr,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:f,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+v,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:c,u_roughnessFactor:h,u_baseColorTexture:ui.BaseColor,u_metallicRoughnessTexture:ui.MetallicRoughness,u_normalTexture:ui.Normal,u_occlusionTexture:ui.Occlusion,u_emissionTexture:ui.Emission,u_lutTexture:ui.LUT,u_color_mix:[S.r,S.g,S.b,E],u_aoIntensity:w,u_emissive_strength:d,u_occlusionTextureTransform:m||[0,0,0,0]}},fr=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:dr}},mr={fillExtrusion:t=>({u_matrix:new e.a7(t),u_lightpos:new e.ar(t),u_lightintensity:new e.ab(t),u_lightcolor:new e.ar(t),u_vertical_gradient:new e.ab(t),u_opacity:new e.ab(t),u_edge_radius:new e.ab(t),u_alignment:new e.ab(t),u_width_scale:new e.ab(t),u_ao:new e.a9(t),u_tile_id:new e.ar(t),u_zoom_transition:new e.ab(t),u_inv_rot_matrix:new e.a7(t),u_merc_center:new e.a9(t),u_up_dir:new e.ar(t),u_height_lift:new e.ab(t),u_flood_light_color:new e.ar(t),u_vertical_scale:new e.ab(t),u_flood_light_intensity:new e.ab(t),u_ground_shadow_factor:new e.ar(t),u_emissive_strength:new e.ab(t)}),fillExtrusionDepth:t=>({u_matrix:new e.a7(t),u_edge_radius:new e.ab(t),u_alignment:new e.ab(t),u_width_scale:new e.ab(t),u_vertical_scale:new e.ab(t)}),fillExtrusionPattern:t=>({u_matrix:new e.a7(t),u_lightpos:new e.ar(t),u_lightintensity:new e.ab(t),u_lightcolor:new e.ar(t),u_vertical_gradient:new e.ab(t),u_height_factor:new e.ab(t),u_edge_radius:new e.ab(t),u_alignment:new e.ab(t),u_width_scale:new e.ab(t),u_ao:new e.a9(t),u_tile_id:new e.ar(t),u_zoom_transition:new e.ab(t),u_inv_rot_matrix:new e.a7(t),u_merc_center:new e.a9(t),u_up_dir:new e.ar(t),u_height_lift:new e.ab(t),u_image:new e.a8(t),u_texsize:new e.a9(t),u_pixel_coord_upper:new e.a9(t),u_pixel_coord_lower:new e.a9(t),u_tile_units_to_pixels:new e.ab(t),u_opacity:new e.ab(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.a7(t),u_opacity:new e.ab(t),u_ao_pass:new e.ab(t),u_meter_to_tile:new e.ab(t),u_ao:new e.a9(t),u_flood_light_intensity:new e.ab(t),u_flood_light_color:new e.ar(t),u_attenuation:new e.ab(t),u_edge_radius:new e.ab(t),u_fb:new e.a8(t),u_fb_size:new e.ab(t)}),fill:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t)}),fillPattern:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t),u_image:new e.a8(t),u_texsize:new e.a9(t),u_pixel_coord_upper:new e.a9(t),u_pixel_coord_lower:new e.a9(t),u_tile_units_to_pixels:new e.ab(t)}),fillOutline:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t),u_world:new e.a9(t)}),fillOutlinePattern:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t),u_world:new e.a9(t),u_image:new e.a8(t),u_texsize:new e.a9(t),u_pixel_coord_upper:new e.a9(t),u_pixel_coord_lower:new e.a9(t),u_tile_units_to_pixels:new e.ab(t)}),circle:e.bK,collisionBox:t=>({u_matrix:new e.a7(t),u_camera_to_center_distance:new e.ab(t),u_extrude_scale:new e.a9(t)}),collisionCircle:t=>({u_matrix:new e.a7(t),u_inv_matrix:new e.a7(t),u_camera_to_center_distance:new e.ab(t),u_viewport_size:new e.a9(t)}),debug:t=>({u_color:new e.aa(t),u_matrix:new e.a7(t),u_overlay:new e.a8(t),u_overlay_scale:new e.ab(t)}),clippingMask:t=>({u_matrix:new e.a7(t)}),heatmap:t=>({u_extrude_scale:new e.ab(t),u_intensity:new e.ab(t),u_matrix:new e.a7(t),u_inv_rot_matrix:new e.a7(t),u_merc_center:new e.a9(t),u_tile_id:new e.ar(t),u_zoom_transition:new e.ab(t),u_up_dir:new e.ar(t)}),heatmapTexture:t=>({u_image:new e.a8(t),u_color_ramp:new e.a8(t),u_opacity:new e.ab(t)}),hillshade:t=>({u_matrix:new e.a7(t),u_image:new e.a8(t),u_latrange:new e.a9(t),u_light:new e.a9(t),u_shadow:new e.aa(t),u_highlight:new e.aa(t),u_emissive_strength:new e.ab(t),u_accent:new e.aa(t)}),hillshadePrepare:t=>({u_matrix:new e.a7(t),u_image:new e.a8(t),u_dimension:new e.a9(t),u_zoom:new e.ab(t)}),line:e.bL,linePattern:e.bM,raster:t=>({u_matrix:new e.a7(t),u_normalize_matrix:new e.a7(t),u_globe_matrix:new e.a7(t),u_merc_matrix:new e.a7(t),u_grid_matrix:new e.as(t),u_tl_parent:new e.a9(t),u_scale_parent:new e.ab(t),u_fade_t:new e.ab(t),u_opacity:new e.ab(t),u_image0:new e.a8(t),u_image1:new e.a8(t),u_brightness_low:new e.ab(t),u_brightness_high:new e.ab(t),u_saturation_factor:new e.ab(t),u_contrast_factor:new e.ab(t),u_spin_weights:new e.ar(t),u_perspective_transform:new e.a9(t),u_raster_elevation:new e.ab(t),u_zoom_transition:new e.ab(t),u_merc_center:new e.a9(t),u_cutoff_params:new e.at(t),u_colorization_mix:new e.at(t),u_colorization_offset:new e.ab(t),u_color_ramp:new e.a8(t),u_texture_offset:new e.a9(t),u_texture_res:new e.a9(t),u_emissive_strength:new e.ab(t)}),rasterParticle:t=>({u_matrix:new e.a7(t),u_normalize_matrix:new e.a7(t),u_globe_matrix:new e.a7(t),u_merc_matrix:new e.a7(t),u_grid_matrix:new e.as(t),u_tl_parent:new e.a9(t),u_scale_parent:new e.ab(t),u_fade_t:new e.ab(t),u_opacity:new e.ab(t),u_image0:new e.a8(t),u_image1:new e.a8(t),u_raster_elevation:new e.ab(t),u_zoom_transition:new e.ab(t),u_merc_center:new e.a9(t),u_cutoff_params:new e.at(t)}),rasterParticleTexture:t=>({u_texture:new e.a8(t),u_opacity:new e.ab(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.a8(t),u_particle_texture_side_len:new e.ab(t),u_tile_offset:new e.a9(t),u_velocity:new e.a8(t),u_color_ramp:new e.a8(t),u_velocity_res:new e.a9(t),u_max_speed:new e.ab(t),u_uv_offset:new e.a9(t),u_data_scale:new e.a9(t),u_data_offset:new e.ab(t),u_particle_pos_scale:new e.ab(t),u_particle_pos_offset:new e.a9(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.a8(t),u_particle_texture_side_len:new e.ab(t),u_velocity:new e.a8(t),u_velocity_res:new e.a9(t),u_max_speed:new e.ab(t),u_speed_factor:new e.ab(t),u_reset_rate:new e.ab(t),u_rand_seed:new e.ab(t),u_uv_offset:new e.a9(t),u_data_scale:new e.a9(t),u_data_offset:new e.ab(t),u_particle_pos_scale:new e.ab(t),u_particle_pos_offset:new e.a9(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.a8(t),u_is_size_feature_constant:new e.a8(t),u_size_t:new e.ab(t),u_size:new e.ab(t),u_camera_to_center_distance:new e.ab(t),u_rotate_symbol:new e.a8(t),u_aspect_ratio:new e.ab(t),u_fade_change:new e.ab(t),u_matrix:new e.a7(t),u_label_plane_matrix:new e.a7(t),u_coord_matrix:new e.a7(t),u_is_text:new e.a8(t),u_pitch_with_map:new e.a8(t),u_texsize:new e.a9(t),u_tile_id:new e.ar(t),u_zoom_transition:new e.ab(t),u_inv_rot_matrix:new e.a7(t),u_merc_center:new e.a9(t),u_camera_forward:new e.ar(t),u_tile_matrix:new e.a7(t),u_up_vector:new e.ar(t),u_ecef_origin:new e.ar(t),u_texture:new e.a8(t),u_icon_transition:new e.ab(t),u_color_adj_mat:new e.a7(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.a8(t),u_is_size_feature_constant:new e.a8(t),u_size_t:new e.ab(t),u_size:new e.ab(t),u_camera_to_center_distance:new e.ab(t),u_rotate_symbol:new e.a8(t),u_aspect_ratio:new e.ab(t),u_fade_change:new e.ab(t),u_matrix:new e.a7(t),u_label_plane_matrix:new e.a7(t),u_coord_matrix:new e.a7(t),u_is_text:new e.a8(t),u_pitch_with_map:new e.a8(t),u_texsize:new e.a9(t),u_texture:new e.a8(t),u_gamma_scale:new e.ab(t),u_device_pixel_ratio:new e.ab(t),u_tile_id:new e.ar(t),u_zoom_transition:new e.ab(t),u_inv_rot_matrix:new e.a7(t),u_merc_center:new e.a9(t),u_camera_forward:new e.ar(t),u_tile_matrix:new e.a7(t),u_up_vector:new e.ar(t),u_ecef_origin:new e.ar(t),u_is_halo:new e.a8(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.a8(t),u_is_size_feature_constant:new e.a8(t),u_size_t:new e.ab(t),u_size:new e.ab(t),u_camera_to_center_distance:new e.ab(t),u_rotate_symbol:new e.a8(t),u_aspect_ratio:new e.ab(t),u_fade_change:new e.ab(t),u_matrix:new e.a7(t),u_label_plane_matrix:new e.a7(t),u_coord_matrix:new e.a7(t),u_is_text:new e.a8(t),u_pitch_with_map:new e.a8(t),u_texsize:new e.a9(t),u_texsize_icon:new e.a9(t),u_texture:new e.a8(t),u_texture_icon:new e.a8(t),u_gamma_scale:new e.ab(t),u_device_pixel_ratio:new e.ab(t),u_is_halo:new e.a8(t)}),background:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t),u_opacity:new e.ab(t),u_color:new e.aa(t)}),backgroundPattern:t=>({u_matrix:new e.a7(t),u_emissive_strength:new e.ab(t),u_opacity:new e.ab(t),u_image:new e.a8(t),u_pattern_tl:new e.a9(t),u_pattern_br:new e.a9(t),u_texsize:new e.a9(t),u_pattern_size:new e.a9(t),u_pixel_coord_upper:new e.a9(t),u_pixel_coord_lower:new e.a9(t),u_tile_units_to_pixels:new e.ab(t)}),terrainRaster:t=>({u_matrix:new e.a7(t),u_image0:new e.a8(t),u_skirt_height:new e.ab(t),u_ground_shadow_factor:new e.ar(t)}),skybox:t=>({u_matrix:new e.a7(t),u_sun_direction:new e.ar(t),u_cubemap:new e.a8(t),u_opacity:new e.ab(t),u_temporal_offset:new e.ab(t)}),skyboxGradient:t=>({u_matrix:new e.a7(t),u_color_ramp:new e.a8(t),u_center_direction:new e.ar(t),u_radius:new e.ab(t),u_opacity:new e.ab(t),u_temporal_offset:new e.ab(t)}),skyboxCapture:t=>({u_matrix_3f:new e.as(t),u_sun_direction:new e.ar(t),u_sun_intensity:new e.ab(t),u_color_tint_r:new e.at(t),u_color_tint_m:new e.at(t),u_luminance:new e.ab(t)}),globeRaster:t=>({u_proj_matrix:new e.a7(t),u_globe_matrix:new e.a7(t),u_normalize_matrix:new e.a7(t),u_merc_matrix:new e.a7(t),u_zoom_transition:new e.ab(t),u_merc_center:new e.a9(t),u_image0:new e.a8(t),u_grid_matrix:new e.as(t),u_skirt_height:new e.ab(t),u_far_z_cutoff:new e.ab(t),u_frustum_tl:new e.ar(t),u_frustum_tr:new e.ar(t),u_frustum_br:new e.ar(t),u_frustum_bl:new e.ar(t),u_globe_pos:new e.ar(t),u_globe_radius:new e.ab(t),u_viewport:new e.a9(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ar(t),u_frustum_tr:new e.ar(t),u_frustum_br:new e.ar(t),u_frustum_bl:new e.ar(t),u_horizon:new e.ab(t),u_transition:new e.ab(t),u_fadeout_range:new e.ab(t),u_color:new e.at(t),u_high_color:new e.at(t),u_space_color:new e.at(t),u_temporal_offset:new e.ab(t),u_horizon_angle:new e.ab(t)}),model:t=>({u_matrix:new e.a7(t),u_lighting_matrix:new e.a7(t),u_normal_matrix:new e.a7(t),u_node_matrix:new e.a7(t),u_lightpos:new e.ar(t),u_lightintensity:new e.ab(t),u_lightcolor:new e.ar(t),u_camera_pos:new e.ar(t),u_opacity:new e.ab(t),u_baseColorFactor:new e.at(t),u_emissiveFactor:new e.at(t),u_metallicFactor:new e.ab(t),u_roughnessFactor:new e.ab(t),u_baseTextureIsAlpha:new e.a8(t),u_alphaMask:new e.a8(t),u_alphaCutoff:new e.ab(t),u_baseColorTexture:new e.a8(t),u_metallicRoughnessTexture:new e.a8(t),u_normalTexture:new e.a8(t),u_occlusionTexture:new e.a8(t),u_emissionTexture:new e.a8(t),u_lutTexture:new e.a8(t),u_color_mix:new e.at(t),u_aoIntensity:new e.ab(t),u_emissive_strength:new e.ab(t),u_occlusionTextureTransform:new e.at(t)}),modelDepth:t=>({u_matrix:new e.a7(t),u_instance:new e.a7(t),u_node_matrix:new e.a7(t)}),groundShadow:t=>({u_matrix:new e.a7(t),u_ground_shadow_factor:new e.ar(t)}),stars:t=>({u_matrix:new e.a7(t),u_up:new e.ar(t),u_right:new e.ar(t),u_intensity_multiplier:new e.ab(t)}),occlusion:t=>({u_matrix:new e.a7(t),u_anchorPos:new e.ar(t),u_screenSizePx:new e.a9(t),u_occluderSizePx:new e.a9(t),u_color:new e.at(t)})};function gr(t,i,r){const n=i.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.ae.multiply(new Float32Array(16),t.projMatrix,n)}function _r(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),gr(r,t.getProjection(),e)}function yr(e,t,i){return t.name===i.projection.name?e.projMatrix:gr(i,t,e)}let xr;function vr(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=t.transform,u=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let b=0;b<n.length;b++){const l=n[b],m=i.getTile(l),g=m.getBucket(r);if(!g)continue;const _=_r(l,g,h);let y=_;0===a[0]&&0===a[1]||(y=t.translatePosMatrix(_,m,a,o));const x=s?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const t=e.ae.create(),i=y;e.ae.mul(t,g.placementInvProjMatrix,h.glCoordMatrix),e.ae.mul(t,t,g.placementViewportMatrix),d.push({circleArray:v,circleOffset:f,transform:i,invTransform:t,projection:g.getProjection()}),p+=v.length/4,f=p}x&&(t.terrain&&t.terrain.setupElevationDraw(m,u),u.draw(t,c.LINES,e.af.disabled,e.ah.disabled,t.colorModeForRenderPass(),e.ag.disabled,Zi(y,h,m,g.getProjection()),r.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,h.zoom,null,[x.collisionVertexBuffer,x.collisionVertexBufferExt]))}if(!s||!d.length)return;const m=t.getOrCreateProgram("collisionCircle"),g=new e.bN;g.resize(4*p),g._trim();let _=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],a=e.circleArray[i+2],o=e.circleArray[i+3];g.emplace(_++,r,n,a,o,0),g.emplace(_++,r,n,a,o,1),g.emplace(_++,r,n,a,o,2),g.emplace(_++,r,n,a,o,3)}(!xr||xr.length<2*p)&&(xr=function(t){const i=2*t,r=new e.bw;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(p));const y=l.createIndexBuffer(xr,!0),x=l.createVertexBuffer(g,e.bO.members,!0);for(const b of d){const i={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(v=h).getCameraToCenterDistance(b.projection),u_viewport_size:[v.width,v.height]};m.draw(t,c.TRIANGLES,e.af.disabled,e.ah.disabled,t.colorModeForRenderPass(),e.ag.disabled,i,r.id,x,y,e.b.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,h.zoom)}var v;x.destroy(),y.destroy()}const br=e.ae.create();function wr(t){const i=t._camera.getWorldToCamera(t.worldSize,1),r=e.ae.multiply([],i,t.globeMatrix);e.ae.invert(r,r);const n=[0,0,0],a=[0,1,0,0];return e.aB.transformMat4(a,a,r),n[0]=a[0],n[1]=a[1],n[2]=a[2],e.$.normalize(n,n),n}function Sr(t,i){let{width:r,height:n,anchor:a,textOffset:o,textScale:s}=t;const{horizontalAlign:l,verticalAlign:c}=e.bS(a),h=-(l-.5)*r,u=-(c-.5)*n,d=e.bR(a,o);return new e.P((h/s+d[0])*i,(u/s+d[1])*i)}function Er(t,i,r,n,a,o,s,l,c,h,u){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=t.getProjection(),_=yr(l,g,o),y=o.elevation,x=g.upVectorScale(l.canonical,o.center.lat,o.worldSize).metersToTile;p.clear();for(let v=0;v<d.length;v++){const f=d.get(v),{tileAnchorX:b,tileAnchorY:w,numGlyphs:S}=f,E=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:n[f.crossTileID];if(E){let n=0,d=0,v=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,i,r]=g.upVector(l.canonical,b,w);n=e*t*x,d=e*i*x,v=e*r*x}let[T,C,k,M]=Yt(f.projectedAnchorX+n,f.projectedAnchorY+d,f.projectedAnchorZ+v,r?_:s);const A=Jt(o.getCameraToCenterDistance(g),M);let P=a.evaluateSizeForFeature(t.textSizeData,h,f)*A/e.bP;r&&(P*=t.tilePixelRatio/c);const I=Sr(E,P);r?(({x:T,y:C,z:k}=g.projectTilePoint(b+I.x,w+I.y,l.canonical)),[T,C,k]=Yt(T+n,C+d,k+v,s)):(i&&I._rotate(-o.angle),T+=I.x,C+=I.y,k=0);const D=t.allowVerticalPlacement&&f.placedOrientation===e.aF.vertical?Math.PI/2:0;for(let t=0;t<S;t++)e.aI(p,T,C,k,D);u&&f.associatedIconIndex>=0&&(m[f.associatedIconIndex]={x:T,y:C,z:k,angle:D})}else oi(S,p)}if(u){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t),{numGlyphs:n}=r,a=m[t];if(r.hidden||!a)oi(n,f);else{const{x:t,y:i,z:r,angle:o}=a;for(let a=0;a<n;a++)e.aI(f,t,i,r,o)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Tr(t,i,r,n,a,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=r.paint.get("icon-translate"),c=r.paint.get("text-translate"),h=r.paint.get("icon-translate-anchor"),u=r.paint.get("text-translate-anchor"),d=r.layout.get("icon-rotation-alignment"),p=r.layout.get("text-rotation-alignment"),f=r.layout.get("icon-pitch-alignment"),m=r.layout.get("text-pitch-alignment"),g=r.layout.get("icon-keep-upright"),_=r.layout.get("text-keep-upright"),y=r.paint.get("icon-color-saturation"),x=r.paint.get("icon-color-contrast"),v=r.paint.get("icon-color-brightness-min"),b=r.paint.get("icon-color-brightness-max");r.paint.get("icon-occlusion-opacity").constantOr(0),r.paint.get("text-occlusion-opacity").constantOr(0);const w=t.context,S=w.gl,E=t.transform,T="map"===d,C="map"===p,k="map"===f,M="map"===m,A=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let P=!1;const I=t.depthModeForSublayer(0,e.af.ReadOnly),D=[e.ak(E.center.lng),e.al(E.center.lat)],R=r.layout.get("text-variable-anchor"),z="globe"===E.projection.name,L=[],F=[0,-1,0];for(const B of n){const n=i.getTile(B),a=n.getBucket(r);if(!a)continue;if("mercator"===a.projection.name&&z)continue;if(a.fullyClipped)continue;const o="globe"===a.projection.name,d=o?e.a2(E.zoom):0,p=yr(B,a.getProjection(),E),f=E.calculatePixelsToTileUnitsMatrix(n),m=R&&a.hasTextData(),w=a.hasIconTextFit()&&m&&a.hasIconData(),I=a.getProjection().createInversionMatrix(E,B.canonical),O=e=>{E.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},N=()=>{const i=T&&"point"!==r.layout.get("symbol-placement"),s=[];O(s);const c=i||w,u=r.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&k&&s.push("PITCH_WITH_MAP_TERRAIN"),o&&(s.push("PROJECTION_GLOBE_VIEW"),c&&s.push("PROJECTED_POS_ON_VIEWPORT")),u>0&&s.push("ICON_TRANSITION"),a.icon.zOffsetVertexBuffer&&s.push("Z_OFFSET"),0===y&&0===x&&0===v&&1===b||s.push("COLOR_ADJUSTMENT");const m=a.icon.programConfigurations.get(r.id),_=t.getOrCreateProgram(a.sdfIcons?"symbolSDF":"symbolIcon",{config:m,defines:s});let C;const M=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],A=a.iconSizeData,P=e.aE(A,E.zoom),R=k||0!==E.pitch,L=Wt(p,n.tileID.canonical,k,T,E,a.getProjection(),f),N=Xt(p,n.tileID.canonical,k,T,E,a.getProjection(),f),V=t.translatePosMatrix(N,n,l,h,!0),j=t.translatePosMatrix(p,n,l,h),U=c?br:L,G=T&&!k&&!i;let $=F;!z&&!E.mercatorFromTransition||T||($=wr(E));const q=o?$:F;if(a.sdfIcons&&!a.iconsInText)C=lr(A.kind,P,G,k,t,j,U,V,!1,M,!0,B,d,D,I,q,a.getProjection());else{const e=r.getColorAdjustmentMatrix(y,x,v,b);C=sr(A.kind,P,G,k,t,j,U,V,!1,M,B,d,D,I,q,a.getProjection(),e,u)}const H=n.imageAtlasTexture?n.imageAtlasTexture:null,W=1!==r.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear,Z=a.sdfIcons||t.options.rotating||t.options.zooming||W||R?S.LINEAR:S.NEAREST,X=a.sdfIcons&&0!==r.paint.get("icon-halo-width").constantOr(1),Y=t.terrain&&k&&i?e.ae.invert(e.ae.create(),L):br;if(i&&a.icon){const e=E.elevation,i=e?e.getAtTileOffsetFunc(B,E.center.lat,E.worldSize,a.getProjection()):null,r=Zt(p,n.tileID.canonical,k,T,E,a.getProjection(),f);Kt(a,p,t,!1,r,N,k,g,i,B)}return{program:_,buffers:a.icon,uniformValues:C,atlasTexture:H,atlasTextureIcon:null,atlasInterpolation:Z,atlasInterpolationIcon:null,isSDF:a.sdfIcons,hasHalo:X,tile:n,labelPlaneMatrixInv:Y}},V=()=>{const i=C&&"point"!==r.layout.get("symbol-placement"),s=[],l=i||R||w;t.terrainRenderModeElevated()&&M&&s.push("PITCH_WITH_MAP_TERRAIN"),o&&(s.push("PROJECTION_GLOBE_VIEW"),l&&s.push("PROJECTED_POS_ON_VIEWPORT")),a.text.zOffsetVertexBuffer&&s.push("Z_OFFSET"),O(s);const h=a.text.programConfigurations.get(r.id),m=t.getOrCreateProgram(a.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:h,defines:s});let g,y=[0,0],x=null;const v=a.textSizeData;a.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],x=n.imageAtlasTexture?n.imageAtlasTexture:null,g=M||0!==E.pitch||t.options.rotating||t.options.zooming||"composite"===v.kind||"camera"===v.kind?S.LINEAR:S.NEAREST);const b=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],T=e.aE(v,E.zoom),k=Wt(p,n.tileID.canonical,M,C,E,a.getProjection(),f),A=Xt(p,n.tileID.canonical,M,C,E,a.getProjection(),f),P=t.translatePosMatrix(A,n,c,u,!0),L=t.translatePosMatrix(p,n,c,u),N=l?br:k,V=C&&!M&&!i;let j=F;!z&&!E.mercatorFromTransition||C||(j=wr(E));const U=o?j:F;let G;G=a.iconsInText?cr(v.kind,T,V,M,t,L,N,P,b,y,B,d,D,I,U,a.getProjection()):lr(v.kind,T,V,M,t,L,N,P,!0,b,!0,B,d,D,I,U,a.getProjection());const $=n.glyphAtlasTexture?n.glyphAtlasTexture:null,q=S.LINEAR,H=0!==r.paint.get("text-halo-width").constantOr(1),W=t.terrain&&M&&i?e.ae.invert(e.ae.create(),k):br;if(i&&a.text){const e=E.elevation,i=e?e.getAtTileOffsetFunc(B,E.center.lat,E.worldSize,a.getProjection()):null,r=Zt(p,n.tileID.canonical,M,C,E,a.getProjection(),f);Kt(a,p,t,!0,r,A,M,_,i,B)}return{program:m,buffers:a.text,uniformValues:G,atlasTexture:$,atlasTextureIcon:x,atlasInterpolation:q,atlasInterpolationIcon:g,isSDF:!0,hasHalo:H,tile:n,labelPlaneMatrixInv:W}},j=a.icon.segments.get().length,U=a.text.segments.get().length,G=j&&!s.onlyText?N():null,$=U&&!s.onlyIcons?V():null,q=r.paint.get("icon-opacity").constantOr(1),H=r.paint.get("text-opacity").constantOr(1);if(A&&a.canOverlap){P=!0;const t=q&&!s.onlyText?a.icon.segments.get():[],i=H&&!s.onlyIcons?a.text.segments.get():[];for(const r of t)L.push({segments:new e.b([r]),sortKey:r.sortKey,state:G});for(const r of i)L.push({segments:new e.b([r]),sortKey:r.sortKey,state:$})}else s.onlyText||L.push({segments:q?a.icon.segments:new e.b([]),sortKey:0,state:G}),s.onlyIcons||L.push({segments:H?a.text.segments:new e.b([]),sortKey:0,state:$})}P&&L.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of L){const i=e.state;if(i)if(t.terrain?t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}):t.setupDepthForOcclusion(E.depthOcclusionForSymbolsAndCircles,i.program),w.activeTexture.set(S.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,S.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(w.activeTexture.set(S.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,S.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,i.program),i.hasHalo){const n=i.uniformValues;n.u_is_halo=1,Cr(i.buffers,e.segments,r,t,i.program,I,a,o,n,2),n.u_is_halo=0}else{if(i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Cr(i.buffers,e.segments,r,t,i.program,I,a,o,n,1)),n.u_is_halo=0}Cr(i.buffers,e.segments,r,t,i.program,I,a,o,i.uniformValues,1)}}}function Cr(t,i,r,n,a,o,s,l,c,h){const u=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];a.draw(n,n.context.gl.TRIANGLES,o,s,l,e.ag.disabled,c,r.id,t.layoutVertexBuffer,t.indexBuffer,i,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),u,h)}function kr(t,i,r,n,a,o,s){const l=t.context.gl,c=r.paint.get("fill-pattern"),h=c&&c.constantOr(1);let u,d,p,f,m;s?(d=h&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=l.LINES):(d=h?"fillPattern":"fill",u=l.TRIANGLES);for(const g of n){const n=i.getTile(g);if(h&&!n.patternsLoaded())continue;const _=n.getBucket(r);if(!_)continue;t.prepareDrawTile();const y=_.programConfigurations.get(r.id),x=t.isTileAffectedByFog(g),v=t.getOrCreateProgram(d,{config:y,overrideFog:x});h&&(t.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers());const b=c.constantOr(null);if(b&&n.imageAtlas){const e=n.imageAtlas.patternPositions[b.toString()];e&&y.setConstantPatternPositions(e)}const w=t.translatePosMatrix(g.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),S=r.paint.get("fill-emissive-strength");if(s){f=_.indexBuffer2,m=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===d&&h?Wi(w,S,t,n,e):Hi(w,S,e)}else f=_.indexBuffer,m=_.segments,p=h?qi(w,S,t,n):$i(w,S);t.uploadCommonUniforms(t.context,v,g.toUnwrapped()),v.draw(t,u,a,t.stencilModeForClipping(g),o,e.ag.disabled,p,r.id,_.layoutVertexBuffer,f,m,r.paint,t.transform.zoom,y,void 0)}}function Mr(t,i,r,n,a,o,s,l){r.resetLayerRenderingStats(t);const c=t.context,h=c.gl,u=t.transform,d=r.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),m=t.style.enable3dLights(),g=r.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=r.layout.get("fill-extrusion-edge-radius"),x=y>0&&!r.paint.get("fill-extrusion-rounded-roof"),v=x?0:y,b="globe"===u.projection.name?e.b_():0,w="globe"===u.projection.name,S=w?e.a2(u.zoom):0,E=[e.ak(u.center.lng),e.al(u.center.lat)],T=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),C=r.paint.get("fill-extrusion-flood-light-intensity"),k=r.paint.get("fill-extrusion-vertical-scale"),M=0!==r.paint.get("fill-extrusion-line-width").constantOr(1),A=di(t,r.paint.get("fill-extrusion-cutoff-fade-range")),P=r.paint.get("fill-extrusion-emissive-strength"),I=[];w&&I.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&I.push("FAUX_AO"),x&&I.push("ZERO_ROOF_RADIUS"),l&&I.push("HAS_CENTROID"),C>0&&I.push("FLOOD_LIGHT"),A.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),M&&I.push("RENDER_WALL_MODE");const D=(()=>{const t=r.paint.get("fill-extrusion-line-alignment");switch(t){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return e.w(`Unsupported value for fill-extrusion-line-alignment: ${t}`),0}})();let R;const z="shadow"===t.renderPass,L=t.shadowRenderer,F=z&&!!L;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let B=[0,0,0];if(L){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(B=xi(t.style,e,i)),R=I.concat(["SHADOWS_SINGLE_CASCADE"])}const O=F?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",N=r.getLayerRenderingStats();for(const V of n){const n=i.getTile(V),m=n.getBucket(r);if(!m||m.projection.name!==u.projection.name)continue;let g=!1;L&&(g=0===L.getMaxCascadeForTile(V.toUnwrapped()));const y=t.isTileAffectedByFog(V),x=m.programConfigurations.get(r.id),F=t.getOrCreateProgram(O,{config:x,defines:g?R:I,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(n,F,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=F.attributes.a_centroid_pos;void 0!==e&&h.vertexAttrib2f(e,0,0)}!z&&L&&L.setupShadows(n.tileID.toUnwrapped(),F,"vector-tile",n.tileID.overscaledZ),p&&(t.context.activeTexture.set(h.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),x.updatePaintBuffers());const j=d.constantOr(null);if(j&&n.imageAtlas){const e=n.imageAtlas.patternPositions[j.toString()];e&&x.setConstantPatternPositions(e)}const U=r.paint.get("fill-extrusion-vertical-gradient"),G=1/m.tileToMeter;let $;if(z&&L){if(zr(n.tileID,m,t))continue;const e=L.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());$=Ui(e,v,D,G,k)}else{const e=t.translatePosMatrix(V.expandedProjMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=u.projection.createInversionMatrix(u,V.canonical);$=p?Gi(e,t,U,f,_,v,D,G,V,n,b,S,E,i,T,k):ji(e,t,U,f,_,v,D,G,V,b,S,E,i,T,k,C,B,P)}t.uploadCommonUniforms(c,F,V.toUnwrapped(),null,A);let q=m.segments;if("mercator"===u.projection.name&&!z&&(q=m.getVisibleSegments(n.tileID,t.terrain,t.transform.getFrustum(0)),!q.get().length))continue;if(N)if(z)for(const e of q.get())N.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of q.get())N.numRenderedVerticesInTransparentPass+=e.primitiveLength;const H=[];(t.terrain||l)&&H.push(m.centroidVertexBuffer),w&&H.push(m.layoutVertexExtBuffer),M&&H.push(m.wallVertexBuffer),F.draw(t,c.gl.TRIANGLES,a,o,s,e.ag.backCCW,$,r.id,m.layoutVertexBuffer,m.indexBuffer,q,r.paint,t.transform.zoom,x,H)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function Ar(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,x){const v=t.context,b=v.gl,w=t.transform,S=t.transform.zoom,E=[],T=di(t,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===h?(E.push("CLEAR_SUBPASS"),x&&(E.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(b.TEXTURE0),x.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===h&&E.push("SDF_SUBPASS"),_&&E.push("HAS_CENTROID"),T.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const C=r.layout.get("fill-extrusion-edge-radius"),k=(e,i,n,h,y)=>{const b=i.programConfigurations.get(r.id),w=t.isTileAffectedByFog(e),k=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:E,overrideFog:w}),M=((e,t,i,r,n,a,o,s,l,c,h)=>({u_matrix:t,u_opacity:i,u_ao_pass:r?1:0,u_meter_to_tile:n,u_ao:a,u_flood_light_intensity:o,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:h}))(0,h,u,c,y,[d,p*y],f,m,g,S>=17?0:C*y,x?x.size[0]:0),A=[];_&&A.push(i.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(v,k,e.toUnwrapped(),null,T),k.draw(t,v.gl.TRIANGLES,a,o,s,l,M,r.id,i.vertexBuffer,i.indexBuffer,n,r.paint,S,b,A)};for(const M of n){const n=i.getTile(M),a=n.getBucket(r);if(!a||a.projection.name!==w.projection.name||!a.groundEffect||a.groundEffect&&!a.groundEffect.hasData())continue;const o=a.groundEffect,s=1/a.tileToMeter;{const e=t.translatePosMatrix(M.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=o.getDefaultSegment();k(M,o,i,e,s)}if(y)for(let l=0;l<4;l++){const a=e.b$[l](M),o=i.getTile(a);if(!o)continue;const c=o.getBucket(r);if(!c||c.projection.name!==w.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const h=c.groundEffect;let u,d;0===l?(u=[-e.a4,0,0],d=1):1===l?(u=[e.a4,0,0],d=0):2===l?(u=[0,-e.a4,0],d=3):(u=[0,e.a4,0],d=2);const p=h.regionSegments[d];if(!p)continue;const f=new Float32Array(16);e.ae.translate(f,M.projMatrix,u),k(M,h,p,t.translatePosMatrix(f,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),s)}}}function Pr(t,i,r,n,a,o,s){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=o?o.findDEMTileFor(r):null;if(!(l&&l.dem||s))return;const c=t=>new e.P(Math.ceil((t+e.c2)*e.c3),0),h=e=>{const t=i.getSource().minzoom,r=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(a)},n=[0,-1,1];for(const i of n){if(e.overscaledZ+i<t)continue;const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},u=[0,0,0],d=(t,i)=>(u[0]=Math.min(t.min.y,i.min.y),u[1]=Math.max(t.max.y,i.max.y),u[2]=e.a4-i.min.x>t.max.x?i.min.x-e.a4:t.max.x,u),p=(t,i)=>(u[0]=Math.min(t.min.x,i.min.x),u[1]=Math.max(t.max.x,i.max.x),u[2]=e.a4-i.min.y>t.max.y?i.min.y-e.a4:t.max.y,u),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],m=(t,i,n,a,s,c,h)=>{if(!o)return 0;const u=[[c?n:t,c?t:n,0],[c?n:i,c?i:n,0]],d=h<0?e.a4+h:h,p=[c?d:(t+i)/2,c?(t+i)/2:d,0];return 0===n&&h<0||0!==n&&h>0?o.getForTilePoints(s,[p],!0,a):u.push(p),o.getForTilePoints(r,u,!0,l),Math.max(u[0][2],u[1][2],p[2])/o.exaggeration()};for(let y=0;y<4;y++){const t=n.borderFeatureIndices[y];if(0===t.length)continue;const i=e.b$[y](r),a=h(i);if(!(a&&a instanceof e.c0))continue;if(n.borderDoneWithNeighborZ[y]===a.canonical.z)continue;0===a.centroidVertexArray.length&&a.createCentroidsBuffer();const l=o?o.findDEMTileFor(i):null;if(!(l&&l.dem||s))continue;const u=(y<2?1:5)-y,d=a.borderDoneWithNeighborZ[u]!==n.canonical.z,p=a.borderFeatureIndices[u];let x=0;if(n.canonical.z!==a.canonical.z){for(const e of t)n.showCentroid(n.featuresOnBorder[e]);if(d)for(const e of p)a.showCentroid(a.featuresOnBorder[e]);n.borderDoneWithNeighborZ[y]=a.canonical.z,a.borderDoneWithNeighborZ[u]=n.canonical.z}for(const r of t){const t=n.featuresOnBorder[r],o=n.centroidData[t.centroidDataIndex],h=t.borders[y];let d;for(;x<p.length;){d=a.featuresOnBorder[p[x]];const e=d.borders[u];if(e[1]>h[0]+3||e[0]>h[0]-3)break;a.showCentroid(d),x++}if(d&&x<p.length){const r=x;let v=0;for(;!(d.borders[u][0]>h[1]-3)&&(v++,++x!==p.length);)d=a.featuresOnBorder[p[x]];if(d=a.featuresOnBorder[p[r]],v>1){const e=d.borders[u];Math.abs(h[0]-e[0])<3&&Math.abs(h[1]-e[1])<3&&(v=1,x=r+1)}else if(0===v){n.showCentroid(t);continue}const b=a.centroidData[d.centroidDataIndex];s&&1===v&&(((g=o).flags|(_=b).flags)&e.c1?(g.flags|=e.c1,_.flags|=e.c1):(g.flags&=~e.c1,_.flags&=~e.c1));const w=t.intersectsCount()>1||d.intersectsCount()>1;if(v>1)x=r,o.centroidXY=b.centroidXY=new e.P(0,0);else if(l&&l.dem&&!w){const t=f[y](o,b),r=y%2?e.a4-1:0,n=m(t[0],Math.min(e.a4-1,t[1]),r,l,i,y<2,t[2]);o.centroidXY=b.centroidXY=c(n)}else w?o.centroidXY=b.centroidXY=new e.P(0,0):(o.centroidXY=n.encodeBorderCentroid(t),b.centroidXY=a.encodeBorderCentroid(d));n.writeCentroidToBuffer(o),a.writeCentroidToBuffer(b)}else n.showCentroid(t)}n.borderDoneWithNeighborZ[y]=a.canonical.z,a.borderDoneWithNeighborZ[u]=n.canonical.z}var g,_;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const Ir=[1,0,0],Dr=[0,1,0],Rr=[0,0,1];function zr(t,i,r){const n=r.transform,a=r.shadowRenderer;if(!a)return!0;const o=t.toUnwrapped(),s=n.tileSize*a._cascades[r.currentShadowCascade].scale;let l=i.maxHeight;if(n.elevation){const e=n.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...a.shadowDirection];c[2]=-c[2];const h=a.computeSimplifiedTileShadowVolume(o,l,s,c);if(!h)return!1;const u=[Ir,Dr,Rr,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===n.projection.name,p=n.scaleZoom(s),f=e.aM.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,p,!d),m=a.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(h.vertices,h.planes,u)||0===m.intersectsPrecise(h.vertices,h.planes,u)}function Lr(t){return[t[0]*e.c4,t[1]*e.c4,t[2]*e.c4,0]}function Fr(t,i,r,n,a,o,s,l,c){const h=n.getSource(),u=r.globeSharedBuffers;if(!u)return;let d,p,f;if(i&&(d=n.getTile(i)),h instanceof e.bo?(p=h.texture,f=e.bj(0,0,r.transform)):d&&i&&(p=d.texture,f=e.bj(i.canonical.z,i.canonical.x,r.transform)),!p||!f)return;t||(f=e.ae.scale(e.ae.create(),f,[1,-1,1]));const m=r.context,g=m.gl,_="nearest"===a.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=r.colorModeForDrapableLayerRenderPass(o),x=s.defines;x.push("GLOBE_POLES");const v=new e.af(g.LEQUAL,e.af.ReadWrite,r.depthRangeFor3D),b=Float32Array.from(r.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bh(e.bi(new e.aO(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),p.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),p.bind(_,g.CLAMP_TO_EDGE),p.useMipmap&&m.extTextureFilterAnisotropic&&r.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[S,E,T,C]=i?u.getPoleBuffers(i.canonical.z,!1):u.getPoleBuffers(0,!0),k=a.paint.get("raster-elevation");let M;t?(M=S,r.renderDefaultNorthPole=0!==k):(M=E,r.renderDefaultSouthPole=0!==k);const A=Lr(s.mix),P=((e,t,i,r,n,a,o,s,l,c,h,u,d)=>er(e,t,i,new Float32Array(16),new Float32Array(9),[0,0],r,[0,0],[0,0,0,0],1,{opacity:1,mix:0},a,[0,0]||0,s,2,c,h,u,1,0,d))(b,w,f,e.a2(r.transform.zoom),0,a,0,k,0,A,s.offset,s.range,o),I=r.getOrCreateProgram("raster",{defines:x});r.uploadCommonUniforms(m,I,null),I.draw(r,g.TRIANGLES,v,c,y,l,P,a.id,M,T,C)}function Br(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,a=t+n;return[t,i,(a-n-t)/r,(a-t)/r]}function Or(t,i,r,n){if(t)return i instanceof Mi&&t instanceof e.c5?i.getTextureDescriptor(t,r,!0):{texture:t.texture,mix:Lr(n.mix),offset:n.offset,buffer:0,tileSize:1}}function Nr(t,i,r){if(!t)return null;const n=i.getTextureDescriptor(t,r,!0);if(!n)return null;let{texture:a,mix:o,offset:s,tileSize:l,buffer:c,format:h}=n;if(!a||!h)return null;let u=!1;return"uint32"===h&&(u=!0,o[3]=0,o=Qi(e.c6,o,[0,r.paint.get("raster-particle-max-speed")]),s=Ki(e.c6,s,[0,r.paint.get("raster-particle-max-speed")])),{texture:a,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:u,scale:o,offset:s,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[h]]}}function Vr(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,a=t+n;return[t,i,(a-n-t)/r,(a-t)/r]}const jr=new e.C(1,0,0,1),Ur=new e.C(0,1,0,1),Gr=new e.C(0,0,1,1),$r=new e.C(1,0,1,1),qr=new e.C(0,1,1,1);function Hr(t,i,r,n,a,o,s){const l=t.context,c=t.transform,h=l.gl,u="globe"===c.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[];let p=e.ae.clone(r.projMatrix);if(u&&e.a2(c.zoom)>0){const t=e.c7(r.canonical,c),i=e.c8(t);p=e.ae.multiply(new Float32Array(16),c.globeMatrix,i),e.ae.multiply(p,c.projMatrix,p)}const f=e.ae.create();f[12]+=2*a/(e.e.devicePixelRatio*c.width),f[13]+=2*o/(e.e.devicePixelRatio*c.height),e.ae.multiply(p,f,p);const m=t.getOrCreateProgram("debug",{defines:d}),g=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(g,m);const _=e.af.disabled,y=e.ah.disabled,x=t.colorModeForRenderPass(),v="$debug";l.activeTexture.set(h.TEXTURE0),t.emptyTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,S=g._tileDebugSegments||t.debugSegments;if(m.draw(t,h.LINE_STRIP,_,y,x,e.ag.disabled,Xi(p,n),v,b,w,S,null,null,null,[g._globeTileDebugBorderBuffer]),s){const e=g.latestRawTileData,i=Math.floor((e&&e.byteLength||0)/1024);let n=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(n+=` => ${r.overscaledZ}`),n+=` ${g.state}`,n+=` ${i}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,n)}const E=i.getTile(r).tileSize,T=512/Math.min(E,512)*(r.overscaledZ/c.zoom)*.5,C=g._tileDebugTextBuffer||t.debugBuffer,k=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,M=g._tileDebugTextSegments||t.debugSegments;m.draw(t,h.TRIANGLES,_,y,e.a.alphaBlended,e.ag.disabled,Xi(p,e.C.transparent,T),v,C,k,M,null,null,null,[g._globeTileDebugTextBuffer])}function Wr(e,t,i,r){Xr(e,0,t+i/2,e.transform.width,i,r)}function Zr(e,t,i,r){Xr(e,t-i/2,0,i,e.transform.height,r)}function Xr(t,i,r,n,a,o){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.e.devicePixelRatio,r*e.e.devicePixelRatio,n*e.e.devicePixelRatio,a*e.e.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}const Yr=e.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jr}=Yr;function Qr(e,t,i,r){e.emplaceBack(t,i,r)}class Kr{constructor(t){this.vertexArray=new e.ca,this.indices=new e.bw,Qr(this.vertexArray,-1,-1,1),Qr(this.vertexArray,1,-1,1),Qr(this.vertexArray,-1,1,1),Qr(this.vertexArray,1,1,1),Qr(this.vertexArray,-1,-1,-1),Qr(this.vertexArray,1,-1,-1),Qr(this.vertexArray,-1,1,-1),Qr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Jr),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.b.simpleSegment(0,0,36,12)}}function en(t,i,r,n,a,o){const s=t.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),h=i.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.bE.fromMat4(e.bE.create(),n),a,h,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),r.draw(t,s.TRIANGLES,e.af.disabled,e.ah.disabled,e.a.unblended,e.ag.frontCW,u,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const tn=e.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rn{constructor(t){const i=new e.cb;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new e.bw;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,tn.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const nn=e.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class an{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class on{constructor(t){this.colorModeAlphaBlendedWriteRGB=new e.a([e.cc,e.cd,e.cc,e.cd],e.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new e.a([e.cc,e.ce,e.cc,e.ce],e.C.transparent,[!1,!1,!1,!0]),this.params=new an,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new rn(i);const t=this.params.sizeRange,r=this.params.intensityRange,n=function(t){const i=e.ch(30),r=[];for(let n=0;n<t;++n){const t=2*Math.PI*i(),n=Math.acos(1-2*i())-.5*Math.PI;r.push(e.$.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return r}(this.params.starsCount),a=e.ch(300),o=new e.cf,s=new e.bw;let l=0;for(let i=0;i<n.length;++i){const c=e.$.scale([],n[i],200),h=Math.max(0,1+.01*t*(1*a()-.5)),u=Math.max(0,1+.01*r*(1*a()-.5));o.emplaceBack(c[0],c[1],c[2],-1,-1,h,u),o.emplaceBack(c[0],c[1],c[2],1,-1,h,u),o.emplaceBack(c[0],c[1],c[2],1,1,h,u),o.emplaceBack(c[0],c[1],c[2],-1,1,h,u),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(o,nn.members),this.starsIdx=i.createIndexBuffer(s),this.starsSegments=e.b.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const r=t.context,n=r.gl,a=t.transform,o=new e.af(n.LEQUAL,e.af.ReadOnly,[0,1]),s=e.a2(a.zoom),l=t.style.getLut(i.scope),c=i.properties.get("color").toRenderColor(l).toArray01(),h=i.properties.get("high-color").toRenderColor(l).toArray01(),u=i.properties.get("space-color").toRenderColor(l).toArray01PremultipliedAlpha(),d=5e-4,p=e.cg(i.properties.get("horizon-blend"),0,1,d,.25),f=e.bc(t,r,a)&&p===d?a.worldSize/(2*Math.PI*1.025)-1:a.globeRadius,m=t.frameCounter/1e3%1,g=e.$.length(a.globeCenterInViewSpace),_=Math.sqrt(Math.pow(g,2)-Math.pow(f,2)),y=Math.acos(_/g),x=i=>{const l="globe"===a.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];i&&l.push("ALPHA_PASS");const d=t.getOrCreateProgram("globeAtmosphere",{defines:l}),f=((e,t,i,r,n,a,o,s,l,c,h,u)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:i,u_frustum_bl:r,u_horizon:n,u_transition:a,u_fadeout_range:o,u_color:s,u_high_color:l,u_space_color:c,u_temporal_offset:h,u_horizon_angle:u}))(a.frustumCorners.TL,a.frustumCorners.TR,a.frustumCorners.BR,a.frustumCorners.BL,a.frustumCorners.horizon,s,p,c,h,u,m,y);t.uploadCommonUniforms(r,d);const g=this.atmosphereBuffer;g&&d.draw(t,n.TRIANGLES,o,e.ah.disabled,i?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,e.ag.backCW,f,i?"atmosphere_glow_alpha":"atmosphere_glow",g.vertexBuffer,g.indexBuffer,g.segments)};x(!1),x(!0)}drawStars(t,i){const r=e.au(i.properties.get("star-intensity"),0,1);if(0===r)return;const n=t.context,a=n.gl,o=t.transform,s=t.getOrCreateProgram("stars"),l=e.aw.identity([]);e.aw.rotateX(l,l,-o._pitch),e.aw.rotateZ(l,l,-o.angle),e.aw.rotateX(l,l,e.ac(o._center.lat)),e.aw.rotateY(l,l,-e.ac(o._center.lng));const c=e.ae.fromQuat(new Float32Array(16),l),h=e.ae.multiply([],o.starsProjMatrix,c),u=e.bE.fromMat4([],c),d=e.bE.invert([],u),p=[0,1,0];e.$.transformMat3(p,p,d),e.$.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.$.transformMat3(f,f,d),e.$.scale(f,f,this.params.sizeMultiplier);const m=(g=p,_=f,y=r,{u_matrix:Float32Array.from(h),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(n,s),this.starsVx&&this.starsIdx&&s.draw(t,a.TRIANGLES,e.af.disabled,e.ah.disabled,this.colorModeAlphaBlendedWriteRGB,e.ag.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function sn(t,i){const r=[...t],n=i.cameraWorldSizeForFog/i.worldSize,a=e.ae.identity([]);return e.ae.scale(a,a,[n,n,1]),e.ae.multiply(r,a,r),e.ae.multiply(r,i.worldToFogMatrix,r),r}function ln(t,i,r,n,a){const o=r.material,s=n.context,{baseColorTexture:l,metallicRoughnessTexture:c}=o.pbrMetallicRoughness,{normalTexture:h,occlusionTexture:u,emissionTexture:d}=o;function p(e,i,r){if(e&&(t.push(i),s.activeTexture.set(s.gl.TEXTURE0+r),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:r,wrapT:n}=e.sampler;e.gfxTexture.bindExtraParam(t,i,r,n)}}p(l,"HAS_TEXTURE_u_baseColorTexture",ui.BaseColor),p(c,"HAS_TEXTURE_u_metallicRoughnessTexture",ui.MetallicRoughness),p(h,"HAS_TEXTURE_u_normalTexture",ui.Normal),p(u,"HAS_TEXTURE_u_occlusionTexture",ui.Occlusion),p(d,"HAS_TEXTURE_u_emissionTexture",ui.Emission),a&&(a.texture||(a.texture=new e.cj(n.context,a.image,[a.image.height,a.image.height,a.image.height],s.gl.RGBA)),s.activeTexture.set(s.gl.TEXTURE0+ui.LUT),a.texture&&a.texture.bind(s.gl.LINEAR,s.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(r.texcoordBuffer)),r.colorBuffer&&(t.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(r.colorBuffer)),r.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(r.normalBuffer)),r.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(r.pbrBuffer)),"OPAQUE"!==o.alphaMode&&"MASK"!==o.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),o.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function cn(t,i,r,n,a,o){const s=r.paint.get("model-opacity"),l=i.context,c=new e.af(i.context.gl.LEQUAL,e.af.ReadWrite,i.depthRangeFor3D),h=i.transform,u=t.mesh,d=u.material,p=d.pbrMetallicRoughness,f=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.ae.multiply([],n.zScaleMatrix,t.nodeModelMatrix),e.ae.multiply(m,n.negCameraPosMatrix,m);const g=e.ae.invert([],m);e.ae.transpose(g,g);const _=r.paint.get("model-emissive-strength").constantOr(0),y=pr(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(g),null,i,s,p.baseColorFactor.toRenderColor(null),d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,_,r),x={defines:[]},v=[];ln(x.defines,v,u,i,r.lut);const b=i.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const e=sn(t.nodeModelMatrix,i.transform);if(w=new Float32Array(e),"globe"!==h.projection.name){const t=u.aabb.min,i=u.aabb.max,[r,n]=f.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);x.overrideFog=r>=Ke||n>=Ke}}const S=di(i,r.paint.get("model-cutoff-fade-range"));S.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const E=i.getOrCreateProgram("model",x);i.uploadCommonUniforms(l,E,null,w,S),"shadow"!==i.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,E),E.draw(i,l.gl.TRIANGLES,c,a,o,u.material.doubleSided?e.ag.disabled:e.ag.backCCW,y,r.id,u.vertexBuffer,u.indexBuffer,u.segments,r.paint,i.transform.zoom,void 0,v)}function hn(t,i,r,n,a,o,s){let l;l="globe"===t.projection.name?e.ck(r,t):[...r],e.ae.multiply(l,l,i.matrix);const c=e.ae.multiply([],n,l);if(i.meshes)for(const h of i.meshes){if("BLEND"!==h.material.alphaMode){s.push({mesh:h,depth:0,modelIndex:a,worldViewProjection:c,nodeModelMatrix:l});continue}const t=e.$.transformMat4([],h.centroid,c);t[2]>0&&o.push({mesh:h,depth:t[2],modelIndex:a,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const e of i.children)hn(t,e,r,n,a,o,s)}function un(t,i,r,n){const a=r.shadowRenderer;if(!a)return;const o=a.getShadowPassDepthMode(),s=a.getShadowPassColorMode(),l=a.calculateShadowPassMatrixFromMatrix(i),c=fr(l);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,o,e.ah.disabled,s,e.ag.backCCW,c,n.id,t.vertexBuffer,t.indexBuffer,t.segments,n.paint,r.transform.zoom,void 0,void 0)}function dn(t,i,r){const n=i.updateZoomBasedPaintProperties(),a=function(t,i,r){let n,a,o,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const i=t.terrain,a=i.findDEMTileFor(r);a&&a.dem?n=e.cm.create(i,r,a):s=0}if(0===s&&(i.terrainElevationMin=0,i.terrainElevationMax=0),s===i.validForExaggeration&&(0===s||n&&n._demTile&&n._demTile.tileID===i.validForDEMTile.id&&n._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const e in i.instancesPerModel){const t=i.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const r=(n?s*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=r,a=a?Math.min(i.terrainElevationMin,r):r,o=o?Math.max(i.terrainElevationMax,r):r}}return i.terrainElevationMin=a||0,i.terrainElevationMax=o||0,i.validForExaggeration=s,i.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,i,r);(n||a)&&(i.uploaded=!1,i.upload(t.context))}const pn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.b8([0,0,0],[e.a4,e.a4,0])};function fn(t,i){const r=1<<t.canonical.z,n=i.getFreeCameraOptions().position,a=i.elevation,o=t.canonical.x/r,s=(t.canonical.x+1)/r,l=t.canonical.y/r,c=(t.canonical.y+1)/r;let h=i._centerAltitude;if(a){const e=a.getMinMaxForTile(t);e&&e.max>h&&(h=e.max)}const u=e.au(n.x,o,s)-n.x,d=e.au(n.y,l,c)-n.y,p=e.ay(h,i.center.lat)-n.z;return i._zoomFromMercatorZ(Math.sqrt(u*u+d*d+p*p))}function mn(t,i,r,n,a,o,s){const l=t.context,c="shadow"===t.renderPass,h=t.shadowRenderer,u=c&&h?h.getShadowPassDepthMode():new e.af(l.gl.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D),d=t.isTileAffectedByFog(o);if(r.meshes)for(const p of r.meshes){const f=["MODEL_POSITION_ON_GPU"],m=[];let g,_,y;n.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const x=di(t,i.paint.get("model-cutoff-fade-range"));if(x.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),c&&h)g=t.getOrCreateProgram("modelDepth",{defines:f}),_=fr(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(r.matrix)),y=h.getShadowPassColorMode();else{ln(f,m,p,t,i.lut),g=t.getOrCreateProgram("model",{defines:f,overrideFog:d});const n=p.material,c=n.pbrMetallicRoughness,u=i.paint.get("model-opacity"),v=i.paint.get("model-emissive-strength").constantOr(0);_=pr(o.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,t,u,c.baseColorFactor.toRenderColor(null),n.emissiveFactor,c.metallicFactor,c.roughnessFactor,n,v,i,a),h&&(s.shadowUniformsInitialized?g.setShadowUniformValues(l,h.getShadowUniformValues()):(h.setupShadows(o.toUnwrapped(),g,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),y=x.shouldRenderCutoff||u<1||"OPAQUE"!==n.alphaMode?e.a.alphaBlended:e.a.unblended}t.uploadCommonUniforms(l,g,o.toUnwrapped(),null,x);const v=p.material.doubleSided?e.ag.disabled:e.ag.backCCW;if(n.instancedDataArray.length>20)m.push(n.instancedDataBuffer),g.draw(t,l.gl.TRIANGLES,u,e.ah.disabled,y,v,_,i.id,p.vertexBuffer,p.indexBuffer,p.segments,i.paint,t.transform.zoom,void 0,m,n.instancedDataArray.length);else{const r=c?"u_instance":"u_normal_matrix";for(let a=0;a<n.instancedDataArray.length;++a)_[r]=new Float32Array(n.instancedDataArray.arrayBuffer,64*a,16),g.draw(t,l.gl.TRIANGLES,u,e.ah.disabled,y,v,_,i.id,p.vertexBuffer,p.indexBuffer,p.segments,i.paint,t.transform.zoom,void 0,m)}}if(r.children)for(const e of r.children)mn(t,i,e,n,a,o,s)}const gn=[1,-1,1];function _n(t,i,r,n){if(!r.modelManager)return!0;const a=r.modelManager;if(!r.shadowRenderer)return!0;const o=r.shadowRenderer,s=i.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const i in t.instancesPerModel){const t=a.getModel(i,n);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}s.max[2]=c,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,e.$.transformMat4(s.min,s.min,i.tileMatrix),e.$.transformMat4(s.max,s.max,i.tileMatrix);const h=s.intersects(o.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===h),0===h}function yn(t,i){const r=t.uniformValues.u_cutoff_params[0],n=t.uniformValues.u_cutoff_params[1],a=t.uniformValues.u_cutoff_params[2],o=t.uniformValues.u_cutoff_params[3];return n===r||o===a?1:e.au(((i-r)/(n-r)-a)/(o-a),0,1)}function xn(t,i,r,n){if(i.pitch<20)return 1;const a=i.getWorldToCameraMatrix(),o=e.ae.multiply([],a,t),s=[...r.min,1];let l=e.aB.transformMat4([],s,o),c=l,h=l;s[1]=r.max[1],l=e.aB.transformMat4([],s,o),c=l[1]<c[1]?l:c,h=l[1]>h[1]?l:h,s[0]=r.max[0],l=e.aB.transformMat4([],s,o),c=l[1]<c[1]?l:c,h=l[1]>h[1]?l:h,s[1]=r.min[1],l=e.aB.transformMat4([],s,o),c=l[1]<c[1]?l:c,h=l[1]>h[1]?l:h;const u=e.au(n[0],0,1),d=100*i.pixelsPerMeter*e.au(n[1],0,1),p=e.au(n[2],0,1),f=e.$.lerp([],c,h,u),m=Math.tan(.5*i.fovX),g=-f[2]*m;if(0===d)return f[1]<-Math.abs(g)?p:1;const _=(-Math.abs(g)-f[1])/d,y=(e,t,i)=>(1-i)*e+i*t,x=e.au(y(1,p,_),p,1);return y(1,x,e.au((i.pitch-20)/20,0,1))}class vn{}class bn{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,r){{const e=this._storage.get(i.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const n=r.gl,a=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),o=new ArrayBuffer(a),s=new Int16Array(o);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const l=new e.co;for(let e=0;e<a/2;e+=3){const t=s[e],i=s[e+1],r=s[e+2];l.emplaceBack(t,i),l.emplaceBack(i,r),l.emplaceBack(r,t)}const c=r.bindVertexArrayOES.current,h=new vn;return h.buf=new e.I(r,l),h.lastUsedFrameIdx=t,this._storage.set(i.id,h),r.bindVertexArrayOES.set(c),h.buf}update(e){for(const[t,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class wn{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Sn={symbol:function(t,i,r,n,a){if("translucent"!==t.renderPass)return;const o=e.ah.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,a,o,s){const l=i.transform,c="map"===a,h="map"===o;for(const u of t){const t=n.getTile(u),i=t.getBucket(r);if(!i||!i.text||!i.text.segments.get().length)continue;const a=e.aE(i.textSizeData,l.zoom),o=yr(u,i.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=Wt(o,t.tileID.canonical,h,c,l,i.getProjection(),d),f=i.hasIconTextFit()&&i.hasIconData();if(a){const r=Math.pow(2,l.zoom-t.tileID.overscaledZ);Er(i,c,h,s,e.bQ,l,p,u,r,a,f)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a);const l=0!==r.paint.get("icon-opacity").constantOr(1),c=0!==r.paint.get("text-opacity").constantOr(1);void 0!==r.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?Tr(t,i,r,n,o,s):(l&&Tr(t,i,r,n,o,s,{onlyIcons:!0}),c&&Tr(t,i,r,n,o,s,{onlyText:!0})),i.map.showCollisionBoxes&&(vr(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),vr(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1),c=r.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const h=t.context,u=h.gl,d=t.transform,p=t.depthModeForSublayer(0,e.af.ReadOnly),f=e.ah.disabled,m=t.colorModeForDrapableLayerRenderPass(c),g="globe"===d.projection.name,_=[e.ak(d.center.lng),e.al(d.center.lat)],y=[];for(let v=0;v<n.length;v++){const a=n[v],o=i.getTile(a),s=o.getBucket(r);if(!s||s.projection.name!==d.projection.name)continue;const c=s.programConfigurations.get(r.id),h=e.bT(r),u=t.isTileAffectedByFog(a);g&&h.push("PROJECTION_GLOBE_VIEW"),h.push("DEPTH_D24"),t.terrain&&d.depthOcclusionForSymbolsAndCircles&&h.push("DEPTH_OCCLUSION");const p=t.getOrCreateProgram("circle",{config:c,defines:h,overrideFog:u}),f=s.layoutVertexBuffer,m=s.globeExtVertexBuffer,x=s.indexBuffer,b=d.projection.createInversionMatrix(d,a.canonical),w={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:m,indexBuffer:x,uniformValues:e.bU(t,a,o,b,_,r),tile:o};if(l){const t=s.segments.get();for(const i of t)y.push({segments:new e.b([i]),sortKey:i.sortKey,state:w})}else y.push({segments:s.segments,sortKey:0,state:w})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const x={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const v of y){const{programConfiguration:i,program:n,layoutVertexBuffer:a,globeExtVertexBuffer:o,indexBuffer:s,uniformValues:l,tile:c}=v.state,g=v.segments;t.terrain&&t.terrain.setupElevationDraw(c,n,x),t.uploadCommonUniforms(h,n,c.tileID.toUnwrapped()),n.draw(t,u.TRIANGLES,p,f,m,e.ag.disabled,l,r.id,a,s,g,r.paint,d.zoom,i,[o])}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,o=a.gl,s=e.ah.disabled,l=new e.a([o.ONE,o.ONE,o.ONE,o.ONE],e.C.transparent,[!0,!0,!0,!0]);!function(e,t,i,r){const n=e.gl,a=t.width*r,o=t.height*r;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,a,o]);let s=i.heatmapFbo;if(!s||s&&(s.width!==a||s.height!==o)){s&&s.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),s=i.heatmapFbo=e.createFramebuffer(a,o,!0,null),function(e,t,i,r,n,a){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,n,a,0,o.RGBA,e.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,0,t,s,a,o)}else n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(a,t,r,"globe"===t.transform.projection.name?.5:.25),a.clear({color:e.C.transparent});const c=t.transform,h="globe"===c.projection.name,u=h?["PROJECTION_GLOBE_VIEW"]:[],d=h?e.ag.frontCCW:e.ag.disabled,p=[e.ak(c.center.lng),e.al(c.center.lat)];for(let f=0;f<n.length;f++){const m=n[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),_=g.getBucket(r);if(!_||_.projection.name!==c.projection.name)continue;const y=t.isTileAffectedByFog(m),x=_.programConfigurations.get(r.id),v=t.getOrCreateProgram("heatmap",{config:x,defines:u,overrideFog:y}),{zoom:b}=t.transform;t.terrain&&t.terrain.setupElevationDraw(g,v),t.uploadCommonUniforms(a,v,m.toUnwrapped());const w=c.projection.createInversionMatrix(c,m.canonical);v.draw(t,o.TRIANGLES,e.af.disabled,s,l,d,Ji(t,m,g,w,p,b,r.paint.get("heatmap-intensity")),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,x,h?[_.globeExtVertexBuffer]:null)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,a=i.heatmapFbo;if(!a)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,n.TRIANGLES,e.af.disabled,e.ah.disabled,t.colorModeForRenderPass(),e.ag.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0===a.constantOr(1)||0===o.constantOr(1))return;const s=r.paint.get("line-emissive-strength"),l=r.paint.get("line-occlusion-opacity"),c=t.context,h=c.gl,u=r.layout.get("line-z-offset"),d=!u.isConstant()||!!u.constantOr(0),p=d?new e.af(t.depthOcclusion?h.GREATER:h.LEQUAL,e.af.ReadOnly,t.depthRangeFor3D):t.depthModeForSublayer(0,e.af.ReadOnly),f=t.colorModeForDrapableLayerRenderPass(s),m=t.terrain&&t.terrain.renderingToTexture,g=m?1:e.e.devicePixelRatio,_=r.paint.get("line-dasharray"),y=_.constantOr(1),x=r.layout.get("line-cap"),v=_.constantOr(null),b=x.constantOr(null),w=r.paint.get("line-pattern"),S=w.constantOr(1),E=w.constantOr(null),T=r.paint.get("line-opacity").constantOr(1);let C=!S&&1!==T||t.depthOcclusion&&l>0&&l<1;const k=r.paint.get("line-gradient"),M=S?"linePattern":"line",A=e.bV(r);let P;if(m&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(C=!1),0!==l&&t.depthOcclusion){const t=r.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?P=t.value:e.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}if(d&&(t.forceTerrainMode=!0),!d&&0!==l&&t.terrain&&!m)return void e.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const I=C&&d?t.stencilModeFor3D():e.ah.disabled;for(const D of n){const n=i.getTile(D);if(S&&!n.patternsLoaded())continue;const a=n.getBucket(r);if(!a)continue;t.prepareDrawTile();const o=a.programConfigurations.get(r.id),s=t.isTileAffectedByFog(D),u=t.getOrCreateProgram(M,{config:o,defines:d?[...A,"ELEVATED"]:A,overrideFog:s});if(E&&n.imageAtlas){const e=n.imageAtlas.patternPositions[E.toString()];e&&o.setConstantPatternPositions(e)}if(!S&&v&&b&&n.lineAtlas){const e=n.lineAtlas.getDash(v,b);e&&o.setConstantPatternPositions(e)}let[_,x]=r.paint.get("line-trim-offset");if("round"===b||"square"===b){const e=1;_!==x&&(0===_&&(_-=e),1===x&&(x+=e))}const w=m?D.projMatrix:null,R=S?e.bW(t,n,r,w,g,[_,x]):e.bX(t,n,r,w,a.lineClipsArray.length,g,[_,x]);if(k){const n=a.gradients[r.id];let o=n.texture;if(r.gradientVersion!==n.version){let s=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=D.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-D.canonical.z):1;s=e.au(e.bY(a.maxLineLength/e.a4*1024*n),256,c.maxTextureSize)}n.gradient=e.bZ({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.T(c,n.gradient,h.RGBA),n.version=r.gradientVersion,o=n.texture}c.activeTexture.set(h.TEXTURE1),o.bind(r.stepInterpolant?h.NEAREST:h.LINEAR,h.CLAMP_TO_EDGE)}y&&(c.activeTexture.set(h.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(h.LINEAR,h.REPEAT),o.updatePaintBuffers()),S&&(c.activeTexture.set(h.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),o.updatePaintBuffers()),d&&t.terrain.setupElevationDraw(n,u),t.uploadCommonUniforms(c,u,D.toUnwrapped());const z=i=>{null!=P&&(P.value=T*l),u.draw(t,h.TRIANGLES,p,i,f,e.ag.disabled,R,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,r.paint,t.transform.zoom,o,[a.layoutVertexBuffer2,a.patternVertexBuffer,a.zOffsetVertexBuffer]),null!=P&&(P.value=T)};if(C&&!d){const i=t.stencilModeForClipping(D).ref;0===i&&m&&c.clear({stencil:0});const r={func:h.EQUAL,mask:255};R.u_alpha_discard_threshold=.8,z(new e.ah(r,i,255,h.KEEP,h.KEEP,h.INVERT)),R.u_alpha_discard_threshold=0,z(new e.ah(r,i,255,h.KEEP,h.KEEP,h.KEEP))}else C&&d&&(R.u_alpha_discard_threshold=.001),z(d?I:t.stencilModeForClipping(D))}C&&(t.resetStencilClippingMasks(),m&&c.clear({stencil:0})),0===l||t.depthOcclusion||m||t.layersWithOcclusionOpacity.push(t.currentLayer),d&&(t.forceTerrainMode=!1)},fill:function(t,i,r,n){const a=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=r.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(s),c=r.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===a.constantOr(e.C.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===h){const a=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.af.ReadWrite:e.af.ReadOnly);kr(t,i,r,n,a,l,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const a=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,e.af.ReadOnly);kr(t,i,r,n,a,l,!0)}},"fill-extrusion":function(t,i,r,n){const a=r.paint.get("fill-extrusion-opacity"),o=t.context,s=o.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===a)return;const h=t.conflationActive&&t.style.isLayerClipped(r,i.getSource()),u=t.style.order.indexOf(r.fqid);if(h&&function(e,t,i,r,n){for(const a of r){const r=t.getTile(a).getBucket(i);r&&(r.updateReplacement(a,e.replacementSource,n),r.uploadCentroid(e.context))}}(t,i,r,n,u),l||h)for(const e of n){const n=i.getTile(e).getBucket(r);n&&Pr(t.context,i,e,n,r,l,h)}if("shadow"===t.renderPass&&t.shadowRenderer){const o=t.shadowRenderer;if(l&&a<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.Z)return;const s=o.getShadowPassDepthMode(),c=o.getShadowPassColorMode();Mr(t,i,r,n,s,e.ah.disabled,c,h)}else if("translucent"===t.renderPass){const u=!r.paint.get("fill-extrusion-pattern").constantOr(1),d=r.paint.get("fill-extrusion-color").constantOr(e.C.white);if(!c&&0!==d.a){const o=new e.af(t.context.gl.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D);1===a&&u?Mr(t,i,r,n,o,e.ah.disabled,e.a.unblended,h):(Mr(t,i,r,n,o,e.ah.disabled,e.a.disabled,h),Mr(t,i,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass(),h),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&u&&(!l&&"globe"!==t.transform.projection.name||c)){const a=r.paint.get("fill-extrusion-opacity"),u=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=r.paint.get("fill-extrusion-flood-light-intensity"),f=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),m=u>0&&d>0,g=p>0,_=(e,t,i)=>(1-i)*e+i*t,y=o=>{const l=t.depthModeForSublayer(1,e.af.ReadOnly,s.LEQUAL,!0),c=r.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=_(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new e.ah({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0],s.MIN);Ar(t,i,r,n,l,c,g,e.ag.disabled,o,"sdf",a,u,d,p,f,m,h,!1)}{const c=g?e.ah.disabled:new e.ah({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=g?t.colorModeForRenderPass():new e.a([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],e.C.transparent,[!0,!0,!0,!0]);Ar(t,i,r,n,l,c,_,e.ag.disabled,o,"color",a,u,d,p,f,m,h,!1)}};if(c){const c=(o,l,c)=>{const m=t.depthModeForSublayer(1,e.af.ReadOnly,s.LEQUAL,!1),g=r.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0]);Ar(t,i,r,n,m,e.ah.disabled,c,e.ag.disabled,o,"clear",a,u,d,p,f,y,h,l)}{const c=new e.ah({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new e.a([s.ONE,s.ONE,s.ONE,s.ONE],e.C.transparent,[!1,!1,!1,!0],s.MIN);Ar(t,i,r,n,m,c,g,e.ag.disabled,o,"sdf",a,u,d,p,f,y,h,l)}{const c=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,g=new e.ah({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=new e.a([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],e.C.transparent,[!0,!0,!0,!0]);Ar(t,i,r,n,m,g,_,e.ag.disabled,o,"color",a,u,d,p,f,y,h,l)}{const g=new e.a([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],e.C.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);Ar(t,i,r,n,m,e.ah.disabled,g,e.ag.disabled,o,"clear",a,u,d,p,f,y,h,l,c)}};if(m||g){let i;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===t&&i.size[1]===r)||(i&&i.destroy(),i=l.framebufferCopyTexture=new e.T(o,new e.j({width:t,height:r}),s.RGBA)),i.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,t,r,0)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1),(m||g)&&t.resetStencilClippingMasks()}}},hillshade:function(t,i,r,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const a=t.context,o=t.terrain&&t.terrain.renderingToTexture,[s,l]="translucent"!==t.renderPass||o?[{},n]:t.stencilConfigForOverlap(n);for(const c of l){const n=i.getTile(c);if(n.needsHillshadePrepare&&"offscreen"===t.renderPass)Dt(t,n,r);else if("translucent"===t.renderPass){const i=t.depthModeForSublayer(0,e.af.ReadOnly),a=r.paint.get("hillshade-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),h=o&&t.terrain?t.terrain.stencilModeForRTTOverlap(c):s[c.overscaledZ];Pt(t,c,n,r,i,h,l)}}a.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,r,n,a,o){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const s="globe"===t.transform.projection.name,l=0!==r.paint.get("raster-elevation"),c=l&&s;if(t.renderElevatedRasterBackface&&!c)return;const h=t.context,u=h.gl,d=i.getSource(),p=function(t,i,r,n){const a=i.paint.get("raster-color"),o="raster-array"===t.type,s=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let h=i.paint.get("raster-color-range");const u=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?n.NEAREST:n.LINEAR;if(o&&(s.push("RASTER_ARRAY"),a||s.push("RASTER_COLOR"),"linear"===l&&s.push("RASTER_ARRAY_LINEAR"),p=n.NEAREST,!h&&t.rasterLayers)){const e=t.rasterLayers.find((e=>{let{id:t}=e;return t===i.sourceLayer}));e&&e.fields&&e.fields.range&&(h=e.fields.range)}if(h=h||[0,1],a){s.push("RASTER_COLOR"),r.activeTexture.set(n.TEXTURE2),i.updateColorRamp(h);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:u,range:h,offset:d,defines:s,resampling:p}}(d,r,h,u);if(d instanceof e.bo&&!n.length&&!s)return;const f=r.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(f),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===r.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;if(d instanceof e.bo&&!n.length&&(d.onNorthPole||d.onSouthPole)){const n=l?t.stencilModeFor3D():e.ah.disabled;return void Fr(!!d.onNorthPole,null,t,i,r,f,p,e.ag.disabled,n)}if(!n.length)return;const[x,v]=d instanceof e.bo||g?[{},n]:t.stencilConfigForOverlap(n),b=v[v.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(n,a,v)=>{for(const w of n){const n=w.toUnwrapped(),S=i.getTile(w);if(g&&(!S||!S.hasData()))continue;h.activeTexture.set(u.TEXTURE0);const E=Or(S,d,r,p);if(!E||!E.texture)continue;const{texture:T,mix:C,offset:k,tileSize:M,buffer:A}=E;let P,I;g?(P=e.af.disabled,I=w.projMatrix):l?(P=new e.af(u.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D),I=s?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,_)):(P=t.depthModeForSublayer(w.overscaledZ-b,1===r.paint.get("raster-opacity")?e.af.ReadWrite:e.af.ReadOnly,u.LESS),I=t.transform.calculateProjMatrix(n,_));const D=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):x[w.overscaledZ],R=o?0:r.paint.get("raster-fade-duration");S.registerFadeDuration(R);const z=i.findLoadedParent(w,0),L=ki(S,z,i,t.transform,R);let F,B;t.terrain&&t.terrain.prepareDrawTile(),h.activeTexture.set(u.TEXTURE0),T.bind(y,u.CLAMP_TO_EDGE),h.activeTexture.set(u.TEXTURE1),z?(z.texture&&z.texture.bind(y,u.CLAMP_TO_EDGE),F=Math.pow(2,z.tileID.overscaledZ-S.tileID.overscaledZ),B=[S.tileID.canonical.x*F%1,S.tileID.canonical.y*F%1]):T.bind(y,u.CLAMP_TO_EDGE),T.useMipmap&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const O=t.transform;let N;const V=l?Br(O):[0,0,0,0];let j,U,G,$,q,H=0;if(c&&d instanceof e.bo&&d.coordinates.length>3)j=Float32Array.from(e.bh(e.bi(new e.aO(0,0,0)))),U=Float32Array.from(O.globeMatrix),G=Float32Array.from(e.bd(O)),$=[e.ak(O.center.lng),e.al(O.center.lat)],N=d.elevatedGlobePerspectiveTransform,q=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.be(w.canonical);H=e.bf(t.getCenter().lat),j=Float32Array.from(e.bh(e.bi(w.canonical))),U=Float32Array.from(O.globeMatrix),G=Float32Array.from(e.bd(O)),$=[e.ak(O.center.lng),e.al(O.center.lat)],N=[0,0],q=Float32Array.from(e.bg(w.canonical,t,H,O.worldSize/O._pixelsPerMercatorPixel))}else N=d instanceof e.bo?d.perspectiveTransform:[0,0],j=new Float32Array(16),U=new Float32Array(9),G=new Float32Array(16),$=[0,0],q=new Float32Array(9);const W=er(I,j,U,G,q,B||[0,0],e.a2(t.transform.zoom),$,V,F||1,L,r,N,l?r.paint.get("raster-elevation"):0,2,C,k,p.range,M,A,f),Z=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Z});if(t.uploadCommonUniforms(h,X,n),d instanceof e.bo){const i=d.elevatedGlobeVertexBuffer,n=d.elevatedGlobeIndexBuffer;if(g||!s)d.boundsBuffer&&d.boundsSegments&&X.draw(t,u.TRIANGLES,P,e.ah.disabled,m,e.ag.disabled,W,r.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&n){const o=O.zoom<=e.b3?d.elevatedGlobeSegments:d.getSegmentsForLongitude(O.center.lng);o&&X.draw(t,u.TRIANGLES,P,e.ah.disabled,m,a,W,r.id,i,n,o)}}else if(c){P=new e.af(u.LEQUAL,e.af.ReadOnly,t.depthRangeFor3D);const i=t.globeSharedBuffers;if(i){const[e,n,o]=i.getGridBuffers(H,!1);X.draw(t,u.TRIANGLES,P,v||D,t.colorModeForRenderPass(),a,W,r.id,e,n,o)}}else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:n,tileBoundsSegments:a}=t.getTileBoundsBuffers(S);X.draw(t,u.TRIANGLES,P,D,m,e.ag.disabled,W,r.id,i,n,a)}}if(!(d instanceof e.bo)&&c)for(const o of n){const n=o.canonical.y===(1<<o.canonical.z)-1;0===o.canonical.y&&Fr(!0,o,t,i,r,f,p,a,v||e.ah.disabled),n&&Fr(!1,o,t,i,r,f,p,a===e.ag.frontCW?e.ag.backCW:e.ag.frontCW,v||e.ah.disabled)}};c?w(v,t.renderElevatedRasterBackface?e.ag.backCW:e.ag.frontCW,t.stencilModeFor3D()):w(v,e.ag.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,i,r,n,a,o){"offscreen"===t.renderPass&&function(t,i,r,n){if(!n.length)return;const a=t.context,o=a.gl,s=i.getSource();if(!(s instanceof Mi))return;const l=Math.ceil(Math.sqrt(r.paint.get("raster-particle-count")));let c=r.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,i=new Uint8Array(4*t),r=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},n=1/1.1;for(let a=0;a<t;a++){const e=n*(r(2*a+0)+ir),t=n*(r(2*a+1)+ir),o=255*e%1,s=255*t%1,l=o,c=t-s/255,h=s;i[4*a+0]=255*(e-o/255),i[4*a+1]=255*l,i[4*a+2]=255*c,i[4*a+3]=255*h}return i}(l);c=r.particlePositionRGBAImage=new e.j({width:l,height:l},t)}let h=r.particleFramebuffer;h?h.width!==l&&(h.destroy(),h=r.particleFramebuffer=a.createFramebuffer(l,l,!0,null)):h=r.particleFramebuffer=a.createFramebuffer(l,l,!0,null);const u=[];for(const f of n){const t=i.getTile(f);if(!(t instanceof e.c5))continue;const n=Nr(t,s,r);if(!n)continue;const o=[t.tileSize,t.tileSize];let h=r.tileFramebuffer;h||(h=r.tileFramebuffer=a.createFramebuffer(o[0],o[1],!0,null));let d=t.rasterParticleState;d||(d=t.rasterParticleState=new ae(a,f,o,c));const p=d.update(r.lastInvalidatedAt);d.particleTextureDimension!==l&&d.updateParticleTexture(f,c);const m=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=m;const g=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=g,u.push([f,n,d,p])}if(0===u.length)return;const d=e.e.now(),p=r.previousDrawTimestamp?.001*(d-r.previousDrawTimestamp):.0167;if(r.previousDrawTimestamp=d,r.hasColorMap()){a.activeTexture.set(o.TEXTURE0+2);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(a,r.colorRamp,o.RGBA)),t.bind(o.LINEAR,o.CLAMP_TO_EDGE)}a.bindFramebuffer.set(r.tileFramebuffer.framebuffer),function(t,i,r){const n=t.context,a=n.gl,o=i.tileFramebuffer;n.activeTexture.set(a.TEXTURE0);const s={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const h of r){const[,,r,c]=h;o.colorAttachment.set(r.targetColorTexture.texture),n.viewport.set([0,0,o.width,o.height]),n.clear({color:e.C.transparent}),c&&(r.backgroundColorTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),l.draw(t,a.TRIANGLES,e.af.disabled,e.ah.disabled,e.a.alphaBlended,e.ag.disabled,s,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,r,u),function(t,i,r,n){const a=t.context,o=a.gl,s=r.tileFramebuffer,l="globe"===t.transform.projection.name,c=r.paint.get("raster-particle-max-speed");for(const h of n){const[n,u,d]=h;a.activeTexture.set(o.TEXTURE0+0),u.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.colorAttachment.set(d.targetColorTexture.texture);const p=t.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1});a.activeTexture.set(o.TEXTURE0+1);const f=u.scalarData?[]:[0,1,2,3].map((t=>e.b$[t](n)));f.push(n);const m=n.canonical.x,g=n.canonical.y;for(const a of f){const s=i.getTile(l?a.wrapped():a);if(!s)continue;const h=s.rasterParticleState;if(!h)continue;const d=a.canonical.x+(1<<a.canonical.z)*(a.wrap-n.wrap),f=a.canonical.y;h.particleTexture0.bind(o.NEAREST,o.CLAMP_TO_EDGE);const _=nr(1,h.particleTexture0.size[0],[d-m,f-g],0,u.texture.size,2,c,u.textureOffset,u.scale,u.offset);p.draw(t,o.POINTS,e.af.disabled,e.ah.disabled,e.a.alphaBlended,e.ag.disabled,_,r.id,h.particleIndexBuffer,void 0,h.particleSegment)}}}(t,i,r,u),a.bindFramebuffer.set(r.particleFramebuffer.framebuffer),function(t,i,r,n){const a=t.context,o=a.gl,s=i.paint.get("raster-particle-max-speed"),l=n*i.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),h=i.particleFramebuffer;a.viewport.set([0,0,h.width,h.height]);for(const u of r){const[,r,n]=u;a.activeTexture.set(o.TEXTURE0+0),r.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.activeTexture.set(o.TEXTURE0+1);const d=n.particleTexture0;d.bind(o.NEAREST,o.CLAMP_TO_EDGE);const p=ar(1,d.size[0],0,r.texture.size,s,l,c,r.textureOffset,r.scale,r.offset);h.colorAttachment.set(n.particleTexture1.texture),a.clear({color:e.C.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:r.defines}).draw(t,o.TRIANGLES,e.af.disabled,e.ah.disabled,e.a.unblended,e.ag.disabled,p,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,r,u,p)}(t,i,r,n),"translucent"===t.renderPass&&(function(t,i,r,n){const a=t.context,o=a.gl,s=i.getSource().tileSize,l=5*(1-e.a0(e.aV,e.aV+1,t.transform.zoom))*s+r.paint.get("raster-particle-elevation"),c=!t.options.moving,h="globe"===t.transform.projection.name;if(!n.length)return;const[u,d]=t.stencilConfigForOverlap(n),p=[];h&&p.push("PROJECTION_GLOBE_VIEW");const f=t.stencilModeFor3D();for(const m of d){const n=m.toUnwrapped(),s=i.getTile(m);if(!s.rasterParticleState)continue;const d=s.rasterParticleState,g=100;s.registerFadeDuration(g);const _=i.findLoadedParent(m,0),y=ki(s,_,i,t.transform,g);let x,v;t.terrain&&t.terrain.prepareDrawTile(),a.activeTexture.set(o.TEXTURE0),d.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.activeTexture.set(o.TEXTURE1),_&&_.rasterParticleState?(_.rasterParticleState.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),x=Math.pow(2,_.tileID.overscaledZ-s.tileID.overscaledZ),v=[s.tileID.canonical.x*x%1,s.tileID.canonical.y*x%1]):d.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const b=h?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,c),w=t.transform,S=Vr(w),E=e.be(m.canonical),T=e.bf(E.getCenter().lat);let C,k,M,A,P;h?(C=Float32Array.from(e.bh(e.bi(m.canonical))),k=Float32Array.from(w.globeMatrix),M=Float32Array.from(e.bd(w)),A=[e.ak(w.center.lng),e.al(w.center.lat)],P=Float32Array.from(e.bg(m.canonical,E,T,w.worldSize/w._pixelsPerMercatorPixel))):(C=new Float32Array(16),k=new Float32Array(9),M=new Float32Array(16),A=[0,0],P=new Float32Array(9));const I=rr(b,C,k,M,P,v||[0,0],e.a2(t.transform.zoom),A,S,x||1,y,l),D=t.isTileAffectedByFog(m),R=t.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:D});if(t.uploadCommonUniforms(a,R,n),h){const i=new e.af(o.LEQUAL,e.af.ReadOnly,t.depthRangeFor3D),n=0,a=t.globeSharedBuffers;if(a){const[s,l,c]=a.getGridBuffers(T,0!==n);R.draw(t,o.TRIANGLES,i,f,e.a.alphaBlended,t.renderElevatedRasterBackface?e.ag.frontCCW:e.ag.backCCW,I,r.id,s,l,c)}}else{const i=t.depthModeForSublayer(0,e.af.ReadOnly),n=u[m.overscaledZ],{tileBoundsBuffer:a,tileBoundsIndexBuffer:l,tileBoundsSegments:c}=t.getTileBoundsBuffers(s);R.draw(t,o.TRIANGLES,i,n,e.a.alphaBlended,e.ag.disabled,I,r.id,a,l,c)}}t.resetStencilClippingMasks()}(t,i,r,n),t.style.map.triggerRepaint())},background:function(t,i,r,n){const a=r.paint.get("background-color"),o=r.paint.get("background-opacity"),s=r.paint.get("background-emissive-strength");if(0===o)return;const l=t.context,c=l.gl,h=t.transform,u=h.tileSize,d=r.paint.get("background-pattern");let p;if(void 0!==d){if(null===d)return;if(p=t.imageManager.getPattern(d.toString(),r.scope,t.style.getLut(r.scope)),!p)return}const f=!d&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==f)return;const m=e.ah.disabled,g=t.depthModeForSublayer(0,"opaque"===f?e.af.ReadWrite:e.af.ReadOnly),_=t.colorModeForDrapableLayerRenderPass(s),y=d?"backgroundPattern":"background";let x,v=n;v||(x=t.getBackgroundTiles(),v=Object.values(x).map((e=>e.tileID))),d&&(l.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context,r.scope));for(const b of v){const f=t.isTileAffectedByFog(b),v=t.getOrCreateProgram(y,{overrideFog:f}),w=b.toUnwrapped(),S=n?b.projMatrix:t.transform.calculateProjMatrix(w);t.prepareDrawTile();const E=i?i.getTile(b):x?x[b.key]:new e.bA(b,u,h.zoom,t),T=d?ur(S,s,o,t,0,r.scope,p,{tileID:b,tileSize:u}):hr(S,s,o,a.toRenderColor(r.lut));t.uploadCommonUniforms(l,v,w);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:k,tileBoundsSegments:M}=t.getTileBoundsBuffers(E);v.draw(t,c.TRIANGLES,g,m,_,e.ag.disabled,T,r.id,C,k,M)}},sky:function(t,i,r){const n=t._atmosphere?e.a2(t.transform.zoom):1,a=r.paint.get("sky-opacity")*n;if(0===a)return;const o=t.context,s=r.paint.get("sky-type"),l=new e.af(o.gl.LEQUAL,e.af.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i){const r=t.context,n=r.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=r.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new Kr(r),i.skyboxTexture=r.gl.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,i.skyboxTexture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);for(let e=0;e<6;++e)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,n.RGBA,32,32,0,n.RGBA,n.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,32,32]);const o=i.getCenter(t,!0),s=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.ae.identity(l),e.ae.rotateY(l,l,.5*-Math.PI),en(t,i,s,l,o,0),e.ae.identity(l),e.ae.rotateY(l,l,.5*Math.PI),en(t,i,s,l,o,1),e.ae.identity(l),e.ae.rotateX(l,l,.5*-Math.PI),en(t,i,s,l,o,2),e.ae.identity(l),e.ae.rotateX(l,l,.5*Math.PI),en(t,i,s,l,o,3),e.ae.identity(l),en(t,i,s,l,o,4),e.ae.identity(l),e.ae.rotateY(l,l,Math.PI),en(t,i,s,l,o,5),r.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,r,n,a){const o=t.context,s=o.gl,l=t.transform,c=t.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture);const h=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(l.skyboxMatrix,i.getCenter(t,!1),0,n,a);t.uploadCommonUniforms(o,c),c.draw(t,s.TRIANGLES,r,e.ah.disabled,t.colorModeForRenderPass(),e.ag.backCW,h,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,l,a,c):"gradient"===s&&"sky"===t.renderPass&&function(t,i,r,n,a){const o=t.context,s=o.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Kr(o)),o.activeTexture.set(s.TEXTURE0);let h=i.colorRampTexture;h||(h=i.colorRampTexture=new e.T(o,i.colorRamp,s.RGBA)),h.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((t,i,r,n,a)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.ac(r),u_opacity:n,u_temporal_offset:a}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,a);t.uploadCommonUniforms(o,c),c.draw(t,s.TRIANGLES,r,e.ah.disabled,t.colorModeForRenderPass(),e.ag.backCW,u,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,l,a,c)},debug:function(t,i,r,n,a,o){for(let s=0;s<r.length;s++)if(a){const a=1,l=.8,c=new e.C(n.r*l,n.g*l,n.b*l,1);Hr(t,i,r[s],n,-a,-a,o),Hr(t,i,r[s],n,-a,a,o),Hr(t,i,r[s],n,a,a,o),Hr(t,i,r[s],n,a,-a,o),Hr(t,i,r[s],c,0,0,o)}else Hr(t,i,r[s],n,0,0,o)},custom:function(t,i,r,n){const a=t.context,o=r.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&r.isDraped(i)){if("offscreen"===t.renderPass){const i=o.prerender;if(i){if(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;i.call(o,a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.a2(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else i.call(o,a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=o.renderToTile;if(i){const r=n[0].canonical,s=new e._(r.x+n[0].wrap*(1<<r.z),r.y,r.z);a.setDepthMode(e.af.disabled),a.setStencilMode(e.ah.disabled),a.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(o,a.gl,s),a.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(e.ah.disabled);const i="3d"===o.renderingMode?new e.af(t.context.gl.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.af.ReadOnly);if(a.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;o.render(a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.a2(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else o.render(a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,i,r,n){if("opaque"===t.renderPass)return;const a=r.paint.get("model-opacity");if(0===a)return;const o=r.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!o)return;if(t.terrain&&a<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof e.Z)return}const s=t.shadowRenderer,l=r.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,l||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,l||(s.enabled=!0))},h=i.getSource();if("light-beam"===t.renderPass&&"batched-model"!==h.type)return;if("vector"===h.type||"geojson"===h.type)return function(t,i,r,n,a){const o=t.transform;if("mercator"!==o.projection.name)return void e.w(`Drawing 3D models for ${o.projection.name} projection is not yet implemented`);const s=o.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;r.modelManager=l;const c=t.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const h=r._unevaluatedLayout._values["model-id"],u={...r.layout.get("model-id").parameters},d=t.style.order.indexOf(r.fqid);for(const p of n){const n=i.getTile(p).getBucket(r);if(!n||n.projection.name!==o.projection.name)continue;const f=n.getModelUris();f&&!n.modelsRequested&&(l.addModelsFromBucket(f,a),n.modelsRequested=!0);const m=fn(p,o);u.zoom=m;const g=h.possiblyEvaluate(u);if(dn(t,n,p),pn.shadowUniformsInitialized=!1,pn.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(p.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const i=o.calculatePosMatrix(p.toUnwrapped(),o.worldSize);if(pn.tileMatrix.set(i),pn.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(i)),pn.aabb.min.fill(0),pn.aabb.max[0]=pn.aabb.max[1]=e.a4,pn.aabb.max[2]=0,_n(n,pn,t,r.scope))continue}const _=1<<p.canonical.z,y=[((s.x-p.wrap)*_-p.canonical.x)*e.a4,(s.y*_-p.canonical.y)*e.a4,s.z*_*e.a4];t.conflationActive&&Object.keys(n.instancesPerModel).length>0&&t.style.isLayerClipped(r,i.getSource())&&n.updateReplacement(p,t.replacementSource,d,a)&&(n.uploaded=!1,n.upload(t.context));for(let e in n.instancesPerModel){const i=n.instancesPerModel[e];i.features.length>0&&(e=g.evaluate(i.features[0].feature,{}));const o=l.getModel(e,a);if(o&&o.uploaded)for(const e of o.nodes)mn(t,r,e,i,y,p,pn)}}}(t,i,r,n,"vector"===h.type?r.scope:""),void c();if(!h.loaded())return;if("batched-model"===h.type)return function(t,i,r,n){r.resetLayerRenderingStats(t);const a=t.context,o=t.transform,s=t.style.fog,l=t.shadowRenderer;if("mercator"!==o.projection.name)return void e.w(`Drawing 3D landmark models for ${o.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,h=e.$.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.$.negate(h,h);const u=e.ae.identity([]),d=e.ci(o.center.lat,o.zoom),p=e.ae.fromScaling([],[1,1,1/d]);e.ae.translate(u,u,h);const f=r.paint.get("model-opacity"),m=new e.af(a.gl.LEQUAL,e.af.ReadWrite,t.depthRangeFor3D),g=new e.af(a.gl.LEQUAL,e.af.ReadOnly,t.depthRangeFor3D),_=new e.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,x=y&&l?l.getCurrentCascadeFrustum():o.getFrustum(o.scaleZoom(o.worldSize)),v=r.paint.get("model-front-cutoff"),b=v[2]<1,w=di(t,r.paint.get("model-cutoff-fade-range")),S=r.getLayerRenderingStats();(function(e,t,i,r){const n=e.terrain?e.terrain.exaggeration():0,a=e.transform.zoom;for(const o of r){const r=t.getTile(o).getBucket(i);r&&(e.conflationActive&&r.updateReplacement(o,e.replacementSource),r.evaluateScale(e,i),e.terrain&&n>0&&r.elevationUpdate(e.terrain,n,o,i.source),r.needsReEvaluation(e,a,i)&&r.evaluate(i))}})(t,i,r,n),function(){let c,h,d;b?(c=n.length-1,h=-1,d=-1):(c=0,h=n.length,d=1);for(let E=c;E!==h;E+=d){const c=n[E],h=i.getTile(c).getBucket(r);if(!h||!h.uploaded)continue;let d=!1;l&&(d=0===l.getMaxCascadeForTile(c.toUnwrapped()));const T=o.calculatePosMatrix(c.toUnwrapped(),o.worldSize),C=h.modelTraits,k=[];for(const i of h.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const r=i.node;let n=0;t.terrain&&r.elevation&&(n=r.elevation*t.terrain.exaggeration());const a=i.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===(()=>{const t=i.aabb;return _.min=[...t.min],_.max=[...t.max],_.min[2]+=n,_.max[2]+=n,e.$.transformMat4(_.min,_.min,T),e.$.transformMat4(_.max,_.max,T),_})().intersects(x))continue;const s=[...T],l=r.anchor?r.anchor[0]:0,c=r.anchor?r.anchor[1]:0;e.ae.translate(s,s,[l*(a[0]-1),c*(a[1]-1),n]),e.$.exactEquals(a,e.cl)||e.ae.scale(s,s,a);const h=e.ae.multiply([],s,r.matrix),u=e.ae.multiply([],o.expandedFarZProjMatrix,h),d=e.ae.multiply([],o.expandedFarZProjMatrix,s),p=e.aB.transformMat4([],[l,c,n,1],u)[2];r.hidden=!1;let m=f;y||(b&&(m*=xn(s,o,i.aabb,v)),m*=yn(w,p)),0!==m?k.push({nodeInfo:i,depth:p,opacity:m,wvpForNode:u,wvpForTile:d,nodeModelMatrix:h,tileModelMatrix:s}):r.hidden=!0}y||k.sort(((e,t)=>!b||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1));for(const i of k){const n=i.nodeInfo,c=n.node;let h=e.ae.multiply([],p,i.tileModelMatrix);e.ae.multiply(h,u,h);const f=e.ae.invert([],h);e.ae.transpose(f,f),e.ae.scale(f,f,gn),h=e.ae.multiply(h,h,c.matrix);const _="light-beam"===t.renderPass,x=C&e.cn.HasMapboxMeshFeatures,v=x?0:n.evaluatedRMEA[0][2];for(let u=0;u<c.meshes.length;++u){const p=c.meshes[u],b=u===c.lightMeshIndex;let w=i.wvpForNode;if(b){if(!_&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}w=i.wvpForTile}else if(_)continue;const E={defines:[]},T=[];if(ln(E.defines,T,p,t,r.lut),x||E.defines.push("DIFFUSE_SHADED"),d&&E.defines.push("SHADOWS_SINGLE_CASCADE"),S&&(y?S.numRenderedVerticesInShadowPass+=p.vertexArray.length:S.numRenderedVerticesInTransparentPass+=p.vertexArray.length),y){un(p,i.nodeModelMatrix,t,r);continue}let C=null;if(s){const e=sn(i.nodeModelMatrix,t.transform);if(C=new Float32Array(e),"globe"!==o.projection.name){const t=p.aabb.min,i=p.aabb.max,[r,n]=s.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);E.overrideFog=r>=Ke||n>=Ke}}const k=p.material;let M;k.occlusionTexture&&k.occlusionTexture.offsetScale&&(M=k.occlusionTexture.offsetScale,E.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!p.normalBuffer);const A=t.getOrCreateProgram("model",E);!y&&l&&l.setupShadowsFromMatrix(i.tileModelMatrix,A,l.useNormalOffset),t.uploadCommonUniforms(a,A,null,C);const P=k.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;const I=pr(new Float32Array(w),new Float32Array(h),new Float32Array(f),new Float32Array(c.matrix),t,i.opacity,P.baseColorFactor.toRenderColor(null),k.emissiveFactor,P.metallicFactor,P.roughnessFactor,k,v,r,[0,0,0],M);!b&&(n.hasTranslucentParts||i.opacity<1)&&A.draw(t,a.gl.TRIANGLES,m,e.ah.disabled,e.a.disabled,e.ag.backCCW,I,r.id,p.vertexBuffer,p.indexBuffer,p.segments,r.paint,t.transform.zoom,void 0,T),A.draw(t,a.gl.TRIANGLES,b?g:m,e.ah.disabled,b||i.opacity<1||n.hasTranslucentParts?e.a.alphaBlended:e.a.unblended,e.ag.backCCW,I,r.id,p.vertexBuffer,p.indexBuffer,p.segments,r.paint,t.transform.zoom,void 0,T)}}}}()}(t,i,r,n),void c();if("model"!==h.type)return;const u=h.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.$.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.$.negate(f,f);const m=[],g=[];let _=0;for(const y of u){const i=r.paint.get("model-rotation").constantOr(null),n=r.paint.get("model-scale").constantOr(null),a=r.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,i,n,a,!0,!0,!1);const o=e.ae.identity([]),s=e.ci(y.position.lat,t.transform.zoom),l=e.ae.fromScaling([],[1,1,1/s]);e.ae.translate(o,o,f),d.push({zScaleMatrix:l,negCameraPosMatrix:o});for(const e of y.nodes)hn(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===a)for(const i of g)cn(i,t,r,d[i.modelIndex],e.ah.disabled,t.colorModeForRenderPass());else{for(const i of g)cn(i,t,r,d[i.modelIndex],e.ah.disabled,e.a.disabled);for(const e of g)cn(e,t,r,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const i of m)cn(i,t,r,d[i.modelIndex],e.ah.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)un(e.mesh,e.nodeModelMatrix,t,r);for(const e of m)un(e.mesh,e.nodeModelMatrix,t,r);c()}}},En={model:function(e,t,i){const r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===r.type?e.scope:""));if("batched-model"===r.type)return;if("model"!==r.type)return;const n=r.getModels();for(const a of n)a.upload(i.context)},raster:function(e,t,i){const r=t.getSource();if(!(r instanceof Mi&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const a=e.paint.get("raster-array-band")||r.getInitialBand(n);if(null==a)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const s of o)s.updateNeeded(n,a)&&r.prepareTile(s,n,a)},"raster-particle":function(e,t,i){const r=t.getSource();if(!(r instanceof Mi&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const a=e.paint.get("raster-particle-array-band")||r.getInitialBand(n);if(null==a)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const s of o)s.updateNeeded(n,a)&&r.prepareTile(s,n,a)}};class Tn{constructor(t,i,r,n){this.context=new ne(t,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._timeStamp=e.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),n.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),n.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of a)n.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new wn(n),this.setup(),this.numSublayers=e.bx.maxUnderzooming+e.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gi(this),this._wireframeDebugCache=new bn,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const o=new e.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,o,t.RGBA)}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zi(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=t.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new zi(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*e.e.devicePixelRatio,this.height=i*e.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,i=new e.bv;i.emplaceBack(0,0),i.emplaceBack(e.a4,0),i.emplaceBack(0,e.a4),i.emplaceBack(e.a4,e.a4),this.tileExtentBuffer=t.createVertexBuffer(i,e.bt.members),this.tileExtentSegments=e.b.simpleSegment(0,0,4,2);const r=new e.bv;r.emplaceBack(0,0),r.emplaceBack(e.a4,0),r.emplaceBack(0,e.a4),r.emplaceBack(e.a4,e.a4),this.debugBuffer=t.createVertexBuffer(r,e.bt.members),this.debugSegments=e.b.simpleSegment(0,0,4,5);const n=new e.bv;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.bt.members),this.viewportSegments=e.b.simpleSegment(0,0,4,2);const a=new e.cq;a.emplaceBack(0,0,0,0),a.emplaceBack(e.a4,0,e.a4,0),a.emplaceBack(0,e.a4,0,e.a4),a.emplaceBack(e.a4,e.a4,e.a4,e.a4),this.mercatorBoundsBuffer=t.createVertexBuffer(a,e.cr.members),this.mercatorBoundsSegments=e.b.simpleSegment(0,0,4,2);const o=new e.bw;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);const s=new e.cs;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.T(t,new e.j({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.ae.create();const l=this.context.gl;this.stencilClearMode=new e.ah({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,e.af.disabled,this.stencilClearMode,e.a.disabled,e.ag.disabled,Ci(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,r){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const n=this.context,a=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(e.a.disabled),n.setDepthMode(e.af.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of r){const t=i.getTile(s),r=this._tileClippingMaskIDs[s.key]=this.nextStencilID++,{tileBoundsBuffer:n,tileBoundsIndexBuffer:l,tileBoundsSegments:c}=this.getTileBoundsBuffers(t);o.draw(this,a.TRIANGLES,e.af.disabled,new e.ah({func:a.ALWAYS,mask:0},r,255,a.KEEP,a.KEEP,a.REPLACE),e.a.disabled,e.ag.disabled,Ci(s.projMatrix),"$clipping",n,l,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.ah({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.ah({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,r=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=r[r.length-1].overscaledZ,a=r[0].overscaledZ-n+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();const t={};for(let r=0;r<a;r++)t[r+n]=new e.ah({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=a,[t,r]}return[{[n]:e.ah.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.a([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.C(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.a.unblended:e.a.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new e.a([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new e.C(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new e.af(this.context.gl.GREATER,e.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return e.af.disabled;const a=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.af(r||this.context.gl.LEQUAL,i,[a,a])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),r=Math.ceil(this.height),n=this.context.bindFramebuffer.get(),a=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===r||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==i&&0!==r&&(this.depthFBO=new re(this.context,i,r,!1,"texture"),this.depthTexture=new e.T(this.context,{width:i,height:r,data:null},t.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(n),t.bindTexture(t.TEXTURE_2D,a),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,r,0,0,i,r,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((e,t)=>e+t/this._fpsHistory.length),0))}render(t,i){const r=e.e.now();this._dt=r-this._timeStamp,this._timeStamp=r,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const n=this.style._mergedLayers,a=this.style.order.filter((e=>{const t=n[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]}));let o=!1,s=!1;for(const e of a){const t=n[e];"circle"===t.type&&(o=!0),"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?s=!0:o=!0)}const l=a.map((e=>n[e])),c=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.e.now()),this.imageManager.beginFrame();let h=0,u=!1;for(const e in c){const t=c[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++h)}let d=!1;for(const e of l)e.isHidden(this.transform.zoom)||("clip"===e.type&&(d=!0),this.prepareLayer(e));const p={},f={},m={},g={},_={};for(const e in c){const t=c[e];p[e]=t.getVisibleCoordinates(),f[e]=p[e].slice().reverse(),m[e]=t.getVisibleCoordinates(!0).reverse(),g[e]=t.getShadowCasterCoordinates(),_[e]=t.sortCoordinatesByDistance(p[e])}const y=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(h||d){const t=[],i=[];let r=0;for(const e of l)this.isSourceForClippingOrConflation(e,y(e))&&(t.push(e),i.push(r)),r++;if(t&&(d||t.length>1)){const r=[];for(let n=0;n<t.length;n++){const a=t[n],o=i[n],s=this.style.getLayerSourceCache(a);if(!s||!s.used||!s.getSource().usedInConflation&&"clip"!==a.type)continue;let l=e.cv,c=e.cw.None;const h=[];if("clip"===a.type){l=o;for(const t of a.layout.get("clip-layer-types"))c|="model"===t?e.cw.Model:"symbol"===t?e.cw.Symbol:e.cw.FillExtrusion;for(const e of a.layout.get("clip-layer-scope"))h.push(e)}r.push({layer:a.fqid,cache:s,order:l,clipMask:c,clipScope:h})}this.replacementSource.setSources(r),u=!0}}u||this.replacementSource.clear(),this.conflationActive=u,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<l.length;e++){const t=l[e],i=t.cutoffRange();if(this.longestCutoffRange=Math.max(i,this.longestCutoffRange),i>0){const e=y(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const x=this.style&&this.style.fog;x?(this._fogVisible=0!==x.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=x.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(m),this.opaquePassCutoff=0);const v=this._shadowRenderer;if(v){v.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in c)for(const t of p[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),v.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new on(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.cu(this.context.gl))return;this.renderPass="offscreen";for(const e of l){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const r=i?f[i.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,i,e,r)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,g)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const b="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),w=(()=>{if(i.showOverdrawInspector)return e.C.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const i=this.style.getLut(t.scope);if(!b){const r=t.properties.get("color").toRenderColor(i).toArray01();return new e.C(...r)}if(b){const r=t.properties.get("space-color").toRenderColor(i).toArray01();return new e.C(...r)}}return e.C.transparent})();if(this.context.clear({color:w,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&b&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=l[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const r=i?(e.is3D()?_:f)[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&b&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.a2(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=l[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?f[i.id]:void 0)}function S(e,t){let i;return t&&(i=("symbol"===e.type?m:e.is3D()?_:f)[t.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=l[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,S(e,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let E=0;v&&(E=v.getShadowCastingLayerCount());let T=!1,C=-1;for(let e=0;e<a.length;++e){const t=l[e];t.isHidden(this.transform.zoom)||t.is3D()&&(C=e)}for(s&&-1===C&&(o=!0);this.currentLayer<a.length;){const e=l[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(o&&!T&&this.terrain&&!this.transform.isOrthographic&&(T=!0,this.blitDepth()),s&&-1!==C&&this.currentLayer===C+1&&!this.transform.isOrthographic&&this.blitDepth(),e.is3D()||this.terrain||this._renderTileClippingMasks(e,i,i?p[i.id]:void 0),this.renderLayer(this,i,e,S(e,i)),!this.terrain&&v&&E>0&&e.hasShadowPass()&&0==--E&&(v.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=l[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?f[i.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const i of this.layersWithOcclusionOpacity){this.currentLayer=i;const e=l[this.currentLayer],r=t.getLayerSourceCache(e),n=r?f[r.id]:void 0;e.is3D()||this.terrain||this._renderTileClippingMasks(e,r,r?p[r.id]:void 0),this.renderLayer(this,r,e,n)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;l.forEach((e=>{const r=t.getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Sn.debug(this,i,i.getVisibleCoordinates(),e.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Sn.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Wr(e,e.transform.height-(t.top||0),3,jr),Wr(e,t.bottom||0,3,Ur),Zr(e,t.left||0,3,Gr),Zr(e,e.transform.width-(t.right||0),3,$r);const i=e.transform.centerPoint;!function(e,t,i,r){Xr(e,t-1,i-10,2,20,r),Xr(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,qr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),u||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,i=!t||!t.includes(e.type);if(En[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);En[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)&&(!e.terrain||"custom"!==i.type)||"clip"===i.type||Sn[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,i=this.context.gl;let r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(t.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,i=t.createQuery();this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,a=n.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(r.query),t[i]=a}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,i=this.context.gl;let r=0;for(const n of e)r+=t.getQueryParameter(n,i.QUERY_RESULT)/1e6,t.deleteQueryEXT(n);return r}translatePosMatrix(t,i,r,n,a){if(!r[0]&&!r[1])return t;const o=a?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const s=[a?r[0]:e.bD(i,r[0],this.transform.zoom),a?r[1]:e.bD(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.ae.translate(l,t,s),l}saveTileTexture(e){const t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){const r=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,n=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(n.push("LIGHTING_3D_MODE"),n.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||n.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||n.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):n.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(n.push("TERRAIN"),this.linearFloatFilteringSupported()&&n.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&n.push("GLOBE"),!this._fogVisible||r||void 0!==t&&!t||n.push("FOG","FOG_DITHERING"),r&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}getOrCreateProgram(e,t){this.cache=this.cache||{};const i=t&&t.defines||[],r=t&&t.config,n=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),a=Oi.cacheKey(Tt[e],e,n,r);return this.cache[a]||(this.cache[a]=new Oi(this.context,e,Tt[e],r,mr[e],n)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const a=((t,i,r)=>{const n=t.properties.get("direction"),a=t.properties.get("color").toRenderColor(r.getLut(t.scope)).toArray01(),o=t.properties.get("intensity"),s=i.properties.get("color").toRenderColor(r.getLut(i.scope)).toArray01(),l=i.properties.get("intensity"),c=[n.x,n.y,n.z],h=e.bC(s,l),u=e.bC(a,o);return{u_lighting_ambient_color:h,u_lighting_directional_dir:c,u_lighting_directional_color:u,u_ground_radiance:Li(c,u,h)}})(r,n,this.style);i.setLightsUniformValues(t,a)}}}uploadCommonUniforms(t,i,r,n,a){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const a=o.getOpacity(this.transform.pitch),s=((t,i,r,n,a,o,s,l,c,h,u,d)=>{const p=t.transform,f=i.properties.get("color").toRenderColor(t.style.getLut(i.scope)).toArray01();f[3]=n;const m=t.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:r?p.calculateFogTileMatrix(r):d||t.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:a,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:h,u_viewport:u,u_globe_transition:e.a2(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,o,r,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.e.devicePixelRatio,this.transform.height*e.e.devicePixelRatio],n);i.setFogUniformValues(t,s)}a&&i.setCutoffUniformValues(t,a.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=t[n.key]||new e.bA(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==e.sourceLayer)&&"clip"!==e.type&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Ke||t[1]>=Ke}setupDepthForOcclusion(e,t,i){const r=this.context,n=r.gl,a=!!i;var o;i||(i={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),r.activeTexture.set(n.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),i.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],i.u_depth_range_unpack=[2/((o=this.depthRangeFor3D)[1]-o[0]),-1-2*o[0]/(o[1]-o[0])],i.u_occluder_half_size=.5*this.occlusionParams.occluderSize,i.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),r.activeTexture.set(n.TEXTURE0),a||t.setTerrainUniformValues(r,i)}}class Cn{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.P||"number"==typeof t[0]){const a=e.P.convert(t);r=[a],n=i.isPointAboveHorizon(a)}else{const a=e.P.convert(t[0]),o=e.P.convert(t[1]);r=[a,o],n=e.cx(a,o).every((e=>i.isPointAboveHorizon(e)))}return new Cn(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.cx(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.cx(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),e.cy(n,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.cx(i,r,t),a=this.cameraPoint.clone();switch(3*((a.y>i.y)+(a.y>r.y))+((a.x>i.x)+(a.x>r.x))){case 0:n[0]=a,n[4]=a.clone();break;case 1:n.splice(1,0,a);break;case 2:n[1]=a;break;case 3:n.splice(4,0,a);break;case 5:n.splice(2,0,a);break;case 6:n[3]=a;break;case 7:n.splice(3,0,a);break;case 8:n[2]=a}return n}containsTile(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=t.queryPadding/i._pixelsPerMercatorPixel+1,o=r?this._bufferedCameraMercator(a,i):this._bufferedScreenMercator(a,i);let s=t.tileID.wrap+(o.unwrapped?n:0);const l=o.polygon.map((i=>e.cz(t.tileTransform,i,s)));if(!e.cA(l,0,0,e.a4,e.a4))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>e.cB(t.tileTransform,i,s))),h=c.map((t=>new e.P(t[0],t[1]))),u=i.getFreeCameraOptions().position||new e._(0,0,0),d=e.cB(t.tileTransform,u,s),p=c.map((t=>{const i=e.$.sub(t,t,d);return e.$.normalize(i,i),new e.aU(d,i)})),f=e.bD(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:h,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.cC(l),m.min.x=e.au(m.min.x,0,e.a4),m.min.y=e.au(m.min.y,0,e.a4),m.max.x=e.au(m.max.x,0,e.a4),m.max.y=e.au(m.max.y,0,e.a4),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=An(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=An(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,i){const r=function(t,i){const r=e.ae.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-e.cF,0,1],a=[0,e.cF,0,1],o=[0,0,0,1];e.aB.transformMat4(n,n,r),e.aB.transformMat4(a,a,r),e.aB.transformMat4(o,o,r);const s=new e.P(n[0]/n[3],n[1]/n[3]),l=new e.P(a[0]/a[3],a[1]/a[3]),c=e.cD(t,s)&&n[3]<o[3],h=e.cD(t,l)&&a[3]<o[3];if(!c&&!h)return null;const u=function(e,t,i){for(let r=1;r<e.length;r++){const n=Mn(t.pointCoordinate3D(e[r-1]).x),a=Mn(t.pointCoordinate3D(e[r]).x);if(i<0){if(n<a)return{idx:r,t:-n/(a-1-n)}}else if(a<n)return{idx:r,t:(1-n)/(a+1-n)}}return null}(t,i,c?-1:1);if(!u)return null;const{idx:d,t:p}=u;let f=d>1?kn(t.slice(0,d),i):[],m=d<t.length?kn(t.slice(d),i):[];f=f.map((t=>new e.P(Mn(t.x),t.y))),m=m.map((t=>new e.P(Mn(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=e.a3(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e._(t.x,t.y))),unwrapped:!1}}(t,i);if(r)return r;const n=function(t,i){let r=!1,n=-1/0,a=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,a=e);for(let e=0;e<t.length-1;e++){const i=(a+e)%(t.length-1),n=t[i],o=t[i+1];Math.abs(n.x-o.x)>.5&&(n.x<o.x?(n.x+=1,0===i&&(t[t.length-1].x+=1)):(o.x+=1,i+1===t.length-1&&(t[0].x+=1)),r=!0)}const o=e.ak(i.center.lng);return r&&o<Math.abs(o-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:r}}(kn(t,i).map((t=>new e.P(Mn(t.x),t.y))),i);return{polygon:n.polygon.map((t=>new e._(t.x,t.y))),unwrapped:n.unwrapped}}}function kn(t,i){return e.cE(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Mn(e){return e<0?1+e%1:e%1}function An(e){return 100*e|0}function Pn(t,i){const r=e.ae.identity([]);return e.ae.scale(r,r,[.5*t.width,.5*-t.height,1]),e.ae.translate(r,r,[1,-1,0]),e.ae.multiply(r,r,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function In(e,t,i,r,n,a,o){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(r,o,s);l.sort(Rn);const c=[];for(const u of l)c.push({wrappedTileID:u.tile.tileID.wrapped().key,queryResults:u.tile.queryRenderedFeatures(t,i,e._state,u,n,a,Pn(e.transform,u.tile.tileID),s)});const h=function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,a=i[n]=i[n]||{};for(const i in e){const r=e[i],n=a[i]=a[i]||{},o=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,o.push(e))}}return t}(c);for(const u in h)h[u].forEach((t=>{const i=t.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&"slot"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(r["source-layer"],i.id):{})}));return h}function Dn(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let a=0;a<i.length;a++){const e=i[a],o=e.tileID.canonical.key;n[o]||(n[o]=!0,e.querySourceFeatures(r,t))}return r}function Rn(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class zn{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const i in this.style._mergedLayers){const r=this.style._mergedLayers[i];if("fill-extrusion"===r.type)this.layers.push({layer:r,visible:e,visibilityChanged:t});else if("model"===r.type){const i=this.style.getLayerSource(r);i&&"batched-model"===i.type&&this.layers.push({layer:r,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const i=t.layer;let r=!1;"fill-extrusion"===i.type?r=!i.isHidden(e)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(r=!i.isHidden(e)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!r&&t.visible,t.visible=r}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const r of this.layers){const e=r.layer,i=this.style.getLayerSourceCache(e);let n=1;"fill-extrusion"===e.type&&(n=r.visible?e.paint.get("fill-extrusion-vertical-scale"):0);let a=i?i.getTile(t):null;if(!a&&i&&t.canonical.z>i.getSource().minzoom){let e=t.scaledTo(Math.min(i.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=i.getSource().minzoom&&(a=i.getTile(e),!a&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:a?a.getBucket(e):null,tileID:a?a.tileID:t,verticalScale:n})}e.hasAnyZOffset=!1;let i=!1;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),a=n.zOffset,o=this._getHeightAtTileOffset(t,n.tileAnchorX,n.tileAnchorY);n.zOffset=o!==Number.NEGATIVE_INFINITY?o:a,i||a===n.zOffset||(i=!0),e.hasAnyZOffset||0===n.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,r,n){let a=i,o=r;if(t.canonical.z!==n.canonical.z){const s=n.canonical,l=1/(1<<t.canonical.z-s.z);a=(i+t.canonical.x*e.a4)*l-s.x*e.a4|0,o=(r+t.canonical.y*e.a4)*l-s.y*e.a4|0}return{tileX:a,tileY:o}}_getHeightAtTileOffset(e,t,i){let r,n;for(let a=0;a<this.layers.length;++a){if("fill-extrusion"!==this.layers[a].layer.type)continue;const{bucket:o,tileID:s,verticalScale:l}=this.currentBuildingBuckets[a];if(!o)continue;const{tileX:c,tileY:h}=this._mapCoordToOverlappingTile(e,t,i,s),u=o.getHeightAtTileCoord(c,h);u&&void 0!==u.height&&(u.hidden?r=u.height:n=Math.max(u.height*l,n||0))}if(void 0!==n)return n;for(let a=0;a<this.layers.length;++a){const n=this.layers[a];if("model"!==n.layer.type||!n.visible)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[a];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,i,s),h=o.getHeightAtTileCoord(l,c);if(h&&!h.hidden)return void 0===h.height&&void 0!==r?Math.min(h.maxHeight,r)*h.verticalScale:h.height?h.height*h.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ln(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.cG.forEach((e=>{e in i&&(r[e]=i[e])})),r}function Fn(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Ln(e[i],t[e[i].ref]));return e}const Bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function On(e,t,i){i.push({command:Bn.addSource,args:[e,t[e]]})}function Nn(e,t,i){t.push({command:Bn.removeSource,args:[e]}),i[e]=!0}function Vn(e,t,i,r){Nn(e,i,r),On(e,t,i)}function jn(t,i,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e.d(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e.d(t[r][n],i[r][n]))return!1;return!0}function Un(t,i,r,n,a,o){let s;for(s in i=i||{},t=t||{})t.hasOwnProperty(s)&&(e.d(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.d(t[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}))}function Gn(e){return e.id}function $n(e,t){return e[t.id]=t,e}class qn{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.au(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const a=i-1,o=this._distances[a],s=r-o,l=s>0?(n-o)/s:0;return this.points[a].mult(1-l).add(this.points[i].mult(l))}}class Hn{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let a=0;a<this.xCellCount*this.yCellCount;a++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,a){this.boxCells[n].push(a)}_insertCircleCell(e,t,i,r,n,a){this.circleCells[n].push(a)}_query(e,t,i,r,n,a){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return a?o.filter(a):o}return this._forEachCell(e,t,i,r,this._queryCell,o,{hitTest:n,seenUids:{box:{},circle:{}}},a),n?o.length>0:o}_queryCircle(e,t,i,r,n){const a=e-i,o=e+i,s=t-i,l=t+i;if(o<0||a>this.width||l<0||s>this.height)return!r&&[];const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,a,o,s){const l=o.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=n[c+2]&&t<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!s||s(this.boxKeys[h]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[h],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const h=this.circleCells[n];if(null!==h){const n=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],e,t,i,r)&&(!s||s(this.circleKeys[c]))){if(o.hitTest)return a.push(!0),!0;{const e=n[h],t=n[h+1],i=n[h+2];a.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,a,o,s){const l=o.circle,c=o.seenUids,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!s||s(this.boxKeys[t])))return a.push(!0),!0}}const u=this.circleCells[n];if(null!==u){const e=this.circles;for(const t of u)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(e,t,i,r,n,a,o,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),h=this._convertToXCellCoord(i),u=this._convertToYCellCoord(r);for(let d=l;d<=h;d++)for(let l=c;l<=u;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,a){const o=r-e,s=n-t,l=i+a;return l*l>o*o+s*s}_circleAndRectCollide(e,t,i,r,n,a,o){const s=(a-r)/2,l=Math.abs(e-(r+s));if(l>s+i)return!1;const c=(o-n)/2,h=Math.abs(t-(n+c));if(h>c+i)return!1;if(l<=s||h<=c)return!0;const u=l-s,d=h-c;return u*u+d*d<=i*i}}const Wn=100;class Zn{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Hn(e.width+200,e.height+200,25),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Hn(e.width+200,e.height+200,25);this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Wn,this.screenBottomBoundary=e.height+Wn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,a,o,s){let l=i.projectedAnchorX,c=i.projectedAnchorY,h=i.projectedAnchorZ;const u=i.elevation,d=i.tileID,p=e.getProjection();if(u&&d){const[e,t,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*u*n,c+=t*u*n,h+=r*u*n}const f=this.projectAndGetPerspectiveRatio(o,l,c,h,i.tileID,"globe"===p.name||!!u||this.transform.pitch>0,p),m=a*f.perspectiveRatio,g=(i.x1*t+r.x-i.padding)*m+f.point.x,_=(i.y1*t+r.y-i.padding)*m+f.point.y,y=(i.x2*t+r.x+i.padding)*m+f.point.x,x=(i.y2*t+r.y+i.padding)*m+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,x)||!n&&this.grid.hitTest(g,_,y,x,s)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,x],offscreen:this.isOffscreen(g,_,y,x),occluded:!1}}placeCollisionCircles(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=[],_=this.transform.elevation,y=t.getProjection(),x=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,v=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(v.x,v.y,m.canonical);if(x){const[e,t,i]=x(v);b+=e,w+=t,S+=i}const E="globe"===y.name,T=this.projectAndGetPerspectiveRatio(s,b,w,S,m,E||!!_||this.transform.pitch>0,y),{perspectiveRatio:C}=T,k=(u?o/C:o*C)/e.bP,M=Yt(b,w,S,l),A=T.signedDistanceFromCamera>0?ei(k,a,r.lineOffsetX*k,r.lineOffsetY*k,!1,M,v,r,n,l,{},_&&!u?x:null,u&&!!_,y,m,u):null;let P=!1,I=!1,D=!0;if(A&&!T.occluded){const t=.5*p*C+f,r=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new qn,{first:o,last:s}=A,l=o.path.length;let u=[];for(let e=l-1;e>=1;e--)u.push(o.path[e]);for(let e=1;e<s.path.length;e++)u.push(s.path[e]);const m=2.5*t;c&&(u=u.map(((e,t)=>{let[i,r,n]=e;return x&&!E&&(n=x(t<l-1?o.tilePath[l-1-t]:s.tilePath[t-l+2])[2]),Yt(i,r,n,c)})),u.some((e=>e[3]<=0))&&(u=[]));let _=[];if(u.length>0){let t=1/0,i=-1/0,a=1/0,o=-1/0;for(const e of u)t=Math.min(t,e[0]),a=Math.min(a,e[1]),i=Math.max(i,e[0]),o=Math.max(o,e[1]);i>=r.x&&t<=n.x&&o>=r.y&&a<=n.y&&(_=[u.map((t=>new e.P(t[0],t[1])))],(t<r.x||i>n.x||a<r.y||o>n.y)&&(_=e.cH(_,r.x,r.y,n.x,n.y)))}for(const e of _){a.reset(e,.25*t);let r=0;r=a.length<=.5*t?1:Math.ceil(a.paddedLength/m)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),o=a.lerp(n),s=o.x+Wn,l=o.y+Wn;g.push(s,l,t,0);const c=s-t,u=l-t,p=s+t,f=l+t;if(D=D&&this.isOffscreen(c,u,p,f),I=I||this.isInsideGrid(c,u,p,f),!i&&this.grid.hitTestCircle(s,l,t,d)&&(P=!0,!h))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!h&&P||!I?[]:g,offscreen:D,collisionDetected:P,occluded:T.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,a=-1/0,o=-1/0;for(const h of t){const t=new e.P(h.x+Wn,h.y+Wn);r=Math.min(r,t.x),n=Math.min(n,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y),i.push(t)}const s=this.grid.query(r,n,a,o).concat(this.ignoredGrid.query(r,n,a,o)),l={},c={};for(const h of s){const t=h.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const r=[new e.P(h.x1,h.y1),new e.P(h.x2,h.y1),new e.P(h.x2,h.y2),new e.P(h.x1,h.y2)];e.cI(i,r)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,i,r,n,a,o,s){const l=[i,r,n,1];let c=!1;if(n||this.transform.pitch>0){if(e.aB.transformMat4(l,l,t),this.fogState&&a&&"globe"!==s.name){const t=function(t,i,r,n,a,o){const s=o.calculateFogTileMatrix(a),l=[i,r,n];return e.$.transformMat4(l,l,s),et(t,e.$.length(l),o.pitch,o._fov)}(this.fogState,i,r,n,a.toUnwrapped(),this.transform);c=t>.9}}else si(l,l,t);const h=l[3];return{point:new e.P((l[0]/h+1)/2*this.transform.width+Wn,(-l[1]/h+1)/2*this.transform.height+Wn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/h*.5,1.5),signedDistanceFromCamera:h,occluded:o&&l[2]>h||c}}isOffscreen(e,t,i,r){return i<Wn||e>=this.screenRightBoundary||r<Wn||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.ae.identity([]);return e.ae.translate(t,t,[-100,-100,0]),t}}class Xn{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Yn{constructor(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new Xn(e?e.text:null,t,i,n),this.icon=new Xn(e?e.icon:null,t,r,n),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jn{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class Qn{constructor(){this.invProjMatrix=e.ae.create(),this.viewportMatrix=e.ae.create(),this.circles=[]}}class Kn{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class ea{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function ta(t,i,r,n,a){const{horizontalAlign:o,verticalAlign:s}=e.bS(t),l=-(o-.5)*i,c=-(s-.5)*r,h=e.bR(t,n);return new e.P(l+h[0]*a,c+h[1]*a)}function ia(t,i,r,n,a){const o=new e.P(t,i);return r&&o._rotate(n?a:-a),o}class ra{constructor(e,t,i,r,n,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Zn(this.transform,n),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new ea(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n){const a=r.getBucket(i),o=r.latestFeatureIndex;if(!a||!o||i.fqid!==a.layerIds[0])return;const s=a.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/e.a4,u=r.tileID.toUnwrapped();this.transform.setProjection(a.projection);const d=(p=r.tileID,f=a.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):gr(m,f,p));var p,f,m;const g="map"===s.get("text-pitch-alignment"),_="map"===s.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),x=i.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(r),b=Zt(d,r.tileID.canonical,g,_,this.transform,a.getProjection(),v);let w=null;if(g){const t=Xt(d,r.tileID.canonical,g,_,this.transform,a.getProjection(),v);w=e.ae.multiply([],this.transform.labelPlaneMatrix,t)}let S=null;y&&r.latestFeatureIndex&&(S={unwrappedTileID:u,dynamicFilter:y,dynamicFilterNeedsFeature:x,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[a.bucketInstanceId]=new Kn(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);const E={bucket:a,layout:s,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:S,scale:c,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.aE(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.aE(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(n)for(const e of a.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:E})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:E})}attemptAnchorPlacement(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_){const{textOffset0:y,textOffset1:x,crossTileID:v}=u,b=[y,x],w=ta(e,i,r,b,n),S=this.collisionIndex.placeCollisionBox(p,n,t,ia(w.x,w.y,a,o,this.transform.angle),h,s,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(_,this.transform.zoom,u.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,ia(w.x,w.y,a,o,this.transform.angle),h,s,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(t=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:b,width:i,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(p,e,u,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,u),this.placedOrientations[v]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,r,n){const{bucket:a,layout:o,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:h,textPixelRatio:u,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,_=o.get("text-optional"),y=o.get("icon-optional"),x=o.get("text-allow-overlap"),v=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="viewport-y"===o.get("symbol-z-order"),E=o.get("symbol-z-elevate");this.transform.setProjection(a.projection);let T=x&&(v||!a.hasIconData()||y),C=v&&(x||!a.hasTextData()||_);!a.collisionArrays&&p&&a.deserializeCollisionBoxes(p),r&&n&&a.updateCollisionDebugBuffers(this.transform.zoom,p);const k=(t,n,p)=>{const{crossTileID:S,numVerticalGlyphVertices:E}=t;if(h){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(h.dynamicFilterNeedsFeature){const e=this.retainedQueryData[a.bucketInstanceId];n=h.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,h.dynamicFilter)(r,n,this.retainedQueryData[a.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(h.unwrappedTileID)))return this.placements[S]=new Jn(!1,!1,!1,!0),void i.add(S)}if(i.has(S))return;if(d)return void(this.placements[S]=new Jn(!1,!1,!1));let k=!1,M=!1,A=!0,P=!1,I=!1,D=null,R={box:null,offscreen:null,occluded:null},z={box:null,offscreen:null,occluded:null},L=null,F=null,B=null,O=0,N=0,V=0;p.textFeatureIndex?O=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(O=t.featureIndex),p.verticalTextFeatureIndex&&(N=p.verticalTextFeatureIndex);const j=e=>{e.tileID=this.retainedQueryData[a.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=t.zOffset+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},U=p.textBox;if(U){j(U);const i=i=>{let r=e.aF.horizontal;if(a.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[S];e&&(this.placedOrientations[S]=e,r=e,this.markUsedOrientation(a,r,t))}return r},r=(t,i)=>{if(a.allowVerticalPlacement&&E>0&&p.verticalTextBox){for(const r of a.writingModes)if(r===e.aF.vertical?(R=i(),z=R):R=t(),R&&R.box&&R.box.length)break}else R=t()};if(o.get("text-variable-anchor")){let l=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S]){const e=this.prevPlacement.variableOffsets[S];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,r)=>{const o=a.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),c=(e.x2-e.x1)*o+2*e.padding,h=(e.y2-e.y1)*o+2*e.padding,d=t.hasIconTextFit&&!v?i:null;d&&j(d);let p={box:[],offscreen:!1,occluded:!1};const _=x?2*l.length:l.length;for(let y=0;y<_;++y){const i=this.attemptAnchorPlacement(l[y%l.length],e,c,h,o,b,w,u,s,g,y>=l.length,t,n,a,r,d,f,m);if(i&&(p=i.placedGlyphBoxes,p&&p.box&&p.box.length)){k=!0,D=i.shift;break}}return p};r((()=>c(U,p.iconBox,e.aF.horizontal)),(()=>{const t=p.verticalTextBox;return t&&j(t),a.allowVerticalPlacement&&!(R&&R.box&&R.box.length)&&E>0&&t?c(t,p.verticalIconBox,e.aF.vertical):{box:null,offscreen:null,occluded:null}})),R&&(k=R.box,A=R.offscreen,P=R.occluded);const h=i(!(!R||!R.box));if(!k&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[S];e&&(this.variableOffsets[S]=e,this.markUsedJustification(a,e.anchor,t,h))}}else{const o=(i,r)=>{const o=a.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(a,o,i,new e.P(0,0),x,u,s,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(a,r,t),this.placedOrientations[S]=r),l};r((()=>o(U,e.aF.horizontal)),(()=>{const t=p.verticalTextBox;return a.allowVerticalPlacement&&E>0&&t?(j(t),o(t,e.aF.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(R&&R.box&&R.box.length))}}if(L=R,k=L&&L.box&&L.box.length>0,A=L&&L.offscreen,P=L&&L.occluded,t.useRuntimeCollisionCircles){const i=a.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.aG(a.textSizeData,f,i),h=o.get("text-padding");F=this.collisionIndex.placeCollisionCircles(a,x,i,a.lineVertexArray,a.glyphOffsetArray,n,s,l,c,r,w,g.predicate,t.collisionCircleDiameter*n/e.bP,h,this.retainedQueryData[a.bucketInstanceId].tileID),k=x||F.circles.length>0&&!F.collisionDetected,A=A&&F.offscreen,P=F.occluded}if(p.iconFeatureIndex&&(V=p.iconFeatureIndex),p.iconBox){const i=i=>{j(i);const r=t.hasIconTextFit&&D?ia(D.x,D.y,b,w,this.transform.angle):new e.P(0,0),n=a.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(a,n,i,r,v,u,s,g.predicate)};z&&z.box&&z.box.length&&p.verticalIconBox?(B=i(p.verticalIconBox),M=B.box.length>0):(B=i(p.iconBox),M=B.box.length>0),A=A&&B.offscreen,I=B.occluded}const G=_||0===t.numHorizontalGlyphVertices&&0===E,$=y||0===t.numIconVertices;if(G||$?$?G||(M=M&&k):k=M&&k:M=k=M&&k,k&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,o.get("text-ignore-placement"),a.bucketInstanceId,z&&z.box&&N?N:O,g.ID),M&&B&&this.collisionIndex.insertCollisionBox(B.box,o.get("icon-ignore-placement"),a.bucketInstanceId,V,g.ID),F&&(k&&this.collisionIndex.insertCollisionCircles(F.circles,o.get("text-ignore-placement"),a.bucketInstanceId,O,g.ID),r)){const e=a.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Qn);for(let i=0;i<F.circles.length;i+=4)t.circles.push(F.circles[i+0]),t.circles.push(F.circles[i+1]),t.circles.push(F.circles[i+2]),t.circles.push(F.collisionDetected?1:0)}const q="globe"!==a.projection.name;T=T&&(q||!P),C=C&&(q||!I),this.placements[S]=new Jn(k||T,M||C,A||a.justReloaded),i.add(S)};if(E&&this.buildingIndex&&(this.buildingIndex.updateZOffset(a,this.retainedQueryData[a.bucketInstanceId].tileID),a.updateZOffset()),S){const t=a.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];k(a.symbolInstances.get(i),i,a.collisionArrays[i])}a.hasAnyZOffset&&e.w(`${a.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(a.hasAnyZOffset){const e=a.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const i=e[t];k(a.symbolInstances.get(i),i,a.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)k(a.symbolInstances.get(e),e,a.collisionArrays[e]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[a.bucketInstanceId];e.ae.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1}markUsedJustification(t,i,r,n){const{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,h=e.cM(i),u=n===e.aF.vertical?l:"left"===h?a:"center"===h?o:"right"===h?s:-1;a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:c),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=u>=0&&l!==u?0:c)}markUsedOrientation(t,i,r){const n=i===e.aF.horizontal||i===e.aF.horizontalOnly?i:0,a=i===e.aF.vertical?i:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,h=t.text.placedSymbolArray;o>=0&&(h.get(o).placedOrientation=n),s>=0&&(h.get(s).placedOrientation=n),l>=0&&(h.get(l).placedOrientation=n),c>=0&&(h.get(c).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=n[s];t?(this.opacities[s]=new Yn(t,r,e.text,e.icon,null,e.clipped),i=i||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new Yn(null,r,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const s in n){const e=n[s];if(!this.opacities[s]){const t=new Yn(e,r,!1,!1);t.isHidden()||(this.opacities[s]=t,i=i||e.text.placed||e.icon.placed)}}for(const s in a)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=a[s]);for(const s in o)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=o[s]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,i,r){const n=new Set;for(const a of t){const t=a.getBucket(e);t&&a.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,a.collisionBoxArray,i,r,a.tileID,e.scope),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,a.tileID),t.updateZOffset()))}}updateBucketOpacities(t,i,r,n,a,o,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const l=t.layers[0].layout,c=!!t.layers[0].dynamicFilter(),h=new Yn(null,0,!1,!1,!0),u=l.get("text-allow-overlap"),d=l.get("icon-allow-overlap"),p=l.get("text-variable-anchor"),f="map"===l.get("text-rotation-alignment"),m="map"===l.get("text-pitch-alignment"),g=new Yn(null,0,u&&(d||!t.hasIconData()||l.get("icon-optional")),d&&(u||!t.hasTextData()||l.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const _=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};let y=0;a&&t.updateReplacement(o,a);for(let x=0;x<t.symbolInstances.length;x++){const r=t.symbolInstances.get(x),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:u,crossTileID:d,numIconVertices:v,tileAnchorX:b,tileAnchorY:w}=r,S=i.has(d);let E=this.opacities[d];S?E=h:E||(E=g,this.opacities[d]=E),i.add(d);const T=l>0||u>0,C=v>0,k=this.placedOrientations[d],M=k===e.aF.vertical,A=k===e.aF.horizontal||k===e.aF.horizontalOnly;!T&&!C||E.isHidden()||y++;let P=!1;if((T||C)&&a)for(const i of t.activeReplacements){if(e.cJ(i,n,e.cw.Symbol,s))continue;if(i.min.x>b||b>i.max.x||i.min.y>w||w>i.max.y)continue;const t=e.cK(b,w,o.canonical,i.footprintTileId.canonical);if(P=e.cL(t,i),P)break}if(T){const e=P?pa:da(E.text);_(t.text,l,M?pa:e),_(t.text,u,A?pa:e);const i=E.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:s}=r,c=t.text.placedSymbolArray,h=i||M?1:0;n>=0&&(c.get(n).hidden=h),a>=0&&(c.get(a).hidden=h),o>=0&&(c.get(o).hidden=h),s>=0&&(c.get(s).hidden=i||A?1:0);const p=this.variableOffsets[d];p&&this.markUsedJustification(t,p.anchor,r,k);const f=this.placedOrientations[d];f&&(this.markUsedJustification(t,"left",r,f),this.markUsedOrientation(t,f,r))}if(C){const e=P?pa:da(E.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,a=t.icon.placedSymbolArray,o=E.icon.isHidden()?1:0;i>=0&&(_(t.icon,v,M?pa:e),a.get(i).hidden=o),n>=0&&(_(t.icon,r.numVerticalIconVertices,A?pa:e),a.get(n).hidden=o)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[x];if(i){let n=new e.P(0,0),a=!0;if(i.textBox||i.verticalTextBox){if(p){const e=this.variableOffsets[d];e?(n=ta(e.anchor,e.width,e.height,e.textOffset,e.textScale),f&&n._rotate(m?this.transform.angle:-this.transform.angle)):a=!1}c&&(a=!E.clipped),i.textBox&&na(t.textCollisionBox.collisionVertexArray,E.text.placed,!a||M,n.x,n.y),i.verticalTextBox&&na(t.textCollisionBox.collisionVertexArray,E.text.placed,!a||A,n.x,n.y)}const o=a&&Boolean(!A&&i.verticalIconBox);i.iconBox&&na(t.iconCollisionBox.collisionVertexArray,E.icon.placed,o,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0),i.verticalIconBox&&na(t.iconCollisionBox.collisionVertexArray,E.icon.placed,!o,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===y,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function na(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const aa=Math.pow(2,25),oa=Math.pow(2,24),sa=Math.pow(2,17),la=Math.pow(2,16),ca=Math.pow(2,9),ha=Math.pow(2,8),ua=Math.pow(2,1);function da(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*aa+t*oa+i*sa+t*la+i*ca+t*ha+i*ua+t}const pa=0;class fa{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,r,n){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class ma{constructor(e,t,i,r,n,a,o,s,l){this.placement=new ra(e,n,a,o,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r,n){const a=e.e.now(),o=()=>{const t=e.e.now()-a;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const a=i[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=s)&&(!a.maxzoom||a.maxzoom>s)){const t=a,i=t.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new fa(t),l=e.am(a.source,a.scope);if(s.continuePlacement(i?n[l]:r[l],this.placement,this._showCollisionBoxes,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ga=512/e.a4/2;class _a{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this.index=new e.cN(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=t.canonical.x*e.a4,a=t.canonical.y*e.a4;for(let e=0;e<i.length;e++){const{key:t,crossTileID:r,tileAnchorX:o,tileAnchorY:s}=i.get(e),l=Math.floor((n+o)*ga),c=Math.floor((a+s)*ga);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(r)}this.index.finish()}findMatches(t,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),a=ga/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=i.canonical.x*e.a4,s=i.canonical.y*e.a4;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:h}=i,u=Math.floor((o+c)*a),d=Math.floor((s+h)*a),p=this.index.range(u-n,d-n,u+n,d+n);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!r.has(t)){r.add(t),i.crossTileID=t;break}}}}}class ya{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const i in this.indexes){const e=this.indexes[i],r={};for(const i in e){const n=e[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[i]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let n=0;n<t.symbolInstances.length;n++)t.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const r=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const i=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in i){const a=i[n];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,r)}else{const a=i[e.scaledTo(Number(n)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let n=0;n<t.symbolInstances.length;n++){const e=t.symbolInstances.get(n);e.crossTileID||(e.crossTileID=i.generate(),r.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new _a(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class va{constructor(){this.layerIndexes={},this.crossTileIDs=new ya,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.fqid];void 0===n&&(n=this.layerIndexes[e.fqid]=new xa);let a=!1;const o={};"globe"!==r.name&&n.handleWrapJump(i);for(const s of t){const t=s.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(s.tileID,t,this.crossTileIDs)&&(a=!0),o[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(a=!0),a}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const i in this.layerIndexes)t[i]||delete this.layerIndexes[i]}}const ba=new e.U({data:new e.W(e.N.colorTheme.data)}),wa=(e,t)=>He(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),Sa=e.ai(Bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Ea=e.ai(Bn,["setCenter","setZoom","setBearing","setPitch"]),Ta={version:8,layers:[],sources:{}},Ca={duration:300,delay:0};class ka extends e.E{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=e.Q({},Ca),this._buildingIndex=new zn(this),this.crossTileSymbolIndex=new va,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new _,this.dispatcher=i.dispatcher?i.dispatcher:new e.by(e.bz(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new le,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new e.cP(t._requestManager,i.localFontFamily?e.cQ.all:i.localIdeographFontFamily?e.cQ.ideographs:e.cQ.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new oe(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",e.cR());const r=this;this._rtlTextPluginCallback=ka.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.cS(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const i in this._layers){const e=this._layers[i];e.source===t.id&&this._validateLayer(e)}}))}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.cT(t))return t;const i=e.cU(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(e){return i}return i}return`json://${e.cV(JSON.stringify(t))}`}_diffStyle(t,i,r){this.globalId=this._getGlobalId(t);const n=(e,t)=>{try{t(null,this.setState(e,r))}catch(e){t(e,!1)}};if("string"==typeof t){const r=this.map._requestManager.normalizeStyleURL(t),a=this.map._requestManager.transformRequest(r,e.R.Style);e.h(a,((t,r)=>{t?this.fire(new e.f(t)):r&&n(r,i)}))}else"object"==typeof t&&n(t,i)}loadURL(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.g("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.cT(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const n=this.importsCache.get(t);if(n)return this._load(n,r);const a=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.h(a,((i,n)=>{if(this._request=null,i)this.fire(new e.f(i));else if(n)return this.importsCache.set(t,n),this._load(n,r)}))}loadJSON(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.e.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.g("dataloading",{dataType:"style"})),this._load(Ta,!1)}_loadImports(t,i,r){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const e of t){const t=this._createFragmentStyle(e),a=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(n.push(a),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const o=e.data||this.importsCache.get(e.url);o?(t.loadJSON(o,{validate:i}),this._isInternalStyle(o)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:i}):t.loadEmpty();const s={style:t,id:e.id,config:e.config};if(r){const e=this.fragments.findIndex((e=>{let{id:t}=e;return t===r}));this.fragments=this.fragments.slice(0,e).concat(s).concat(this.fragments.slice(e))}else this.fragments.push(s)}return Promise.allSettled(n)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const i of e.fragments)i.style.globalId&&t.add(i.style.globalId),this.getImportGlobalIds(i.style,t);return[...t.values()]}_createFragmentStyle(t){const i=this.scope?e.am(t.id,this.scope):t.id;let r;const n=this._initialConfig&&this._initialConfig[i];(t.config||n)&&(r=e.Q({},t.config,n));const a=new ka(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r,configOptions:this.options,configDependentLayers:this._configDependentLayers});return a.setEventedParent(this.map,{style:a}),a}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,i){const r=t.schema;if(this._isInternalStyle(t)){const r=e.Q({},Ta,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(r,i)}if(this.updateConfig(this._config,r),i&&wa(this,ze(t)))return;this._loaded=!0,this.stylesheet=e.cW(t);const n=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const r=Fn(this.stylesheet.layers);if(this._order=r.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Ze(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ze(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const t of r){const i=e.c$(t,this.scope,this._styleColorTheme.lut,this.options);0!==i.configDependencies.size&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize();const r=this.getOwnLayerSourceCache(i),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&i.canCastShadows()&&n&&(r.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const n=this.stylesheet.terrain;n&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(n,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.g("data",{dataType:"style"}));const a=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then((()=>{this._reloadImports(),this.fire(new e.g(a?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new e.g(a?"style.load":"style.import.load")))},a=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=a,a){const t=this._evaluateColorThemeData(a);this._loadColorTheme(t).then((()=>{n()})).catch((t=>{e.w(`Couldn't load color theme from the stylesheet: ${t}`),n()}))}else this._styleColorTheme.lut=null,n()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,r,n,a,o,s,l;const c={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(r=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(a=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(o=e.stylesheet.projection),null!=e.stylesheet.transition&&(s=e.stylesheet.transition),c[e.scope]=e._styleColorTheme}})),this.light=t,this.ambientLight=i,this.directionalLight=r,this.fog=a,this._styleColorThemeForScope=c,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=e.Q({},Ca,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=i=>{for(const e of i.fragments)t(e.style);e(i)};t(this)}_prioritizeTerrain(e,t,i){const r=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:r?e:null:null!=t&&(!e||r||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},i={},r={};this.forEachFragmentStyle((n=>{for(const i in n._sourceCaches){const r=e.am(i,n.scope);t[r]=n._sourceCaches[i]}for(const t in n._otherSourceCaches){const r=e.am(t,n.scope);i[r]=n._otherSourceCaches[t]}for(const t in n._symbolSourceCaches){const i=e.am(t,n.scope);r[i]=n._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){var t=this;const i={},r=[],n={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((t=>{for(const n of t._order){const a=t._layers[n];if("slot"===a.type){const t=e.cX(n);if(i[t])continue;i[t]=[]}a.slot&&i[a.slot]?i[a.slot].push(a):r.push(a)}})),this._mergedOrder=[],this._clipLayerIndices=[];let a=0;const o=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const s of r)if("slot"===s.type){const r=e.cX(s.id);i[r]&&o(i[r]),t._mergedSlots.push(r)}else{const i=e.am(s.id,s.scope);t._mergedOrder.push(i),n[i]=s,s.is3D()&&(t._has3DLayers=!0),"circle"===s.type&&(t._hasCircleLayers=!0),"symbol"===s.type&&(t._hasSymbolLayers=!0),"clip"===s.type&&t._clipLayerIndices.push(a),a++}};o(r),this._mergedOrder.sort(((e,t)=>{const i=n[e],r=n[t];return i.hasInitialOcclusionOpacityProperties?r.is3D()?1:0:i.is3D()&&r.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.Q({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,i,r){const n=e.Q({},i);for(const o of Object.keys(e.N.colorTheme))void 0===n[o]&&(n[o]=e.N.colorTheme[o].default);const a=new e.O(ba,t,new Map(r));return a.setTransitionOrValue(n,r),a.untransitioned().possiblyEvaluate(new e.Y(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((r,n)=>{const a="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void r();let o=t;o.startsWith(a)||(o=a+o);const s="mapbox-reserved-lut",l=new Image;l.src=o,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,n(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void r();this._styleColorTheme.lutLoading=!1;const{width:a,height:o,data:c}=e.e.getImageData(l);if(o>32)return void n(new Error("The height of the image must be less than or equal to 32 pixels."));if(a!==o*o)return void n(new Error("The width of the image must be equal to the height squared."));this.getImage(s)&&this.removeImage(s),this.addImage(s,{data:new e.j({width:a,height:o},c),pixelRatio:1,sdf:!1,version:0});const h=this.imageManager.getImage(s,this.scope);h?(this._styleColorTheme.lut={image:h.data,data:t},r()):n(new Error("Missing LUT image."))}}))}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,a,o;const s=e.e.devicePixelRatio>1?"@2x":"";let l=e.h(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.R.SpriteJSON),((e,t)=>{l=null,o||(o=e,n=t,h())})),c=e.i(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.R.SpriteImage),((e,t)=>{c=null,o||(o=e,a=t,h())}));function h(){if(o)r(o);else if(n&&a){const t=e.e.getImageData(a),i={};for(const r in n){const{width:a,height:o,x:s,y:l,sdf:c,pixelRatio:h,stretchX:u,stretchY:d,content:p}=n[r],f=new e.j({width:a,height:o});e.j.copy(t,f,{x:s,y:l},{x:0,y:0},{width:a,height:o},null),i[r]={data:f,pixelRatio:h,sdf:c,stretchX:u,stretchY:d,content:p}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.f(t));else if(i)for(const e in i)this.imageManager.addImage(e,this.scope,i[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.g("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.f(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const i=this.fragments[t];return i&&i.style&&(e.data=i.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new e.f(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new e.f(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(e,t){const i=this.map.painter;if(i)for(let r=e.minzoom||0;r<(e.maxzoom||25.5);r++){const r=e.getProgramIds();if(r)for(const n of r){const r=e.getDefaultProgramParams(n,t.zoom,this._styleColorTheme.lut);r&&(i.style=this,this.fog&&(i._fogVisible=!0,r.overrideFog=!0,i.getOrCreateProgram(n,r)),i._fogVisible=!1,r.overrideFog=!1,i.getOrCreateProgram(n,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,i.getOrCreateProgram(n,r)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();let n=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:r}=e[t];(i||r)&&(this._updateWorkerLayers(t,i,r),n=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const a={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];a[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this.getLayerSourceCache(i);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,i.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(i,t)})):this.precompilePrograms(i,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&n&&this.mergeLayers();for(const o in a){const t=this._mergedSourceCaches[o];a[o]!==t.used&&t.getSource().fire(new e.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new e.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,i){const r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:i||[],options:r.options})}setState(t,i){if(this._checkLoaded(),wa(this,ze(t)))return!1;(t=e.cW(t)).layers=Fn(t.layers);const r=function(t,i){if(!t)return[{command:Bn.setStyle,args:[i]}];let r=[];try{if(!e.d(t.version,i.version))return[{command:Bn.setStyle,args:[i]}];if(e.d(t.center,i.center)||r.push({command:Bn.setCenter,args:[i.center]}),e.d(t.zoom,i.zoom)||r.push({command:Bn.setZoom,args:[i.zoom]}),e.d(t.bearing,i.bearing)||r.push({command:Bn.setBearing,args:[i.bearing]}),e.d(t.pitch,i.pitch)||r.push({command:Bn.setPitch,args:[i.pitch]}),e.d(t.sprite,i.sprite)||r.push({command:Bn.setSprite,args:[i.sprite]}),e.d(t.glyphs,i.glyphs)||r.push({command:Bn.setGlyphs,args:[i.glyphs]}),e.d(t.imports,i.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;i=i||[];const n=(t=t||[]).map(Gn),a=i.map(Gn),o=t.reduce($n,{}),s=i.reduce($n,{}),l=n.slice();let c,h,u,d;for(c=0,h=0;c<n.length;c++)u=n[c],s.hasOwnProperty(u)?h++:(r.push({command:Bn.removeImport,args:[u]}),l.splice(l.indexOf(u,h),1));for(c=0,h=0;c<a.length;c++)u=a[a.length-1-c],l[l.length-1-c]!==u&&(o.hasOwnProperty(u)?(r.push({command:Bn.removeImport,args:[u]}),l.splice(l.lastIndexOf(u,l.length-h),1)):h++,d=l[l.length-c],r.push({command:Bn.addImport,args:[s[u],d]}),l.splice(l.length-c,0,u));for(const p of i){const t=o[p.id];t&&!e.d(t,p)&&r.push({command:Bn.updateImport,args:[p.id,p]})}}(t.imports,i.imports,r),e.d(t.transition,i.transition)||r.push({command:Bn.setTransition,args:[i.transition]}),e.d(t.light,i.light)||r.push({command:Bn.setLight,args:[i.light]}),e.d(t.fog,i.fog)||r.push({command:Bn.setFog,args:[i.fog]}),e.d(t.projection,i.projection)||r.push({command:Bn.setProjection,args:[i.projection]}),e.d(t.lights,i.lights)||r.push({command:Bn.setLights,args:[i.lights]}),e.d(t.camera,i.camera)||r.push({command:Bn.setCamera,args:[i.camera]}),!e.d(t["color-theme"],i["color-theme"]))return[{command:Bn.setStyle,args:[i]}];const n={},a=[];!function(t,i,r,n){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(i.hasOwnProperty(a)||Nn(a,r,n));for(a in i){if(!i.hasOwnProperty(a))continue;const o=i[a];t.hasOwnProperty(a)?e.d(t[a],o)||("geojson"===t[a].type&&"geojson"===o.type&&jn(t,i,a)?r.push({command:Bn.setGeoJSONSourceData,args:[a,o.data]}):Vn(a,i,r,n)):On(a,i,r)}}(t.sources,i.sources,a,n);const o=[];t.layers&&t.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:Bn.removeLayer,args:[e.id]}):o.push(e)}));let s=t.terrain;s&&n[s.source]&&(r.push({command:Bn.setTerrain,args:[void 0]}),s=void 0),r=r.concat(a),e.d(s,i.terrain)||r.push({command:Bn.setTerrain,args:[i.terrain]}),function(t,i,r){i=i||[];const n=(t=t||[]).map(Gn),a=i.map(Gn),o=t.reduce($n,{}),s=i.reduce($n,{}),l=n.slice(),c=Object.create(null);let h,u,d,p,f,m,g;for(h=0,u=0;h<n.length;h++)d=n[h],s.hasOwnProperty(d)?u++:(r.push({command:Bn.removeLayer,args:[d]}),l.splice(l.indexOf(d,u),1));for(h=0,u=0;h<a.length;h++)d=a[a.length-1-h],l[l.length-1-h]!==d&&(o.hasOwnProperty(d)?(r.push({command:Bn.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,m=l[l.length-h],r.push({command:Bn.addLayer,args:[s[d],m]}),l.splice(l.length-h,0,d),c[d]=!0);for(h=0;h<a.length;h++)if(d=a[h],p=o[d],f=s[d],!c[d]&&!e.d(p,f))if(e.d(p.source,f.source)&&e.d(p["source-layer"],f["source-layer"])&&e.d(p.type,f.type)){for(g in Un(p.layout,f.layout,r,d,null,Bn.setLayoutProperty),Un(p.paint,f.paint,r,d,null,Bn.setPaintProperty),e.d(p.slot,f.slot)||r.push({command:Bn.setSlot,args:[d,f.slot]}),e.d(p.filter,f.filter)||r.push({command:Bn.setFilter,args:[d,f.filter]}),e.d(p.minzoom,f.minzoom)&&e.d(p.maxzoom,f.maxzoom)||r.push({command:Bn.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Un(p[g],f[g],r,d,g.slice(6),Bn.setPaintProperty):e.d(p[g],f[g])||r.push({command:Bn.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Un(p[g],f[g],r,d,g.slice(6),Bn.setPaintProperty):e.d(p[g],f[g])||r.push({command:Bn.setLayerProperty,args:[d,g,f[g]]}))}else r.push({command:Bn.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],r.push({command:Bn.addLayer,args:[f,m]})}(o,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Bn.setStyle,args:[i]}]}return r}(this.serialize(),t).filter((e=>!(e.command in Ea)));if(0===r.length)return!1;const n=r.filter((e=>!(e.command in Sa)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);const a=[];return r.forEach((e=>{a.push(this[e.command].apply(this,e.args))})),i&&Promise.all(a).then(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.f(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate($e,`models.${e}`,t,null,i)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(Le,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=Pi(t,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const a=t=>{const i=(t?"symbol:":"other:")+n.id,r=e.am(i,this.scope),a=this._sourceCaches[i]=new e.bx(r,n,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=a,a.onAdd(this.map)};a(!1),"vector"!==i.type&&"geojson"!==i.type||a(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===t)return this.fire(new e.f(new Error(`Source "${t}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.f(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(t);for(const n of r){const t=e.cX(n.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(n.id),n.fire(new e.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const i=this.getOwnSourceCache(t);i&&e.push(i.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const n of t){if(this._validate(Be,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(n),e.updateTransitions(i)}else this.ambientLight=new ot(n,st||(st=new e.U({color:new e.W(e.N.properties_light_ambient.color),intensity:new e.W(e.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(n),e.updateTransitions(i)}else this.directionalLight=new ot(n,lt||(lt=new e.U({direction:new e.a6(e.N.properties_light_directional.direction),color:new e.W(e.N.properties_light_directional.color),intensity:new e.W(e.N.properties_light_directional.intensity),"cast-shadows":new e.W(e.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.W(e.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const r=new e.Y(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const r=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=t.properties.get("color").toRenderColor(null).toArray01(),a=t.properties.get("intensity"),o=t.properties.get("direction"),s=1-e.ad(o.x,o.y,o.z)[2]/90,l=r(n)*a*s,c=i.properties.get("color").toRenderColor(null).toArray01(),h=i.properties.get("intensity");return(l+r(c)*h)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.cY(t)){const i=e.cZ(t),r=this.fragments.find((e=>{let{id:t}=e;return t===i}));if(!r)throw new Error(`Style import not found: ${t}`);const n=e.cX(t);return r.style.getFragmentStyle(n)}{const e=this.fragments.find((e=>{let{id:i}=e;return i===t}));if(!e)throw new Error(`Style import not found: ${t}`);return e.style}}getConfigProperty(t,i){const r=this.getFragmentStyle(t);if(!r)return null;const n=e.am(i,r.scope),a=r.options.get(n),o=a?a.value||a.default:null;return o?o.serialize():null}setConfigProperty(t,i,r){const n=this.getFragmentStyle(t);if(!n)return;const a=n.stylesheet.schema;if(!a||!a[i])return;const o=e.z(r);if("success"!==o.result)return void wa(this,o.value);const s=o.value.expression,l=e.am(i,n.scope),c=n.options.get(l);if(!c)return;let h;const{minValue:u,maxValue:d,stepValue:p,type:f,values:m}=a[i],g=e.z(a[i].default);"success"===g.result&&(h=g.value.expression),h?(this.options.set(l,{...c,value:s,default:h,minValue:u,maxValue:d,stepValue:p,type:f,values:m}),this.updateConfigDependencies(i)):this.fire(new e.f(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const r=i.stylesheet.schema;if(!r)return null;const n={};for(const a in r){const t=e.am(a,i.scope),r=i.options.get(t),o=r?r.value||r.default:null;n[a]=o?o.serialize():null}return n}setConfig(e,t){const i=this.getFragmentStyle(e);i&&(i.updateConfig(t,i.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const i=this.getFragmentStyle(e);i&&(i.stylesheet.schema=t,i.updateConfig(i._config,t),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const r in i){let n,a;const o=e.z(i[r].default);if("success"===o.result&&(n=o.value.expression),t&&void 0!==t[r]){const i=e.z(t[r]);"success"===i.result&&(a=i.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:h,values:u}=i[r];if(n){const t=e.am(r,this.scope);this.options.set(t,{default:n,value:a,minValue:s,maxValue:l,stepValue:c,type:h,values:u})}else this.fire(new e.f(new Error(`No schema defined for config option "${r}".`)))}else this.fire(new e.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(const t of this._configDependentLayers){const i=this.getLayer(t);if(i){if(e&&!i.configDependencies.has(e))continue;i.possiblyEvaluateVisibility(),this._updateLayer(i)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle((e=>{if(e._styleColorTheme.colorTheme){const t=e._evaluateColorThemeData(e._styleColorTheme.colorTheme);(!e._styleColorTheme.lut&&""!==t||e._styleColorTheme.lut&&t!==e._styleColorTheme.lut.data)&&e.setColorTheme(e._styleColorTheme.colorTheme)}})),this._changes.setDirty()}addLayer(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=t.id;if(this._layers[n])return void this.fire(new e.f(new Error(`Layer with id "${n}" already exists on this map`)));let a;if("custom"===t.type){if(wa(this,e.c_(t)))return;a=e.c$(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.cW(t),t=e.Q(t,{source:n})),this._validate(Ve,`layers.${n}`,t,{arrayIndex:-1},r))return;a=e.c$(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[a.id]=a.serialize()}0!==a.configDependencies.size&&this._configDependentLayers.add(a.fqid);let o=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.f(new Error(`Layer with id "${i}" does not exist on this map.`)));a.slot===this._layers[i].slot?o=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=a;const s=this.getOwnLayerSourceCache(a),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&a.canCastShadows()&&l&&(s.castsShadows=!0);const c=this._changes.getRemovedLayer(a);if(c&&a.source&&s&&"custom"!==a.type){this._changes.discardLayerRemoval(a);const t=e.am(a.source,a.scope);c.type!==a.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map),a.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);let a=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.f(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?a=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const r=this.getOwnLayerSourceCache(t);if(r&&r.castsShadows){let e=!1;for(const i in this._layers)if(this._layers[i].source===t.source&&this._layers[i].canCastShadows()){e=!0;break}r.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,i){this._checkLoaded();const r=this._checkLayer(e);r&&(r.minzoom===t&&r.maxzoom===i||(null!=t&&(r.minzoom=t),null!=i&&(r.maxzoom=i),this._updateLayer(r)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==t&&(i.slot=t,this._updateLayer(i))}setFilter(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=this._checkLayer(t);if(n&&!e.d(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(je,`layers.${n.id}.filter`,i,{layerType:n.type},r)||(n.filter=e.cW(i),this._updateLayer(n)))}getFilter(t){const i=this._checkLayer(t);if(i)return e.cW(i.filter)}setLayoutProperty(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this._checkLayer(t);if(a&&!e.d(a.getLayoutProperty(i),r)){if(null!=r&&(!n||!1!==n.validate)&&wa(a,Ge.call(ze,{key:`layers.${t}.layout.${i}`,layerType:a.type,objectKey:i,value:r,styleSpec:e.N,style:{glyphs:!0,sprite:!0}})))return;a.setLayoutProperty(i,r),0!==a.configDependencies.size&&this._configDependentLayers.add(a.fqid),this._updateLayer(a)}}getLayoutProperty(e,t){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(t)}setPaintProperty(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this._checkLayer(t);if(!a)return;if(e.d(a.getPaintProperty(i),r))return;if(null!=r&&(!n||!1!==n.validate)&&wa(a,Ue.call(ze,{key:`layers.${t}.paint.${i}`,layerType:a.type,objectKey:i,value:r,styleSpec:e.N})))return;const o=a.setPaintProperty(i,r);0!==a.configDependencies.size&&this._configDependentLayers.add(a.fqid),o&&this._updateLayer(a),this._changes.updatePaintProperties(a)}getPaintProperty(e,t){const i=this._checkLayer(e);if(i)return i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,a=this._checkSource(r);if(!a)return;const o=a.type;if("geojson"===o&&n)return void this.fire(new e.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!n)return void this.fire(new e.f(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.f(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(r);for(const e of s)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this._checkSource(r);if(!n)return;const a=n.type,o="vector"===a?t.sourceLayer:void 0;if("vector"===a&&!o)return void this.fire(new e.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.f(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(r);for(const e of s)e.removeFeatureState(o,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this._checkSource(i);if(n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.Q({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),r=e.am(t.source,t.scope),n=this._changes.getUpdatedSourceCaches();t.source&&!n[r]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(r,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,i=this.order,r={},n=[];for(let o=i.length-1;o>=0;o--){const a=i[o];if(t(a)){r[a]=o;for(const t of e){const e=t[a];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const a=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(t(s))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(t.layer&&r[t.layer.id]<o)break;a.push(t),n.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)a.push(t.feature)}}return a}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(je,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.f(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._mergedLayers[t];if(!i)return this.fire(new e.f(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const a=[],o=i.serializedLayers||{},s=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Cn.createFromScreenPoints(t,r);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==i.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;i.layers&&!n[c]||a.push(In(this._mergedSourceCaches[e],this._mergedLayers,o,l,i,r,s,!!this.map._showQueryGeometry))}return this.placement&&a.push(function(e,t,i,r,n,a,o){const s={},l=a.queryRenderedSymbols(r),c=[];for(const h of Object.keys(l).map(Number))c.push(o[h]);c.sort(Rn);for(const h of c){const i=h.featureIndex.lookupSymbolFeatures(l[h.bucketInstanceId],t,h.bucketIndex,h.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in i){const t=s[e]=s[e]||[],r=i[e];r.sort(((e,t)=>{const i=h.featureSortOrder;if(i){const r=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const h in s)s[h].forEach((t=>{const r=t.feature,n=i(e[h]);if(!n)return;const a=n.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a}));return s}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(e,t){t&&t.filter&&this._validate(je,"querySourceFeatures.filter",t.filter,null,t);const i=this.getOwnSourceCaches(e);let r=[];for(const n of i)r=r.concat(Dn(n,t));return r}addSourceType(e,t,i){return ka.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(ka.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=this.light.getLight();let a=!1;for(const s in t)if(!e.d(t[s],n[s])){a=!0;break}if(!a)return;const o=this._getTransitionParameters();this.light.setLight(t,i,r),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===i&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let r=t;const n=null==t.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.cW(r),r=e.Q(r,{source:t})}const t=e.Q({},r),i={};if(this.terrain&&n){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(i.style=e.serialize())}if(this._validate(Oe,"terrain",t,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!n||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new e.g("data",{dataType:"style"}))}else{const i=this.terrain,n=i.get();for(const t of Object.keys(e.N.terrain))!r.hasOwnProperty(t)&&e.N.terrain[t].default&&(r[t]=e.N.terrain[t].default);for(const r in t)if(!e.d(t[r],n[r])){i.set(t,this.options),this.stylesheet.terrain=t;const r=this._getTransitionParameters({duration:0});i.updateTransitions(r),this.fire(new e.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new at(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!e.d(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();const i=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void i();const r=this._evaluateColorThemeData(t);this._loadColorTheme(r).then((()=>{this.fire(new e.g("colorthemeset")),i()})).catch((t=>{e.w(`Couldn't set color theme: ${t}`)}))}_getTransitionParameters(t){return{now:e.e.now(),transition:e.Q(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const i of this._mergedOrder)this.isLayerDraped(this._mergedLayers[i])?e.push(i):t.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new Ye(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(a&&!1===a.validate)return!1;const o=e.Q({},this.serialize());return wa(this,t.call(ze,e.Q({key:i,style:o,value:r,styleSpec:e.N},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const i of t)i.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const i of t)i.resume(),i.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=yi(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n,a,o){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const h={},u={};for(const d of this._mergedOrder){const t=this._mergedLayers[d];if("symbol"!==t.type)continue;const r=e.am(t.source,t.scope);let n=h[r];if(!n){const e=this.getLayerSourceCache(t);if(!e)continue;const i=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));u[r]=i.slice(),n=h[r]=i.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(t,n,i.center.lng,i.projection);l=l||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.g("neworder")),(s||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.e.now(),i.zoom))&&(this.pauseablePlacement=new ma(i,this._mergedOrder,s,r,n,a,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,h,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.e.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(i.zoom);for(let t=0;t<this._mergedOrder.length;t++){const i=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==i.type)continue;const r=this.isLayerClipped(i)&&this._clipLayerIndices.some((e=>t<e));this.placement.updateLayerOpacities(i,h[e.am(i.source,i.scope)],t,r?o:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.e.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==r.findIndex((e=>{let{id:i}=e;return i===t.id})))return void this.fire(new e.f(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return r.push(t),this._loadImports([t],!0);const n=r.findIndex((e=>{let{id:t}=e;return t===i}));return-1===n&&this.fire(new e.f(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=r.slice(0,n).concat(t).concat(r.slice(n)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(t);return-1===n?this:"string"==typeof i?(this.setImportUrl(t,i),this):(i.url&&i.url!==r[n].url&&this.setImportUrl(t,i.url),e.d(i.config,r[n].config)||this.setImportConfig(t,i.config),e.d(i.data,r[n].data)||this.setImportData(t,i.data),this)}moveImport(e,t){this._checkLoaded();let i=this.stylesheet.imports||[];const r=this.getImportIndex(e);if(-1===r)return this;const n=this.getImportIndex(t);if(-1===n)return this;const a=i[r],o=this.fragments[r];return i=i.filter((t=>{let{id:i}=t;return i!==e})),this.fragments=this.fragments.filter((t=>{let{id:i}=t;return i!==e})),this.stylesheet.imports=i.slice(0,n).concat(a).concat(i.slice(n)),this.fragments=this.fragments.slice(0,n).concat(o).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(e);if(-1===r)return this;i[r].url=t;const n=this.fragments[r];return n.style=this._createFragmentStyle(i[r]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(e,r[i].url))}setImportConfig(e,t){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===i)return this;t?r[i].config=t:delete r[i].config;const n=this.fragments[i],a=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=t,n.style.updateConfig(t,a),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],i=this.getImportIndex(e);-1!==i&&(t.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===i&&this.fire(new e.f(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[t];i&&e.push(i.getSource())}return e}getSource(e,t){const i=this.getSourceCache(e,t);return i&&i.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,i){const r=e.am(t,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const i=e.am(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const i=e[t];"reload"===i?this.reloadSource(t):"clear"===i&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e)}}getImages(e,t,i){this.imageManager.getImages(t.icons,t.scope,i),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,t.scope,i)}getResource(t,i,r){return e.d2(i,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return 0===i.length?(this.fire(new e.f(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,i){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==t.type)return!1;const r="fill-extrusion"===t.type&&"building"===t.sourceLayer;let n=0;if(t.is3D()){if(r||i&&"batched-model"===i.type)return!0;"model"===t.type&&(n=e.cw.Model)}else"symbol"===t.type&&(n=e.cw.Symbol);for(const a of this._clipLayerIndices){const t=this._mergedLayers[this._mergedOrder[a]];if(!t)continue;const i=[];for(const r of t.layout.get("clip-layer-types"))i.push("model"===r?e.cw.Model:"symbol"===r?e.cw.Symbol:e.cw.FillExtrusion);for(const e of i)if(n&e)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Ma(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}ka.getSourceType=function(e){return Ai[e]},ka.setSourceType=function(e,t){Ai[e]=t},ka.registerForPluginStateChange=e.cO;class Aa{constructor(t){this._hashName=t&&encodeURIComponent(t),e.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ma(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=Pa(e);if(this._hashName){const e=this._hashName;let i=!1;const r=location.hash.slice(1).split("&").map((r=>{const n=r.split("=")[0];return n===e?(i=!0,`${n}=${t}`):r})).filter((e=>e));return i||r.push(`${e}=${t}`),`#${r.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Pa(e,t){const i=e.getCenter(),r=Math.round(100*e.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,n),o=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=e.getBearing(),c=e.getPitch();let h=t?`/${o}/${s}/${r}`:`${r}/${s}/${o}`;return(l||c)&&(h+="/"+Math.round(10*l)/10),c&&(h+=`/${Math.round(c)}`),h}const Ia={linearity:.3,easing:e.d3(0,0,.3,1)},Da=e.Q({deceleration:2500,maxSpeed:1400},Ia),Ra=e.Q({deceleration:20,maxSpeed:1400},Ia),za=e.Q({deceleration:1e3,maxSpeed:360},Ia),La=e.Q({deceleration:1e3,maxSpeed:90},Ia);class Fa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.e.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.e.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const a=Oa(i.pan.mag(),r,e.Q({},Da,t||{}));n.offset=i.pan.mult(a.amount/i.pan.mag()),n.center=this._map.transform.center,Ba(n,a)}if(i.zoom){const e=Oa(i.zoom,r,Ra);n.zoom=this._map.transform.zoom+e.amount,Ba(n,e)}if(i.bearing){const t=Oa(i.bearing,r,za);n.bearing=this._map.transform.bearing+e.au(t.amount,-179,179),Ba(n,t)}if(i.pitch){const e=Oa(i.pitch,r,La);n.pitch=this._map.transform.pitch+e.amount,Ba(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function Ba(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Oa(t,i,r){const{maxSpeed:n,linearity:a,deceleration:o}=r,s=e.au(t*a/(i/1e3),-n,n),l=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class Na extends e.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=p(i.getCanvasContainer(),r),o=i.unproject(a);super(t,e.Q({point:a,lngLat:o,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class Va extends e.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,a=f(i.getCanvasContainer(),n),o=a.map((e=>i.unproject(e))),s=a.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.P(0,0));super(t,{points:a,point:s,lngLats:o,lngLat:i.unproject(s),originalEvent:r}),this._defaultPrevented=!1}}class ja extends e.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Ua{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new ja(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Na(e.type,this._map,e))}mouseup(e){this._map.fire(new Na(e.type,this._map,e))}preclick(t){const i=e.Q({},t);i.type="preclick",this._map.fire(new Na(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Na(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Na(e.type,this._map,e))}mouseover(e){this._map.fire(new Na(e.type,this._map,e))}mouseout(e){this._map.fire(new Na(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Va(e.type,this._map,e))}touchmove(e){this._map.fire(new Va(e.type,this._map,e))}touchend(e){this._map.fire(new Va(e.type,this._map,e))}touchcancel(e){this._map.fire(new Va(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ga{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Na(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Na("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Na(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $a{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(c(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,r=this._startPos,a=this._lastPos;if(!r||!a||a.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=n("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(r.x,i.x),s=Math.max(r.x,i.x),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${o}px,${l}px)`,this._box.style.width=s-o+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&0===t.button){if(this.reset(),d(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.g("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.g(t,{originalEvent:i}))}}function qa(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class Ha{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=qa(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=qa(i,t);for(const n in this.touches){const e=r[n];(!e||e.dist(this.touches[n])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Wa{constructor(e){this.singleTap=new Ha(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Za{constructor(){this._zoomIn=new Wa({numTouches:1,numTaps:2}),this._zoomOut=new Wa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xa={0:1,2:2};class Ya{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=m(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=Xa[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&m(e)===this._eventButton&&(this._moved&&d(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ja extends Ya{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Qa extends Ya{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class Ka extends Ya{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class eo{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!e.d4())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,r)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=qa(r,i),a=new e.P(0,0),o=new e.P(0,0);let s=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(a._add(t),o._add(t.sub(i)),s++,n[e]=t)}if(this._touches=n,s<this._minTouches||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=n("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class to{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[n,a]=r,o=io(i,t,n),s=io(i,t,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,a=io(i,t,r),o=io(i,t,n);a&&o||(this._active&&d(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function io(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function ro(e,t){return Math.log(e/t)/Math.LN2}class no extends to{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ro(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ro(this._distance,i),pinchAround:t}}}function ao(e,t){return 180*e.angleWith(t)/Math.PI}class oo extends to{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ao(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=ao(e,i);return Math.abs(r)<t}}function so(e){return Math.abs(e.y)>Math.abs(e.x)}class lo extends to{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,so(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,r){const n=this._lastPoints;if(!n)return;const a=t[0].sub(n[0]),o=t[1].sub(n[1]);return this._map._cooperativeGestures&&!e.d4()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(a,o,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(a.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return so(e)&&so(t)&&a}}const co={panStep:100,bearingStep:15,pitchStep:10};class ho{constructor(){const e=co;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:o=>{const s=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-a*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(e){return e*(2-e)}const po=4.000244140625,fo=1/450;class mo{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fo,e.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.d4()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.e.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%po==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=p(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>po?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),a=Math.pow(2,n),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,a=this._easing;let o,s=!1;if("wheel"===this._type&&n&&a){const t=Math.min((e.e.now()-this._lastWheelEventTime)/200,1),i=a(t);o=e.a3(n,r,i),t<1?this._frameId||(this._frameId=!0):s=!0}else o=r,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=o-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.d5;if(this._prevEase){const t=this._prevEase,r=(e.e.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),a=.27/Math.sqrt(n*n+1e-4)*.01,o=Math.sqrt(.0729-a*a);i=e.d3(a,o,.25,1)}return this._prevEase={start:e.e.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=n("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class go{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _o{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yo{constructor(){this._tap=new Wa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xo{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vo{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bo{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wo=e=>e.zoom||e.drag||e.pitch||e.rotate;class So extends e.g{}class Eo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.$.sub([],i,t);this.radius=e.$.length(r[2]<0?e.$.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.$.div(t,t,this.constants),e.$.normalize(t,t),e.$.mul(t,t,this.constants);const i=e.$.scale([],t,this.radius);if(i[2]>0){const t=e.$.scale([],[0,0,1],e.$.dot(i,[0,0,1])),r=e.$.scale([],e.$.normalize([],[i[0],i[1],0]),this.radius),n=e.$.add([],i,e.$.scale([],e.$.sub([],e.$.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function To(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Co{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fa(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Eo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.br(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,n,a]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(n,t,a)}}destroy(){for(const[e,t,i]of this._listeners){const r=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,r,i)}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Ua(t,e));const r=t.boxZoom=new $a(t,e);this._add("boxZoom",r);const n=new Za,a=new _o;t.doubleClickZoom=new go(a,n),this._add("tapZoom",n),this._add("clickZoom",a);const o=new yo;this._add("tapDragZoom",o);const s=t.touchPitch=new lo(t);this._add("touchPitch",s);const l=new Qa(e),c=new Ka(e);t.dragRotate=new vo(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const h=new Ja(e),u=new eo(t,e);t.dragPan=new xo(i,h,u),this._add("mousePan",h),this._add("touchPan",u,["touchZoom","touchRotate"]);const d=new oo,p=new no;t.touchZoomRotate=new bo(i,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ga(t));const f=t.scrollZoom=new mo(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new ho;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,r=i?void 0:e,n={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?f(this._el,s):i?void 0:p(this._el,e);for(const{handlerName:u,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let i;this._blockedByActive(o,p,u)?d.reset():d[t||e.type]&&(i=d[t||e.type](e,l,s),this.mergeHandlerResult(n,a,i,u,r),i&&i.needsRenderFrame&&this._triggerRenderFrame()),(i||d.isActive())&&(o[u]=d)}const c={};for(const u in this._previousActiveHandlers)o[u]||(c[u]=r);this._previousActiveHandlers=o,(Object.keys(c).length||To(n))&&(this._changes.push([n,a,c]),this._triggerRenderFrame()),(Object.keys(o).length||To(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=n;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(t,i,r,n,a){if(!r)return;e.Q(t,r);const o={handlerName:n,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(i.zoom=o),void 0!==r.panDelta&&(i.drag=o),void 0!==r.pitchDelta&&(i.pitch=o),void 0!==r.bearingDelta&&(i.rotate=o)}_applyChanges(){const t={},i={},r={};for(const[n,a,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.Q(i,a),e.Q(r,o);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,a=n.transform,o=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!To(t)){const e=a.zoom;a.cameraElevationReference="sea",null!=this._originalZoom&&a._orthographicProjectionAtLowPitch&&"globe"!==a.projection.name&&0===a.pitch?(a.cameraElevationReference="ground",a.zoom=this._originalZoom):(a.recenterOnTerrain(),a.cameraElevationReference="ground"),e!==a.zoom&&this._map._update(!0)}if(a._isCameraConstrained&&n._stop(!0),!To(t))return void this._fireEvents(i,r,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:h,around:u,aroundCoord:d,pinchAround:p}=t;a._isCameraConstrained&&(l>0&&(l=0),a._isCameraConstrained=!1),void 0!==p&&(u=p),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=o(a.pointCoordinate3D(u)),this._originalZoom=a.zoom,this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),a.cameraElevationReference="sea",n._stop(!0),u=u||n.transform.centerPoint,c&&(a.bearing+=c),h&&(a.pitch+=h),a._updateCameraState();const f=[0,0,0];if(s)if("mercator"===a.projection.name){const e=this._trackingEllipsoid.projectRay(a.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(a.screenPointToMercatorRay(u.sub(s)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=a.pointCoordinate(u);if("globe"===a.projection.name){s=s.rotate(-a.angle);const i=a._pixelsPerMercatorPixel/a.worldSize;f[0]=-s.x*e.d6(e.az(t.y))*i,f[1]=-s.y*e.d6(a.center.lat)*i}else{const e=a.pointCoordinate(u.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=a.zoom,g=[0,0,0];if(l){const t=o(d||a.pointCoordinate3D(u)),i={dir:e.$.normalize([],e.$.sub([],t,a._camera.position))};if(i.dir[2]<0){const r=a.zoomDeltaToMovement(t,l);e.$.scale(g,i.dir,r)}}const _=e.$.add(f,f,g);a._translateCameraConstrained(_),l&&Math.abs(a.zoom-m)>1e-4&&a.recenterOnTerrain(),a.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=wo(this._eventsInProgress),a=wo(t),o={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in o)this._fireEvent(e,o[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=wo(this._eventsInProgress);if(r&&(n||a)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.g("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.g(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new So("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ko="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mo extends e.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.br(["_renderFrameCallback"],this)}getCenter(){return new e.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.Q({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.Q({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.Q({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.Q({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.Q({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.Q({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.aj.convert(t);const r=i&&i.bearing||0,n=i&&i.pitch||0,a=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,a,o,r,n,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return null==t?e.Q({},i,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.Q({},i,t)}_extendCameraOptions(t){return(t=e.Q({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],r=t.max[1]-t.min[1];return i/r>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,r,n,a,o){const s=t.clone(),l=this._extendCameraOptions(o);s.bearing=n,s.pitch=a;const c=e.aJ.convert(i),h=e.aJ.convert(r),u=.5*(c.lat+h.lat),d=.5*(c.lng+h.lng),p=e.d7(u,d),f=e.$.normalize([],p),m=e.$.normalize([],e.$.cross([],f,[0,1,0])),g=e.$.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.d7(c.lat,c.lng),e.d7(h.lat,c.lng),e.d7(h.lat,h.lng),e.d7(c.lat,h.lng),e.d7(u,c.lng),e.d7(u,h.lng),e.d7(c.lat,d),e.d7(h.lat,d)];let x=e.b8.fromPoints(y.map((t=>[e.$.dot(m,t),e.$.dot(g,t),e.$.dot(f,t)])));const v=e.$.transformMat4([],x.center,_);0===e.$.squaredLength(v)&&e.$.set(v,0,0,1),e.$.normalize(v,v),e.$.scale(v,v,e.cF),s.center=e.d8(v);const b=s.getWorldToCameraMatrix(),w=e.ae.invert(new Float64Array(16),b);x=e.b8.applyTransform(x,e.ae.multiply([],b,_));const S=this._extendAABB(x,s,l,n);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=S,e.$.transformMat4(v,v,b);const E=.5*(x.max[2]-x.min[2]),T=this._minimumAABBFrustumDistance(s,x),C=e.$.scale([],[0,0,1],E),k=e.$.add(C,v,C),M=T+(0===s.pitch?0:e.$.distance(v,k)),A=s.globeCenterInViewSpace,P=e.$.sub([],v,[A[0],A[1],A[2]]);e.$.normalize(P,P),e.$.scale(P,P,M);const I=e.$.add([],v,P);e.$.transformMat4(I,I,w);const D=e.da/e.cF,R=e.$.length(I),z=e.ay(Math.max(R*D-e.da,Number.EPSILON),0),L=Math.min(s.zoomFromMercatorZAdjusted(z),l.maxZoom);return L>.5*(e.b3+e.aV)?(s.setProjection({name:"mercator"}),s.zoom=L,this._cameraForBounds(s,i,r,n,a,o)):{center:s.center,zoom:L,bearing:n,pitch:a}}_extendAABB(t,i,r,n){const a=.5*((r.padding.left||0)+(r.padding.right||0)),o=.5*((r.padding.top||0)+(r.padding.bottom||0)),s=o,l=a,c=a,h=o,u=i.width-(l+c),d=i.height-(s+h),p=e.$.sub([],t.max,t.min),f=Math.min(u/p[0],d/p[1]),m=Math.min(i.scaleZoom(i.scale*f),r.maxZoom);if(isNaN(m))return null;const g=i.scale/i.zoomScale(m),_=new e.b8([t.min[0]-l*g,t.min[1]-h*g,t.min[2]],[t.max[0]+c*g,t.max[1]+s*g,t.max[2]]),y=("number"==typeof r.offset.x&&"number"==typeof r.offset.y?new e.P(r.offset.x,r.offset.y):e.P.convert(r.offset)).rotate(-e.ac(n));return _.center[0]-=y.x*g,_.center[1]+=y.y*g,_}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=e.Q({},{exaggerated:!0},i),r.getAtPoint(e._.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,r,n,a,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,r,n,a,o);const s=t.clone(),l=this._extendCameraOptions(o);s.bearing=n,s.pitch=a;const c=e.aJ.convert(i),h=e.aJ.convert(r),u=new e.aJ(c.lng,h.lat),d=new e.aJ(h.lng,c.lat),p=s.project(c),f=s.project(h),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(h),_=this.queryTerrainElevation(u),y=this.queryTerrainElevation(d),x=[[p.x,p.y,Math.min(m||0,g||0,_||0,y||0)],[f.x,f.y,Math.max(m||0,g||0,_||0,y||0)]];let v=e.b8.fromPoints(x);const b=s.getWorldToCameraMatrix(),w=e.ae.invert(new Float64Array(16),b);v=e.b8.applyTransform(v,b);const S=this._extendAABB(v,s,l,n);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=S;const E=.5*e.$.sub([],v.max,v.min)[2],T=this._minimumAABBFrustumDistance(s,v),C=[0,0,1,0];e.aB.transformMat4(C,C,b),e.aB.normalize(C,C);const k=e.$.scale([],C,T+E),M=e.$.add([],v.center,k);e.$.transformMat4(v.center,v.center,w),e.$.transformMat4(M,M,w);const A=[v.center[0],v.center[1],M[2]*s.pixelsPerMeter];e.$.scale(A,A,1/s.worldSize);const P=e.d9(A[0]),I=e.az(A[1]),D=Math.min(s._zoomFromMercatorZ(A[2]),l.maxZoom),R=new e.aJ(P,I);return s.mercatorFromTransition&&D<.5*(e.b3+e.aV)?(s.setProjection({name:"globe"}),s.zoom=D,this._cameraForBounds(s,i,r,n,a,o)):{center:R,zoom:D,bearing:n,pitch:a}}fitBounds(e,t,i){const r=this.cameraForBounds(e,t);return this._fitInternal(r,t,i)}fitScreenCoordinates(t,i,r,n,a){const o=e.P.convert(t),s=e.P.convert(i),l=new e.P(Math.min(o.x,s.x),Math.min(o.y,s.y)),c=new e.P(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const h=this.transform.pointLocation3D(l),u=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(h.lng,u.lng,d.lng,p.lng),Math.min(h.lat,u.lat,d.lat,p.lat)],m=[Math.max(h.lng,u.lng,d.lng,p.lng),Math.max(h.lat,u.lat,d.lat,p.lat)],g=n&&n.pitch?n.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,r,g,n);return this._fitInternal(_,n,a)}_fitInternal(t,i,r){return t?(i=e.Q(t,i)).linear?this.easeTo(i,r):this.flyTo(i,r):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let n=!1,a=!1,o=!1;if("zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.aJ.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null!=t.padding){const e="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;r.isPaddingEqual(e)||(r.padding=e)}return t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.g("movestart",i)).fire(new e.g("move",i)),n&&this.fire(new e.g("zoomstart",i)).fire(new e.g("zoom",i)).fire(new e.g("zoomend",i)),a&&this.fire(new e.g("rotatestart",i)).fire(new e.g("rotate",i)).fire(new e.g("rotateend",i)),o&&this.fire(new e.g("pitchstart",i)).fire(new e.g("pitch",i)).fire(new e.g("pitchend",i)),this.fire(new e.g("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(ko),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.w(ko),this;this.stop();const n=r.zoom,a=r.pitch,o=r.bearing;r.setFreeCameraOptions(t);const s=n!==r.zoom,l=a!==r.pitch,c=o!==r.bearing;return this.fire(new e.g("movestart",i)).fire(new e.g("move",i)),s&&this.fire(new e.g("zoomstart",i)).fire(new e.g("zoom",i)).fire(new e.g("zoomend",i)),c&&this.fire(new e.g("rotatestart",i)).fire(new e.g("rotate",i)).fire(new e.g("rotateend",i)),l&&this.fire(new e.g("pitchstart",i)).fire(new e.g("pitch",i)).fire(new e.g("pitchend",i)),this.fire(new e.g("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.Q({offset:[0,0],duration:500,easing:e.d5},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u=this._extendPadding(t.padding),d=e.P.convert(t.offset);let p,f,m;if("globe"===r.projection.name){const i=e._.fromLngLat(r.center),n=d.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const a=i.toLngLat(),o=e.aJ.convert(t.center||a);this._normalizeCenter(o),p=r.centerPoint.add(n),f=new e.P(i.x,i.y).mult(r.worldSize),m=new e.P(e.ak(o.lng),e.al(o.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const i=r.pointLocation(p),n=e.aJ.convert(t.center||i);this._normalizeCenter(n),f=r.project(i),m=r.project(n).sub(f)}const g=r.zoomScale(l-n);let _,y;t.around&&(_=e.aJ.convert(t.around),y=r.locationPoint(_));const x=this._zooming||l!==n,v=this._rotating||a!==c,b=this._pitching||h!==o,w=!r.isPaddingEqual(u),S=r=>S=>{if(x&&(r.zoom=e.a3(n,l,S)),v&&(r.bearing=e.a3(a,c,S)),b&&(r.pitch=e.a3(o,h,S)),w&&(r.interpolatePadding(s,u,S),p=r.centerPoint.add(d)),_)r.setLocationAtPoint(_,y);else{const e=r.zoomScale(r.zoom-n),t=l>n?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-S),a=r.unproject(f.add(m.mult(S*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?a.wrap():a,p)}return t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(S,t.duration,r);return this._preloadTiles(e),this}const E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=x,this._rotating=v,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,E),this._ease(S(r),(e=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new e.g("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.g("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.g("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.g("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.g("move",t)),this._zooming&&this.fire(new e.g("zoom",t)),this._rotating&&this.fire(new e.g("rotate",t)),this._pitching&&this.fire(new e.g("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.g("zoomend",t)),n&&this.fire(new e.g("rotateend",t)),a&&this.fire(new e.g("pitchend",t)),this.fire(new e.g("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const r=e.ai(t,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(r,i)}this.stop(),t=e.Q({offset:[0,0],speed:1.2,curve:1.42,easing:e.d5},t);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.au(+t.zoom,r.minZoom,r.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u=this._extendPadding(t.padding),d=r.zoomScale(l-n),p=e.P.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),g=e.aJ.convert(t.center||m);this._normalizeCenter(g);const _=r.project(m),y=r.project(g).sub(_);let x=t.curve;const v=Math.max(r.width,r.height),b=v/d,w=y.mag();if("minZoom"in t){const i=e.au(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),a=v/r.zoomScale(i-n);x=Math.sqrt(a/w*2)}const S=x*x;function E(e){const t=(b*b-v*v+(e?-1:1)*S*S*w*w)/(2*(e?b:v)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}const k=E(0);let M=function(e){return C(k)/C(k+x*e)},A=function(e){return v*((C(k)*(T(t=k+x*e)/C(t))-T(k))/S)/w;var t},P=(E(1)-k)/x;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(v-b)<1e-6)return this.easeTo(t,i);const e=b<v?-1:1;P=Math.abs(Math.log(b/v))/x,A=function(){return 0},M=function(t){return Math.exp(e*x*t)}}t.duration="duration"in t?+t.duration:1e3*P/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const I=a!==c,D=h!==o,R=!r.isPaddingEqual(u),z=r=>d=>{const m=d*P,x=1/M(m);r.zoom=1===d?l:n+r.scaleZoom(x),I&&(r.bearing=e.a3(a,c,d)),D&&(r.pitch=e.a3(o,h,d)),R&&(r.interpolatePadding(s,u,d),f=r.centerPoint.add(p));const v=1===d?g:r.unproject(_.add(y.mult(A(m))).mult(x));return r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(z,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=I,this._pitching=D,this._padding=R,this._prepareEase(i,!1),this._ease(z(r),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.e.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.e.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.av(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.e.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const r=Math.ceil(15*t/1e3),n=[],a=e(i.clone());for(let o=0;o<=r;o++){const e=a(o/r);n.push(e.clone())}return n}_preloadTiles(e,t){}}class Ao{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,i=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",i);const r=n("span","mapboxgl-ctrl-icon",this._compactButton);return r.setAttribute("aria-hidden","true"),r.setAttribute("title",i),this._innerContainer=n("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.db.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e)),"?");t.href=`${e.db.FEEDBACK_URL}/${r}#${Pa(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const r in t){const i=t[r];if(i.used){const t=i.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Po{constructor(){e.br(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=n("div","mapboxgl-ctrl");const t=n("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Io{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const r of i)if(r.id===e)return void(r.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Do(t,i,r){if(t=new e.aJ(t.lng,t.lat),i){const n=new e.aJ(t.lng-360,t.lat),a=new e.aJ(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),s=r.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<s&&(l||Math.abs(n.lng-r.center.lng)<o)?t=n:r.locationPoint(a).distSqr(i)<s&&(l||Math.abs(a.lng-r.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const Ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zo extends e.E{constructor(t,i){if(super(),(t instanceof HTMLElement||i)&&(t=e.Q({element:t},i)),e.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=n("div");const i=41,r=27,o=a("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${i}`},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},o));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const r=this._element.classList;for(const e in Ro)r.remove(`mapboxgl-marker-anchor-${e}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const o=t&&t.className?t.className.trim().split(/\s+/):[];r.add(...o),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.aJ.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t),r=e.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i);let n;t._showingGlobe()&&e.dc(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${Ro[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!t||"map"!==r)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const n=e.b1(e.dd(i.transform,this._lngLat)),a=t.sub(e.de(i.transform)),o=Math.abs(a.x)+Math.abs(a.y);if(0===o)return"";const s=n/o;return`rotateX(${-a.y*s}deg) rotateY(${a.x*s}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(i._showingGlobe()){const t=i.project(new e.aJ(this._lngLat.lng,this._lngLat.lat+.001)),n=i.project(new e.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);r=e.b1(Math.atan2(n.y,n.x))-90}else r=-i.getBearing();else if("horizon"===n){const n=e.a0(4,6,i.getZoom()),a=e.de(i.transform);a.y+=n*i.transform.height;const o=t.sub(a),s=e.b1(Math.atan2(o.y,o.x));r=(s>90?s-270:s+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Do(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(r)<e)return;this._isDragging=!0}this._pos=t.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.g("dragstart"))),this.fire(new e.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.g("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Lo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.P(0,t);case"top-left":return new e.P(r,r);case"top-right":return new e.P(-r,r);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(r,-r);case"bottom-right":return new e.P(-r,-r);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[i]||[0,0])}class Oo{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.bb((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const No={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Vo{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const jo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Uo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Go{constructor(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=i,this.mouseRotate=new Qa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new Ka({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),c()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.Q({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),p(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,p(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=f(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=f(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $o={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qo={maxWidth:100,unit:"metric"},Ho={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wo={version:e.dw,supported:t,setRTLTextPlugin:e.dy,getRTLTextPluginStatus:e.dz,Map:class extends Mo{constructor(t){e.df.mark(e.dg.create);const i=t;if(null!=(t=e.Q({},jo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.dh(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hi(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new Io,this._domRenderTaskQueue=new Io,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.di(),this._locale=e.Q({},No,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Oo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new e.dj(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Vo),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Co(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.db.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new Aa("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const r=t.bounds;r&&(this.resize(),this.fitBounds(r,e.Q({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Ao({customAttribution:t.customAttribution})),this._logoControl=new Po,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.g(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.g(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.g("movestart",t)).fire(new e.g("move",t)),this.fire(new e.g("resize",t)),i&&this.fire(new e.g("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aj.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.g("zoomstart")).fire(new e.g("zoom")).fire(new e.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.g("zoomstart")).fire(new e.g("zoom")).fire(new e.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.g("pitchstart")).fire(new e.g("pitch")).fire(new e.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.g("pitchstart")).fire(new e.g("pitch")).fire(new e.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let r;"globe"===i&&t.zoom>=e.aV?(t.setMercatorFromTransition(),r=!0):"mercator"===i&&t.zoom<e.aV&&(t.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;return i="globe"===t.name&&this.transform.zoom>=e.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.aJ.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const a=t.filter((e=>this.getLayer(e))),o=a.length?this.queryRenderedFeatures(n.point,{layers:a}):[];o.length?r||(r=!0,i.call(this,new Na(e,this,n.originalEvent,{features:o}))):r=!1},a=()=>{r=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:a}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const a=t.filter((e=>this.getLayer(e)));(a.length?this.queryRenderedFeatures(n.point,{layers:a}):[]).length?r=!0:r&&(r=!1,i.call(this,new Na(e,this,n.originalEvent)))},a=t=>{r&&(r=!1,i.call(this,new Na(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:a}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if("function"==typeof t||void 0===i)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const n in r.delegates)this.on(n,r.delegates[n]);return this}once(e,t,i){if("function"==typeof t||void 0===i)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const r=this._createDelegatedListener(e,t,i);for(const n in r.delegates)this.once(n,r.delegates[n]);return this}off(e,t,i){if("function"==typeof t||void 0===i)return super.off(e,t);const r=new Set(Array.isArray(t)?t:[t]);for(const o of r)if(!this._isValidId(o))return this;const n=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&(e=>{for(let t=0;t<e.length;t++){const a=e[t];if(a.listener===i&&n(a.layers,r)){for(const e in a.delegates)this.off(e,a.delegates[e]);return e.splice(t,1),this}}})(a),this}queryRenderedFeatures(t,i){if(!this.style)return[];if(void 0!==i||void 0===t||t instanceof e.P||Array.isArray(t)||(i=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const e of i.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,i,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&e.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,i){return i=e.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&t&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(t,((r,n)=>{r?(e.w(`Unable to perform style diff: ${String(r.message||r.error||r)}. Rebuilding the style from scratch.`),this._updateStyle(t,i)):n&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(t,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const r=e.Q({},i);i&&i.config&&(r.initialConfig=i.config,delete r.config),this.style=new ka(this,r).load(t),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ka(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.f(new Error("IDs can't be empty."))),!1):!e.cY(t)||(this.fire(new e.f(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,i){let{pixelRatio:r=1,sdf:n=!1,stretchX:a,stretchY:o,content:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:c,data:h}=e.e.getImageData(i);this.style.addImage(t,{data:new e.j({width:l,height:c},h),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,h=i;this.style.addImage(t,{data:new e.j({width:l,height:c},new Uint8Array(h.data)),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}updateImage(t,i){this._lazyInitEmptyStyle();const r=this.style.getImage(t);if(!r)return void this.fire(new e.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?e.e.getImageData(i):i,{width:a,height:o,data:s}=n;if(void 0===a||void 0===o)return void this.fire(new e.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==r.data.width||o!==r.data.height)return void this.fire(new e.f(new Error(`The width and height of the updated image (${a}, ${o})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`)));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);r.data.replace(s,l),this.style.updateImage(t,r)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.f(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.i(this._requestManager.transformRequest(t,e.R.Image),((t,r)=>{i(t,r instanceof HTMLImageElement?e.e.getImageData(r):r)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.f(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.aJ.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,r,n,a=this._container;for(;a&&(!r||!n);){const e=window.getComputedStyle(a).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(n=i[3])),a=a.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=n?Math.abs(t/n):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=n("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=n("div","mapboxgl-canvas-container",e);this._canvas=n("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=n("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=n("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.e.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const i=e.Q({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",i);r?(e.dk(r,!0),this.painter=new Tn(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.dl.testSupport(r)):this.fire(new e.f(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.g("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.g("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.g("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,n=e.e.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=a.createQuery(),a.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=e.e.now(),n=new e.Y(t,{now:r,fadeDuration:o,pitch:i,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(n);const l=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions,this.painter.replacementSource);if(l&&(this._placementDirty=l.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.df.mark(e.dg.load),this.fire(new e.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.e.now()-n;a.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const r=a.getQueryParameter(i,a.QUERY_RESULT)/1e6;a.deleteQuery(i),this.fire(new e.g("gpu-timing-frame",{cpuTime:t,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.g("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.g("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(c||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.g("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,e.df.mark(e.dg.fullLoad),this._performanceMetricsCollection&&e.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const a=Math.abs(t-n);if(a>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(a>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.dp||401===t.status)){const t=this.painter.context.gl;e.dk(t,!1),this._logoControl instanceof Po&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&e.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let a=0;a<t.length;a++){const o=t[a];let s=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(s+=1);r+=(i[a+2]-i[a+1])*(1-s/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.ds(this.painter.context.gl),e.dt.remove(),e.du.remove(),this._removed=!0,this.fire(new e.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.e.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?this.style.getSourceCaches():[];return e.dv(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,i){e.dx(t,i)}get version(){return e.dw}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.Q({},Uo,t),this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),n("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),n("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=n("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Go(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=n("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const i=navigator.geolocation;this.options=e.Q({geolocation:i},$o,t),e.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ma(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const i=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=i,e(i)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>i("denied"!==e.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.g("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.g("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.aJ(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),a=e.Q({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),a,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.aJ(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.ay(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.g("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=n("button","mapboxgl-ctrl-geolocate",this._container),n("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n("div","mapboxgl-user-location"),this._dotElement.appendChild(n("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(n("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=n("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.g("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ao,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e.Q({},qo,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,n=t.unproject([r,i]),a=t.unproject([r+e,i]),o=n.distanceTo(a);if("imperial"===this.options.unit){const t=3.2808*o;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,i){this._map._requestDomTask((()=>{const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),n=r/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${Ho[i]}`,this._container.style.width=e*n+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=n("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.Q(Object.create(Lo),t),e.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.g("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.aJ.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=n("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=n("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const n=i.offsetWidth,a=i.offsetHeight,o=r.x<n/2,s=r.x>t.transform.width-n/2;if(r.y+e<a)return o?"top-left":s?"top-right":"top";if(r.y>t.transform.height-a){if(o)return"bottom-left";if(s)return"bottom-right"}return o?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let a=this._container;if(a||(a=this._container=n("div","mapboxgl-popup",i.getContainer()),this._tip=n("div","mapboxgl-popup-tip",a),a.appendChild(r)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Do(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const r=this._pos=this._trackPointer&&t instanceof e.P?t:i.project(this._lngLat),n=Bo(this.options.offset),a=this._anchor=this._getAnchor(n.y),o=Bo(this.options.offset,a),s=r.add(o).round();i._requestDomTask((()=>{this._container&&a&&(this._container.style.transform=`${Ro[a]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const t=e.dc(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Fo);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:zo,Style:ka,LngLat:e.aJ,LngLatBounds:e.aj,Point:e.P,MercatorCoordinate:e._,FreeCameraOptions:Gt,Evented:e.E,config:e.db,prewarm:e.dA,clearPrewarmedResources:e.dB,get accessToken(){return e.db.ACCESS_TOKEN},set accessToken(t){e.db.ACCESS_TOKEN=t},get baseApiUrl(){return e.db.API_URL},set baseApiUrl(t){e.db.API_URL=t},get workerCount(){return e.dC.workerCount},set workerCount(t){e.dC.workerCount=t},get maxParallelImageRequests(){return e.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.db.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.dD(t)},get workerUrl(){return e.dE.workerUrl},set workerUrl(t){e.dE.workerUrl=t},get workerClass(){return e.dE.workerClass},set workerClass(t){e.dE.workerClass=t},get workerParams(){return e.dE.workerParams},set workerParams(t){e.dE.workerParams=t},get dracoUrl(){return e.dF()},set dracoUrl(t){e.dG(t)},get meshoptUrl(){return e.dH()},set meshoptUrl(t){e.dI(t)},setNow:e.e.setNow,restoreNow:e.e.restoreNow};return Wo})),i}()},730:(e,t,i)=>{"use strict";var r=i(43),n=i(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,i,r,n,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,i,r){var n=g.hasOwnProperty(t)?g[t]:null;(null!==n?0!==n.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,r){if(null===t||"undefined"===typeof t||function(e,t,i,r){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,r))return!0;if(r)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,n,r)&&(i=null),r||null===n?function(e){return!!u.call(f,e)||!u.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=null===i?3!==n.type&&"":i:(t=n.attributeName,r=n.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(n=n.type)||4===n&&!0===i?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var v=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),k=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var z=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=z&&e[z]||e["@@iterator"])?e:null}var F,B=Object.assign;function O(e){if(void 0===F)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var N=!1;function V(e,t){if(!e||N)return"";N=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var n=c.stack.split("\n"),a=r.stack.split("\n"),o=n.length-1,s=a.length-1;1<=o&&0<=s&&n[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(n[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||n[o]!==a[s]){var l="\n"+n[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{N=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?O(e):""}function j(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case E:return"StrictMode";case A:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case k:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case M:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return U(e(t))}catch(i){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function $(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var n=i.get,a=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==i&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var i=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Y(e,t){var i=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;i=$(null!=t.value?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function Q(e,t){J(e,t);var i=$(t.value),r=t.type;if(null!=i)"number"===r?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function K(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&Z(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+$(i),t=null,n=0;n<e.length;n++){if(e[n].value===i)return e[n].selected=!0,void(r&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ne(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(a(92));if(te(i)){if(1<i.length)throw Error(a(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:$(i)}}function ae(e,t){var i=$(t.value),r=$(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,ue=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var r=0===i.indexOf("--"),n=me(i,t[i],r);"float"===i&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Ee=null;function Te(e){if(e=xn(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=bn(t),we(e.stateNode,e.type,t))}}function Ce(e){Se?Ee?Ee.push(e):Ee=[e]:Se=e}function ke(){if(Se){var e=Se,t=Ee;if(Ee=Se=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Me(e,t){return e(t)}function Ae(){}var Pe=!1;function Ie(e,t,i){if(Pe)return e(t,i);Pe=!0;try{return Me(e,t,i)}finally{Pe=!1,(null!==Se||null!==Ee)&&(Ae(),ke())}}function De(e,t){var i=e.stateNode;if(null===i)return null;var r=bn(i);if(null===r)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(a(231,t,typeof i));return i}var Re=!1;if(h)try{var ze={};Object.defineProperty(ze,"passive",{get:function(){Re=!0}}),window.addEventListener("test",ze,ze),window.removeEventListener("test",ze,ze)}catch(he){Re=!1}function Le(e,t,i,r,n,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Fe=!1,Be=null,Oe=!1,Ne=null,Ve={onError:function(e){Fe=!0,Be=e}};function je(e,t,i,r,n,a,o,s,l){Fe=!1,Be=null,Le.apply(Ve,arguments)}function Ue(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function $e(e){if(Ue(e)!==e)throw Error(a(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(a(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(null===n)break;var o=n.alternate;if(null===o){if(null!==(r=n.return)){i=r;continue}break}if(n.child===o.child){for(o=n.child;o;){if(o===i)return $e(n),e;if(o===r)return $e(n),t;o=o.sibling}throw Error(a(188))}if(i.return!==r.return)i=n,r=o;else{for(var s=!1,l=n.child;l;){if(l===i){s=!0,i=n,r=o;break}if(l===r){s=!0,r=n,i=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===i){s=!0,i=o,r=n;break}if(l===r){s=!0,r=o,i=n;break}l=l.sibling}if(!s)throw Error(a(189))}}if(i.alternate!==r)throw Error(a(190))}if(3!==i.tag)throw Error(a(188));return i.stateNode.current===i?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var We=n.unstable_scheduleCallback,Ze=n.unstable_cancelCallback,Xe=n.unstable_shouldYield,Ye=n.unstable_requestPaint,Je=n.unstable_now,Qe=n.unstable_getCurrentPriorityLevel,Ke=n.unstable_ImmediatePriority,et=n.unstable_UserBlockingPriority,tt=n.unstable_NormalPriority,it=n.unstable_LowPriority,rt=n.unstable_IdlePriority,nt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ht=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var i=e.pendingLanes;if(0===i)return 0;var r=0,n=e.suspendedLanes,a=e.pingedLanes,o=268435455&i;if(0!==o){var s=o&~n;0!==s?r=ut(s):0!==(a&=o)&&(r=ut(a))}else 0!==(o=i&~n)?r=ut(o):0!==a&&(r=ut(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&n)&&((n=r&-r)>=(a=t&-t)||16===n&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)n=1<<(i=31-ot(t)),r|=e[i],t&=~n;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function _t(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-ot(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var xt=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,St,Et,Tt,Ct=!1,kt=[],Mt=null,At=null,Pt=null,It=new Map,Dt=new Map,Rt=[],zt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ft(e,t,i,r,n,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:a,targetContainers:[n]},null!==t&&(null!==(t=xn(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function Bt(e){var t=yn(e.target);if(null!==t){var i=Ue(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ge(i)))return e.blockedOn=t,void Tt(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=xn(i))&&wt(t),e.blockedOn=i,!1;var r=new(i=e.nativeEvent).constructor(i.type,i);ve=r,i.target.dispatchEvent(r),ve=null,t.shift()}return!0}function Nt(e,t,i){Ot(e)&&i.delete(t)}function Vt(){Ct=!1,null!==Mt&&Ot(Mt)&&(Mt=null),null!==At&&Ot(At)&&(At=null),null!==Pt&&Ot(Pt)&&(Pt=null),It.forEach(Nt),Dt.forEach(Nt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Vt)))}function Ut(e){function t(t){return jt(t,e)}if(0<kt.length){jt(kt[0],e);for(var i=1;i<kt.length;i++){var r=kt[i];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Mt&&jt(Mt,e),null!==At&&jt(At,e),null!==Pt&&jt(Pt,e),It.forEach(t),Dt.forEach(t),i=0;i<Rt.length;i++)(r=Rt[i]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(i=Rt[0]).blockedOn;)Bt(i),null===i.blockedOn&&Rt.shift()}var Gt=v.ReactCurrentBatchConfig,$t=!0;function qt(e,t,i,r){var n=xt,a=Gt.transition;Gt.transition=null;try{xt=1,Wt(e,t,i,r)}finally{xt=n,Gt.transition=a}}function Ht(e,t,i,r){var n=xt,a=Gt.transition;Gt.transition=null;try{xt=4,Wt(e,t,i,r)}finally{xt=n,Gt.transition=a}}function Wt(e,t,i,r){if($t){var n=Xt(e,t,i,r);if(null===n)Gr(e,t,r,Zt,i),Lt(e,r);else if(function(e,t,i,r,n){switch(t){case"focusin":return Mt=Ft(Mt,e,t,i,r,n),!0;case"dragenter":return At=Ft(At,e,t,i,r,n),!0;case"mouseover":return Pt=Ft(Pt,e,t,i,r,n),!0;case"pointerover":var a=n.pointerId;return It.set(a,Ft(It.get(a)||null,e,t,i,r,n)),!0;case"gotpointercapture":return a=n.pointerId,Dt.set(a,Ft(Dt.get(a)||null,e,t,i,r,n)),!0}return!1}(n,e,t,i,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<zt.indexOf(e)){for(;null!==n;){var a=xn(n);if(null!==a&&bt(a),null===(a=Xt(e,t,i,r))&&Gr(e,t,r,Zt,i),a===n)break;n=a}null!==n&&r.stopPropagation()}else Gr(e,t,r,null,i)}}var Zt=null;function Xt(e,t,i,r){if(Zt=null,null!==(e=yn(e=be(r))))if(null===(t=Ue(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ke:return 1;case et:return 4;case tt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,Kt=null;function ei(){if(Kt)return Kt;var e,t,i=Qt,r=i.length,n="value"in Jt?Jt.value:Jt.textContent,a=n.length;for(e=0;e<r&&i[e]===n[e];e++);var o=r-e;for(t=1;t<=o&&i[r-t]===n[a-t];t++);return Kt=n.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ri(){return!1}function ni(e){function t(t,i,r,n,a){for(var o in this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=n,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?ii:ri,this.isPropagationStopped=ri,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var ai,oi,si,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ni(li),hi=B({},li,{view:0,detail:0}),ui=ni(hi),di=B({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==si&&(si&&"mousemove"===e.type?(ai=e.screenX-si.screenX,oi=e.screenY-si.screenY):oi=ai=0,si=e),ai)},movementY:function(e){return"movementY"in e?e.movementY:oi}}),pi=ni(di),fi=ni(B({},di,{dataTransfer:0})),mi=ni(B({},hi,{relatedTarget:0})),gi=ni(B({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),_i=B({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ni(_i),xi=ni(B({},li,{data:0})),vi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wi[e])&&!!t[e]}function Ei(){return Si}var Ti=B({},hi,{key:function(e){if(e.key){var t=vi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ci=ni(Ti),ki=ni(B({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mi=ni(B({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei})),Ai=ni(B({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pi=B({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ii=ni(Pi),Di=[9,13,27,32],Ri=h&&"CompositionEvent"in window,zi=null;h&&"documentMode"in document&&(zi=document.documentMode);var Li=h&&"TextEvent"in window&&!zi,Fi=h&&(!Ri||zi&&8<zi&&11>=zi),Bi=String.fromCharCode(32),Oi=!1;function Ni(e,t){switch(e){case"keyup":return-1!==Di.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var ji=!1;var Ui={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ui[e.type]:"textarea"===t}function $i(e,t,i,r){Ce(r),0<(t=qr(t,"onChange")).length&&(i=new ci("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var qi=null,Hi=null;function Wi(e){Br(e,0)}function Zi(e){if(W(vn(e)))return e}function Xi(e,t){if("change"===e)return t}var Yi=!1;if(h){var Ji;if(h){var Qi="oninput"in document;if(!Qi){var Ki=document.createElement("div");Ki.setAttribute("oninput","return;"),Qi="function"===typeof Ki.oninput}Ji=Qi}else Ji=!1;Yi=Ji&&(!document.documentMode||9<document.documentMode)}function er(){qi&&(qi.detachEvent("onpropertychange",tr),Hi=qi=null)}function tr(e){if("value"===e.propertyName&&Zi(Hi)){var t=[];$i(t,Hi,e,be(e)),Ie(Wi,t)}}function ir(e,t,i){"focusin"===e?(er(),Hi=i,(qi=t).attachEvent("onpropertychange",tr)):"focusout"===e&&er()}function rr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Zi(Hi)}function nr(e,t){if("click"===e)return Zi(t)}function ar(e,t){if("input"===e||"change"===e)return Zi(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function sr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!u.call(t,n)||!or(e[n],t[n]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var i,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ur(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(r){i=!1}if(!i)break;t=Z((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=ur(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&hr(i.ownerDocument.documentElement,i)){if(null!==r&&dr(i))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var n=i.textContent.length,a=Math.min(r.start,n);r=void 0===r.end?a:Math.min(r.end,n),!e.extend&&a>r&&(n=r,r=a,a=n),n=cr(i,a);var o=cr(i,r);n&&o&&(1!==e.rangeCount||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(n.node,n.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=h&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,_r=null,yr=!1;function xr(e,t,i){var r=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;yr||null==mr||mr!==Z(r)||("selectionStart"in(r=mr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},_r&&sr(_r,r)||(_r=r,0<(r=qr(gr,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=mr)))}function vr(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var br={animationend:vr("Animation","AnimationEnd"),animationiteration:vr("Animation","AnimationIteration"),animationstart:vr("Animation","AnimationStart"),transitionend:vr("Transition","TransitionEnd")},wr={},Sr={};function Er(e){if(wr[e])return wr[e];if(!br[e])return e;var t,i=br[e];for(t in i)if(i.hasOwnProperty(t)&&t in Sr)return wr[e]=i[t];return e}h&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete br.animationend.animation,delete br.animationiteration.animation,delete br.animationstart.animation),"TransitionEvent"in window||delete br.transitionend.transition);var Tr=Er("animationend"),Cr=Er("animationiteration"),kr=Er("animationstart"),Mr=Er("transitionend"),Ar=new Map,Pr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ir(e,t){Ar.set(e,t),l(t,[e])}for(var Dr=0;Dr<Pr.length;Dr++){var Rr=Pr[Dr];Ir(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Ir(Tr,"onAnimationEnd"),Ir(Cr,"onAnimationIteration"),Ir(kr,"onAnimationStart"),Ir("dblclick","onDoubleClick"),Ir("focusin","onFocus"),Ir("focusout","onBlur"),Ir(Mr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(zr));function Fr(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,r,n,o,s,l,c){if(je.apply(this,arguments),Fe){if(!Fe)throw Error(a(198));var h=Be;Fe=!1,Be=null,Oe||(Oe=!0,Ne=h)}}(r,t,void 0,e),e.currentTarget=null}function Br(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&n.isPropagationStopped())break e;Fr(n,s,c),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&n.isPropagationStopped())break e;Fr(n,s,c),a=l}}}if(Oe)throw e=Ne,Oe=!1,Ne=null,e}function Or(e,t){var i=t[mn];void 0===i&&(i=t[mn]=new Set);var r=e+"__bubble";i.has(r)||(Ur(t,e,2,!1),i.add(r))}function Nr(e,t,i){var r=0;t&&(r|=4),Ur(i,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function jr(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Nr(t,!1,e),Nr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Nr("selectionchange",!1,t))}}function Ur(e,t,i,r){switch(Yt(t)){case 1:var n=qt;break;case 4:n=Ht;break;default:n=Wt}i=n.bind(null,t,i,e),n=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),r?void 0!==n?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):void 0!==n?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function Gr(e,t,i,r,n){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===n||8===s.nodeType&&s.parentNode===n)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;o=o.return}for(;null!==s;){if(null===(o=yn(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}Ie((function(){var r=a,n=be(i),o=[];e:{var s=Ar.get(e);if(void 0!==s){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ci;break;case"focusin":c="focus",l=mi;break;case"focusout":c="blur",l=mi;break;case"beforeblur":case"afterblur":l=mi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mi;break;case Tr:case Cr:case kr:l=gi;break;case Mr:l=Ai;break;case"scroll":l=ui;break;case"wheel":l=Ii;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=ki}var h=0!==(4&t),u=!h&&"scroll"===e,d=h?null!==s?s+"Capture":null:s;h=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=De(f,d))&&h.push($r(f,m,p)))),u)break;f=f.return}0<h.length&&(s=new l(s,c,null,i,n),o.push({event:s,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||i===ve||!(c=i.relatedTarget||i.fromElement)||!yn(c)&&!c[fn])&&(l||s)&&(s=n.window===n?n:(s=n.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=i.relatedTarget||i.toElement)?yn(c):null)&&(c!==(u=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(h=pi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(h=ki,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?s:vn(l),p=null==c?s:vn(c),(s=new h(m,f+"leave",l,i,n)).target=u,s.relatedTarget=p,m=null,yn(n)===r&&((h=new h(d,f+"enter",c,i,n)).target=p,h.relatedTarget=u,m=h),u=m,l&&c)e:{for(d=c,f=0,p=h=l;p;p=Hr(p))f++;for(p=0,m=d;m;m=Hr(m))p++;for(;0<f-p;)h=Hr(h),f--;for(;0<p-f;)d=Hr(d),p--;for(;f--;){if(h===d||null!==d&&h===d.alternate)break e;h=Hr(h),d=Hr(d)}h=null}else h=null;null!==l&&Wr(o,s,l,h,!1),null!==c&&null!==u&&Wr(o,u,c,h,!0)}if("select"===(l=(s=r?vn(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Xi;else if(Gi(s))if(Yi)g=ar;else{g=rr;var _=ir}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=nr);switch(g&&(g=g(e,r))?$i(o,g,i,n):(_&&_(e,s,r),"focusout"===e&&(_=s._wrapperState)&&_.controlled&&"number"===s.type&&ee(s,"number",s.value)),_=r?vn(r):window,e){case"focusin":(Gi(_)||"true"===_.contentEditable)&&(mr=_,gr=r,_r=null);break;case"focusout":_r=gr=mr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,xr(o,i,n);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":xr(o,i,n)}var y;if(Ri)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ji?Ni(e,i)&&(x="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(x="onCompositionStart");x&&(Fi&&"ko"!==i.locale&&(ji||"onCompositionStart"!==x?"onCompositionEnd"===x&&ji&&(y=ei()):(Qt="value"in(Jt=n)?Jt.value:Jt.textContent,ji=!0)),0<(_=qr(r,x)).length&&(x=new xi(x,e,null,i,n),o.push({event:x,listeners:_}),y?x.data=y:null!==(y=Vi(i))&&(x.data=y))),(y=Li?function(e,t){switch(e){case"compositionend":return Vi(t);case"keypress":return 32!==t.which?null:(Oi=!0,Bi);case"textInput":return(e=t.data)===Bi&&Oi?null:e;default:return null}}(e,i):function(e,t){if(ji)return"compositionend"===e||!Ri&&Ni(e,t)?(e=ei(),Kt=Qt=Jt=null,ji=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(r=qr(r,"onBeforeInput")).length&&(n=new xi("onBeforeInput","beforeinput",null,i,n),o.push({event:n,listeners:r}),n.data=y))}Br(o,t)}))}function $r(e,t,i){return{instance:e,listener:t,currentTarget:i}}function qr(e,t){for(var i=t+"Capture",r=[];null!==e;){var n=e,a=n.stateNode;5===n.tag&&null!==a&&(n=a,null!=(a=De(e,i))&&r.unshift($r(e,a,n)),null!=(a=De(e,t))&&r.push($r(e,a,n))),e=e.return}return r}function Hr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Wr(e,t,i,r,n){for(var a=t._reactName,o=[];null!==i&&i!==r;){var s=i,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,n?null!=(l=De(i,a))&&o.unshift($r(i,l,s)):n||null!=(l=De(i,a))&&o.push($r(i,l,s))),i=i.return}0!==o.length&&e.push({event:t,listeners:o})}var Zr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Zr,"\n").replace(Xr,"")}function Jr(e,t,i){if(t=Yr(t),Yr(e)!==t&&i)throw Error(a(425))}function Qr(){}var Kr=null,en=null;function tn(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rn="function"===typeof setTimeout?setTimeout:void 0,nn="function"===typeof clearTimeout?clearTimeout:void 0,an="function"===typeof Promise?Promise:void 0,on="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof an?function(e){return an.resolve(null).then(e).catch(sn)}:rn;function sn(e){setTimeout((function(){throw e}))}function ln(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&8===n.nodeType)if("/$"===(i=n.data)){if(0===r)return e.removeChild(n),void Ut(t);r--}else"$"!==i&&"$?"!==i&&"$!"!==i||r++;i=n}while(i);Ut(t)}function cn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var un=Math.random().toString(36).slice(2),dn="__reactFiber$"+un,pn="__reactProps$"+un,fn="__reactContainer$"+un,mn="__reactEvents$"+un,gn="__reactListeners$"+un,_n="__reactHandles$"+un;function yn(e){var t=e[dn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fn]||i[dn]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hn(e);null!==e;){if(i=e[dn])return i;e=hn(e)}return t}i=(e=i).parentNode}return null}function xn(e){return!(e=e[dn]||e[fn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function bn(e){return e[pn]||null}var wn=[],Sn=-1;function En(e){return{current:e}}function Tn(e){0>Sn||(e.current=wn[Sn],wn[Sn]=null,Sn--)}function Cn(e,t){Sn++,wn[Sn]=e.current,e.current=t}var kn={},Mn=En(kn),An=En(!1),Pn=kn;function In(e,t){var i=e.type.contextTypes;if(!i)return kn;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n,a={};for(n in i)a[n]=t[n];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Dn(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rn(){Tn(An),Tn(Mn)}function zn(e,t,i){if(Mn.current!==kn)throw Error(a(168));Cn(Mn,t),Cn(An,i)}function Ln(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return i;for(var n in r=r.getChildContext())if(!(n in t))throw Error(a(108,G(e)||"Unknown",n));return B({},i,r)}function Fn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||kn,Pn=Mn.current,Cn(Mn,e),Cn(An,An.current),!0}function Bn(e,t,i){var r=e.stateNode;if(!r)throw Error(a(169));i?(e=Ln(e,t,Pn),r.__reactInternalMemoizedMergedChildContext=e,Tn(An),Tn(Mn),Cn(Mn,e)):Tn(An),Cn(An,i)}var On=null,Nn=!1,Vn=!1;function jn(e){null===On?On=[e]:On.push(e)}function Un(){if(!Vn&&null!==On){Vn=!0;var e=0,t=xt;try{var i=On;for(xt=1;e<i.length;e++){var r=i[e];do{r=r(!0)}while(null!==r)}On=null,Nn=!1}catch(n){throw null!==On&&(On=On.slice(e+1)),We(Ke,Un),n}finally{xt=t,Vn=!1}}return null}var Gn=[],$n=0,qn=null,Hn=0,Wn=[],Zn=0,Xn=null,Yn=1,Jn="";function Qn(e,t){Gn[$n++]=Hn,Gn[$n++]=qn,qn=e,Hn=t}function Kn(e,t,i){Wn[Zn++]=Yn,Wn[Zn++]=Jn,Wn[Zn++]=Xn,Xn=e;var r=Yn;e=Jn;var n=32-ot(r)-1;r&=~(1<<n),i+=1;var a=32-ot(t)+n;if(30<a){var o=n-n%5;a=(r&(1<<o)-1).toString(32),r>>=o,n-=o,Yn=1<<32-ot(t)+n|i<<n|r,Jn=a+e}else Yn=1<<a|i<<n|r,Jn=e}function ea(e){null!==e.return&&(Qn(e,1),Kn(e,1,0))}function ta(e){for(;e===qn;)qn=Gn[--$n],Gn[$n]=null,Hn=Gn[--$n],Gn[$n]=null;for(;e===Xn;)Xn=Wn[--Zn],Wn[Zn]=null,Jn=Wn[--Zn],Wn[Zn]=null,Yn=Wn[--Zn],Wn[Zn]=null}var ia=null,ra=null,na=!1,aa=null;function oa(e,t){var i=Ic(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function sa(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ia=e,ra=cn(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ia=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Xn?{id:Yn,overflow:Jn}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Ic(18,null,null,0)).stateNode=t,i.return=e,e.child=i,ia=e,ra=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(na){var t=ra;if(t){var i=t;if(!sa(e,t)){if(la(e))throw Error(a(418));t=cn(i.nextSibling);var r=ia;t&&sa(e,t)?oa(r,i):(e.flags=-4097&e.flags|2,na=!1,ia=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,na=!1,ia=e}}}function ha(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ia=e}function ua(e){if(e!==ia)return!1;if(!na)return ha(e),na=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!tn(e.type,e.memoizedProps)),t&&(t=ra)){if(la(e))throw da(),Error(a(418));for(;t;)oa(e,t),t=cn(t.nextSibling)}if(ha(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ra=cn(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ra=null}}else ra=ia?cn(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ra;e;)e=cn(e.nextSibling)}function pa(){ra=ia=null,na=!1}function fa(e){null===aa?aa=[e]:aa.push(e)}var ma=v.ReactCurrentBatchConfig;function ga(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(a(309));var r=i.stateNode}if(!r)throw Error(a(147,e));var n=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=n.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!i._owner)throw Error(a(290,e))}return e}function _a(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ya(e){return(0,e._init)(e._payload)}function xa(e){function t(t,i){if(e){var r=t.deletions;null===r?(t.deletions=[i],t.flags|=16):r.push(i)}}function i(i,r){if(!e)return null;for(;null!==r;)t(i,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function o(t,i,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<i?(t.flags|=2,i):r:(t.flags|=2,i):(t.flags|=1048576,i)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,r){return null===t||6!==t.tag?((t=Bc(i,e.mode,r)).return=e,t):((t=n(t,i)).return=e,t)}function c(e,t,i,r){var a=i.type;return a===S?u(e,t,i.props.children,r,i.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&ya(a)===t.type)?((r=n(t,i.props)).ref=ga(e,t,i),r.return=e,r):((r=zc(i.type,i.key,i.props,null,e.mode,r)).ref=ga(e,t,i),r.return=e,r)}function h(e,t,i,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Oc(i,e.mode,r)).return=e,t):((t=n(t,i.children||[])).return=e,t)}function u(e,t,i,r,a){return null===t||7!==t.tag?((t=Lc(i,e.mode,r,a)).return=e,t):((t=n(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Bc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(i=zc(t.type,t.key,t.props,null,e.mode,i)).ref=ga(e,null,t),i.return=e,i;case w:return(t=Oc(t,e.mode,i)).return=e,t;case D:return d(e,(0,t._init)(t._payload),i)}if(te(t)||L(t))return(t=Lc(t,e.mode,i,null)).return=e,t;_a(e,t)}return null}function p(e,t,i,r){var n=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==n?null:l(e,t,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return i.key===n?c(e,t,i,r):null;case w:return i.key===n?h(e,t,i,r):null;case D:return p(e,t,(n=i._init)(i._payload),r)}if(te(i)||L(i))return null!==n?null:u(e,t,i,r,null);_a(e,i)}return null}function f(e,t,i,r,n){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(i)||null,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return c(t,e=e.get(null===r.key?i:r.key)||null,r,n);case w:return h(t,e=e.get(null===r.key?i:r.key)||null,r,n);case D:return f(e,t,i,(0,r._init)(r._payload),n)}if(te(r)||L(r))return u(t,e=e.get(i)||null,r,n,null);_a(t,r)}return null}function m(n,a,s,l){for(var c=null,h=null,u=a,m=a=0,g=null;null!==u&&m<s.length;m++){u.index>m?(g=u,u=null):g=u.sibling;var _=p(n,u,s[m],l);if(null===_){null===u&&(u=g);break}e&&u&&null===_.alternate&&t(n,u),a=o(_,a,m),null===h?c=_:h.sibling=_,h=_,u=g}if(m===s.length)return i(n,u),na&&Qn(n,m),c;if(null===u){for(;m<s.length;m++)null!==(u=d(n,s[m],l))&&(a=o(u,a,m),null===h?c=u:h.sibling=u,h=u);return na&&Qn(n,m),c}for(u=r(n,u);m<s.length;m++)null!==(g=f(u,n,m,s[m],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?m:g.key),a=o(g,a,m),null===h?c=g:h.sibling=g,h=g);return e&&u.forEach((function(e){return t(n,e)})),na&&Qn(n,m),c}function g(n,s,l,c){var h=L(l);if("function"!==typeof h)throw Error(a(150));if(null==(l=h.call(l)))throw Error(a(151));for(var u=h=null,m=s,g=s=0,_=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var x=p(n,m,y.value,c);if(null===x){null===m&&(m=_);break}e&&m&&null===x.alternate&&t(n,m),s=o(x,s,g),null===u?h=x:u.sibling=x,u=x,m=_}if(y.done)return i(n,m),na&&Qn(n,g),h;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(n,y.value,c))&&(s=o(y,s,g),null===u?h=y:u.sibling=y,u=y);return na&&Qn(n,g),h}for(m=r(n,m);!y.done;g++,y=l.next())null!==(y=f(m,n,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=o(y,s,g),null===u?h=y:u.sibling=y,u=y);return e&&m.forEach((function(e){return t(n,e)})),na&&Qn(n,g),h}return function e(r,a,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var c=o.key,h=a;null!==h;){if(h.key===c){if((c=o.type)===S){if(7===h.tag){i(r,h.sibling),(a=n(h,o.props.children)).return=r,r=a;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&ya(c)===h.type){i(r,h.sibling),(a=n(h,o.props)).ref=ga(r,h,o),a.return=r,r=a;break e}i(r,h);break}t(r,h),h=h.sibling}o.type===S?((a=Lc(o.props.children,r.mode,l,o.key)).return=r,r=a):((l=zc(o.type,o.key,o.props,null,r.mode,l)).ref=ga(r,a,o),l.return=r,r=l)}return s(r);case w:e:{for(h=o.key;null!==a;){if(a.key===h){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){i(r,a.sibling),(a=n(a,o.children||[])).return=r,r=a;break e}i(r,a);break}t(r,a),a=a.sibling}(a=Oc(o,r.mode,l)).return=r,r=a}return s(r);case D:return e(r,a,(h=o._init)(o._payload),l)}if(te(o))return m(r,a,o,l);if(L(o))return g(r,a,o,l);_a(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(i(r,a.sibling),(a=n(a,o)).return=r,r=a):(i(r,a),(a=Bc(o,r.mode,l)).return=r,r=a),s(r)):i(r,a)}}var va=xa(!0),ba=xa(!1),wa=En(null),Sa=null,Ea=null,Ta=null;function Ca(){Ta=Ea=Sa=null}function ka(e){var t=wa.current;Tn(wa),e._currentValue=t}function Ma(e,t,i){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Aa(e,t){Sa=e,Ta=Ea=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Pa(e){var t=e._currentValue;if(Ta!==e)if(e={context:e,memoizedValue:t,next:null},null===Ea){if(null===Sa)throw Error(a(308));Ea=e,Sa.dependencies={lanes:0,firstContext:e}}else Ea=Ea.next=e;return t}var Ia=null;function Da(e){null===Ia?Ia=[e]:Ia.push(e)}function Ra(e,t,i,r){var n=t.interleaved;return null===n?(i.next=i,Da(t)):(i.next=n.next,n.next=i),t.interleaved=i,za(e,r)}function za(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var La=!1;function Fa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ba(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Na(e,t,i){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ml)){var n=r.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),r.pending=t,za(e,i)}return null===(n=r.interleaved)?(t.next=t,Da(r)):(t.next=n.next,n.next=t),r.interleaved=t,za(e,i)}function Va(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,yt(e,i)}}function ja(e,t){var i=e.updateQueue,r=e.alternate;if(null!==r&&i===(r=r.updateQueue)){var n=null,a=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===a?n=a=o:a=a.next=o,i=i.next}while(null!==i);null===a?n=a=t:a=a.next=t}else n=a=t;return i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Ua(e,t,i,r){var n=e.updateQueue;La=!1;var a=n.firstBaseUpdate,o=n.lastBaseUpdate,s=n.shared.pending;if(null!==s){n.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var h=e.alternate;null!==h&&((s=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===s?h.firstBaseUpdate=c:s.next=c,h.lastBaseUpdate=l))}if(null!==a){var u=n.baseState;for(o=0,h=c=l=null,s=a;;){var d=s.lane,p=s.eventTime;if((r&d)===d){null!==h&&(h=h.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(d=t,p=i,m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(p,u,d);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,u,d):f)||void 0===d)break e;u=B({},u,d);break e;case 2:La=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=n.effects)?n.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===h?(c=h=p,l=u):h=h.next=p,o|=d;if(null===(s=s.next)){if(null===(s=n.shared.pending))break;s=(d=s).next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}if(null===h&&(l=u),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,null!==(t=n.shared.interleaved)){n=t;do{o|=n.lane,n=n.next}while(n!==t)}else null===a&&(n.shared.lanes=0);Fl|=o,e.lanes=o,e.memoizedState=u}}function Ga(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(null!==n){if(r.callback=null,r=i,"function"!==typeof n)throw Error(a(191,n));n.call(r)}}}var $a={},qa=En($a),Ha=En($a),Wa=En($a);function Za(e){if(e===$a)throw Error(a(174));return e}function Xa(e,t){switch(Cn(Wa,t),Cn(Ha,e),Cn(qa,$a),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Tn(qa),Cn(qa,t)}function Ya(){Tn(qa),Tn(Ha),Tn(Wa)}function Ja(e){Za(Wa.current);var t=Za(qa.current),i=le(t,e.type);t!==i&&(Cn(Ha,e),Cn(qa,i))}function Qa(e){Ha.current===e&&(Tn(qa),Tn(Ha))}var Ka=En(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function io(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=v.ReactCurrentDispatcher,no=v.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,ho=!1,uo=0,po=0;function fo(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!or(e[i],t[i]))return!1;return!0}function go(e,t,i,r,n,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?Ko:es,e=i(r,n),ho){o=0;do{if(ho=!1,uo=0,25<=o)throw Error(a(301));o+=1,lo=so=null,t.updateQueue=null,ro.current=ts,e=i(r,n)}while(ho)}if(ro.current=Qo,t=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,t)throw Error(a(300));return e}function _o(){var e=0!==uo;return uo=0,e}function yo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function xo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===lo?oo.memoizedState:lo.next;if(null!==t)lo=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function vo(e,t){return"function"===typeof t?t(e):t}function bo(e){var t=xo(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var r=so,n=r.baseQueue,o=i.pending;if(null!==o){if(null!==n){var s=n.next;n.next=o.next,o.next=s}r.baseQueue=n=o,i.pending=null}if(null!==n){o=n.next,r=r.baseState;var l=s=null,c=null,h=o;do{var u=h.lane;if((ao&u)===u)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:e(r,h.action);else{var d={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=d,s=r):c=c.next=d,oo.lanes|=u,Fl|=u}h=h.next}while(null!==h&&h!==o);null===c?s=r:c.next=l,or(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,i.lastRenderedState=r}if(null!==(e=i.interleaved)){n=e;do{o=n.lane,oo.lanes|=o,Fl|=o,n=n.next}while(n!==e)}else null===n&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function wo(e){var t=xo(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,o=t.memoizedState;if(null!==n){i.pending=null;var s=n=n.next;do{o=e(o,s.action),s=s.next}while(s!==n);or(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,r]}function So(){}function Eo(e,t){var i=oo,r=xo(),n=t(),o=!or(r.memoizedState,n);if(o&&(r.memoizedState=n,xs=!0),r=r.queue,Fo(ko.bind(null,i,r,e),[e]),r.getSnapshot!==t||o||null!==lo&&1&lo.memoizedState.tag){if(i.flags|=2048,Io(9,Co.bind(null,i,r,n,t),void 0,null),null===Al)throw Error(a(349));0!==(30&ao)||To(i,t,n)}return n}function To(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Co(e,t,i,r){t.value=i,t.getSnapshot=r,Mo(t)&&Ao(e)}function ko(e,t,i){return i((function(){Mo(t)&&Ao(e)}))}function Mo(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!or(e,i)}catch(r){return!0}}function Ao(e){var t=za(e,1);null!==t&&ic(t,e,1,-1)}function Po(e){var t=yo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vo,lastRenderedState:e},t.queue=e,e=e.dispatch=Zo.bind(null,oo,e),[t.memoizedState,e]}function Io(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e),e}function Do(){return xo().memoizedState}function Ro(e,t,i,r){var n=yo();oo.flags|=e,n.memoizedState=Io(1|t,i,void 0,void 0===r?null:r)}function zo(e,t,i,r){var n=xo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(n.memoizedState=Io(t,i,a,r))}oo.flags|=e,n.memoizedState=Io(1|t,i,a,r)}function Lo(e,t){return Ro(8390656,8,e,t)}function Fo(e,t){return zo(2048,8,e,t)}function Bo(e,t){return zo(4,2,e,t)}function Oo(e,t){return zo(4,4,e,t)}function No(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vo(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,zo(4,4,No.bind(null,t,e),i)}function jo(){}function Uo(e,t){var i=xo();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function Go(e,t){var i=xo();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function $o(e,t,i){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=i):(or(i,t)||(i=mt(),oo.lanes|=i,Fl|=i,e.baseState=!0),t)}function qo(e,t){var i=xt;xt=0!==i&&4>i?i:4,e(!0);var r=no.transition;no.transition={};try{e(!1),t()}finally{xt=i,no.transition=r}}function Ho(){return xo().memoizedState}function Wo(e,t,i){var r=tc(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},Xo(e))Yo(t,i);else if(null!==(i=Ra(e,t,i,r))){ic(i,e,r,ec()),Jo(i,t,r)}}function Zo(e,t,i){var r=tc(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(Xo(e))Yo(t,n);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,i);if(n.hasEagerState=!0,n.eagerState=s,or(s,o)){var l=t.interleaved;return null===l?(n.next=n,Da(t)):(n.next=l.next,l.next=n),void(t.interleaved=n)}}catch(c){}null!==(i=Ra(e,t,n,r))&&(ic(i,e,r,n=ec()),Jo(i,t,r))}}function Xo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Yo(e,t){ho=co=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Jo(e,t,i){if(0!==(4194240&i)){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,yt(e,i)}}var Qo={readContext:Pa,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},Ko={readContext:Pa,useCallback:function(e,t){return yo().memoizedState=[e,void 0===t?null:t],e},useContext:Pa,useEffect:Lo,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ro(4194308,4,No.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Ro(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ro(4,2,e,t)},useMemo:function(e,t){var i=yo();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=yo();return t=void 0!==i?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Wo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yo().memoizedState=e},useState:Po,useDebugValue:jo,useDeferredValue:function(e){return yo().memoizedState=e},useTransition:function(){var e=Po(!1),t=e[0];return e=qo.bind(null,e[1]),yo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=oo,n=yo();if(na){if(void 0===i)throw Error(a(407));i=i()}else{if(i=t(),null===Al)throw Error(a(349));0!==(30&ao)||To(r,t,i)}n.memoizedState=i;var o={value:i,getSnapshot:t};return n.queue=o,Lo(ko.bind(null,r,o,e),[e]),r.flags|=2048,Io(9,Co.bind(null,r,o,i,t),void 0,null),i},useId:function(){var e=yo(),t=Al.identifierPrefix;if(na){var i=Jn;t=":"+t+"R"+(i=(Yn&~(1<<32-ot(Yn)-1)).toString(32)+i),0<(i=uo++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=po++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Pa,useCallback:Uo,useContext:Pa,useEffect:Fo,useImperativeHandle:Vo,useInsertionEffect:Bo,useLayoutEffect:Oo,useMemo:Go,useReducer:bo,useRef:Do,useState:function(){return bo(vo)},useDebugValue:jo,useDeferredValue:function(e){return $o(xo(),so.memoizedState,e)},useTransition:function(){return[bo(vo)[0],xo().memoizedState]},useMutableSource:So,useSyncExternalStore:Eo,useId:Ho,unstable_isNewReconciler:!1},ts={readContext:Pa,useCallback:Uo,useContext:Pa,useEffect:Fo,useImperativeHandle:Vo,useInsertionEffect:Bo,useLayoutEffect:Oo,useMemo:Go,useReducer:wo,useRef:Do,useState:function(){return wo(vo)},useDebugValue:jo,useDeferredValue:function(e){var t=xo();return null===so?t.memoizedState=e:$o(t,so.memoizedState,e)},useTransition:function(){return[wo(vo)[0],xo().memoizedState]},useMutableSource:So,useSyncExternalStore:Eo,useId:Ho,unstable_isNewReconciler:!1};function is(e,t){if(e&&e.defaultProps){for(var i in t=B({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function rs(e,t,i,r){i=null===(i=i(r,t=e.memoizedState))||void 0===i?t:B({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var ns={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=ec(),n=tc(e),a=Oa(r,n);a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=Na(e,a,n))&&(ic(t,e,n,r),Va(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=ec(),n=tc(e),a=Oa(r,n);a.tag=1,a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=Na(e,a,n))&&(ic(t,e,n,r),Va(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ec(),r=tc(e),n=Oa(i,r);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=Na(e,n,r))&&(ic(t,e,r,i),Va(t,e,r))}};function as(e,t,i,r,n,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!sr(i,r)||!sr(n,a))}function os(e,t,i){var r=!1,n=kn,a=t.contextType;return"object"===typeof a&&null!==a?a=Pa(a):(n=Dn(t)?Pn:Mn.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?In(e,n):kn),t=new t(i,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ns,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,i,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&ns.enqueueReplaceState(t,t.state,null)}function ls(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},Fa(e);var a=t.contextType;"object"===typeof a&&null!==a?n.context=Pa(a):(a=Dn(t)?Pn:Mn.current,n.context=In(e,a)),n.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,i),n.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof n.getSnapshotBeforeUpdate||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||(t=n.state,"function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&ns.enqueueReplaceState(n,n.state,null),Ua(e,i,n,r),n.state=e.memoizedState),"function"===typeof n.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var i="",r=t;do{i+=j(r),r=r.return}while(r);var n=i}catch(a){n="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:n,digest:null}}function hs(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function us(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,i){(i=Oa(-1,i)).tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){$l||($l=!0,ql=r),us(0,t)},i}function fs(e,t,i){(i=Oa(-1,i)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){us(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(i.callback=function(){us(0,t),"function"!==typeof r&&(null===Hl?Hl=new Set([this]):Hl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function ms(e,t,i){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var n=new Set;r.set(t,n)}else void 0===(n=r.get(t))&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=Tc.bind(null,e,t,i),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _s(e,t,i,r,n){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Oa(-1,1)).tag=2,Na(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=n,e)}var ys=v.ReactCurrentOwner,xs=!1;function vs(e,t,i,r){t.child=null===e?ba(t,null,i,r):va(t,e.child,i,r)}function bs(e,t,i,r,n){i=i.render;var a=t.ref;return Aa(t,n),r=go(e,t,i,r,a,n),i=_o(),null===e||xs?(na&&i&&ea(t),t.flags|=1,vs(e,t,r,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,$s(e,t,n))}function ws(e,t,i,r,n){if(null===e){var a=i.type;return"function"!==typeof a||Dc(a)||void 0!==a.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=zc(i.type,null,r,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ss(e,t,a,r,n))}if(a=e.child,0===(e.lanes&n)){var o=a.memoizedProps;if((i=null!==(i=i.compare)?i:sr)(o,r)&&e.ref===t.ref)return $s(e,t,n)}return t.flags|=1,(e=Rc(a,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,i,r,n){if(null!==e){var a=e.memoizedProps;if(sr(a,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=a,0===(e.lanes&n))return t.lanes=e.lanes,$s(e,t,n);0!==(131072&e.flags)&&(xs=!0)}}return Cs(e,t,i,r,n)}function Es(e,t,i){var r=t.pendingProps,n=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cn(Rl,Dl),Dl|=i;else{if(0===(1073741824&i))return e=null!==a?a.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cn(Rl,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:i,Cn(Rl,Dl),Dl|=r}else null!==a?(r=a.baseLanes|i,t.memoizedState=null):r=i,Cn(Rl,Dl),Dl|=r;return vs(e,t,n,i),t.child}function Ts(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,i,r,n){var a=Dn(i)?Pn:Mn.current;return a=In(t,a),Aa(t,n),i=go(e,t,i,r,a,n),r=_o(),null===e||xs?(na&&r&&ea(t),t.flags|=1,vs(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,$s(e,t,n))}function ks(e,t,i,r,n){if(Dn(i)){var a=!0;Fn(t)}else a=!1;if(Aa(t,n),null===t.stateNode)Gs(e,t),os(t,i,r),ls(t,i,r,n),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=i.contextType;"object"===typeof c&&null!==c?c=Pa(c):c=In(t,c=Dn(i)?Pn:Mn.current);var h=i.getDerivedStateFromProps,u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==c)&&ss(t,o,r,c),La=!1;var d=t.memoizedState;o.state=d,Ua(t,r,o,n),l=t.memoizedState,s!==r||d!==l||An.current||La?("function"===typeof h&&(rs(t,i,h,r),l=t.memoizedState),(s=La||as(t,i,s,r,d,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ba(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:is(t.type,s),o.props=c,u=t.pendingProps,d=o.context,"object"===typeof(l=i.contextType)&&null!==l?l=Pa(l):l=In(t,l=Dn(i)?Pn:Mn.current);var p=i.getDerivedStateFromProps;(h="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==u||d!==l)&&ss(t,o,r,l),La=!1,d=t.memoizedState,o.state=d,Ua(t,r,o,n);var f=t.memoizedState;s!==u||d!==f||An.current||La?("function"===typeof p&&(rs(t,i,p,r),f=t.memoizedState),(c=La||as(t,i,c,r,d,f,l)||!1)?(h||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ms(e,t,i,r,a,n)}function Ms(e,t,i,r,n,a){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return n&&Bn(t,i,!1),$s(e,t,a);r=t.stateNode,ys.current=t;var s=o&&"function"!==typeof i.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=va(t,e.child,null,a),t.child=va(t,null,s,a)):vs(e,t,s,a),t.memoizedState=r.state,n&&Bn(t,i,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?zn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&zn(0,t.context,!1),Xa(e,t.containerInfo)}function Ps(e,t,i,r,n){return pa(),fa(n),t.flags|=256,vs(e,t,i,r),t.child}var Is,Ds,Rs,zs,Ls={dehydrated:null,treeContext:null,retryLane:0};function Fs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Bs(e,t,i){var r,n=t.pendingProps,o=Ka.current,s=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Cn(Ka,1&o),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=n.children,e=n.fallback,s?(n=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&n)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Fc(l,n,0,null),e=Lc(e,n,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Fs(i),t.memoizedState=Ls,e):Os(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,i,r,n,o,s){if(i)return 256&t.flags?(t.flags&=-257,Ns(e,t,s,r=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,n=t.mode,r=Fc({mode:"visible",children:r.children},n,0,null),(o=Lc(o,n,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&va(t,e.child,null,s),t.child.memoizedState=Fs(s),t.memoizedState=Ls,o);if(0===(1&t.mode))return Ns(e,t,s,null);if("$!"===n.data){if(r=n.nextSibling&&n.nextSibling.dataset)var l=r.dgst;return r=l,Ns(e,t,s,r=hs(o=Error(a(419)),r,void 0))}if(l=0!==(s&e.childLanes),xs||l){if(null!==(r=Al)){switch(s&-s){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}0!==(n=0!==(n&(r.suspendedLanes|s))?0:n)&&n!==o.retryLane&&(o.retryLane=n,za(e,n),ic(r,e,n,-1))}return mc(),Ns(e,t,s,r=hs(Error(a(421))))}return"$?"===n.data?(t.flags|=128,t.child=e.child,t=kc.bind(null,e),n._reactRetry=t,null):(e=o.treeContext,ra=cn(n.nextSibling),ia=t,na=!0,aa=null,null!==e&&(Wn[Zn++]=Yn,Wn[Zn++]=Jn,Wn[Zn++]=Xn,Yn=e.id,Jn=e.overflow,Xn=t),t=Os(t,r.children),t.flags|=4096,t)}(e,t,l,n,r,o,i);if(s){s=n.fallback,l=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:n.children};return 0===(1&l)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=c,t.deletions=null):(n=Rc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Rc(r,s):(s=Lc(s,l,i,null)).flags|=2,s.return=t,n.return=t,n.sibling=s,t.child=n,n=s,s=t.child,l=null===(l=e.child.memoizedState)?Fs(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~i,t.memoizedState=Ls,n}return e=(s=e.child).sibling,n=Rc(s,{mode:"visible",children:n.children}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n}function Os(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ns(e,t,i,r){return null!==r&&fa(r),va(t,e.child,null,i),(e=Os(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vs(e,t,i){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ma(e.return,t,i)}function js(e,t,i,r,n){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=i,a.tailMode=n)}function Us(e,t,i){var r=t.pendingProps,n=r.revealOrder,a=r.tail;if(vs(e,t,r.children,i),0!==(2&(r=Ka.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vs(e,i,t);else if(19===e.tag)Vs(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Cn(Ka,r),0===(1&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;null!==i;)null!==(e=i.alternate)&&null===eo(e)&&(n=i),i=i.sibling;null===(i=n)?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),js(t,!1,n,i,a);break;case"backwards":for(i=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===eo(e)){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}js(t,!0,i,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $s(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(i=Rc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Rc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function qs(e,t){if(!na)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;null!==i;)null!==i.alternate&&(r=i),i=i.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;null!==n;)i|=n.lanes|n.childLanes,r|=14680064&n.subtreeFlags,r|=14680064&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function Ws(e,t,i){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Dn(t.type)&&Rn(),Hs(t),null;case 3:return r=t.stateNode,Ya(),Tn(An),Tn(Mn),io(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ua(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(oc(aa),aa=null))),Ds(e,t),Hs(t),null;case 5:Qa(t);var n=Za(Wa.current);if(i=t.type,null!==e&&null!=t.stateNode)Rs(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Hs(t),null}if(e=Za(qa.current),ua(t)){r=t.stateNode,i=t.type;var o=t.memoizedProps;switch(r[dn]=t,r[pn]=o,e=0!==(1&t.mode),i){case"dialog":Or("cancel",r),Or("close",r);break;case"iframe":case"object":case"embed":Or("load",r);break;case"video":case"audio":for(n=0;n<zr.length;n++)Or(zr[n],r);break;case"source":Or("error",r);break;case"img":case"image":case"link":Or("error",r),Or("load",r);break;case"details":Or("toggle",r);break;case"input":Y(r,o),Or("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Or("invalid",r);break;case"textarea":ne(r,o),Or("invalid",r)}for(var l in ye(i,o),n=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),n=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),n=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Or("scroll",r)}switch(i){case"input":H(r),K(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Qr)}r=n,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===n.nodeType?n:n.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(i,{is:r.is}):(e=l.createElement(i),"select"===i&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,i),e[dn]=t,e[pn]=r,Is(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(i,r),i){case"dialog":Or("cancel",e),Or("close",e),n=r;break;case"iframe":case"object":case"embed":Or("load",e),n=r;break;case"video":case"audio":for(n=0;n<zr.length;n++)Or(zr[n],e);n=r;break;case"source":Or("error",e),n=r;break;case"img":case"image":case"link":Or("error",e),Or("load",e),n=r;break;case"details":Or("toggle",e),n=r;break;case"input":Y(e,r),n=X(e,r),Or("invalid",e);break;case"option":default:n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=B({},r,{value:void 0}),Or("invalid",e);break;case"textarea":ne(e,r),n=re(e,r),Or("invalid",e)}for(o in ye(i,n),c=n)if(c.hasOwnProperty(o)){var h=c[o];"style"===o?ge(e,h):"dangerouslySetInnerHTML"===o?null!=(h=h?h.__html:void 0)&&ue(e,h):"children"===o?"string"===typeof h?("textarea"!==i||""!==h)&&de(e,h):"number"===typeof h&&de(e,""+h):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=h&&"onScroll"===o&&Or("scroll",e):null!=h&&x(e,o,h,l))}switch(i){case"input":H(e),K(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+$(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ie(e,!!r.multiple,o,!1):null!=r.defaultValue&&ie(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof n.onClick&&(e.onclick=Qr)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)zs(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(i=Za(Wa.current),Za(qa.current),ua(t)){if(r=t.stateNode,i=t.memoizedProps,r[dn]=t,(o=r.nodeValue!==i)&&null!==(e=ia))switch(e.tag){case 3:Jr(r.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,i,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===i.nodeType?i:i.ownerDocument).createTextNode(r))[dn]=t,t.stateNode=r}return Hs(t),null;case 13:if(Tn(Ka),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(na&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))da(),pa(),t.flags|=98560,o=!1;else if(o=ua(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[dn]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),o=!1}else null!==aa&&(oc(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Ka.current)?0===zl&&(zl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return Ya(),Ds(e,t),null===e&&jr(t.stateNode.containerInfo),Hs(t),null;case 10:return ka(t.type._context),Hs(t),null;case 19:if(Tn(Ka),null===(o=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(l=o.rendering))if(r)qs(o,!1);else{if(0!==zl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=eo(e))){for(t.flags|=128,qs(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;null!==i;)e=r,(o=i).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Cn(Ka,1&Ka.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Ul&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(l))){if(t.flags|=128,r=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),qs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!na)return Hs(t),null}else 2*Je()-o.renderingStartTime>Ul&&1073741824!==i&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=o.last)?i.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,i=Ka.current,Cn(Ka,r?1&i|2:1&i),t):(Hs(t),null);case 22:case 23:return uc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Zs(e,t){switch(ta(t),t.tag){case 1:return Dn(t.type)&&Rn(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),Tn(An),Tn(Mn),io(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Qa(t),null;case 13:if(Tn(Ka),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Tn(Ka),null;case 4:return Ya(),null;case 10:return ka(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Is=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Ds=function(){},Rs=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,Za(qa.current);var a,o=null;switch(i){case"input":n=X(e,n),r=X(e,r),o=[];break;case"select":n=B({},n,{value:void 0}),r=B({},r,{value:void 0}),o=[];break;case"textarea":n=re(e,n),r=re(e,r),o=[];break;default:"function"!==typeof n.onClick&&"function"===typeof r.onClick&&(e.onclick=Qr)}for(h in ye(i,r),i=null,n)if(!r.hasOwnProperty(h)&&n.hasOwnProperty(h)&&null!=n[h])if("style"===h){var l=n[h];for(a in l)l.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(s.hasOwnProperty(h)?o||(o=[]):(o=o||[]).push(h,null));for(h in r){var c=r[h];if(l=null!=n?n[h]:void 0,r.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(i||(i={}),i[a]=c[a])}else i||(o||(o=[]),o.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(s.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Or("scroll",e),o||l===c||(o=[])):(o=o||[]).push(h,c))}i&&(o=o||[]).push("style",i);var h=o;(t.updateQueue=h)&&(t.flags|=4)}},zs=function(e,t,i,r){i!==r&&(t.flags|=4)};var Xs=!1,Ys=!1,Js="function"===typeof WeakSet?WeakSet:Set,Qs=null;function Ks(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(r){Ec(e,t,r)}else i.current=null}function el(e,t,i){try{i()}catch(r){Ec(e,t,r)}}var tl=!1;function il(e,t,i){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var n=r=r.next;do{if((n.tag&e)===e){var a=n.destroy;n.destroy=void 0,void 0!==a&&el(t,i,a)}n=n.next}while(n!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function nl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dn],delete t[pn],delete t[mn],delete t[gn],delete t[_n])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function sl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=Qr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function cl(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var hl=null,ul=!1;function dl(e,t,i){for(i=i.child;null!==i;)pl(e,t,i),i=i.sibling}function pl(e,t,i){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(nt,i)}catch(s){}switch(i.tag){case 5:Ys||Ks(i,t);case 6:var r=hl,n=ul;hl=null,dl(e,t,i),ul=n,null!==(hl=r)&&(ul?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(ul?(e=hl,i=i.stateNode,8===e.nodeType?ln(e.parentNode,i):1===e.nodeType&&ln(e,i),Ut(e)):ln(hl,i.stateNode));break;case 4:r=hl,n=ul,hl=i.stateNode.containerInfo,ul=!0,dl(e,t,i),hl=r,ul=n;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=i.updateQueue)&&null!==(r=r.lastEffect))){n=r=r.next;do{var a=n,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&el(i,t,o),n=n.next}while(n!==r)}dl(e,t,i);break;case 1:if(!Ys&&(Ks(i,t),"function"===typeof(r=i.stateNode).componentWillUnmount))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(s){Ec(i,t,s)}dl(e,t,i);break;case 21:dl(e,t,i);break;case 22:1&i.mode?(Ys=(r=Ys)||null!==i.memoizedState,dl(e,t,i),Ys=r):dl(e,t,i);break;default:dl(e,t,i)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Js),t.forEach((function(t){var r=Mc.bind(null,e,t);i.has(t)||(i.add(t),t.then(r,r))}))}}function ml(e,t){var i=t.deletions;if(null!==i)for(var r=0;r<i.length;r++){var n=i[r];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,ul=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===hl)throw Error(a(160));pl(o,s,n),hl=null,ul=!1;var c=n.alternate;null!==c&&(c.return=null),n.return=null}catch(h){Ec(n,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),_l(e),4&r){try{il(3,e,e.return),rl(3,e)}catch(g){Ec(e,e.return,g)}try{il(5,e,e.return)}catch(g){Ec(e,e.return,g)}}break;case 1:ml(t,e),_l(e),512&r&&null!==i&&Ks(i,i.return);break;case 5:if(ml(t,e),_l(e),512&r&&null!==i&&Ks(i,i.return),32&e.flags){var n=e.stateNode;try{de(n,"")}catch(g){Ec(e,e.return,g)}}if(4&r&&null!=(n=e.stateNode)){var o=e.memoizedProps,s=null!==i?i.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(n,o),xe(l,s);var h=xe(l,o);for(s=0;s<c.length;s+=2){var u=c[s],d=c[s+1];"style"===u?ge(n,d):"dangerouslySetInnerHTML"===u?ue(n,d):"children"===u?de(n,d):x(n,u,d,h)}switch(l){case"input":Q(n,o);break;case"textarea":ae(n,o);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ie(n,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ie(n,!!o.multiple,o.defaultValue,!0):ie(n,!!o.multiple,o.multiple?[]:"",!1))}n[pn]=o}catch(g){Ec(e,e.return,g)}}break;case 6:if(ml(t,e),_l(e),4&r){if(null===e.stateNode)throw Error(a(162));n=e.stateNode,o=e.memoizedProps;try{n.nodeValue=o}catch(g){Ec(e,e.return,g)}}break;case 3:if(ml(t,e),_l(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(g){Ec(e,e.return,g)}break;case 4:default:ml(t,e),_l(e);break;case 13:ml(t,e),_l(e),8192&(n=e.child).flags&&(o=null!==n.memoizedState,n.stateNode.isHidden=o,!o||null!==n.alternate&&null!==n.alternate.memoizedState||(jl=Je())),4&r&&fl(e);break;case 22:if(u=null!==i&&null!==i.memoizedState,1&e.mode?(Ys=(h=Ys)||u,ml(t,e),Ys=h):ml(t,e),_l(e),8192&r){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!u&&0!==(1&e.mode))for(Qs=e,u=e.child;null!==u;){for(d=Qs=u;null!==Qs;){switch(f=(p=Qs).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:Ks(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,i=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Ec(r,i,g)}}break;case 5:Ks(p,p.return);break;case 22:if(null!==p.memoizedState){bl(d);continue}}null!==f?(f.return=p,Qs=f):bl(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{n=d.stateNode,h?"function"===typeof(o=n.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(g){Ec(e,e.return,g)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=h?"":d.memoizedProps}catch(g){Ec(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(t,e),_l(e),4&r&&fl(e);case 21:}}function _l(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(ol(i)){var r=i;break e}i=i.return}throw Error(a(160))}switch(r.tag){case 5:var n=r.stateNode;32&r.flags&&(de(n,""),r.flags&=-33),cl(e,sl(e),n);break;case 3:case 4:var o=r.stateNode.containerInfo;ll(e,sl(e),o);break;default:throw Error(a(161))}}catch(s){Ec(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){Qs=e,xl(e,t,i)}function xl(e,t,i){for(var r=0!==(1&e.mode);null!==Qs;){var n=Qs,a=n.child;if(22===n.tag&&r){var o=null!==n.memoizedState||Xs;if(!o){var s=n.alternate,l=null!==s&&null!==s.memoizedState||Ys;s=Xs;var c=Ys;if(Xs=o,(Ys=l)&&!c)for(Qs=n;null!==Qs;)l=(o=Qs).child,22===o.tag&&null!==o.memoizedState?wl(n):null!==l?(l.return=o,Qs=l):wl(n);for(;null!==a;)Qs=a,xl(a,t,i),a=a.sibling;Qs=n,Xs=s,Ys=c}vl(e)}else 0!==(8772&n.subtreeFlags)&&null!==a?(a.return=n,Qs=a):vl(e)}}function vl(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===i)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:is(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ga(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Ga(t,s,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var u=h.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Ut(d)}}}break;default:throw Error(a(163))}Ys||512&t.flags&&nl(t)}catch(p){Ec(t,t.return,p)}}if(t===e){Qs=null;break}if(null!==(i=t.sibling)){i.return=t.return,Qs=i;break}Qs=t.return}}function bl(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Qs=i;break}Qs=t.return}}function wl(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(l){Ec(t,i,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var n=t.return;try{r.componentDidMount()}catch(l){Ec(t,n,l)}}var a=t.return;try{nl(t)}catch(l){Ec(t,a,l)}break;case 5:var o=t.return;try{nl(t)}catch(l){Ec(t,o,l)}}}catch(l){Ec(t,t.return,l)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var Sl,El=Math.ceil,Tl=v.ReactCurrentDispatcher,Cl=v.ReactCurrentOwner,kl=v.ReactCurrentBatchConfig,Ml=0,Al=null,Pl=null,Il=0,Dl=0,Rl=En(0),zl=0,Ll=null,Fl=0,Bl=0,Ol=0,Nl=null,Vl=null,jl=0,Ul=1/0,Gl=null,$l=!1,ql=null,Hl=null,Wl=!1,Zl=null,Xl=0,Yl=0,Jl=null,Ql=-1,Kl=0;function ec(){return 0!==(6&Ml)?Je():-1!==Ql?Ql:Ql=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Ml)&&0!==Il?Il&-Il:null!==ma.transition?(0===Kl&&(Kl=mt()),Kl):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function ic(e,t,i,r){if(50<Yl)throw Yl=0,Jl=null,Error(a(185));_t(e,i,r),0!==(2&Ml)&&e===Al||(e===Al&&(0===(2&Ml)&&(Bl|=i),4===zl&&sc(e,Il)),rc(e,r),1===i&&0===Ml&&0===(1&t.mode)&&(Ul=Je()+500,Nn&&Un()))}function rc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,l=n[o];-1===l?0!==(s&i)&&0===(s&r)||(n[o]=pt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=dt(e,e===Al?Il:0);if(0===r)null!==i&&Ze(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=i&&Ze(i),1===t)0===e.tag?function(e){Nn=!0,jn(e)}(lc.bind(null,e)):jn(lc.bind(null,e)),on((function(){0===(6&Ml)&&Un()})),i=null;else{switch(vt(r)){case 1:i=Ke;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=rt}i=Ac(i,nc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function nc(e,t){if(Ql=-1,Kl=0,0!==(6&Ml))throw Error(a(327));var i=e.callbackNode;if(wc()&&e.callbackNode!==i)return null;var r=dt(e,e===Al?Il:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var n=Ml;Ml|=2;var o=fc();for(Al===e&&Il===t||(Gl=null,Ul=Je()+500,dc(e,t));;)try{yc();break}catch(l){pc(e,l)}Ca(),Tl.current=o,Ml=n,null!==Pl?t=0:(Al=null,Il=0,t=zl)}if(0!==t){if(2===t&&(0!==(n=ft(e))&&(r=n,t=ac(e,n))),1===t)throw i=Ll,dc(e,0),sc(e,r),rc(e,Je()),i;if(6===t)sc(e,r);else{if(n=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var r=0;r<i.length;r++){var n=i[r],a=n.getSnapshot;n=n.value;try{if(!or(a(),n))return!1}catch(s){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)&&(2===(t=gc(e,r))&&(0!==(o=ft(e))&&(r=o,t=ac(e,o))),1===t))throw i=Ll,dc(e,0),sc(e,r),rc(e,Je()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:bc(e,Vl,Gl);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=jl+500-Je())){if(0!==dt(e,0))break;if(((n=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=rn(bc.bind(null,e,Vl,Gl),t);break}bc(e,Vl,Gl);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,n=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>n&&(n=s),r&=~o}if(r=n,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=rn(bc.bind(null,e,Vl,Gl),r);break}bc(e,Vl,Gl);break;default:throw Error(a(329))}}}return rc(e,Je()),e.callbackNode===i?nc.bind(null,e):null}function ac(e,t){var i=Nl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Vl,Vl=i,null!==t&&oc(t)),e}function oc(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function sc(e,t){for(t&=~Ol,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ot(t),r=1<<i;e[i]=-1,t&=~r}}function lc(e){if(0!==(6&Ml))throw Error(a(327));wc();var t=dt(e,0);if(0===(1&t))return rc(e,Je()),null;var i=gc(e,t);if(0!==e.tag&&2===i){var r=ft(e);0!==r&&(t=r,i=ac(e,r))}if(1===i)throw i=Ll,dc(e,0),sc(e,t),rc(e,Je()),i;if(6===i)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bc(e,Vl,Gl),rc(e,Je()),null}function cc(e,t){var i=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=i)&&(Ul=Je()+500,Nn&&Un())}}function hc(e){null!==Zl&&0===Zl.tag&&0===(6&Ml)&&wc();var t=Ml;Ml|=1;var i=kl.transition,r=xt;try{if(kl.transition=null,xt=1,e)return e()}finally{xt=r,kl.transition=i,0===(6&(Ml=t))&&Un()}}function uc(){Dl=Rl.current,Tn(Rl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,nn(i)),null!==Pl)for(i=Pl.return;null!==i;){var r=i;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Rn();break;case 3:Ya(),Tn(An),Tn(Mn),io();break;case 5:Qa(r);break;case 4:Ya();break;case 13:case 19:Tn(Ka);break;case 10:ka(r.type._context);break;case 22:case 23:uc()}i=i.return}if(Al=e,Pl=e=Rc(e.current,null),Il=Dl=t,zl=0,Ll=null,Ol=Bl=Fl=0,Vl=Nl=null,null!==Ia){for(t=0;t<Ia.length;t++)if(null!==(r=(i=Ia[t]).interleaved)){i.interleaved=null;var n=r.next,a=i.pending;if(null!==a){var o=a.next;a.next=n,r.next=o}i.pending=r}Ia=null}return e}function pc(e,t){for(;;){var i=Pl;try{if(Ca(),ro.current=Qo,co){for(var r=oo.memoizedState;null!==r;){var n=r.queue;null!==n&&(n.pending=null),r=r.next}co=!1}if(ao=0,lo=so=oo=null,ho=!1,uo=0,Cl.current=null,null===i||null===i.return){zl=1,Ll=t,Pl=null;break}e:{var o=e,s=i.return,l=i,c=t;if(t=Il,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,_s(f,s,l,0,t),1&f.mode&&ms(o,h,t),c=h;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ms(o,h,t),mc();break e}c=Error(a(426))}else if(na&&1&l.mode){var _=gs(s);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),_s(_,s,l,0,t),fa(cs(c,l));break e}}o=c=cs(c,l),4!==zl&&(zl=2),null===Nl?Nl=[o]:Nl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,ja(o,ps(0,c,t));break e;case 1:l=c;var y=o.type,x=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Hl||!Hl.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t,ja(o,fs(o,l,t));break e}}o=o.return}while(null!==o)}vc(i)}catch(v){t=v,Pl===i&&null!==i&&(Pl=i=i.return);continue}break}}function fc(){var e=Tl.current;return Tl.current=Qo,null===e?Qo:e}function mc(){0!==zl&&3!==zl&&2!==zl||(zl=4),null===Al||0===(268435455&Fl)&&0===(268435455&Bl)||sc(Al,Il)}function gc(e,t){var i=Ml;Ml|=2;var r=fc();for(Al===e&&Il===t||(Gl=null,dc(e,t));;)try{_c();break}catch(n){pc(e,n)}if(Ca(),Ml=i,Tl.current=r,null!==Pl)throw Error(a(261));return Al=null,Il=0,zl}function _c(){for(;null!==Pl;)xc(Pl)}function yc(){for(;null!==Pl&&!Xe();)xc(Pl)}function xc(e){var t=Sl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?vc(e):Pl=t,Cl.current=null}function vc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=Ws(i,t,Dl)))return void(Pl=i)}else{if(null!==(i=Zs(i,t)))return i.flags&=32767,void(Pl=i);if(null===e)return zl=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===zl&&(zl=5)}function bc(e,t,i){var r=xt,n=kl.transition;try{kl.transition=null,xt=1,function(e,t,i,r){do{wc()}while(null!==Zl);if(0!==(6&Ml))throw Error(a(327));i=e.finishedWork;var n=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-ot(i),a=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~a}}(e,o),e===Al&&(Pl=Al=null,Il=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Wl||(Wl=!0,Ac(tt,(function(){return wc(),null}))),o=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||o){o=kl.transition,kl.transition=null;var s=xt;xt=1;var l=Ml;Ml|=4,Cl.current=null,function(e,t){if(Kr=$t,dr(e=ur())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(r&&0!==r.rangeCount){i=r.anchorNode;var n=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{i.nodeType,o.nodeType}catch(b){i=null;break e}var s=0,l=-1,c=-1,h=0,u=0,d=e,p=null;t:for(;;){for(var f;d!==i||0!==n&&3!==d.nodeType||(l=s+n),d!==o||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===i&&++h===n&&(l=s),p===o&&++u===r&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(en={focusedElem:e,selectionRange:i},$t=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:is(t.type,g),_);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(a(163))}}catch(b){Ec(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}m=tl,tl=!1}(e,i),gl(i,e),pr(en),$t=!!Kr,en=Kr=null,e.current=i,yl(i,e,n),Ye(),Ml=l,xt=s,kl.transition=o}else e.current=i;if(Wl&&(Wl=!1,Zl=e,Xl=n),o=e.pendingLanes,0===o&&(Hl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(nt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),rc(e,Je()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if($l)throw $l=!1,e=ql,ql=null,e;0!==(1&Xl)&&0!==e.tag&&wc(),o=e.pendingLanes,0!==(1&o)?e===Jl?Yl++:(Yl=0,Jl=e):Yl=0,Un()}(e,t,i,r)}finally{kl.transition=n,xt=r}return null}function wc(){if(null!==Zl){var e=vt(Xl),t=kl.transition,i=xt;try{if(kl.transition=null,xt=16>e?16:e,null===Zl)var r=!1;else{if(e=Zl,Zl=null,Xl=0,0!==(6&Ml))throw Error(a(331));var n=Ml;for(Ml|=4,Qs=e.current;null!==Qs;){var o=Qs,s=o.child;if(0!==(16&Qs.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for(Qs=h;null!==Qs;){var u=Qs;switch(u.tag){case 0:case 11:case 15:il(8,u,o)}var d=u.child;if(null!==d)d.return=u,Qs=d;else for(;null!==Qs;){var p=(u=Qs).sibling,f=u.return;if(al(u),u===h){Qs=null;break}if(null!==p){p.return=f,Qs=p;break}Qs=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Qs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(o=Qs).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Qs=y;break e}Qs=o.return}}var x=e.current;for(Qs=x;null!==Qs;){var v=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==v)v.return=s,Qs=v;else e:for(s=x;null!==Qs;){if(0!==(2048&(l=Qs).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Ec(l,l.return,w)}if(l===s){Qs=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Qs=b;break e}Qs=l.return}}if(Ml=n,Un(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(nt,e)}catch(w){}r=!0}return r}finally{xt=i,kl.transition=t}}return!1}function Sc(e,t,i){e=Na(e,t=ps(0,t=cs(i,t),1),1),t=ec(),null!==e&&(_t(e,1,t),rc(e,t))}function Ec(e,t,i){if(3===e.tag)Sc(e,e,i);else for(;null!==t;){if(3===t.tag){Sc(t,e,i);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hl||!Hl.has(r))){t=Na(t,e=fs(t,e=cs(i,e),1),1),e=ec(),null!==t&&(_t(t,1,e),rc(t,e));break}}t=t.return}}function Tc(e,t,i){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&i,Al===e&&(Il&i)===i&&(4===zl||3===zl&&(130023424&Il)===Il&&500>Je()-jl?dc(e,0):Ol|=i),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var i=ec();null!==(e=za(e,t))&&(_t(e,t,i),rc(e,i))}function kc(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Cc(e,i)}function Mc(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;null!==n&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Cc(e,i)}function Ac(e,t){return We(e,t)}function Pc(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ic(e,t,i,r){return new Pc(e,t,i,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var i=e.alternate;return null===i?((i=Ic(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function zc(e,t,i,r,n,o){var s=2;if(r=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Lc(i.children,n,o,t);case E:s=8,n|=8;break;case T:return(e=Ic(12,i,t,2|n)).elementType=T,e.lanes=o,e;case A:return(e=Ic(13,i,t,n)).elementType=A,e.lanes=o,e;case P:return(e=Ic(19,i,t,n)).elementType=P,e.lanes=o,e;case R:return Fc(i,n,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case k:s=9;break e;case M:s=11;break e;case I:s=14;break e;case D:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ic(s,i,t,n)).elementType=e,t.type=r,t.lanes=o,t}function Lc(e,t,i,r){return(e=Ic(7,e,r,t)).lanes=i,e}function Fc(e,t,i,r){return(e=Ic(22,e,r,t)).elementType=R,e.lanes=i,e.stateNode={isHidden:!1},e}function Bc(e,t,i){return(e=Ic(6,e,null,t)).lanes=i,e}function Oc(e,t,i){return(t=Ic(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Nc(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Vc(e,t,i,r,n,a,o,s,l){return e=new Nc(e,t,i,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Ic(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fa(a),e}function jc(e){if(!e)return kn;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var i=e.type;if(Dn(i))return Ln(e,i,t)}return t}function Uc(e,t,i,r,n,a,o,s,l){return(e=Vc(i,r,!0,e,0,a,0,s,l)).context=jc(null),i=e.current,(a=Oa(r=ec(),n=tc(i))).callback=void 0!==t&&null!==t?t:null,Na(i,a,n),e.current.lanes=n,_t(e,n,r),rc(e,r),e}function Gc(e,t,i,r){var n=t.current,a=ec(),o=tc(n);return i=jc(i),null===t.context?t.context=i:t.pendingContext=i,(t=Oa(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Na(n,t,o))&&(ic(e,n,o,a),Va(e,n,o)),o}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Hc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}Sl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||An.current)xs=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return xs=!1,function(e,t,i){switch(t.tag){case 3:As(t),pa();break;case 5:Ja(t);break;case 1:Dn(t.type)&&Fn(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;Cn(wa,r._currentValue),r._currentValue=n;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Cn(Ka,1&Ka.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Bs(e,t,i):(Cn(Ka,1&Ka.current),null!==(e=$s(e,t,i))?e.sibling:null);Cn(Ka,1&Ka.current);break;case 19:if(r=0!==(i&t.childLanes),0!==(128&e.flags)){if(r)return Us(e,t,i);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),Cn(Ka,Ka.current),r)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,i)}return $s(e,t,i)}(e,t,i);xs=0!==(131072&e.flags)}else xs=!1,na&&0!==(1048576&t.flags)&&Kn(t,Hn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var n=In(t,Mn.current);Aa(t,i),n=go(null,t,r,e,n,i);var o=_o();return t.flags|=1,"object"===typeof n&&null!==n&&"function"===typeof n.render&&void 0===n.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dn(r)?(o=!0,Fn(t)):o=!1,t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,Fa(t),n.updater=ns,t.stateNode=n,n._reactInternals=t,ls(t,r,e,i),t=Ms(null,t,r,!0,o,i)):(t.tag=0,na&&o&&ea(t),vs(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(n=r._init)(r._payload),t.type=r,n=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===M)return 11;if(e===I)return 14}return 2}(r),e=is(r,e),n){case 0:t=Cs(null,t,r,e,i);break e;case 1:t=ks(null,t,r,e,i);break e;case 11:t=bs(null,t,r,e,i);break e;case 14:t=ws(null,t,r,is(r.type,e),i);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,Cs(e,t,r,n=t.elementType===r?n:is(r,n),i);case 1:return r=t.type,n=t.pendingProps,ks(e,t,r,n=t.elementType===r?n:is(r,n),i);case 3:e:{if(As(t),null===e)throw Error(a(387));r=t.pendingProps,n=(o=t.memoizedState).element,Ba(e,t),Ua(t,r,null,i);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ps(e,t,r,i,n=cs(Error(a(423)),t));break e}if(r!==n){t=Ps(e,t,r,i,n=cs(Error(a(424)),t));break e}for(ra=cn(t.stateNode.containerInfo.firstChild),ia=t,na=!0,aa=null,i=ba(t,null,r,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(pa(),r===n){t=$s(e,t,i);break e}vs(e,t,r,i)}t=t.child}return t;case 5:return Ja(t),null===e&&ca(t),r=t.type,n=t.pendingProps,o=null!==e?e.memoizedProps:null,s=n.children,tn(r,n)?s=null:null!==o&&tn(r,o)&&(t.flags|=32),Ts(e,t),vs(e,t,s,i),t.child;case 6:return null===e&&ca(t),null;case 13:return Bs(e,t,i);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=va(t,null,r,i):vs(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,bs(e,t,r,n=t.elementType===r?n:is(r,n),i);case 7:return vs(e,t,t.pendingProps,i),t.child;case 8:case 12:return vs(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,o=t.memoizedProps,s=n.value,Cn(wa,r._currentValue),r._currentValue=s,null!==o)if(or(o.value,s)){if(o.children===n.children&&!An.current){t=$s(e,t,i);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Oa(-1,i&-i)).tag=2;var h=o.updateQueue;if(null!==h){var u=(h=h.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),h.pending=c}}o.lanes|=i,null!==(c=o.alternate)&&(c.lanes|=i),Ma(o.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=i,null!==(l=s.alternate)&&(l.lanes|=i),Ma(s,i,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}vs(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,Aa(t,i),r=r(n=Pa(n)),t.flags|=1,vs(e,t,r,i),t.child;case 14:return n=is(r=t.type,t.pendingProps),ws(e,t,r,n=is(r.type,n),i);case 15:return Ss(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:is(r,n),Gs(e,t),t.tag=1,Dn(r)?(e=!0,Fn(t)):e=!1,Aa(t,i),os(t,r,n),ls(t,r,n,i),Ms(null,t,r,!0,e,i);case 19:return Us(e,t,i);case 22:return Es(e,t,i)}throw Error(a(156,t.tag))};var Wc="function"===typeof reportError?reportError:function(e){console.error(e)};function Zc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qc(){}function Kc(e,t,i,r,n){var a=i._reactRootContainer;if(a){var o=a;if("function"===typeof n){var s=n;n=function(){var e=$c(o);s.call(e)}}Gc(t,o,e,n)}else o=function(e,t,i,r,n){if(n){if("function"===typeof r){var a=r;r=function(){var e=$c(o);a.call(e)}}var o=Uc(t,r,e,0,null,!1,0,"",Qc);return e._reactRootContainer=o,e[fn]=o.current,jr(8===e.nodeType?e.parentNode:e),hc(),o}for(;n=e.lastChild;)e.removeChild(n);if("function"===typeof r){var s=r;r=function(){var e=$c(l);s.call(e)}}var l=Vc(e,0,!1,null,0,!1,0,"",Qc);return e._reactRootContainer=l,e[fn]=l.current,jr(8===e.nodeType?e.parentNode:e),hc((function(){Gc(t,l,i,r)})),l}(i,t,e,n,r);return $c(o)}Xc.prototype.render=Zc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Gc(e,t,null,null)},Xc.prototype.unmount=Zc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Gc(null,e,null,null)})),t[fn]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Rt.length&&0!==t&&t<Rt[i].priority;i++);Rt.splice(i,0,e),0===i&&Bt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ut(t.pendingLanes);0!==i&&(yt(t,1|i),rc(t,Je()),0===(6&Ml)&&(Ul=Je()+500,Un()))}break;case 13:hc((function(){var t=za(e,1);if(null!==t){var i=ec();ic(t,e,1,i)}})),Hc(e,1)}},wt=function(e){if(13===e.tag){var t=za(e,134217728);if(null!==t)ic(t,e,134217728,ec());Hc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),i=za(e,t);if(null!==i)ic(i,e,t,ec());Hc(e,t)}},Et=function(){return xt},Tt=function(e,t){var i=xt;try{return xt=e,t()}finally{xt=i}},we=function(e,t,i){switch(t){case"input":if(Q(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=bn(r);if(!n)throw Error(a(90));W(r),Q(r,n)}}}break;case"textarea":ae(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Me=cc,Ae=hc;var eh={usingClientEntryPoint:!1,Events:[xn,vn,bn,Ce,ke,cc]},th={findFiberByHostInstance:yn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ih={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:th.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rh.isDisabled&&rh.supportsFiber)try{nt=rh.inject(ih),at=rh}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eh,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var i=!1,r="",n=Wc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(n=t.onRecoverableError)),t=Vc(e,1,!1,null,0,i,0,r,n),e[fn]=t.current,jr(8===e.nodeType?e.parentNode:e),new Zc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,i){if(!Jc(t))throw Error(a(200));return Kc(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Yc(e))throw Error(a(405));var r=null!=i&&i.hydratedSources||null,n=!1,o="",s=Wc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(o=i.identifierPrefix),void 0!==i.onRecoverableError&&(s=i.onRecoverableError)),t=Uc(t,null,e,1,null!=i?i:null,n,0,o,s),e[fn]=t.current,jr(e),r)for(e=0;e<r.length;e++)n=(n=(i=r[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new Xc(t)},t.render=function(e,t,i){if(!Jc(t))throw Error(a(200));return Kc(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(a(40));return!!e._reactRootContainer&&(hc((function(){Kc(null,null,e,!1,(function(){e._reactRootContainer=null,e[fn]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!Jc(i))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Kc(e,t,i,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},391:(e,t,i)=>{"use strict";var r=i(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(730)},507:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Notifications=void 0;const n=r(i(240));t.Notifications=n.default;const a=r(i(173)).default.addNotification;t.default=a},240:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(43)),a=r(i(173));i(659);const o=r(i(677));class s extends n.default.Component{constructor(){super(...arguments),this.state={value:[]}}componentDidMount(){a.default.addListener((e=>this.setState({value:e})))}render(){const{position:e}=this.props,t=`rpn-notification-holder ${e||"top-middle"} supertest`;return n.default.createElement("div",{className:t},this.state.value.map(((e,t)=>n.default.createElement(o.default,{key:t,closeNotification:a.default.popAndPush,onClick:e.onClick,id:e.id,theme:e.theme,title:e.title,subtitle:e.subtitle,closeButton:e.closeButton,message:e.message,styling:e.styling}))))}}t.default=s},677:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(43));t.default=e=>{const{title:t,subtitle:i,message:r,theme:a,id:o,closeNotification:s,styling:l,closeButton:c,onClick:h}=e;let u={},d={};return l&&(u.backgroundColor=l.backgroundTop,u.color=l.colorTop,d.backgroundColor=l.backgroundBottom,d.color=l.colorBottom),n.default.createElement("div",{className:`rpn-notification-card ${a}`,onClick:h},n.default.createElement("div",{className:`rpn-notification-card-top ${a}`,style:Object.keys(u).length?u:void 0},n.default.createElement("span",null,t),n.default.createElement("span",{className:`rpn-notification-card-close ${a}`,onClick:()=>s(o)},c||"close")),n.default.createElement("div",{className:`rpn-notification-card-bottom ${a}`,style:Object.keys(d).length?d:void 0},n.default.createElement("span",{className:"subtitle"},i),n.default.createElement("span",{className:"message"},r)))}},173:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=void 0;class r{constructor(e){this.title=e.title,this.subtitle=e.subtitle,this.message=e.message,this.theme=e.theme,this.id=Math.random(),this.styling=e.styling,this.closeButton=e.closeButton,this.onClick=e.onClick}}t.PushNotification=r;t.default=new class{constructor(){this.Storage=[],this.Listener=()=>this.Storage,this.popAndPush=e=>{let t=0;for(;t<this.Storage.length;)this.Storage[t].id===e?this.Storage.splice(t,1):++t;this.Listener(this.Storage)},this.setTimer=(e,t)=>{setTimeout((()=>this.popAndPush(e)),t)},this.addListener=e=>{this.Listener=e},this.addNativeNotification=e=>i(this,void 0,void 0,(function*(){const{title:t,subtitle:i,message:r,duration:n,icon:a,vibrate:o,silent:s,onClick:l}=e;if("default"!==Notification.permission&&"denied"!==Notification.permission||(yield Notification.requestPermission()),"granted"===Notification.permission){const e=new Notification(t,{body:r,data:i,icon:a,vibrate:o,silent:s});e.onclick=l||null,setTimeout(e.close.bind(e),n||3e3)}})),this.addWebNotification=e=>{const{title:t,subtitle:i,message:n,theme:a,duration:o,backgroundBottom:s,backgroundTop:l,colorBottom:c,colorTop:h,closeButton:u,onClick:d}=e,p=new r({title:t,subtitle:i,message:n,theme:a,styling:{backgroundTop:l,backgroundBottom:s,colorTop:h,colorBottom:c},closeButton:u,onClick:d});this.Storage.push(p),this.setTimer(p.id,o||3e3),this.Listener(this.Storage)},this.addNotification=e=>i(this,void 0,void 0,(function*(){const{native:t}=e;return t?this.addNativeNotification(e):this.addWebNotification(e)}))}}},153:(e,t,i)=>{"use strict";var r=i(43),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var r,a={},c=null,h=null;for(r in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:n,type:e,key:c,ref:h,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function x(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var v=x.prototype=new y;v.constructor=x,m(v,_.prototype),v.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var n,a={},o=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,n)&&!E.hasOwnProperty(n)&&(a[n]=t[n]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];a.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===a[n]&&(a[n]=l[n]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var k=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,n,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case r:l=!0}}if(l)return o=o(l=e),e=""===a?"."+M(l,0):a,b(o)?(n="",null!=e&&(n=e.replace(k,"$&/")+"/"),A(o,t,n,"",(function(e){return e}))):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",b(e))for(var c=0;c<e.length;c++){var h=a+M(s=e[c],c);l+=A(s,t,n,h,o)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(s=e.next()).done;)l+=A(s=s.value,t,n,h=a+M(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,i){if(null==e)return e;var r=[],n=0;return A(e,r,"","",(function(e){return t.call(i,e,n++)})),r}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},R={transition:null},z={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,i){P(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=n,t.Profiler=o,t.PureComponent=x,t.StrictMode=a,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!E.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=r;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];n.children=l}return{$$typeof:i,type:e.type,key:a,ref:o,props:n,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,i){return D.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,i){return D.current.useReducer(e,t,i)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return D.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},43:(e,t,i)=>{"use strict";e.exports=i(202)},579:(e,t,i)=>{"use strict";e.exports=i(153)},234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var r=i-1>>>1,n=e[r];if(!(0<a(n,t)))break e;e[r]=t,e[i]=n,i=r}}function r(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var r=0,n=e.length,o=n>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,h=e[c];if(0>a(l,i))c<n&&0>a(h,l)?(e[r]=h,e[c]=i,r=c):(e[r]=l,e[s]=i,r=s);else{if(!(c<n&&0>a(h,i)))break e;e[r]=h,e[c]=i,r=c}}}return t}function a(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],h=[],u=1,d=null,p=3,f=!1,m=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=r(h);null!==t;){if(null===t.callback)n(h);else{if(!(t.startTime<=e))break;n(h),t.sortIndex=t.expirationTime,i(c,t)}t=r(h)}}function b(e){if(g=!1,v(e),!m)if(null!==r(c))m=!0,R(w);else{var t=r(h);null!==t&&z(b,t.startTime-e)}}function w(e,i){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var a=p;try{for(v(i),d=r(c);null!==d&&(!(d.expirationTime>i)||e&&!A());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=i);i=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&n(c),v(i)}else n(c);d=r(c)}if(null!==d)var l=!0;else{var u=r(h);null!==u&&z(b,u.startTime-i),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,T=null,C=-1,k=5,M=-1;function A(){return!(t.unstable_now()-M<k)}function P(){if(null!==T){var e=t.unstable_now();M=e;var i=!0;try{i=T(!0,e)}finally{i?S():(E=!1,T=null)}}else E=!1}if("function"===typeof x)S=function(){x(P)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,D=I.port2;I.port1.onmessage=P,S=function(){D.postMessage(null)}}else S=function(){_(P,0)};function R(e){T=e,E||(E=!0,S())}function z(e,i){C=_((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,R(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,n,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:n,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,i(h,e),null===r(c)&&e===r(h)&&(g?(y(C),C=-1):g=!0,z(b,a-o))):(e.sortIndex=s,i(c,e),m||f||(m=!0,R(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},853:(e,t,i)=>{"use strict";e.exports=i(234)},659:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});const r={}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;__webpack_require__.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var n=Object.create(null);__webpack_require__.r(n);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&i;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,__webpack_require__.d(n,a),n}})(),__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>"static/js/"+e+".419a5d54.chunk.js",__webpack_require__.miniCssF=e=>{},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="client:";__webpack_require__.l=(i,r,n,a)=>{if(e[i])e[i].push(r);else{var o,s;if(void 0!==n)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var h=l[c];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+n){o=h;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack",t+n),o.src=i),e[i]=[r];var u=(t,r)=>{o.onerror=o.onload=null,clearTimeout(d);var n=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(r))),t)return t(r)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),s&&document.head.appendChild(o)}}})(),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/",(()=>{var e={792:0};__webpack_require__.f.j=(t,i)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var n=new Promise(((i,n)=>r=e[t]=[i,n]));i.push(r[2]=n);var a=__webpack_require__.p+__webpack_require__.u(t),o=new Error;__webpack_require__.l(a,(i=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",o.name="ChunkLoadError",o.type=n,o.request=a,r[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,n,a=i[0],o=i[1],s=i[2],l=0;if(a.some((t=>0!==e[t]))){for(r in o)__webpack_require__.o(o,r)&&(__webpack_require__.m[r]=o[r]);if(s)s(__webpack_require__)}for(t&&t(i);l<a.length;l++)n=a[l],__webpack_require__.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.webpackChunkclient=self.webpackChunkclient||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__={};(()=>{"use strict";var e=__webpack_require__(43),t=__webpack_require__.t(e,2),i=__webpack_require__(391);__webpack_require__.p;var r,n=__webpack_require__(950),a=__webpack_require__.t(n,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(r||(r={}));const s="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(i){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,i,r){return void 0===i&&(i=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:i,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&"?"!==i&&(t+="?"===i.charAt(0)?i:"?"+i),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function p(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function f(e,t,i,n){void 0===n&&(n={});let{window:a=document.defaultView,v5Compat:c=!1}=n,p=a.history,f=r.Pop,m=null,g=_();function _(){return(p.state||{idx:null}).idx}function y(){f=r.Pop;let e=_(),t=null==e?null:e-g;g=e,m&&m({action:f,location:v.location,delta:t})}function x(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,i="string"===typeof e?e:d(e);return i=i.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,t)}null==g&&(g=0,p.replaceState(o({},p.state,{idx:g}),""));let v={get action(){return f},get location(){return e(a,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(s,y),m=e,()=>{a.removeEventListener(s,y),m=null}},createHref:e=>t(a,e),createURL:x,encodeLocation(e){let t=x(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){f=r.Push;let n=u(v.location,e,t);i&&i(n,e),g=_()+1;let o=h(n,g),s=v.createHref(n);try{p.pushState(o,"",s)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;a.location.assign(s)}c&&m&&m({action:f,location:v.location,delta:1})},replace:function(e,t){f=r.Replace;let n=u(v.location,e,t);i&&i(n,e),g=_();let a=h(n,g),o=v.createHref(n);p.replaceState(a,"",o),c&&m&&m({action:f,location:v.location,delta:0})},go:e=>p.go(e)};return v}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function g(e,t,i){return void 0===i&&(i="/"),_(e,t,i,!1)}function _(e,t,i,r){let n=I(("string"===typeof t?p(t):t).pathname||"/",i);if(null==n)return null;let a=y(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let i=e.length===t.length&&e.slice(0,-1).every(((e,i)=>e===t[i]));return i?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let e=P(n);o=M(a[s],e,r)}return o}function y(e,t,i,r){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r="");let n=(e,n,a)=>{let o={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};o.relativePath.startsWith("/")&&(l(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=F([r,o.relativePath]),c=i.concat(o);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),y(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:k(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var i;if(""!==e.path&&null!=(i=e.path)&&i.includes("?"))for(let r of x(e.path))n(e,t,r);else n(e,t)})),t}function x(e){let t=e.split("/");if(0===t.length)return[];let[i,...r]=t,n=i.endsWith("?"),a=i.replace(/\?$/,"");if(0===r.length)return n?[a,""]:[a];let o=x(r.join("/")),s=[];return s.push(...o.map((e=>""===e?a:[a,e].join("/")))),n&&s.push(...o),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const v=/^:[\w-]+$/,b=3,w=2,S=1,E=10,T=-2,C=e=>"*"===e;function k(e,t){let i=e.split("/"),r=i.length;return i.some(C)&&(r+=T),t&&(r+=w),i.filter((e=>!C(e))).reduce(((e,t)=>e+(v.test(t)?b:""===t?S:E)),r)}function M(e,t,i){void 0===i&&(i=!1);let{routesMeta:r}=e,n={},a="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],l=s===r.length-1,c="/"===a?t:t.slice(a.length)||"/",h=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!h&&l&&i&&!r[r.length-1].route.index&&(h=A({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!h)return null;Object.assign(n,h.params),o.push({params:n,pathname:F([a,h.pathname]),pathnameBase:B(F([a,h.pathnameBase])),route:u}),"/"!==h.pathnameBase&&(a=F([a,h.pathnameBase]))}return o}function A(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,i)=>(r.push({paramName:t,isOptional:null!=i}),i?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))");let a=new RegExp(n,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let a=n[0],o=a.replace(/(.)\/+$/,"$1"),s=n.slice(1);return{params:r.reduce(((e,t,i)=>{let{paramName:r,isOptional:n}=t;if("*"===r){let e=s[i]||"";o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[i];return e[r]=n&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:a,pathnameBase:o,pattern:e}}function P(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function I(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&"/"!==r?null:e.slice(i)||"/"}function D(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function R(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function z(e,t){let i=R(e);return t?i.map(((e,t)=>t===i.length-1?e.pathname:e.pathnameBase)):i.map((e=>e.pathnameBase))}function L(e,t,i,r){let n;void 0===r&&(r=!1),"string"===typeof e?n=p(e):(n=o({},e),l(!n.pathname||!n.pathname.includes("?"),D("?","pathname","search",n)),l(!n.pathname||!n.pathname.includes("#"),D("#","pathname","hash",n)),l(!n.search||!n.search.includes("#"),D("#","search","hash",n)));let a,s=""===e||""===n.pathname,c=s?"/":n.pathname;if(null==c)a=i;else{let e=t.length-1;if(!r&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}a=e>=0?t[e]:"/"}let h=function(e,t){void 0===t&&(t="/");let{pathname:i,search:r="",hash:n=""}="string"===typeof e?p(e):e,a=i?i.startsWith("/")?i:function(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?i.length>1&&i.pop():"."!==e&&i.push(e)})),i.length>1?i.join("/"):"/"}(i,t):t;return{pathname:a,search:O(r),hash:N(n)}}(n,a),u=c&&"/"!==c&&c.endsWith("/"),d=(s||"."===c)&&i.endsWith("/");return h.pathname.endsWith("/")||!u&&!d||(h.pathname+="/"),h}const F=e=>e.join("/").replace(/\/\/+/g,"/"),B=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),O=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",N=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function V(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const j=["post","put","patch","delete"],U=(new Set(j),["get",...j]);new Set(U),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},G.apply(this,arguments)}const $=e.createContext(null);const q=e.createContext(null);const H=e.createContext(null);const W=e.createContext(null);const Z=e.createContext({outlet:null,matches:[],isDataRoute:!1});const X=e.createContext(null);function Y(){return null!=e.useContext(W)}function J(){return Y()||l(!1),e.useContext(W).location}function Q(t){e.useContext(H).static||e.useLayoutEffect(t)}function K(){let{isDataRoute:t}=e.useContext(Z);return t?function(){let{router:t}=le(oe.UseNavigateStable),i=he(se.UseNavigateStable),r=e.useRef(!1);return Q((()=>{r.current=!0})),e.useCallback((function(e,n){void 0===n&&(n={}),r.current&&("number"===typeof e?t.navigate(e):t.navigate(e,G({fromRouteId:i},n)))}),[t,i])}():function(){Y()||l(!1);let t=e.useContext($),{basename:i,future:r,navigator:n}=e.useContext(H),{matches:a}=e.useContext(Z),{pathname:o}=J(),s=JSON.stringify(z(a,r.v7_relativeSplatPath)),c=e.useRef(!1);return Q((()=>{c.current=!0})),e.useCallback((function(e,r){if(void 0===r&&(r={}),!c.current)return;if("number"===typeof e)return void n.go(e);let a=L(e,JSON.parse(s),o,"path"===r.relative);null==t&&"/"!==i&&(a.pathname="/"===a.pathname?i:F([i,a.pathname])),(r.replace?n.replace:n.push)(a,r.state,r)}),[i,n,s,o,t])}()}function ee(t,i,n,a){Y()||l(!1);let{navigator:o}=e.useContext(H),{matches:s}=e.useContext(Z),c=s[s.length-1],h=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let d,f=J();if(i){var m;let e="string"===typeof i?p(i):i;"/"===u||(null==(m=e.pathname)?void 0:m.startsWith(u))||l(!1),d=e}else d=f;let _=d.pathname||"/",y=_;if("/"!==u){let e=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=g(t,{pathname:y});let v=ae(x&&x.map((e=>Object.assign({},e,{params:Object.assign({},h,e.params),pathname:F([u,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:F([u,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,n,a);return i&&v?e.createElement(W.Provider,{value:{location:G({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:r.Pop}},v):v}function te(){let t=function(){var t;let i=e.useContext(X),r=ce(se.UseRouteError),n=he(se.UseRouteError);if(void 0!==i)return i;return null==(t=r.errors)?void 0:t[n]}(),i=V(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},i),r?e.createElement("pre",{style:a},r):null,null)}const ie=e.createElement(te,null);class re extends e.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?e.createElement(Z.Provider,{value:this.props.routeContext},e.createElement(X.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(t){let{routeContext:i,match:r,children:n}=t,a=e.useContext($);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),e.createElement(Z.Provider,{value:i},n)}function ae(t,i,r,n){var a;if(void 0===i&&(i=[]),void 0===r&&(r=null),void 0===n&&(n=null),null==t){var o;if(!r)return null;if(r.errors)t=r.matches;else{if(!(null!=(o=n)&&o.v7_partialHydration&&0===i.length&&!r.initialized&&r.matches.length>0))return null;t=r.matches}}let s=t,c=null==(a=r)?void 0:a.errors;if(null!=c){let e=s.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||l(!1),s=s.slice(0,Math.min(s.length,e+1))}let h=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let e=0;e<s.length;e++){let t=s[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(u=e),t.route.id){let{loaderData:e,errors:i}=r,n=t.route.loader&&void 0===e[t.route.id]&&(!i||void 0===i[t.route.id]);if(t.route.lazy||n){h=!0,s=u>=0?s.slice(0,u+1):[s[0]];break}}}return s.reduceRight(((t,n,a)=>{let o,l=!1,d=null,p=null;var f;r&&(o=c&&n.route.id?c[n.route.id]:void 0,d=n.route.errorElement||ie,h&&(u<0&&0===a?(f="route-fallback",!1||ue[f]||(ue[f]=!0),l=!0,p=null):u===a&&(l=!0,p=n.route.hydrateFallbackElement||null)));let m=i.concat(s.slice(0,a+1)),g=()=>{let i;return i=o?d:l?p:n.route.Component?e.createElement(n.route.Component,null):n.route.element?n.route.element:t,e.createElement(ne,{match:n,routeContext:{outlet:t,matches:m,isDataRoute:null!=r},children:i})};return r&&(n.route.ErrorBoundary||n.route.errorElement||0===a)?e.createElement(re,{location:r.location,revalidation:r.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var oe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(oe||{}),se=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(se||{});function le(t){let i=e.useContext($);return i||l(!1),i}function ce(t){let i=e.useContext(q);return i||l(!1),i}function he(t){let i=function(){let t=e.useContext(Z);return t||l(!1),t}(),r=i.matches[i.matches.length-1];return r.route.id||l(!1),r.route.id}const ue={};t.startTransition;function de(e){l(!1)}function pe(t){let{basename:i="/",children:n=null,location:a,navigationType:o=r.Pop,navigator:s,static:c=!1,future:h}=t;Y()&&l(!1);let u=i.replace(/^\/*/,"/"),d=e.useMemo((()=>({basename:u,navigator:s,static:c,future:G({v7_relativeSplatPath:!1},h)})),[u,h,s,c]);"string"===typeof a&&(a=p(a));let{pathname:f="/",search:m="",hash:g="",state:_=null,key:y="default"}=a,x=e.useMemo((()=>{let e=I(f,u);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:y},navigationType:o}}),[u,f,m,g,_,y,o]);return null==x?null:e.createElement(H.Provider,{value:d},e.createElement(W.Provider,{children:n,value:x}))}function fe(e){let{children:t,location:i}=e;return ee(me(t),i)}new Promise((()=>{}));e.Component;function me(t,i){void 0===i&&(i=[]);let r=[];return e.Children.forEach(t,((t,n)=>{if(!e.isValidElement(t))return;let a=[...i,n];if(t.type===e.Fragment)return void r.push.apply(r,me(t.props.children,a));t.type!==de&&l(!1),t.props.index&&t.props.children&&l(!1);let o={id:t.props.id||a.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(o.children=me(t.props.children,a)),r.push(o)})),r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(Ci){}new Map;const ge=t.startTransition;a.flushSync,t.useId;function _e(t){let{basename:i,children:r,future:n,window:a}=t,o=e.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),f((function(e,t){let{pathname:i,search:r,hash:n}=e.location;return u("",{pathname:i,search:r,hash:n},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:d(t)}),null,s)));let l=o.current,[c,h]=e.useState({action:l.action,location:l.location}),{v7_startTransition:p}=n||{},m=e.useCallback((e=>{p&&ge?ge((()=>h(e))):h(e)}),[h,p]);return e.useLayoutEffect((()=>l.listen(m)),[l,m]),e.createElement(pe,{basename:i,children:r,location:c.location,navigationType:c.action,navigator:l,future:n})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var ye,xe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ye||(ye={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(xe||(xe={}));const ve={medical_blue:"#4E95B5",fire_red:"#E86477",weather_gray:"#4A4A4A",natural_green:"#688268",safety_orange:"#CA8955"};const be=__webpack_require__.p+"static/media/medical.57fa76d3602df619557ef76bee78fbb6.svg";const we=__webpack_require__.p+"static/media/fire.bf6ba90b9b528363cd417593763ae0a4.svg";const Se=__webpack_require__.p+"static/media/weather.2782cdaff7a7aac05161e975bad0c24d.svg";const Ee=__webpack_require__.p+"static/media/natural.e002889385235ebc8fefd0779dd02abe.svg";const Te=__webpack_require__.p+"static/media/security.110ff404b00c550f3b818c835f8c0e3b.svg";const Ce=__webpack_require__.p+"static/media/medical_marker.9caaacc1e17d2a18ddda3c374935514c.svg";const ke=__webpack_require__.p+"static/media/fire_marker.e8088aa13f7b9d3c5bfdf2a6ef083e99.svg";const Me=__webpack_require__.p+"static/media/weather_marker.384efc223798b8dddb052f70a57b0326.svg";const Ae=__webpack_require__.p+"static/media/natural_marker.c1d496ed1dc0aacc80ca57a04bcbf97e.svg";const Pe=__webpack_require__.p+"static/media/security_marker.da4f03bfae421e5e948e8cfa2841bd53.svg",Ie=JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":60,"w":144,"h":144,"nm":"system-regular-719-spinner-circle","ddd":0,"assets":[{"id":"comp_11","nm":"loop-scale-dynamic","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":0.66},"o":{"x":0.124,"y":0.088},"t":20,"s":[{"i":[[-0.276,0],[0,-0.276],[0.276,0],[0,0.276]],"o":[[0.276,0],[0,0.276],[-0.276,0],[0,-0.276]],"v":[[0,-0.5],[0.5,0],[0,0.5],[-0.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-30.154,0],[0,-30.154],[30.154,0],[0,30.154]],"o":[[30.154,0],[0,30.154],[-30.154,0],[0,-30.154]],"v":[[0,-54.598],[54.598,0],[0,54.598],[-54.598,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,0.329,0.329,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":20,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 6","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":0,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.507,"y":1},"o":{"x":0.095,"y":0.321},"t":0,"s":[{"i":[[-30.652,0],[0,-30.652],[30.652,0],[0,30.652]],"o":[[30.652,0],[0,30.652],[-30.652,0],[0,-30.652]],"v":[[0,-55.5],[55.5,0],[0,55.5],[-55.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-37.003,0],[0,-37.003],[37.003,0],[0,37.003]],"o":[[37.003,0],[0,37.003],[-37.003,0],[0,-37.003]],"v":[[0,-67],[67,0],[0,67],[-67,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,0.329,0.329,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[1,0.329,0.329],"ix":1}}]}],"ip":0,"op":1751,"st":0,"bm":0},{"ddd":0,"ind":13,"ty":0,"nm":"loop-scale-dynamic","refId":"comp_11","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":70,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:loop-scale-dynamic","dr":60}],"props":{}}'),De={medical:{type:"medical",header:"Health Emergency",colour:ve.medical_blue,icon:be,icon_size:45,marker:Ce,report_causes:["Emergency services to be notified","People in the area to be notified"],radius:.01,spinner:JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":60,"w":144,"h":144,"nm":"system-regular-719-spinner-circle","ddd":0,"assets":[{"id":"comp_11","nm":"loop-scale-dynamic","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":0.66},"o":{"x":0.124,"y":0.088},"t":20,"s":[{"i":[[-0.276,0],[0,-0.276],[0.276,0],[0,0.276]],"o":[[0.276,0],[0,0.276],[-0.276,0],[0,-0.276]],"v":[[0,-0.5],[0.5,0],[0,0.5],[-0.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-30.154,0],[0,-30.154],[30.154,0],[0,30.154]],"o":[[30.154,0],[0,30.154],[-30.154,0],[0,-30.154]],"v":[[0,-54.598],[54.598,0],[0,54.598],[-54.598,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.306,0.584,0.71,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":20,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 6","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":0,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.507,"y":1},"o":{"x":0.095,"y":0.321},"t":0,"s":[{"i":[[-30.652,0],[0,-30.652],[30.652,0],[0,30.652]],"o":[[30.652,0],[0,30.652],[-30.652,0],[0,-30.652]],"v":[[0,-55.5],[55.5,0],[0,55.5],[-55.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-37.003,0],[0,-37.003],[37.003,0],[0,37.003]],"o":[[37.003,0],[0,37.003],[-37.003,0],[0,-37.003]],"v":[[0,-67],[67,0],[0,67],[-67,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.306,0.584,0.71,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[0.306,0.584,0.71],"ix":1}}]}],"ip":0,"op":1751,"st":0,"bm":0},{"ddd":0,"ind":13,"ty":0,"nm":"loop-scale-dynamic","refId":"comp_11","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":70,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:loop-scale-dynamic","dr":60}],"props":{}}')},fire:{type:"fire",header:"Fire Emergency",colour:ve.fire_red,icon:we,icon_size:70,marker:ke,report_causes:["Fire services to be notified","People in the area to be notified","A wide scale evacuation alert"],radius:.05,spinner:Ie},weather:{type:"weather",header:"Weather Emergency",colour:ve.weather_gray,icon:Se,icon_size:60,marker:Me,report_causes:["People in the area to be notified","A wide scale emergency alert"],radius:.02,spinner:JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":60,"w":144,"h":144,"nm":"system-regular-719-spinner-circle","ddd":0,"assets":[{"id":"comp_11","nm":"loop-scale-dynamic","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":0.66},"o":{"x":0.124,"y":0.088},"t":20,"s":[{"i":[[-0.276,0],[0,-0.276],[0.276,0],[0,0.276]],"o":[[0.276,0],[0,0.276],[-0.276,0],[0,-0.276]],"v":[[0,-0.5],[0.5,0],[0,0.5],[-0.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-30.154,0],[0,-30.154],[30.154,0],[0,30.154]],"o":[[30.154,0],[0,30.154],[-30.154,0],[0,-30.154]],"v":[[0,-54.598],[54.598,0],[0,54.598],[-54.598,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.29,0.29,0.29,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":20,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 6","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":0,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.507,"y":1},"o":{"x":0.095,"y":0.321},"t":0,"s":[{"i":[[-30.652,0],[0,-30.652],[30.652,0],[0,30.652]],"o":[[30.652,0],[0,30.652],[-30.652,0],[0,-30.652]],"v":[[0,-55.5],[55.5,0],[0,55.5],[-55.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-37.003,0],[0,-37.003],[37.003,0],[0,37.003]],"o":[[37.003,0],[0,37.003],[-37.003,0],[0,-37.003]],"v":[[0,-67],[67,0],[0,67],[-67,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.29,0.29,0.29,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[0.29,0.29,0.29],"ix":1}}]}],"ip":0,"op":1751,"st":0,"bm":0},{"ddd":0,"ind":13,"ty":0,"nm":"loop-scale-dynamic","refId":"comp_11","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":70,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:loop-scale-dynamic","dr":60}],"props":{}}')},natural:{type:"natural",header:"Natural Disaster Emergency",colour:ve.natural_green,icon:Ee,icon_size:70,marker:Ae,report_causes:["Emergency services to be notified","People in the area to be notified","A wide scale evacuation alert"],radius:.1,spinner:JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":60,"w":144,"h":144,"nm":"system-regular-719-spinner-circle","ddd":0,"assets":[{"id":"comp_11","nm":"loop-scale-dynamic","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":0.66},"o":{"x":0.124,"y":0.088},"t":20,"s":[{"i":[[-0.276,0],[0,-0.276],[0.276,0],[0,0.276]],"o":[[0.276,0],[0,0.276],[-0.276,0],[0,-0.276]],"v":[[0,-0.5],[0.5,0],[0,0.5],[-0.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-30.154,0],[0,-30.154],[30.154,0],[0,30.154]],"o":[[30.154,0],[0,30.154],[-30.154,0],[0,-30.154]],"v":[[0,-54.598],[54.598,0],[0,54.598],[-54.598,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.408,0.51,0.408,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":20,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 6","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":0,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.507,"y":1},"o":{"x":0.095,"y":0.321},"t":0,"s":[{"i":[[-30.652,0],[0,-30.652],[30.652,0],[0,30.652]],"o":[[30.652,0],[0,30.652],[-30.652,0],[0,-30.652]],"v":[[0,-55.5],[55.5,0],[0,55.5],[-55.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-37.003,0],[0,-37.003],[37.003,0],[0,37.003]],"o":[[37.003,0],[0,37.003],[-37.003,0],[0,-37.003]],"v":[[0,-67],[67,0],[0,67],[-67,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.408,0.51,0.408,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[0.408,0.51,0.408],"ix":1}}]}],"ip":0,"op":1751,"st":0,"bm":0},{"ddd":0,"ind":13,"ty":0,"nm":"loop-scale-dynamic","refId":"comp_11","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":70,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:loop-scale-dynamic","dr":60}],"props":{}}')},security:{type:"security",header:"Security Emergency",colour:ve.safety_orange,icon:Te,icon_size:60,marker:Pe,report_causes:["Campus Safety services to be notified","People in the area to be notified","A wide scale safety alert"],radius:.02,spinner:JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":60,"w":144,"h":144,"nm":"system-regular-719-spinner-circle","ddd":0,"assets":[{"id":"comp_11","nm":"loop-scale-dynamic","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":0.66},"o":{"x":0.124,"y":0.088},"t":20,"s":[{"i":[[-0.276,0],[0,-0.276],[0.276,0],[0,0.276]],"o":[[0.276,0],[0,0.276],[-0.276,0],[0,-0.276]],"v":[[0,-0.5],[0.5,0],[0,0.5],[-0.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-30.154,0],[0,-30.154],[30.154,0],[0,30.154]],"o":[[30.154,0],[0,30.154],[-30.154,0],[0,-30.154]],"v":[[0,-54.598],[54.598,0],[0,54.598],[-54.598,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.792,0.537,0.333,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":20,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 6","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":0,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.507,"y":1},"o":{"x":0.095,"y":0.321},"t":0,"s":[{"i":[[-30.652,0],[0,-30.652],[30.652,0],[0,30.652]],"o":[[30.652,0],[0,30.652],[-30.652,0],[0,-30.652]],"v":[[0,-55.5],[55.5,0],[0,55.5],[-55.5,0]],"c":true}]},{"t":60,"s":[{"i":[[-37.003,0],[0,-37.003],[37.003,0],[0,37.003]],"o":[[37.003,0],[0,37.003],[-37.003,0],[0,-37.003]],"v":[[0,-67],[67,0],[0,67],[-67,0]],"c":true}]}],"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[0.792,0.537,0.333,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-719-spinner-circle\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[0.792,0.537,0.333],"ix":1}}]}],"ip":0,"op":1751,"st":0,"bm":0},{"ddd":0,"ind":13,"ty":0,"nm":"loop-scale-dynamic","refId":"comp_11","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":70,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:loop-scale-dynamic","dr":60}],"props":{}}')}};async function Re(){try{const e=[];await fetch("/incidents/all-incidents",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{t.forEach((t=>{["medical","fire","natural","security","weather"].includes(t.type)&&e.push({of_type:"incident",id:t.id,type:t.type,description:t.description,active:1===t.active,date:new Date(t.date.year,t.date.month+1,t.date.day,t.date.time.hour,t.date.time.minute,0,0),location:{lng:parseFloat(t.longitude),lat:parseFloat(t.latitude)},photo:t.photo})}))})),await fetch("/alerts/alerts",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((t=>{t.forEach((t=>{["medical","fire","natural","security","weather"].includes(t.type)&&e.push({of_type:"alert",id:t.id,type:t.type,description:De[t.type].header+" Alert",active:1===t.active,date:new Date(t.date.year,t.date.month+1,t.date.day,t.date.time.hour,t.date.time.minute,0,0),location:{lng:parseFloat(t.longitude),lat:parseFloat(t.latitude)},photo:null})}))}));return e}catch(e){return{error:"Error fetching reports"}}}var ze=__webpack_require__(879),Le=__webpack_require__.n(ze);const Fe="pk.eyJ1IjoibWl0Y2hlbGxuZWlsc29ud2l0cyIsImEiOiJjbHp1d3o3bTEwMWU2MmtyN3RrZ25lbTVsIn0.xUZLlKrDPcGRM_NUv3nfog";var Be,Oe;function Ne(e,t,i,r,n){try{Be=e,Oe=t,Le().accessToken=Fe;const a=new(Le().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1});a.on("geolocate",(()=>{}));let o;return Be.current=new(Le().Map)({container:Oe.current,style:"mapbox://styles/mitchellneilsonwits/cm12lbun601g101pj7kh63w7f"}),Be.current.addControl(a),Be.current.on("load",(()=>{a.trigger(),o=function(e,t){try{return t.forEach(((t,i)=>{t.active&&Ue(e,t)})),{success:"success"}}catch(i){return{error:i}}}(r,n),Be.current.addSource("maine",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.020683,-26.183784],[28.020316,-26.184757],[28.020702,-26.187091],[28.021799,-26.186954],[28.022123,-26.190367],[28.020041,-26.191086],[28.020394,-26.191877],[28.020505,-26.193196],[28.02061,-26.193879],[28.020776,-26.193945],[28.022105,-26.193732],[28.023721,-26.193324],[28.027553,-26.192926],[28.028464,-26.193272],[28.02915,-26.193453],[28.033255,-26.192972],[28.033157,-26.192237],[28.032318,-26.191001],[28.032118,-26.190624],[28.032092,-26.190291],[28.032117,-26.190081],[28.033025,-26.18805],[28.032994,-26.187884],[28.03273,-26.187359],[28.032438,-26.18696],[28.032082,-26.186626],[28.031498,-26.186319],[28.030526,-26.186023],[28.0301,-26.185882],[28.029229,-26.185684],[28.027188,-26.185186],[28.023798,-26.184265],[28.022383,-26.184042],[28.021012,-26.183894]]]}}}),Be.current.addLayer({id:"maine",type:"fill",source:"maine",layout:{},paint:{"fill-color":"#ffffff","fill-opacity":.1}}),Be.current.addLayer({id:"outline",type:"line",source:"maine",layout:{},paint:{"line-color":"#000","line-width":3}}),Be.current.flyTo({center:[28.030228,-26.190955],zoom:18.38,pitch:60,bearing:173.6}),Be.current.on("move",i)})),{success:"success"}}catch(a){return{error:"Could not load map correctly"}}}function Ve(e,t){const i=e.location;Be.current.flyTo({center:[i.lng,i.lat],zoom:18.8}),t(e)}let je=0;function Ue(e,t){Be.current.addSource("polygon"+String(je),function(e,t,i){i||(i=64);for(var r,n,a,o=e[1],s=e[0],l=t,c=[],h=l/(111.32*Math.cos(o*Math.PI/180)),u=l/110.574,d=0;d<i;d++)r=d/i*(2*Math.PI),n=h*Math.cos(r),a=u*Math.sin(r),c.push([s+n,o+a]);return c.push(c[0]),{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[c]}}]}}}([t.location.lng,t.location.lat],De[t.type].radius)),Be.current.addLayer({id:"polygon"+String(je),type:"fill",source:"polygon"+String(je),layout:{},paint:{"fill-color":De[t.type].colour,"fill-opacity":.5}});const i=document.createElement("div");i.className="marker",i.style.backgroundImage=`url(${De[t.type].marker})`,i.style.paddingBottom="45px",i.style.backgroundRepeat="no-repeat",i.style.width=`${De[t.type].icon_size}px`,i.style.height=`${De[t.type].icon_size+45}px`,i.style.backgroundSize="100%",i.style.display="block",i.style.border="none",i.style.cursor="pointer",i.addEventListener("click",(()=>{Ve(t,e)})),new(Le().Marker)(i).setLngLat([t.location.lng,t.location.lat]).addTo(Be.current),je+=1}function Ge(){return $e}const $e={lng:0,lat:0};const qe=__webpack_require__.p+"static/media/camera.8741727dde7226e61f85a228dbc2b5a3.svg";var He=__webpack_require__(750),We=__webpack_require__.n(He),Ze=__webpack_require__(579);function Xe(e){let{size:t,report_type:i}=e;return(0,Ze.jsx)("div",{className:"spinner-root",style:{width:`${t}px`,height:`${t}px`},children:(0,Ze.jsx)(We(),{animationData:De[i].spinner,autoPlay:!0})})}const Ye=__webpack_require__.p+"static/media/tilted_bell.7292fa8f28682db95d32c96cce5dfe1f.svg";const Je=JSON.parse('{"v":"5.12.1","fr":60,"ip":0,"op":90,"w":144,"h":144,"nm":"system-regular-720-spinner-half-circles","ddd":0,"assets":[{"id":"comp_1","nm":"hover-pinch","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 2","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":1,"k":[{"i":{"x":[0.236],"y":[1]},"o":{"x":[0.29],"y":[0]},"t":0,"s":[-228]},{"t":90,"s":[132]}],"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":0,"k":38.2,"ix":1},"e":{"a":0,"k":62,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle","parent":1,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":-175,"ix":10},"p":{"a":0,"k":[0,0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":0,"k":38.2,"ix":1},"e":{"a":0,"k":62,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":1800,"st":0,"ct":1,"bm":0}]},{"id":"comp_5","nm":"element","fr":60,"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"circle 6","parent":3,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":-360,"ix":10},"p":{"a":0,"k":[0,0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[38.2]},{"t":31,"s":[25]}],"ix":1},"e":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[62]},{"t":31,"s":[75]}],"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":31,"st":-29,"ct":1,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"circle 5","parent":3,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":-175,"ix":10},"p":{"a":0,"k":[0,0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[38.2]},{"t":31,"s":[24]}],"ix":1},"e":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[62]},{"t":31,"s":[73]}],"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":31,"st":-29,"ct":1,"bm":0},{"ddd":0,"ind":3,"ty":4,"nm":"circle 7","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"t":31,"s":[100]},{"t":60,"s":[0]}],"ix":11},"r":{"a":0,"k":-228,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":9,"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":31,"op":440,"st":-29,"ct":1,"bm":0},{"ddd":0,"ind":4,"ty":4,"nm":"circle 4","parent":3,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":-360,"ix":10},"p":{"a":0,"k":[0,0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":50,"s":[50]},{"t":90,"s":[38.2]}],"ix":1},"e":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":50,"s":[50]},{"t":90,"s":[62]}],"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":50,"s":[0]},{"t":55,"s":[9]}],"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":50,"op":440,"st":61,"ct":1,"bm":0},{"ddd":0,"ind":5,"ty":4,"nm":"circle 3","parent":3,"sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":-175,"ix":10},"p":{"a":0,"k":[0,0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[111,111],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":50,"s":[50]},{"t":90,"s":[38.2]}],"ix":1},"e":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.333],"y":[0]},"t":50,"s":[50]},{"t":90,"s":[62]}],"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false},{"ty":"st","c":{"a":0,"k":[1,1,1,1],"ix":3,"x":"var $bm_rt;\\n$bm_rt = comp(\'system-regular-720-spinner-half-circles\').layer(\'control\').effect(\'primary\')(\'Color\');"},"o":{"a":0,"k":100,"ix":4},"w":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":50,"s":[0]},{"t":55,"s":[9]}],"ix":5},"lc":2,"lj":2,"bm":0,"nm":".primary","mn":"ADBE Vector Graphic - Stroke","hd":false,"cl":"primary"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":50,"op":440,"st":61,"ct":1,"bm":0}]}],"layers":[{"ddd":0,"ind":1,"ty":3,"nm":"control","sr":1,"ks":{"o":{"a":0,"k":0,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[0,0],"ix":2,"l":2},"a":{"a":0,"k":[0,0,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"ef":[{"ty":5,"nm":"primary","np":3,"mn":"ADBE Color Control","ix":1,"en":1,"ef":[{"ty":2,"nm":"Color","mn":"ADBE Color Control-0001","ix":1,"v":{"a":0,"k":[1,1,1],"ix":1}}]}],"ip":0,"op":611,"st":0,"bm":0},{"ddd":0,"ind":3,"ty":0,"nm":"hover-pinch","refId":"comp_1","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[72,72,0],"ix":2,"l":2},"a":{"a":0,"k":[72,72,0],"ix":1,"l":2},"s":{"a":0,"k":[100,100,100],"ix":6,"l":2}},"ao":0,"w":144,"h":144,"ip":0,"op":100,"st":0,"bm":0}],"markers":[{"tm":0,"cm":"default:hover-pinch","dr":90}],"props":{}}');function Qe(e){let{size:t}=e;return(0,Ze.jsx)("div",{className:"loader-root",style:{width:`${t}px`,height:`${t}px`},children:(0,Ze.jsx)(We(),{animationData:Je,autoPlay:!0})})}function Ke(e){const t=e.split("-");return t[0]+"-"+t[1]+"-"+(parseInt(t[2])+1)}function et(e){const t=e.split("-"),i=t[0],r=t[1],n=t[2];return new Date(i,r,n)}function tt(e){return{year:e.getFullYear(),month:e.getMonth(),day:e.getDate()}}function it(e){const t=String(e.year),i=["January","February","March","April","May","June","July","August","September","October","November","December"][e.month-1];return String(e.day).padStart(2,"0")+" "+i+" "+t}function rt(e){const t=tt(e);return function(e){const t=it(e),i=new Date;return t===it(tt(new Date(i.getFullYear(),i.getMonth()+1,i.getDate())))}(t)?"Today":function(e){const t=new Date,i=tt(new Date(t.getFullYear(),t.getMonth()+1,t.getDate()));return e.year===i.year&&e.month===i.month&&e.day===i.day-1}(t)?"Yesterday":it(t)}function nt(e){return String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0")}function at(e){const t=Date.now()-e,i=new Date(t);return Math.abs(i.getUTCFullYear()-1970)}function ot(e){let{type:t,description:i,time:r,show_time:n,active:a,close_all_menus_handler:o,location:s}=e;return(0,Ze.jsx)("article",{className:"report-item-root",onClick:a?()=>{var e;e=[s.lng,s.lat],Be.current.flyTo({center:e,zoom:18.8}),o()}:()=>{},children:(0,Ze.jsxs)("section",{className:"report-item-contents",children:[(0,Ze.jsx)("div",{className:"report-item-icon-container",style:{background:`${De[t].colour}`},children:(0,Ze.jsx)("img",{className:"report-item-icon",alt:"report icon",src:De[t].icon})}),(0,Ze.jsxs)("section",{className:"report-item-info",children:[(0,Ze.jsxs)("article",{className:"report-item-header",children:[(0,Ze.jsxs)("h2",{className:"report-item-heading",children:[De[t].header," Alert"]}),n?(0,Ze.jsx)("h4",{className:"report-item-time",children:r}):(0,Ze.jsx)(Ze.Fragment,{})]}),(0,Ze.jsx)("h3",{className:"report-item-description",children:i}),(0,Ze.jsx)("p",{className:"report-item-view-on-map",children:a?"Click to view on map":"Emergency cleared! No longer a concern"})]})]})})}function st(t){let{set_error:i,report:r,close:n}=t;const[a,o]=(0,e.useState)(!1),[s,l]=(0,e.useState)(!0),[c,h]=(0,e.useState)(!0===r.active?"Active":"Inactive");return(0,e.useEffect)((()=>{if(r.photo){const e=new Image;e.src=r.photo,e.onload=()=>{l(!1)}}}),[r.photo]),(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("div",{className:"marker-popup-back",onClick:n}),(0,Ze.jsx)("section",{className:"marker-popup-root",onClick:n,children:(0,Ze.jsxs)("article",{className:"marker-popup-content",onClick:e=>e.stopPropagation(),children:[(0,Ze.jsxs)("section",{className:"marker-popup-header",style:{background:`${De[r.type].colour}`},children:[(0,Ze.jsx)("img",{className:"marker-popup-icon",src:De[r.type].icon}),(0,Ze.jsx)("h2",{className:"marker-popup-heading",children:De[r.type].header}),(0,Ze.jsx)("div",{className:"marker-popup-empty-div"})]}),(0,Ze.jsxs)("section",{className:"marker-popup-main-info",children:[(0,Ze.jsx)("img",{className:"marker-popup-main-icon",alt:"marker icon",src:De[r.type].marker}),(0,Ze.jsx)("h1",{className:"marker-popup-main-header",children:"Marker Information"})]}),(0,Ze.jsx)("p",{className:"marker-popup-description",children:r.description}),r.photo?(0,Ze.jsxs)("section",{className:"marker-popup-photo",children:[(0,Ze.jsxs)("section",{className:"marker-popup-photo-header",children:[(0,Ze.jsx)("div",{className:"marker-popup-photo-icon-container",children:(0,Ze.jsx)("img",{className:"marker-popup-photo-icon",alt:"Upload Photo",src:qe})}),(0,Ze.jsx)("h1",{className:"marker-popup-main-header",children:"Photo"})]}),r.photo?(0,Ze.jsx)("div",{className:"markup-popup-photo-image",style:{backgroundImage:""+(s?"":`url(${r.photo})`)},children:!0===s?(0,Ze.jsx)(Xe,{size:40,report_type:r.type}):(0,Ze.jsx)(Ze.Fragment,{})}):(0,Ze.jsx)(Ze.Fragment,{})]}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsxs)("section",{className:"marker-popup-status",children:[(0,Ze.jsxs)("section",{className:"marker-popup-status-header",children:[(0,Ze.jsx)("div",{className:"marker-popup-status-icon-container",children:(0,Ze.jsx)("img",{className:"marker-popup-status-icon",alt:"status icon",src:Ye})}),(0,Ze.jsx)("h1",{className:"marker-popup-main-header",children:"Status"})]}),(0,Ze.jsxs)("section",{className:"marker-popup-status-selector-container",children:[(0,Ze.jsxs)("select",{className:"marker-popup-status-selector",onChange:e=>{h(e.target.value)},value:c,children:[(0,Ze.jsx)("option",{value:"Active",children:"Active"}),(0,Ze.jsx)("option",{value:"Inactive",children:"Inactive"})]}),r.active===("Active"===c)?(0,Ze.jsx)(Ze.Fragment,{}):(0,Ze.jsx)("button",{onClick:a?()=>{}:async e=>{"alert"===r.of_type?(o(!0),await async function(e,t){try{return(await fetch(`/alerts/alerts/${e}/active`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:t})}).then((e=>e.json())).catch((e=>({error:"Error updating alert status"})))).error?{error:"Error updating alert status"}:{success:"success"}}catch(i){return{error:"Error updating alert status"}}}(r.id,"Active"===c).then((e=>{e.error?(i({message:"Status change error: Could not update status"}),h("Active"===c?"Inactive":"Active"),o(!1)):(r.active="Active"===c,o(!1))})).catch((e=>{i({message:"Status change error: Could not update status"}),h("Active"===c?"Inactive":"Active"),o(!1)}))):"incident"===r.of_type&&(o(!0),await async function(e,t){try{return(await fetch(`/incidents/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:t})}).then((e=>e.json())).catch((e=>({error:"Error updating alert status"})))).error?{error:"Error updating alert status"}:{success:"success"}}catch(i){return{error:"Error updating alert status"}}}(r.id,"Active"===c).then((e=>{r.active="Active"===c,o(!1)})).catch((e=>{i({message:"Status change error: Could not update status"}),h("Active"===c?"Inactive":"Active"),o(!1)})))},className:"marker-popup-status-change",style:{background:`${De[r.type].colour}`},children:a?(0,Ze.jsx)(Qe,{size:30}):"Change Status"})]})]})]})})]})}const lt=__webpack_require__.p+"static/media/cross_black.f52a7d36baf4f9187df7e2eda2307a58.svg";function ct(t){let{report:i,close_notification:r,go_to:n}=t;const[a,o]=(0,e.useState)(!1),s=()=>{o(!1),setTimeout((()=>{r()}),500)};return(0,e.useEffect)((()=>{setTimeout((()=>{o(!0)}),1)}),[]),(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("div",{className:"notification-back "+(a?"notification-back-shown":""),onClick:s}),(0,Ze.jsx)("div",{className:"notification-root "+(a?"notification-root-shown":""),children:(0,Ze.jsxs)("div",{className:"notification-container",onClick:n,children:[(0,Ze.jsxs)("section",{className:"notification-header",children:[(0,Ze.jsx)("div",{className:"notification-blank-div"}),(0,Ze.jsx)("h1",{className:"notification-heading",children:"New Notification!"}),(0,Ze.jsx)("img",{className:"notification-close",alt:"close",src:lt,onClick:s})]}),(0,Ze.jsxs)("div",{className:"notification-info",children:[(0,Ze.jsx)("div",{className:"notificaiton-icon-container",style:{background:`${De[i.type].colour}`},children:(0,Ze.jsx)("img",{className:"notificaiton-icon",alt:"notification icon",src:De[i.type].icon})}),(0,Ze.jsxs)("div",{className:"notification-extra-info",children:[(0,Ze.jsx)("h2",{className:"notification-type",children:De[i.type].header}),(0,Ze.jsx)("h3",{className:"notification-click-me",children:"Click to view on map"})]})]})]})})]})}function ht(t){let{add_new_report:i,set_location_services_enabled:r,set_error:n,incident_reports:a,new_notification:o,set_new_notification:s}=t;const l=(0,e.useRef)(null),c=(0,e.useRef)(null),[h,u]=(0,e.useState)(25),[d,p]=(0,e.useState)(-30),[f,m]=(0,e.useState)(0),[g,_]=(0,e.useState)(0),[y,x]=(0,e.useState)(null),[v,b]=(0,e.useState)(null),w=e=>{x(e)},S=()=>{u(c.current.getCenter().lng.toFixed(4)),p(c.current.getCenter().lat.toFixed(4))};(0,e.useEffect)((()=>{try{if(!c.current){Ne(c,l,S,w,a)}const e={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.watchPosition((t=>{!function(e,t){$e.lat=t,$e.lng=e}(t.coords.longitude,t.coords.latitude),r(!0),e.timeout=1e4}),(t=>{t.PERMISSION_DENIED?n({message:"Please enable your location to make reports."}):t.POSITION_UNAVAILABLE&&n({message:"Location error: Could not find your position"}),r(!1),e.timeout=1e3}),e)}catch(e){n({message:"Error loading map"})}}),[]);const E=()=>{s(null),b(null)};(0,e.useEffect)((()=>{if(o){console.log(o);const t={of_type:(e=o).of_type,id:e.id,type:e.type,description:e.description?e.description:De[e.type].header+" Alert",active:1==e.active,date:new Date(e.date.year,e.date.month,e.date.day,e.date.time.hour+2,e.date.time.minute,0,0),location:{lng:parseFloat(e.longitude),lat:parseFloat(e.latitude)},photo:e.photo};i(t),b(t),Ue(w,t)}var e}),[o]);return(0,Ze.jsxs)(Ze.Fragment,{children:[v?(0,Ze.jsx)(ct,{go_to:()=>{E(),Ve(v,w)},close_notification:E,report:v}):(0,Ze.jsx)(Ze.Fragment,{}),null===y?(0,Ze.jsx)(Ze.Fragment,{}):(0,Ze.jsx)(st,{set_error:n,report:y,close:()=>x(null)}),(0,Ze.jsx)("section",{className:"map-root",children:(0,Ze.jsx)("section",{ref:l,className:"map-container"})})]})}function ut(e){let{children:t,colour:i}=e;return(0,Ze.jsx)("button",{className:"quick-report-button-root",style:{background:`${i}`},children:(0,Ze.jsx)("img",{className:"quick-report-button-icon",alt:"alert icon",src:t})})}const dt=__webpack_require__.p+"static/media/sos.f19b22f5ee41cd23c0b0d334b5d7ce4f.svg";const pt=__webpack_require__.p+"static/media/arrow_white.669cb05f420eb88e999acd754aafc104.svg";function ft(t){let{uploading_report:i,location_services_enabled:r,show_quickreports:n,set_show_quickreports:a,report_types_data:o,open_detailed_report_menu:s,set_confirmation_menu:l}=t;const[c,h]=(0,e.useState)(null),[u,d]=(0,e.useState)(null);return(0,e.useEffect)((()=>{const e=new Image;e.src=dt;const t=new Image;t.src=pt,e.onload=()=>{h(e)},t.onload=()=>{d(t)}}),[]),(0,Ze.jsxs)(Ze.Fragment,{children:[n?(0,Ze.jsx)("div",{className:"navbar-back",onClick:()=>a(!1)}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsxs)("nav",{className:"navbar-root",children:[r&&!i?(0,Ze.jsx)("ul",{className:"navbar-report-buttons",children:o.map((e=>(0,Ze.jsx)("li",{onClick:()=>l(e),className:"navbar-report-button-item "+(n?`shown-navbar-button-${e.type}`:""),children:(0,Ze.jsx)(ut,{type:e.type,colour:e.colour,children:e.icon})},e.type)))}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsx)("button",{className:"navbar-report-button "+(r&&!i?"navbar-report-button-shown":"navbar-report-button-hidden"),onClick:n?()=>(a(!1),void s()):()=>a(!0),children:(0,Ze.jsx)("section",{className:"navbar-report-button-inner",children:n?u?(0,Ze.jsx)("img",{className:"navbar-report-icon arrow-icon",alt:"Open detailed menu",src:u.src}):(0,Ze.jsx)(Qe,{size:50}):i?(0,Ze.jsx)(Qe,{size:40}):c?(0,Ze.jsx)("img",{className:"navbar-report-icon",alt:"Report Alert",src:c.src,style:{marginTop:"-7px"}}):(0,Ze.jsx)(Qe,{size:50})})}),r?(0,Ze.jsx)("section",{className:"navbar-detailed-menu-indicator "+(n?"navbar-detailed-menu-indicator-shown":""),children:(0,Ze.jsx)("h3",{className:"navbar-detailed-menu-indicator-text",children:"click again to bring up detailed menu"})}):(0,Ze.jsx)("section",{className:"navbar-disabled-location "+(r?"":"navbar-disabled-location-shown"),children:(0,Ze.jsx)("h3",{className:"navbar-disabled-location-text",children:"enable your location and refresh to make reports"})})]})]})}const mt=__webpack_require__.p+"static/media/call.7030483e25025c4edac0ac38551c48a8.svg";function gt(){return(0,Ze.jsxs)("a",{className:"emergency-call-root",href:"tel: 10111",children:[(0,Ze.jsx)("h2",{className:"emergency-call-header",children:"Emergency Call"}),(0,Ze.jsx)("img",{className:"emergency-call-icon",src:mt,alt:"call icon"})]})}const _t=__webpack_require__.p+"static/media/menu.934740cd6e1da1b1d6b6813fbbe20819.svg";function yt(e){return(0,Ze.jsx)("button",{className:"menu-button-root",onClick:e.on_click,children:(0,Ze.jsx)("img",{className:"menu-button-icon",alt:"menu",src:_t})})}function xt(e){return(0,Ze.jsxs)("section",{className:"topbar-root",children:[(0,Ze.jsx)(yt,{on_click:()=>{e.set_show_side_menu(!0)}}),(0,Ze.jsx)(gt,{})]})}function vt(e){let{children:t,icon:i,styles:r}=e;return(0,Ze.jsxs)("button",{className:"side-menu-item-root",children:[(0,Ze.jsx)("img",{src:i,alt:"menu icon",className:"side-menu-item-icon",style:r}),(0,Ze.jsx)("h2",{className:"side-menu-item-text",children:t})]})}__webpack_require__.p;const bt=__webpack_require__.p+"static/media/notifications.360e9423c42af72546c6b8ea26dda577.svg";const wt=__webpack_require__.p+"static/media/reports.b2e191bec249d5f434a3eda0a5364b07.svg";const St=__webpack_require__.p+"static/media/info.6a335aabb4eb58b2544760db0b7b381d.svg";const Et=__webpack_require__.p+"static/media/heart.9bf972d6088bae610d1260b7d7ed7785.svg";const Tt=__webpack_require__.p+"static/media/car.ddec9f0d23650a3c543a78de3ae5868e.svg";const Ct=__webpack_require__.p+"static/media/signout.4737d96abd4b6f9a6f014fd6fb310741.svg";const kt=__webpack_require__.p+"static/media/fire_extinguisher.8b7ab6ac6ff249cbb58a96c1ea1bd9d5.svg";const Mt=__webpack_require__.p+"static/media/account.4248911dcc45fb9d894d64f525e6e45b.svg";const At=t=>{let{set_error:i,isOpen:r,onClose:n,onSchedule:a}=t;const[o,s]=(0,e.useState)("10:00"),[l,c]=(0,e.useState)(!1);return r?(0,Ze.jsx)("div",{className:"scheduleride-overlay",onClick:n,children:(0,Ze.jsxs)("div",{className:"scheduleride-content "+(l?"scheduleride-content-hidden":""),onClick:e=>e.stopPropagation(),children:[(0,Ze.jsx)("h1",{className:"scheduleride-heading",children:"Schedule a Ride"}),(0,Ze.jsx)("h6",{className:"scheduleride-subheading",children:"Pick a time for your ride"}),(0,Ze.jsx)("input",{type:"time",value:o,onChange:e=>s(e.target.value),className:"time-picker"}),(0,Ze.jsx)("button",{className:"scheduleride-button",onClick:l?()=>{}:async()=>{try{c(!0),await async function(e){return await fetch("/email/store-time",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({time:e})})}(o).then((e=>{a(o),n(),c(!1)})).catch((e=>{c(!1),i({message:"Error allocating time slot. Please try again."})}))}catch(e){console.error("Error storing time:",e),i({message:"Error allocating time slot. Please try again."}),c(!1)}},children:l?(0,Ze.jsx)(Qe,{size:30}):"Schedule"})]})}):null},Pt=t=>{let{onClose:i,show_sub_message:r}=t;const[n,a]=(0,e.useState)(!1);(0,e.useEffect)((()=>{const e=setTimeout((()=>{o()}),5e3);return()=>clearTimeout(e)}),[]);const o=()=>{a(!0),setTimeout((()=>{i()}),400)};return(0,Ze.jsx)("div",{className:"ride-now-confirmation-overlay",onClick:i,children:(0,Ze.jsxs)("div",{className:"ride-now-confirmation-content",onClick:e=>e.stopPropagation(),children:[(0,Ze.jsx)("h1",{className:"confirmation-heading",children:"You're all set!"}),r?(0,Ze.jsx)("p",{className:"confirmation-subheading",children:"Make your way to the nearest campus security office."}):(0,Ze.jsx)(Ze.Fragment,{})]})})},It=t=>{let{set_error:i,isOpen:r,onClose:n}=t;const[a,o]=(0,e.useState)(!1),[s,l]=(0,e.useState)(""),[c,h]=(0,e.useState)(!1);return r||a?(0,Ze.jsxs)(Ze.Fragment,{children:[!a&&r&&(0,Ze.jsx)("div",{className:"selectres-overlay",onClick:n,children:(0,Ze.jsxs)("div",{className:"selectres-content "+(c?"selectres-content-loading":""),onClick:e=>e.stopPropagation(),children:[(0,Ze.jsx)("h1",{className:"Card1-Heading",children:"Select Residence"}),(0,Ze.jsx)("h6",{className:"Card1-subheading",children:"Choose your residence from the list"}),(0,Ze.jsxs)("select",{className:"selectres-dropdown",onChange:e=>{const t=e.target.value;l(t)},children:[(0,Ze.jsx)("option",{value:"",children:"Select a residence"}),(0,Ze.jsx)("option",{value:"Noswal Hall",children:"Noswal Hall"}),(0,Ze.jsx)("option",{value:"Ernest Oppenheimer Hall",children:"Ernest Oppenheimer Hall"}),(0,Ze.jsx)("option",{value:"Knockando Hall",children:"Knockando Hall"}),(0,Ze.jsx)("option",{value:"Girton Hall",children:"Girton Hall"}),(0,Ze.jsx)("option",{value:"Reith Hall",children:"Reith Hall"})]}),(0,Ze.jsx)("button",{className:"selectres-button",onClick:c?()=>{}:async()=>{try{h(!0),await async function(e){return await fetch("/email/store-residence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({residence:e})})}(s).then((e=>{h(!1),o(!0),setTimeout((()=>{o(!1),n()}),5e3)})).catch((e=>{h(!1),i({message:"Error submitting your residence. Please try again"})}))}catch(e){h(!1),i({message:"Error submitting your residence. Please try again"})}},disabled:!s,children:c?(0,Ze.jsx)(Qe,{size:30}):"Go"})]})}),a&&(0,Ze.jsx)(Pt,{onClose:n,show_sub_message:!1})]}):null},Dt=t=>{let{set_error:i,isOpen:r,onClose:n}=t;const[a,o]=(0,e.useState)(!1),[s,l]=(0,e.useState)(!1),[c,h]=(0,e.useState)(!1),[u,d]=(0,e.useState)(!1),[p,f]=(0,e.useState)(!1),[m,g]=(0,e.useState)(!1);(0,e.useEffect)((()=>{o(!0),r||(l(!0),setTimeout((()=>{n(),l(!1),h(!1),d(!1),f(!1),g(!1)}),400))}),[r]);const _=()=>{l(!0),o(!1),setTimeout((()=>{n()}),400)};return r||s?(0,Ze.jsx)("div",{className:"popup-overlay",onClick:_,children:(0,Ze.jsx)("div",{className:"popup-content "+(a?"popup-content-show":""),onClick:e=>e.stopPropagation(),children:(0,Ze.jsxs)("div",{className:"popup-container",children:[!m&&!c&&!u&&!p&&(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("h1",{className:"Card1-Heading",id:"Main-Heading",children:"Walk Home Assistance"}),(0,Ze.jsx)("h1",{className:"Card1-Heading",children:"Leave now"}),(0,Ze.jsx)("h6",{className:"Card1-subheading",children:"Get dropped off at your residence"}),(0,Ze.jsx)("button",{className:"Card1-Button",onClick:()=>{g(!0),f(!0)},children:"Ride Now"}),(0,Ze.jsx)("h1",{className:"Card1-Heading",children:"Leaving later?"}),(0,Ze.jsx)("h6",{className:"Card1-subheading",children:"Schedule a drop-off time with campus security."}),(0,Ze.jsx)("button",{className:"Card1-Button",onClick:()=>{h(!0),g(!0)},children:"Schedule"})]}),c&&(0,Ze.jsx)(At,{set_error:i,isOpen:c,onClose:()=>h(!1),onSchedule:()=>{h(!1),d(!0)}}),u&&(0,Ze.jsx)(It,{set_error:i,isOpen:u,onClose:_}),p&&(0,Ze.jsx)(Pt,{onClose:_,show_sub_message:!0})]})})}):null};function Rt(t){const[i,r]=(0,e.useState)(!1);return(0,Ze.jsxs)("section",{className:"side-menu-root "+(t.show_side_menu?" shown-side-menu":""),children:[(0,Ze.jsxs)("section",{className:"side-menu-contents-top",children:[(0,Ze.jsxs)("article",{className:"side-menu-profile",children:[(0,Ze.jsx)("div",{className:"side-menu-profile-image-container",style:{backgroundImage:`url(${Mt})`}}),(0,Ze.jsxs)("section",{className:"side-menu-profile-info",onClick:t.valid_profile?()=>t.set_current_menu("medical_profile"):()=>{},children:[(0,Ze.jsxs)("section",{className:"side-menu-profile-name-num",children:[(0,Ze.jsxs)("h1",{className:"side-menu-profile-name",children:[t.profile.first_names," ",t.profile.last_name]}),(0,Ze.jsx)("h2",{className:"side-menu-profile-student-num",children:t.profile.student_staff_num})]}),(0,Ze.jsx)("button",{className:"side-menu-view-profile",children:t.valid_profile?"View Medical Profile":"Profile inaccessible. Please reload the page"})]})]}),(0,Ze.jsxs)("ul",{className:"side-menu-navigations",children:[(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-notifications",onClick:()=>t.set_current_menu("notifications"),children:(0,Ze.jsx)(vt,{icon:bt,children:"Notifications"})}),(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-reports",onClick:()=>t.set_current_menu("incident_reports"),children:(0,Ze.jsx)(vt,{icon:wt,children:"Incident Reports"})}),(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-info",onClick:()=>t.set_current_menu("emergency_info"),children:(0,Ze.jsx)(vt,{icon:St,children:"Emergency Information"})}),(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-first-aid",onClick:()=>t.set_current_menu("first_aid"),children:(0,Ze.jsx)(vt,{icon:Et,children:"First Aid Information"})}),(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-first-aid",onClick:()=>t.set_current_menu("safety_resources"),children:(0,Ze.jsx)(vt,{icon:kt,children:"Safety Resources"})}),(0,Ze.jsx)("li",{className:"side-menu-nav-item side-menu-walk-home",onClick:()=>t.set_current_menu("walk_home"),children:(0,Ze.jsx)(vt,{icon:Tt,children:"Walk-home assistance"})})]})]}),(0,Ze.jsx)("section",{className:"side-menu-contents-bottom",children:(0,Ze.jsxs)("button",{className:"side-menu-signout-button",onClick:t.handle_signout,children:[(0,Ze.jsx)("img",{src:Ct,alt:"sign out icon",className:"side-menu-signout-button-icon",style:{rotate:"180deg"}}),(0,Ze.jsx)("h2",{className:"side-menu-signout-button-text",children:"Sign out"})]})})]})}const zt=__webpack_require__.p+"static/media/arrow.2b7c53f8ae436d1b7dec535f7d1b4ef6.svg";function Lt(t){let{close:i,menu_header:r,children:n}=t;const[a,o]=(0,e.useState)(!1);(0,e.useEffect)((()=>{o(!0)}),[]);const s=()=>{o(!1),setTimeout((()=>{i()}),500)};return(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("div",{className:"menu-background "+(a?"menu-background-shown":"menu-background-hidden"),onClick:()=>s()}),(0,Ze.jsxs)("section",{className:"menu-root "+(a?"menu-root-shown":""),children:[(0,Ze.jsxs)("header",{className:"menu-top-header",children:[(0,Ze.jsx)("nav",{className:"menu-top-nav",children:(0,Ze.jsx)("img",{alt:"back",className:"menu-back",src:zt,onClick:()=>{s()}})}),(0,Ze.jsx)("h1",{className:"menu-top-heading",children:r}),(0,Ze.jsx)("div",{className:"menu-empty-div"})]}),(0,Ze.jsx)("section",{className:"menu-content",children:n})]})]})}function Ft(e){return(0,Ze.jsx)(Lt,{menu_header:"Notifications",close:e.close_menu,children:(0,Ze.jsx)("section",{className:"notifications-menu-content",children:(()=>{const t=function(e,t){try{var i=[...e];if(i.length>0){i.sort(((e,t)=>function(e,t){return e>t?-1:1}(e.date,t.date)));var r=rt(i[0].date);i.splice(0,0,{type:"new-date",date:r});for(var n=0;n<i.length;){const e=i[n];if("new-date"!==e.type&&"scroll-base"!==e.type){const t=rt(e.date);t!==r?(i.splice(n,0,{type:"new-date",date:t}),r=t):n++}else n++}return i.push({type:"scroll-base"}),i.map(((e,i)=>"new-date"===e.type?(0,Ze.jsx)("div",{className:"notifications-menu-new-date",children:e.date},i):"scroll-base"===e.type?(0,Ze.jsx)("div",{className:"notifications-menu-scroll-base"},i):(0,Ze.jsx)(ot,{location:e.location,type:e.type,description:e.description,active:e.active,time:nt(e.date),show_time:!0,close_all_menus_handler:t},i)))}return(0,Ze.jsx)("p",{className:"notifications-menu-no-notifications",children:"You have no notifications"})}catch(a){return{error:a}}}(e.reports,e.close_all_menus);return t.error?(e.set_error({error:t.error}),(0,Ze.jsx)(Ze.Fragment,{})):t})()})})}function Bt(e){return(0,Ze.jsx)(Lt,{menu_header:"Incident Reports",close:e.close_menu,children:(0,Ze.jsxs)("section",{className:"incidents-reports-menu-container",children:[(0,Ze.jsx)("h2",{className:"incidents-reports-menu-subheading",children:"These reports are still active. Please remain vigilant."}),(0,Ze.jsx)("section",{className:"incidents-reports-menu-content",children:(()=>{const t=function(e,t){try{var i=[...e];return i.length>0?(i.push({type:"scroll-base"}),i.map(((e,i)=>"scroll-base"===e.type?(0,Ze.jsx)("div",{className:"reports-menu-scroll-base"},i):e.active?(0,Ze.jsx)(ot,{location:e.location,close_all_menus_handler:t,type:e.type,description:e.description,active:e.active,time:nt(e.date),show_time:!1},i):void 0))):(0,Ze.jsx)("p",{className:"reports-menu-no-reports",children:"No reports currently active."})}catch(r){return{error:"Error getting incident reports"}}}(e.reports,e.close_all_menus);return t.error?(e.set_error({message:"Error getting incident reports"}),(0,Ze.jsx)(Ze.Fragment,{})):t})()})]})})}function Ot(t){let{click_event:i,left_option:r,right_option:n}=t;const[a,o]=(0,e.useState)("left"),s=e=>{o(e),i(e)};return(0,Ze.jsxs)("div",{className:"slider-root",children:[(0,Ze.jsx)("div",{className:"slider-selected "+("left"===a?"slider-selected-left":"slider-selected-right")}),(0,Ze.jsx)("div",{className:"slider-option slider-option-left "+("left"===a?"slider-option-selected":"slider-option-unselected"),onClick:()=>s("left"),children:r}),(0,Ze.jsx)("div",{className:"slider-option slider-option-right "+("right"===a?"slider-option-selected":"slider-option-unselected"),onClick:()=>s("right"),children:n})]})}const Nt=__webpack_require__.p+"static/media/call_2.23d0dbf5ed6a72a72b18cc5a085f65f3.svg";function Vt(e){let{name:t,phone_num:i}=e;return(0,Ze.jsx)("article",{className:"contact-card-root",children:(0,Ze.jsxs)("section",{className:"contact-card-content",children:[(0,Ze.jsxs)("section",{className:"contact-card-info",children:[(0,Ze.jsx)("h2",{className:"contact-card-name",children:t}),(0,Ze.jsx)("h3",{className:"contact-card-phone-num",children:i})]}),(0,Ze.jsxs)("a",{href:`tel: ${i}`,className:"contact-card-call-button",children:[(0,Ze.jsx)("p",{className:"contact-card-call-button-text",children:"Call"}),(0,Ze.jsx)("img",{className:"contact-card-call-button-icon",src:Nt,alt:"call icon"})]})]})})}function jt(e){let{header:t,content:i}=e;return(0,Ze.jsx)("div",{className:"emergency-info-box-root",children:(0,Ze.jsxs)("div",{className:"emergency-info-box-inner",children:[(0,Ze.jsx)("h2",{className:"emergency-info-box-header",children:t}),(0,Ze.jsx)("ul",{className:"emergency-info-box-items",children:i.map(((e,t)=>{var r=!0;return t==i.length-1&&(r=!1),(0,Ze.jsxs)("li",{className:"emergency-info-box-item",children:[(0,Ze.jsx)(Vt,{name:e.name,phone_num:e.phone_num}),r?(0,Ze.jsx)("div",{className:"emergency-box-info-item-line"}):(0,Ze.jsx)(Ze.Fragment,{})]},t)}))})]})})}const Ut={wits_contacts:[{contact_group_name:"Wits Protection Services",contacts:[{name:"Braamfontein Campus East",phone_num:"011 717 4444"},{name:"Braamfontein Campus West",phone_num:"011 717 1842"},{name:"Health Sciences Campus",phone_num:"011 717 2232"},{name:"Education Campus",phone_num:"011 717 3340"},{name:"Business School Campus",phone_num:"011 717 3589"}]}],external_contacts:[{contact_group_name:"Ambulance Services Nearby",contacts:[{name:"Netcare Park Lane",phone_num:"011 480 4000"},{name:"Donald Gordon Medical Center",phone_num:"086 100 3932"},{name:"St John EMS Paramedics",phone_num:"086 178 5646"},{name:"Johannesburg Central Ambulance Services",phone_num:"011 375 5911"}]},{contact_group_name:"Police/Security Services Nearby",contacts:[{name:"SAPS Hillbrow Police Station",phone_num:"011 488 6511"},{name:"Johannesburg Metro Police",phone_num:"011 375 5911"}]},{contact_group_name:"Fire Services Nearby",contacts:[{name:"Berea Fire Station",phone_num:"011 375 5911"},{name:"Johannesburg Central Fire Station",phone_num:"011 375 5911"}]}]};function Gt(t){const[i,r]=(0,e.useState)("wits"),[n,a]=(0,e.useState)(!0),[o,s]=(0,e.useState)(!1),[l,c]=(0,e.useState)({wits_contacts:[],external_contacts:[]});(0,e.useEffect)((()=>{(async function(){return await fetch("/emergencycontacts/emergency-contacts",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{const t={wits_contacts:[],external_contacts:[]},i=[],r=[];return e.forEach((e=>{const n=e.name,a=e.cellNumber,o=e.contactGroup,s=e.serviceGroup;if("Wits"===o){i.includes(s)||(i.push(s),t.wits_contacts.push({contact_group_name:s,contacts:[]}));for(let e=0;e<t.wits_contacts.length;e++)t.wits_contacts[e].contact_group_name===s&&t.wits_contacts[e].contacts.push({name:n,phone_num:a})}else if("External"===o){r.includes(s)||(r.push(s),t.external_contacts.push({contact_group_name:s,contacts:[]}));for(let e=0;e<t.external_contacts.length;e++)t.external_contacts[e].contact_group_name===s&&t.external_contacts[e].contacts.push({name:n,phone_num:a})}})),t}))})().then((e=>{c(e),a(!1),s(!1)})).catch((e=>{c(Ut),a(!1),s(!0),t.set_error({message:"Could not fetch contact list. Showing static contact list for emergency purposes."})}))}),[]);return(0,Ze.jsx)(Lt,{menu_header:"Emergency Information",close:t.close_menu,children:(0,Ze.jsxs)("section",{className:"emergency-info-menu-container",children:[(0,Ze.jsx)("h2",{className:"emergency-info-menu-subheading",children:"Remember to stay calm so we can best understand you. You\u2019ve got this"}),(0,Ze.jsx)("div",{className:"emergency-info-header-slider",children:(0,Ze.jsx)(Ot,{click_event:e=>{a(!0),r("left"===e?"wits":"external"),a(!1)},left_option:"Wits Contacts",right_option:"External Contacts"})}),n?(0,Ze.jsx)("section",{className:"emergency-info-menu-spinner-container",children:(0,Ze.jsx)(Xe,{size:80,report_type:"fire"})}):"wits"==i?(0,Ze.jsxs)("section",{className:"emergency-info-menu-content",children:[l.wits_contacts.map(((e,t)=>(0,Ze.jsx)(jt,{header:e.contact_group_name,content:e.contacts},t))),(0,Ze.jsx)("div",{className:"emergency-info-menu-scroll-bottom"})]}):(0,Ze.jsxs)("section",{className:"emergency-info-menu-content",children:[l.external_contacts.map(((e,t)=>(0,Ze.jsx)(jt,{header:e.contact_group_name,content:e.contacts},t))),(0,Ze.jsx)("div",{className:"emergency-info-menu-scroll-bottom"})]})]})})}function $t(e){let{icon:t,header:i,icon_size:r,click:n}=e;return(0,Ze.jsx)("div",{className:"first-aid-option-root",onClick:n,children:(0,Ze.jsxs)("div",{className:"first-aid-option-inner",children:[(0,Ze.jsx)("img",{className:"first-aid-option-icon",alt:"first aid icon",src:t,style:{width:`${r}px`,height:`${r}`}}),(0,Ze.jsx)("h2",{className:"first-aid-option-header",children:i})]})})}const qt=__webpack_require__.p+"static/media/cpr.92cc5b98b1f772b48c9be018656635d9.svg";const Ht=__webpack_require__.p+"static/media/unconcious.d590c11c9b1472c219d2e3d63d8d4808.svg";const Wt=__webpack_require__.p+"static/media/cross.37c0fb85191897d1f6f8c6c8fde25167.svg";function Zt(t){let{guide_name:i,icon:r,icon_size:n,close:a,steps:o}=t;const[s,l]=(0,e.useState)(0);return(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("div",{className:"first-aid-guide-back",onClick:a}),(0,Ze.jsxs)("section",{className:"first-aid-guide-root",children:[(0,Ze.jsxs)("section",{className:"first-aid-guide-top",children:[(0,Ze.jsx)("img",{className:"first-aid-guide-icon",alt:"first aid icon",src:r,style:{width:`${n}px`,height:`${n}px`}}),(0,Ze.jsx)("h2",{className:"first-aid-guide-name",children:i}),(0,Ze.jsx)("div",{className:"first-aid-close",onClick:a,style:{width:`${n}px`,height:`${n}px`},children:(0,Ze.jsx)("img",{className:"first-aid-close-icon",src:Wt,alt:"close"})})]}),(0,Ze.jsxs)("section",{className:"first-aid-guide-content",children:[(0,Ze.jsx)("section",{className:"first-aid-guide-card-container",children:(0,Ze.jsx)("article",{className:"first-aid-guide-card",children:(0,Ze.jsxs)("section",{className:"first-aid-guide-inner",children:[(0,Ze.jsxs)("section",{className:"first-aid-guide-upper",children:[(0,Ze.jsx)("h3",{className:"first-aid-guide-card-header",children:o[s].header}),(0,Ze.jsx)("ul",{className:"first-aid-guide-card-description",children:o[s].description.map((e=>(0,Ze.jsx)("li",{className:"first-aid-guide-card-description-item",children:e})))})]}),(0,Ze.jsx)("p",{className:"first-aid-guide-card-footer",children:`Step ${s+1}`})]})})}),(0,Ze.jsxs)("section",{className:"first-aid-guide-buttons",children:[(0,Ze.jsx)("button",{className:"first-aid-guide-button "+(0===s?"first-aid-guide-button-disabled":"first-aid-guide-button-enabled"),onClick:()=>{const e=s-1;e>=0&&l(e)},children:"Previous Step"}),(0,Ze.jsx)("button",{className:"first-aid-guide-button "+(s===o.length-1?"first-aid-guide-button-disabled":"first-aid-guide-button-enabled"),onClick:()=>{const e=s+1;e<=o.length-1&&l(e)},children:"Next Step"})]})]})]})]})}const Xt={general_health_assistance:{header:"General Health Assistance",icon:be,icon_size:25,steps:[{header:"Call an ambulance",description:["Before anything else, call a medical emergency service immediately!","Listen to their assistance before proceeding"]},{header:"Check for a pulse",description:["To check for blood flow, position your index and middle finger on the patient's wrist.","You should feel a beating sensation.","If not, you need to proceed to CPR (see CPR first aid guide).","If you do feel a pulse, move to the next step."]},{header:"Health checklist",description:["Check the patient for any and all health issues. This will be important information for the paramedics.","Loss of conciousness,","Seizure or fit,","Burns,","Bruising,","Scratches,","Bite marks,","Stings,","Other skin abrasions,","etc."]},{header:"Important Tips",description:["Make sure the patient is breathing properly","If the patient is bleeding, apply intense pressure to the wound (with gloves or other protection)","If the patient has a fire burn, run the burn under cold water","If the patient is having a seizure/fit, place them on their side and protect from injury. Let the fit proceed."]}]},cpr:{header:"CPR",icon:qt,icon_size:35,steps:[{header:"Check the scene",description:["Check around you to ensure that it is safe to do CPR","Use personal protective equipment when dealing with a patient"]},{header:"Check responsiveness",description:["Use 'shout-tap-shout'","Shout the patient's name, or simply 'Hello, can you hear me?'","Tap the patient and check for responsiveness, breathing, and/or life-threatening bleeding or conditions","If the patient is unresponsive, not breathing or is only gasping, shout for help, call emergency services and get equipment"]},{header:"Positioning",description:["Kneel beside the person","Place the person on their back on a firm, flat surface"]},{header:"CPR: Step A",description:["Give 30 chest compressions","Hand position: Two hands centered on the chest","Body position: Shoulders directly over hands, elbows locked","Depth: At least 2 inches","Rate: 100 to 120 per minute","Allow chest to return to normal position after each compression"]},{header:"CPR: Step B",description:["Give 2 breaths","Open the airway to a past-neutral position using the head-tilt/chin-lift technique","Pinch the nose shut, take a normal breath and make complete seal over the person's mouth with your mouth","Ensure each breath lasts about 1 second and makes the chest rise; allow air to exit before giving the next breath","Go back to STEP A and repeat this process"]}]},unconcious:{header:"Unconcious Patient",icon:Ht,icon_size:35,steps:[{header:"Call an ambulance",description:["Before anything else, call a medical emergency service immediately!","Listen to their assistance before proceeding"]},{header:"Check the patient",description:["Check the person's airway, breathing and pulse. You should do this frequently while they are unconcious","If the person is not breathing, begin CPR (see CPR guide)"]},{header:"Check for injury",description:["Check for any spinal injuries","If you think there is a spinal injury, leave the person where you found them (as long as they continue breathing). If the person vomits, roll the entire body at one time to their side, making sure to support the neck and back to keep the head and body in the same position while you roll","If there is no spinal injury, continue to the next step, otherwise keep the person warm until medical help arrives"]},{header:"Positioning",description:["Carefully roll the person towards you on their side","Bend the top leg so both the hip and knee are at right angles","Gently tilt their head back to keep the airway open","If breathing or pulse stops at any time, roll the person onto their back and begin CPR"]},{header:"Types of unconcious",description:["If you know more about why the patient is unconcious, consider the following tips:","Low blood sugar: Give the person something sweet to eat or drink once they are conscious again","Choking: Begin CPR to help dislodge the object, or (if there is something blocking the airway that you can reach) try to remove blockages without pushing it farther into the airway. Continue until medical help arrives"]},{header:"What not to do:",description:["DO NOT give an unconscious person any food or drink.","DO NOT leave the person alone.","DO NOT place a pillow under the head of an unconscious person.","DO NOT slap an unconscious person's face or splash water on their face to try to revive them."]}]}};function Yt(t){const[i,r]=(0,e.useState)("none"),n=()=>{r("none")};return(0,Ze.jsx)(Lt,{menu_header:"First Aid",close:t.close_menu,children:(0,Ze.jsxs)("section",{className:"first-aid-menu-container",children:[(0,Ze.jsx)("h2",{className:"first-aid-menu-subheading",children:"Stay calm and focus. You can help save a life."}),(0,Ze.jsxs)("section",{className:"first-aid-menu-content",children:[(0,Ze.jsx)($t,{click:()=>r("general_health_assistance"),header:"General health assistance",icon:be,icon_size:25}),(0,Ze.jsx)($t,{click:()=>r("cpr"),header:"CPR",icon:qt,icon_size:35}),(0,Ze.jsx)($t,{click:()=>r("unconcious"),header:"Unconcious Patient",icon:Ht,icon_size:35})]}),(()=>{switch(i){case"none":return(0,Ze.jsx)(Ze.Fragment,{});case"general_health_assistance":return(0,Ze.jsx)(Zt,{guide_name:"General health assistance",icon:Xt.general_health_assistance.icon,icon_size:35,close:n,steps:Xt.general_health_assistance.steps});case"cpr":return(0,Ze.jsx)(Zt,{guide_name:"CPR",icon:Xt.cpr.icon,icon_size:35,close:n,steps:Xt.cpr.steps});case"unconcious":return(0,Ze.jsx)(Zt,{guide_name:"Unconcious Patient",icon:Xt.unconcious.icon,icon_size:35,close:n,steps:Xt.unconcious.steps})}})()]})})}const Jt=__webpack_require__.p+"static/media/clipboard.61837f723d175778f72f642be511b6a9.svg";function Qt(t){let{user_profile:i,close_edit_menu:r,get_user_profile:n}=t;const[a,o]=(0,e.useState)({first_names:i.first_names,last_name:i.last_name,student_staff_num:i.student_staff_num,gender:i.gender,dob:i.dob.substr(0,10),allergens:i.allergens,first_emergency_contact:{name:i.first_emergency_contact.name,relationship:i.first_emergency_contact.relationship,cell:i.first_emergency_contact.cell,work:i.first_emergency_contact.work},second_emergency_contact:{name:i.second_emergency_contact.name,relationship:i.second_emergency_contact.relationship,cell:i.second_emergency_contact.cell,work:i.second_emergency_contact.work}}),[s,l]=(0,e.useState)(!1),c=e=>{const{name:t,value:i}=e.target;o({...a,[t]:i})},h=(e,t)=>{const{name:i,value:r}=e.target;o({...a,[t]:{...a[t],[i]:r}})};return(0,Ze.jsxs)("div",{className:"edit-medical-profile-root",children:[(0,Ze.jsxs)("section",{className:"edit-medical-profile-content "+(s?"edit-medical-profile-content-disabled":""),children:[(0,Ze.jsx)("h2",{className:"edit-medical-profile-heading",children:"Personal Profile"}),(0,Ze.jsxs)("section",{className:"edit-medical-profile-section",children:[(0,Ze.jsx)("label",{children:"Student/Staff Number:"}),(0,Ze.jsx)("input",{type:"text",name:"student_staff_num",value:a.student_staff_num,onChange:c,disabled:"true",className:"edit-medical-profile-input edit-medical-profile-student-num"}),(0,Ze.jsx)("label",{children:"First Names:"}),(0,Ze.jsx)("input",{type:"text",name:"first_names",value:a.first_names,onChange:c,className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Last Name:"}),(0,Ze.jsx)("input",{type:"text",name:"last_name",value:a.last_name,onChange:c,className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Gender:"}),(0,Ze.jsxs)("select",{className:"edit-medical-profile-input",name:"gender",onChange:c,value:a.gender,children:[(0,Ze.jsx)("option",{value:"Male",children:"Male"}),(0,Ze.jsx)("option",{value:"Female",children:"Female"})]}),(0,Ze.jsx)("label",{children:"Date of Birth:"}),(0,Ze.jsx)("input",{type:"date",name:"dob",value:a.dob,onChange:c,className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Allergens:"}),(0,Ze.jsx)("input",{type:"text",name:"allergens",value:a.allergens,onChange:c,className:"edit-medical-profile-input"})]}),(0,Ze.jsx)("h2",{className:"edit-medical-profile-heading",children:"First Emergency Contact"}),(0,Ze.jsxs)("section",{className:"edit-medical-profile-section",children:[(0,Ze.jsx)("label",{children:"Name:"}),(0,Ze.jsx)("input",{type:"text",name:"name",value:a.first_emergency_contact.name,onChange:e=>h(e,"first_emergency_contact"),className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Relationship to individual:"}),(0,Ze.jsxs)("select",{className:"edit-medical-profile-input",name:"relationship",value:a.first_emergency_contact.relationship,onChange:e=>h(e,"first_emergency_contact"),children:[(0,Ze.jsx)("option",{value:"Mother",children:"Mother"}),(0,Ze.jsx)("option",{value:"Father",children:"Father"}),(0,Ze.jsx)("option",{value:"Child",children:"Child"}),(0,Ze.jsx)("option",{value:"Spouse",children:"Spouse"}),(0,Ze.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,Ze.jsx)("option",{value:"Other",children:"Other"})]}),(0,Ze.jsx)("label",{children:"Cell No.:"}),(0,Ze.jsx)("input",{type:"text",name:"cell",value:a.first_emergency_contact.cell,onChange:e=>h(e,"first_emergency_contact"),className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Work Phone No.:"}),(0,Ze.jsx)("input",{type:"text",name:"work",value:a.first_emergency_contact.work,onChange:e=>h(e,"first_emergency_contact"),className:"edit-medical-profile-input"})]}),(0,Ze.jsx)("h2",{className:"edit-medical-profile-heading",children:"Second Emergency Contact"}),(0,Ze.jsxs)("section",{className:"edit-medical-profile-section",children:[(0,Ze.jsx)("label",{children:"Name:"}),(0,Ze.jsx)("input",{type:"text",name:"name",value:a.second_emergency_contact.name,onChange:e=>h(e,"second_emergency_contact"),className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Relationship to individual:"}),(0,Ze.jsxs)("select",{className:"edit-medical-profile-input",name:"relationship",value:a.second_emergency_contact.relationship,onChange:e=>h(e,"second_emergency_contact"),children:[(0,Ze.jsx)("option",{value:"Mother",children:"Mother"}),(0,Ze.jsx)("option",{value:"Father",children:"Father"}),(0,Ze.jsx)("option",{value:"Child",children:"Child"}),(0,Ze.jsx)("option",{value:"Spouse",children:"Spouse"}),(0,Ze.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,Ze.jsx)("option",{value:"Other",children:"Other"})]}),(0,Ze.jsx)("label",{children:"Cell No.:"}),(0,Ze.jsx)("input",{type:"text",name:"cell",value:a.second_emergency_contact.cell,onChange:e=>h(e,"second_emergency_contact"),className:"edit-medical-profile-input"}),(0,Ze.jsx)("label",{children:"Work Phone No.:"}),(0,Ze.jsx)("input",{type:"text",name:"work",value:a.second_emergency_contact.work,onChange:e=>h(e,"second_emergency_contact"),className:"edit-medical-profile-input"})]})]}),(0,Ze.jsxs)("section",{className:"edit-medical-profile-buttons",children:[(0,Ze.jsx)("button",{className:"edit-medical-profile-save",onClick:()=>{l(!0),async function(e){try{if((await fetch("/users/update-user",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstnames:e.first_names,lastnames:e.last_name,student_number:e.student_staff_num,gender:e.gender,DOB:Ke(e.dob),allergies:e.allergens,first_emergency_contact_name:e.first_emergency_contact.name,first_emergency_contact_relationship:e.first_emergency_contact.relationship,first_emergency_contact_cell_number:e.first_emergency_contact.cell,first_emergency_contact_work_number:e.first_emergency_contact.work,second_emergency_contact_name:e.second_emergency_contact.name,second_emergency_contact_relationship:e.second_emergency_contact.relationship,second_emergency_contact_cell_number:e.second_emergency_contact.cell,second_emergency_contact_work_number:e.second_emergency_contact.work})}).then((e=>e.json()))).ok)return{success:"Success"}}catch(t){return{error:"Error updating user information"}}}(a).then((()=>{l(!1),n(),r()}))},children:s?(0,Ze.jsx)(Qe,{size:40,report_type:"natural"}):"Save Profile"}),(0,Ze.jsx)("button",{className:"edit-medical-profile-cancel "+(s?"edit-medical-profile-cancel-disabled":""),onClick:()=>{r()},children:"Cancel"})]})]})}function Kt(t){let{studentNumber:i,close_menu:r,profile:n,get_user_profile:a}=t;const[o,s]=(0,e.useState)(!1),[l,c]=(0,e.useState)(null);return(0,e.useEffect)((()=>{(async()=>{let e;try{e=await navigator.wakeLock.request("screen"),c(e)}catch(t){c(null)}})()}),[]),(0,Ze.jsx)(Ze.Fragment,{children:(0,Ze.jsx)(Lt,{menu_header:"Medical Profile",close:()=>{(async()=>{l&&await l.release()})(),r()},children:o?(0,Ze.jsx)(Qt,{get_user_profile:a,close_edit_menu:()=>{s(!1)},user_profile:n}):(0,Ze.jsxs)("section",{className:"medical-profile-menu-content",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-screen-on",children:[(0,Ze.jsx)("img",{className:"medical-profile-menu-screen-on-icon",alt:"clipboard icon",src:Jt}),(0,Ze.jsx)("h4",{className:"medical-profile-menu-screen-on-text",children:"This profile will keep the screen on for emergency reasons"})]}),(0,Ze.jsx)("article",{className:"medical-profile-menu-box",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-main-personal",children:[(0,Ze.jsx)("div",{className:"medical-profile-menu-main-personal-image",style:{backgroundImage:`url(${Mt})`}}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-main-personal-info",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-name",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-name-box",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-name-header",children:"First Names"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-name-value",children:n.first_names})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-name-box",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-name-header",children:"Last Name"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-name-value",children:n.last_name})]})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Student/Staff Number"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.student_staff_num})]})]})]})}),(0,Ze.jsxs)("article",{className:"medical-profile-menu-box",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-box-header",children:"General Information"}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-row",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Gender"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.gender})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"DOB | Age"}),(0,Ze.jsxs)("h3",{className:"medical-profile-menu-info-item-value",children:[n.dob.substr(0,10)," | ","-"!==n.dob?at(et(n.dob.substr(0,10))):"-"]})]})]}),(0,Ze.jsx)("section",{className:"medical-profile-menu-row",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Allergens"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.allergens})]})})]}),(0,Ze.jsxs)("article",{className:"medical-profile-menu-box",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-box-header",children:"Contact Information"}),(0,Ze.jsx)("section",{className:"medical-profile-menu-row",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"First Emergency Contact"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.first_emergency_contact.name})]})}),(0,Ze.jsx)("section",{className:"medical-profile-menu-row",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Relationship to patient"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.first_emergency_contact.relationship})]})}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-row",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Cell no."}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.first_emergency_contact.cell})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Work phone no."}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.first_emergency_contact.work})]})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-row",children:[" "," "]}),(0,Ze.jsx)("section",{className:"medical-profile-menu-row",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Second Emergency Contact"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.second_emergency_contact.name})]})}),(0,Ze.jsx)("section",{className:"medical-profile-menu-row",children:(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Relationship to patient"}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.second_emergency_contact.relationship})]})}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-row",children:[(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Cell no."}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.second_emergency_contact.cell})]}),(0,Ze.jsxs)("section",{className:"medical-profile-menu-info-item",children:[(0,Ze.jsx)("h2",{className:"medical-profile-menu-info-item-header",children:"Work phone no."}),(0,Ze.jsx)("h3",{className:"medical-profile-menu-info-item-value",children:n.second_emergency_contact.work})]})]})]}),(0,Ze.jsx)("button",{className:"medical-profile-edit",onClick:()=>{s(!0)},children:"Edit Profile"}),(0,Ze.jsx)("div",{className:"medical-profile-menu-scroll-bottom"})]})})})}function ei(e){let{report_type:t}=e;return(0,Ze.jsxs)("button",{className:"report-card-root",style:{background:`${t.colour}`},children:[(0,Ze.jsx)("img",{className:"report-card-icon",alt:"report icon",src:t.icon}),(0,Ze.jsx)("h4",{className:"report-card-header",children:t.header})]})}function ti(t){let{report_types_data:i,close_menu:r,report:n,set_detailed_report_menu:a}=t;const[o,s]=(0,e.useState)(!1);(0,e.useEffect)((()=>{s(!0)}),[]);const l=()=>{s(!1),setTimeout((()=>{r()}),400)};return(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)("div",{className:"detailed-report-back "+(o?"detailed-report-back-shown":"detailed-report-back-hidden"),onClick:l}),(0,Ze.jsx)("section",{className:"detailed-report-root "+(o?"detailed-report-shown":""),children:(0,Ze.jsxs)("section",{className:"detailed-report-content",children:[(0,Ze.jsxs)("section",{className:"detailed-report-top",children:[(0,Ze.jsx)("div",{className:"detailed-report-blank-div"}),(0,Ze.jsx)("h2",{className:"detailed-report-header",children:"Report"}),(0,Ze.jsx)("img",{className:"detailed-report-close",src:lt,onClick:l,alt:"close"})]}),(0,Ze.jsx)("h3",{className:"detailed-report-sub-header",children:"What type of incident are you reporting?"}),(0,Ze.jsxs)("ul",{className:"detailed-report-types",children:[i.map((e=>(0,Ze.jsx)("li",{className:"detailed-report-type-item",onClick:()=>a(e),children:(0,Ze.jsx)(ei,{report_type:e})}))),(0,Ze.jsx)("div",{className:"detailed-report-scroll-bottom"})]})]})})]})}function ii(t){let{on_finish_event:i}=t;const[r,n]=(0,e.useState)(9);return(0,e.useEffect)((()=>{const e=setInterval((()=>{n((e=>0==e?(i(),0):e-1))}),1e3);return()=>clearInterval(e)}),[]),(0,Ze.jsx)(Ze.Fragment,{children:r})}function ri(e){let{set_error:t,report_type:i,close_all_menus:r,close_menu:n,set_uploading_report:a}=e;const o=()=>{a(i.type),r(),async function(e){try{const t=Ge();return(await fetch("/alerts/alerts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,active:1,latitude:t.lat,longitude:t.lng})}).then((e=>e.json())).catch((e=>({error:"Error sending alert"})))).error?{error:"Error sending alert"}:{success:"success"}}catch(t){return{error:"Error sending alert"}}}(i.type).then((e=>{a(null),e.error&&t({message:"Error sending alert"})})).catch((e=>{t({message:"Error sending alert"}),a(null)}))};return(0,Ze.jsx)("section",{className:"report-confirmation-root",children:(0,Ze.jsxs)("section",{className:"report-confirmation-content",children:[(0,Ze.jsx)(ei,{report_type:i}),(0,Ze.jsxs)("article",{className:"report-confirmation-causes",children:[(0,Ze.jsx)("p",{className:"report-confirmation-header",children:"This report will cause:"}),(0,Ze.jsx)("ul",{className:"report-confirmation-list",children:i.report_causes.map((e=>(0,Ze.jsx)("li",{className:"report-confirmation-causes-item",children:e})))})]}),(0,Ze.jsxs)("section",{className:"report-confirmation-options",children:[(0,Ze.jsx)("h5",{className:"report-confirmation-options-text",children:"Are you sure you want to make this report?"}),(0,Ze.jsxs)("section",{className:"report-confirmation-buttons",children:[(0,Ze.jsx)("button",{className:"report-confirmation-button-no",onClick:()=>{n()},children:(0,Ze.jsx)("p",{className:"report-confirmation-button-text",children:"No"})}),(0,Ze.jsx)("button",{className:"report-confirmation-button-yes",onClick:o,style:{background:`${i.colour}`},children:(0,Ze.jsx)("p",{className:"report-confirmation-button-text",children:"Yes"})})]}),(0,Ze.jsxs)("section",{className:"report-confirmation-auto-text",children:["Automatically confirming in ",(0,Ze.jsx)(ii,{on_finish_event:()=>{o()}})," seconds"]})]})]})})}function ni(e){let{resource:t}=e;return(0,Ze.jsxs)("div",{className:"safety-resource-root",children:[(0,Ze.jsxs)("div",{className:"safety-resource-header",style:{background:`${De[t.type].colour}`},children:[(0,Ze.jsx)("img",{className:"safety-resource-icon",alt:"resource icon",src:De[t.type].icon}),(0,Ze.jsx)("h2",{className:"safety-resource-heading",children:t.title})]}),(0,Ze.jsxs)("div",{className:"safety-resource-base",children:[(0,Ze.jsx)("p",{className:"safety-resource-description",children:t.description}),(0,Ze.jsx)("div",{className:"safety-resource-button-container",children:(0,Ze.jsx)("a",{className:"safety-resource-button",style:{background:`${De[t.type].colour}`},href:t.link,target:"_blank",children:"Open Link"})})]})]})}const ai=__webpack_require__.p+"static/media/search.d4eb7c2fa04d7c91c1170f7719bfb23a.svg";function oi(t){let{set_error:i,close_menu:r}=t;const[n,a]=(0,e.useState)(""),[o,s]=(0,e.useState)([]),[l,c]=(0,e.useState)(!0),h=async()=>{const e=await async function(){const e=await fetch("/resources/safety-resources",{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e)).catch((e=>({error:"Error fetching safety resources"})));return e.error?{error:"Error fetching safety resources"}:e}().then((e=>e?e.error?(i({message:"Error fetching safety resources"}),[]):e:(i({message:"Error fetching safety resources"}),[]))).catch((e=>(i({message:"Error fetching safety resources"}),[])));s(e),c(!1)};return(0,e.useEffect)((()=>{c(!0),h()}),[]),(0,Ze.jsx)(Lt,{menu_header:"Safety Resources",close:r,children:(0,Ze.jsxs)("section",{className:"safety-resources-menu-container",children:[(0,Ze.jsx)("section",{className:"safety-resources-menu-subcountainer",children:(0,Ze.jsxs)("section",{className:"safety-resources-menu-search-container",children:[(0,Ze.jsx)("img",{className:"safety-resources-menu-search-icon",alt:"search icon",src:ai}),(0,Ze.jsx)("input",{className:"safety-resources-menu-search",placeholder:"Search for a safety resource",value:n,onChange:e=>a(e.target.value)})]})}),l?(0,Ze.jsx)(Xe,{size:40,report_type:"medical"}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsx)("ul",{className:"safety-resources-menu-items",children:(()=>{if(o.length>0){return(""===n?o:o.filter((e=>e.title.toLowerCase().includes(n.toLowerCase())))).map((e=>(0,Ze.jsx)("li",{className:"safety-resources-menu-item",children:(0,Ze.jsx)(ni,{resource:e})})))}return(0,Ze.jsx)(Ze.Fragment,{})})()})]})})}function si(t){let{set_error:i,set_uploading_report:r,report_type:n,close_menu:a,close_all_menus:o}=t;const[s,l]=(0,e.useState)(!1),[c,h]=(0,e.useState)(null);(0,e.useEffect)((()=>{l(!0)}),[]);return(0,Ze.jsx)(Ze.Fragment,{children:(0,Ze.jsx)("div",{className:"make-detailed-report-root "+(s?"make-detailed-report-root-shown":""),children:(0,Ze.jsxs)("div",{className:"make-detailed-report-container",children:[(0,Ze.jsxs)("div",{className:"make-detailed-report-header",style:{background:`${n.colour}`},children:[(0,Ze.jsx)("img",{className:"make-detailed-report-icon",src:n.icon,alt:"report icon"}),(0,Ze.jsx)("h2",{className:"make-detailed-report-heading",children:n.header}),(0,Ze.jsx)("div",{className:"make-detailed-report-empty-div"})]}),(0,Ze.jsxs)("div",{className:"make-detailed-report",children:[(0,Ze.jsx)("h3",{className:"make-detailed-report-subheading",children:"Make a detailed report"}),(0,Ze.jsxs)("div",{className:"make-detailed-report-input-group",children:[(0,Ze.jsxs)("div",{className:"make-detailed-report-picture",children:[(0,Ze.jsx)("h4",{className:"make-detailed-report-picture-heading",children:"Upload a picture (Click to upload)"}),(0,Ze.jsx)("div",{className:"make-detailed-report-upload-picture",style:{border:`3px dashed ${n.colour}`,backgroundImage:""+(c?`url(${URL.createObjectURL(c)})`:`url(${qe})`),backgroundSize:""+(c?"100%":"25%")},children:(0,Ze.jsx)("input",{className:"make-detailed-report-upload-picture-input",label:"Image",placeholder:"Choose image",accept:"image/png,image/jpeg",type:"file",onChange:e=>{h(e.target.files[0])}})})]}),(0,Ze.jsxs)("div",{className:"make-detailed-report-description",children:[(0,Ze.jsx)("h4",{className:"make-detailed-report-description-heading",children:"Add a description"}),(0,Ze.jsx)("textarea",{id:"report-description-input",className:"make-detailed-report-description-input",placeholder:"Add report description here..."})]})]})]}),(0,Ze.jsxs)("div",{className:"make-detailed-report-buttons",children:[(0,Ze.jsx)("button",{className:"make-detailed-report-button-submit",style:{background:`${n.colour}`},onClick:async()=>{const e=document.getElementById("report-description-input").value;r(n.type),o(),async function(e,t,i){try{const a=Ge();var r=new FormData;r.append("description",i),r.append("latitude",a.lat),r.append("longitude",a.lng),r.append("type",e),t?r.append("photo",t,t.name):r.append("photo",null);var n={method:"POST",body:r,redirect:"follow"};return(await fetch("/incidents/report-incidents",n).then((e=>e.json())).catch((e=>({error:e})))).error?{error:"Error sending alert"}:{success:"success"}}catch(a){return{error:"Error sending incident report"}}}(n.type,c,e).then((e=>{e.error&&i({message:"Error sending incident report"}),r(null)})).catch((e=>{i({message:"Error sending incident report"}),r(null)}))},children:"Submit Report"}),(0,Ze.jsx)("button",{className:"make-detailed-report-button-cancel",onClick:a,children:"Cancel"})]})]})})})}const li=(0,e.createContext)(),ci=t=>{let{children:i}=t;const[r,n]=(0,e.useState)(null);return(0,Ze.jsx)(li.Provider,{value:{studentNumber:r,setStudentNumber:n},children:i})};function hi(t){let{report_type:i}=t;const[r,n]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{n(!0)}),[]),(0,Ze.jsxs)("div",{className:"uploading-report-root "+(r?"uploading-report-root-shown":""),style:{background:`${De[i].colour}`},children:[(0,Ze.jsx)("img",{className:"uploading-report-icon",alt:"report icon",src:De[i].icon}),(0,Ze.jsx)("h3",{className:"uploading-report-text",children:"Uploading your report"}),(0,Ze.jsx)(Qe,{size:30})]})}const ui=__webpack_require__.p+"static/media/error.7fec6a97b88b9795bde2301dc9e97439.svg";function di(t){let{set_error:i,error:r}=t;const[n,a]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{a(!0),setTimeout((()=>{a(!1),setTimeout((()=>{i(!1)}),400)}),8e3)}),[]),(0,Ze.jsx)("div",{className:"error-card-root "+(n?"error-card-root-shown":""),children:(0,Ze.jsxs)("div",{className:"error-card-content "+(n?"error-card-content-shown":""),children:[(0,Ze.jsx)("div",{className:"error-card-icon-container",children:(0,Ze.jsx)("img",{className:"error-card-icon",src:ui,alt:"error icon"})}),(0,Ze.jsxs)("div",{className:"error-card-text-container",children:[(0,Ze.jsx)("h2",{className:"error-card-heading",children:"An error has occurred: "}),(0,Ze.jsx)("h3",{className:"error-card-message",children:r.message})]})]})})}const pi=JSON.parse('{"v":"4.6.9","fr":29.9700012207031,"ip":0,"op":330.000013441176,"w":800,"h":600,"nm":"Finding Location","ddd":0,"assets":[],"fonts":{"list":[{"fName":"Gotham-Medium","fFamily":"Gotham","fStyle":"Medium","ascent":72.9995727539062}]},"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Shape Layer 10","ks":{"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":190,"s":[0],"e":[100]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":205,"s":[100],"e":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":270,"s":[100],"e":[0]},{"t":300.00001221925}]},"r":{"a":0,"k":0},"p":{"a":0,"k":[400.25,301.25,0]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":190,"s":[{"i":[[47.262,-15.098],[0,0],[-25.855,-8.344],[0,0],[0,0],[-15.098,32.115],[0,0]],"o":[[0,0],[-40.855,20.288],[0,0],[0,0],[17.032,36.078],[0,0],[12.052,-25.565]],"v":[[36.988,-88.902],[-63.584,-44.051],[-62.622,33.081],[-39.261,42.81],[-29.532,66.172],[47.598,67.135],[92.448,-33.435]],"c":true}],"e":[{"i":[[18.478,-7.877],[0,0],[-18.53,-8.459],[0,0],[0,0],[-10.627,20.643],[0,0]],"o":[[0,0],[-16.077,7.064],[0,0],[0,0],[4.603,13.627],[0,0],[7.629,-18.147]],"v":[[41.293,-70.863],[-59.277,-26.012],[-58.783,13.469],[-27.624,26.447],[-14.645,57.613],[24.835,58.097],[69.684,-42.467]],"c":true}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":205,"s":[{"i":[[18.478,-7.877],[0,0],[-18.53,-8.459],[0,0],[0,0],[-10.627,20.643],[0,0]],"o":[[0,0],[-16.077,7.064],[0,0],[0,0],[4.603,13.627],[0,0],[7.629,-18.147]],"v":[[41.293,-70.863],[-59.277,-26.012],[-58.783,13.469],[-27.624,26.447],[-14.645,57.613],[24.835,58.097],[69.684,-42.467]],"c":true}],"e":[{"i":[[18.478,-7.877],[0,0],[-18.53,-8.459],[0,0],[0,0],[-10.627,20.643],[0,0]],"o":[[0,0],[-16.077,7.064],[0,0],[0,0],[4.603,13.627],[0,0],[7.629,-18.147]],"v":[[41.293,-70.863],[-59.277,-26.012],[-58.783,13.469],[-27.624,26.447],[-14.645,57.613],[24.835,58.097],[69.684,-42.467]],"c":true}]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":270,"s":[{"i":[[18.478,-7.877],[0,0],[-18.53,-8.459],[0,0],[0,0],[-10.627,20.643],[0,0]],"o":[[0,0],[-16.077,7.064],[0,0],[0,0],[4.603,13.627],[0,0],[7.629,-18.147]],"v":[[41.293,-70.863],[-59.277,-26.012],[-58.783,13.469],[-27.624,26.447],[-14.645,57.613],[24.835,58.097],[69.684,-42.467]],"c":true}],"e":[{"i":[[47.262,-15.098],[0,0],[-25.855,-8.344],[0,0],[0,0],[-15.098,32.115],[0,0]],"o":[[0,0],[-40.855,20.288],[0,0],[0,0],[17.032,36.078],[0,0],[12.052,-25.565]],"v":[[36.988,-88.902],[-63.584,-44.051],[-62.622,33.081],[-39.261,42.81],[-29.532,66.172],[47.598,67.135],[92.448,-33.435]],"c":true}]},{"t":300.00001221925}]},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"st","c":{"a":0,"k":[0.105882,0.105882,0.105882,1]},"o":{"a":0,"k":100},"w":{"a":0,"k":9},"lc":1,"lj":1,"ml":4,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"tm","s":{"a":0,"k":0,"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":-20,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":2,"ty":5,"nm":"Lost","ks":{"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":270,"s":[0],"e":[25]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":280,"s":[25],"e":[25]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":320,"s":[25],"e":[0]},{"t":330.000013441176}]},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":270,"s":[470,474.363,0],"e":[470,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":280,"s":[470,444.363,0],"e":[470,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":320,"s":[470,444.363,0],"e":[470,414.363,0],"to":[0,0,0],"ti":[0,0,0]},{"t":330.000013441176}]},"a":{"a":0,"k":[0.117,-19.637,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"t":{"d":{"k":[{"s":{"s":30,"f":"Gotham-Medium","t":"Lost","j":2,"tr":0,"lh":36,"ls":20,"fc":[0.11,0.11,0.11]},"t":0}]},"p":{},"m":{"g":1,"a":{"a":0,"k":[0,0]}},"a":[]},"ip":137.000005580124,"op":587.000023909,"st":137.000005580124,"bm":0,"sr":1},{"ddd":0,"ind":3,"ty":5,"nm":"Found","ks":{"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":190,"s":[0],"e":[100]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":200,"s":[100],"e":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":270,"s":[100],"e":[0]},{"t":280.000011404634}]},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":190,"s":[590,444.363,0],"e":[470,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":200,"s":[470,444.363,0],"e":[470,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":270,"s":[470,444.363,0],"e":[470,414.363,0],"to":[0,0,0],"ti":[0,0,0]},{"t":280.000011404634}]},"a":{"a":0,"k":[0.117,-19.637,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"t":{"d":{"k":[{"s":{"s":30,"f":"Gotham-Medium","t":"Found","j":2,"tr":0,"lh":36,"ls":20,"fc":[0.11,0.11,0.11]},"t":0}]},"p":{},"m":{"g":1,"a":{"a":0,"k":[0,0]}},"a":[]},"ip":57.0000023216576,"op":507.000020650533,"st":57.0000023216576,"bm":0,"sr":1},{"ddd":0,"ind":4,"ty":4,"nm":"Shape Layer 11","td":1,"ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":0,"s":[400,330,0],"e":[399.976,298.89,0],"to":[0,-0.31353041529655,0],"ti":[0.01543623209,0.42409509420395,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":10,"s":[399.976,298.89,0],"e":[400,300,0],"to":[-0.23073178529739,-6.33912563323975,0],"ti":[-2.03080344200134,4.68646955490112,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":270,"s":[400,300,0],"e":[413,300,0],"to":[2.16666674613953,-5,0],"ti":[-2.16666674613953,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":280,"s":[413,300,0],"e":[413,300,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":320,"s":[413,300,0],"e":[413,270,0],"to":[0,-5,0],"ti":[0,5,0]},{"t":330.000013441176}]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"ty":"rc","d":1,"s":{"a":0,"k":[253.738,47.785]},"p":{"a":0,"k":[0,0]},"r":{"a":0,"k":0},"nm":"Rectangle Path 1","mn":"ADBE Vector Shape - Rect"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[-1.131,134.893],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Rectangle 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":5,"ty":5,"nm":"Finding Location ","tt":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":0,"s":[0],"e":[25]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":10,"s":[25],"e":[25]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":190,"s":[25],"e":[100]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":200,"s":[100],"e":[100]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":270,"s":[100],"e":[25]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":280,"s":[25],"e":[25]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0_1_0p167_0p167"],"t":320,"s":[25],"e":[0]},{"t":330.000013441176}]},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":0,"s":[400,474.363,0],"e":[400,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":10,"s":[400,444.363,0],"e":[400,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":190,"s":[400,444.363,0],"e":[285,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":200,"s":[285,444.363,0],"e":[285,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":270,"s":[285,444.363,0],"e":[298,444.363,0],"to":[0,0,0],"ti":[-2.16666674613953,0,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":280,"s":[298,444.363,0],"e":[298,444.363,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0,"y":1},"o":{"x":0.167,"y":0.167},"n":"0_1_0p167_0p167","t":320,"s":[298,444.363,0],"e":[298,414.363,0],"to":[0,-5,0],"ti":[0,5,0]},{"t":330.000013441176}]},"a":{"a":0,"k":[0.117,-19.637,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"t":{"d":{"k":[{"s":{"s":30,"f":"Gotham-Medium","t":"Finding Location","j":2,"tr":0,"lh":36,"ls":20,"fc":[0.11,0.11,0.11]},"t":0}]},"p":{},"m":{"g":1,"a":{"a":0,"k":[0,0]}},"a":[]},"ip":-133.000005417201,"op":450.000018328876,"st":-133.000005417201,"bm":0,"sr":1},{"ddd":0,"ind":6,"ty":4,"nm":"Shape Layer 1","ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[410,293,0]},"a":{"a":0,"k":[10,-7,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[1.675,-0.747],[0,0],[-1.62,-0.674],[0,0],[0,0],[-0.715,1.602],[0,0]],"o":[[0,0],[-1.602,0.715],[0,0],[0,0],[0.674,1.62],[0,0],[0.747,-1.675]],"v":[[49.39,-52.032],[-51.176,-7.182],[-51.131,-3.509],[-12.555,12.555],[3.509,51.131],[7.182,51.176],[52.032,-49.39]],"c":true}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"st","c":{"a":0,"k":[0.105882,0.105882,0.105882,1]},"o":{"a":0,"k":100},"w":{"a":0,"k":9},"lc":1,"lj":1,"ml":4,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":7,"ty":4,"nm":"Shape Layer 8","ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0p667_1_0p333_0"],"t":130,"s":[5],"e":[10]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0_1_0p333_0"],"t":145,"s":[10],"e":[0]},{"t":190.000007738859}]},"r":{"a":0,"k":0},"p":{"a":0,"k":[383.715,289.715,0]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0.167,0.167],"y":[0.167,0.167]},"n":["0_1_0p167_0p167","0_1_0p167_0p167"],"t":130,"s":[38.57,38.57],"e":[350,350]},{"t":190.000007738859}]},"p":{"a":0,"k":[0,0]},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":75},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[24.285,4.285],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":8,"ty":4,"nm":"Shape Layer 7","ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0p667_1_0p333_0"],"t":105,"s":[5],"e":[10]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0_1_0p333_0"],"t":120,"s":[10],"e":[0]},{"t":165.000006720588}]},"r":{"a":0,"k":0},"p":{"a":0,"k":[383.715,289.715,0]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0.167,0.167],"y":[0.167,0.167]},"n":["0_1_0p167_0p167","0_1_0p167_0p167"],"t":105,"s":[38.57,38.57],"e":[350,350]},{"t":165.000006720588}]},"p":{"a":0,"k":[0,0]},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":75},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[24.285,4.285],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":9,"ty":4,"nm":"Shape Layer 6","ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0p667_1_0p333_0"],"t":25,"s":[5],"e":[10]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0_1_0p333_0"],"t":40,"s":[10],"e":[0]},{"t":85.000003462121}]},"r":{"a":0,"k":0},"p":{"a":0,"k":[383.715,289.715,0]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0.167,0.167],"y":[0.167,0.167]},"n":["0_1_0p167_0p167","0_1_0p167_0p167"],"t":25,"s":[38.57,38.57],"e":[350,350]},{"t":85.000003462121}]},"p":{"a":0,"k":[0,0]},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":75},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[24.285,4.285],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":10,"ty":4,"nm":"Shape Layer 5","ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0p667_1_0p333_0"],"t":0,"s":[5],"e":[10]},{"i":{"x":[0],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0_1_0p333_0"],"t":15,"s":[10],"e":[0]},{"t":60.0000024438501}]},"r":{"a":0,"k":0},"p":{"a":0,"k":[383.715,289.715,0]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":1,"k":[{"i":{"x":[0,0],"y":[1,1]},"o":{"x":[0.167,0.167],"y":[0.167,0.167]},"n":["0_1_0p167_0p167","0_1_0p167_0p167"],"t":0,"s":[38.57,38.57],"e":[350,350]},{"t":60.0000024438501}]},"p":{"a":0,"k":[0,0]},"nm":"Ellipse Path 1","mn":"ADBE Vector Shape - Ellipse"},{"ty":"fl","c":{"a":0,"k":[0.1058824,0.1058824,0.1058824,1]},"o":{"a":0,"k":75},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[24.285,4.285],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Ellipse 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":450.000018328876,"st":0,"bm":0,"sr":1}],"chars":[{"ch":"F","size":30,"style":"Medium","w":65.6,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[9.064,0],[21.451,0],[21.451,-28.702],[57.001,-28.702],[57.001,-39.981],[21.451,-39.981],[21.451,-59.216],[61.533,-59.216],[61.533,-70.496],[9.064,-70.496]],"o":[[9.064,0],[21.451,0],[21.451,-28.702],[57.001,-28.702],[57.001,-39.981],[21.451,-39.981],[21.451,-59.216],[61.533,-59.216],[61.533,-70.496],[9.064,-70.496]],"v":[[9.064,0],[21.451,0],[21.451,-28.702],[57.001,-28.702],[57.001,-39.981],[21.451,-39.981],[21.451,-59.216],[61.533,-59.216],[61.533,-70.496],[9.064,-70.496]],"c":true}},"nm":"F","mn":"ADBE Vector Shape - Group"}],"nm":"F","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[74.663,0],[87.05,0],[87.05,-28.702],[122.6,-28.702],[122.6,-39.981],[87.05,-39.981],[87.05,-59.216],[127.132,-59.216],[127.132,-70.496],[74.663,-70.496]],"c":true}},"nm":"F","mn":"ADBE Vector Shape - Group"}],"nm":"F","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"i","size":30,"style":"Medium","w":28.6,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[7.855,-61.331],[20.947,-61.331],[20.947,-72.913],[7.855,-72.913]],"o":[[7.855,-61.331],[20.947,-61.331],[20.947,-72.913],[7.855,-72.913]],"v":[[7.855,-61.331],[20.947,-61.331],[20.947,-72.913],[7.855,-72.913]],"c":true}},"nm":"i","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[8.359,0],[20.544,0],[20.544,-53.174],[8.359,-53.174]],"o":[[8.359,0],[20.544,0],[20.544,-53.174],[8.359,-53.174]],"v":[[8.359,0],[20.544,0],[20.544,-53.174],[8.359,-53.174]],"c":true}},"nm":"i","mn":"ADBE Vector Shape - Group"}],"nm":"i","np":5,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[36.455,-61.331],[49.547,-61.331],[49.547,-72.913],[36.455,-72.913]],"c":true}},"nm":"i","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[36.958,0],[49.144,0],[49.144,-53.174],[36.958,-53.174]],"c":true}},"nm":"i","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"}],"nm":"i","np":5,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"n","size":30,"style":"Medium","w":62,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[7.654,0],[19.839,0],[19.839,-30.011],[24.774,-43.204],[43.204,-38.47],[43.204,0],[55.389,0],[55.389,-33.939],[48.44,-54.282],[23.263,-49.951],[19.839,-53.174],[7.654,-53.174]],"o":[[7.654,0],[19.839,0],[19.839,-38.269],[39.075,-43.204],[43.204,-30.212],[43.204,0],[55.389,0],[55.389,-46.225],[28.198,-54.282],[19.839,-45.016],[19.839,-53.174],[7.654,-53.174]],"v":[[7.654,0],[19.839,0],[19.839,-30.011],[31.824,-43.204],[43.204,-30.212],[43.204,0],[55.389,0],[55.389,-33.939],[36.456,-54.282],[19.839,-45.016],[19.839,-53.174],[7.654,-53.174]],"c":true}},"nm":"n","mn":"ADBE Vector Shape - Group"}],"nm":"n","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[-7.05,0],[0,-8.258],[0,0],[0,0],[0,0],[11.984,0],[3.424,-4.935],[0,0],[0,0]],"o":[[0,0],[0,0],[0,-8.258],[7.251,0],[0,0],[0,0],[0,0],[0,-12.286],[-8.258,0],[0,0],[0,0],[0,0]],"v":[[69.653,0],[81.839,0],[81.839,-30.011],[93.823,-43.204],[105.203,-30.212],[105.203,0],[117.389,0],[117.389,-33.939],[98.456,-54.282],[81.839,-45.016],[81.839,-53.174],[69.653,-53.174]],"c":true}},"nm":"n","mn":"ADBE Vector Shape - Group"}],"nm":"n","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"d","size":30,"style":"Medium","w":67.1,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[17.12,1.108],[43.808,-3.323],[47.736,0],[59.921,0],[59.921,-73.517],[47.736,-73.517],[47.736,-44.916],[38.37,-54.282],[4.935,-44.312],[4.935,-26.486]],"o":[[38.269,1.108],[47.736,-8.862],[47.736,0],[59.921,0],[59.921,-73.517],[47.736,-73.517],[43.909,-49.951],[16.919,-54.282],[4.935,-26.688],[4.935,-8.862]],"v":[[29.608,1.108],[47.736,-8.862],[47.736,0],[59.921,0],[59.921,-73.517],[47.736,-73.517],[47.736,-44.916],[29.608,-54.282],[4.935,-26.688],[4.935,-26.486]],"c":true}},"nm":"d","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[40.686,-9.467],[17.221,-16.214],[17.221,-26.688],[24.17,-43.707],[47.937,-36.96],[47.937,-26.486]],"o":[[24.271,-9.467],[17.221,-26.486],[17.221,-37.262],[40.686,-43.707],[47.937,-26.688],[47.937,-16.314]],"v":[[32.529,-9.467],[17.221,-26.486],[17.221,-26.688],[32.529,-43.707],[47.937,-26.688],[47.937,-26.486]],"c":true}},"nm":"d","mn":"ADBE Vector Shape - Group"}],"nm":"d","np":5,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-12.488,0],[-3.928,5.539],[0,0],[0,0],[0,0],[0,0],[0,0],[8.762,0],[0,-17.624],[0,0]],"o":[[8.661,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-3.827,-5.035],[-12.689,0],[0,0],[0,17.624]],"v":[[96.707,1.108],[114.835,-8.862],[114.835,0],[127.02,0],[127.02,-73.517],[114.835,-73.517],[114.835,-44.916],[96.707,-54.282],[72.034,-26.688],[72.034,-26.486]],"c":true}},"nm":"d","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[8.157,0],[0,10.272],[0,0],[-8.359,0],[0,-10.272],[0,0]],"o":[[-8.258,0],[0,0],[0,-10.574],[8.157,0],[0,0],[0,10.172]],"v":[[99.628,-9.467],[84.32,-26.486],[84.32,-26.688],[99.628,-43.707],[115.036,-26.688],[115.036,-26.486]],"c":true}},"nm":"d","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"}],"nm":"d","np":5,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"g","size":30,"style":"Medium","w":67.1,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[22.558,16.315],[48.34,13.998],[59.921,-1.913],[59.921,-53.174],[47.736,-53.174],[47.736,-45.218],[38.068,-54.282],[4.935,-45.016],[4.935,-29.105],[16.617,-4.23],[43.405,-8.258],[47.836,-9.869],[41.894,6.445],[17.825,4.331],[7.553,9.97]],"o":[[40.887,16.315],[57.605,4.733],[59.921,-10.876],[59.921,-53.174],[47.736,-53.174],[43.607,-50.153],[16.718,-54.282],[4.935,-29.306],[4.935,-13.495],[37.867,-4.23],[47.836,-13.998],[47.836,0.806],[23.767,6.445],[12.085,0.806],[14.401,14.099]],"v":[[31.32,16.315],[53.174,9.164],[59.921,-10.876],[59.921,-53.174],[47.736,-53.174],[47.736,-45.218],[29.105,-54.282],[4.935,-29.306],[4.935,-29.105],[29.105,-4.23],[47.836,-13.998],[47.836,-9.869],[31.018,6.445],[12.085,0.806],[7.553,9.97]],"c":true}},"nm":"g","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[40.786,-14.603],[17.221,-20.544],[17.221,-29.407],[23.868,-44.009],[47.937,-38.068],[47.937,-29.205]],"o":[[23.968,-14.603],[17.221,-29.205],[17.221,-38.169],[40.786,-44.009],[47.937,-29.407],[47.937,-20.544]],"v":[[32.327,-14.603],[17.221,-29.205],[17.221,-29.407],[32.327,-44.009],[47.937,-29.407],[47.937,-29.205]],"c":true}},"nm":"g","mn":"ADBE Vector Shape - Group"}],"nm":"g","np":5,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-8.762,0],[-4.834,4.834],[0,8.963],[0,0],[0,0],[0,0],[8.963,0],[0,-15.71],[0,0],[-12.488,0],[-4.431,5.74],[0,0],[10.876,0],[5.74,3.525],[0,0]],"o":[[9.567,0],[4.431,-4.431],[0,0],[0,0],[0,0],[-4.129,-4.935],[-12.387,0],[0,0],[0,15.61],[8.762,0],[0,0],[0,10.675],[-7.251,0],[0,0],[6.848,4.129]],"v":[[98.419,16.315],[120.273,9.164],[127.02,-10.876],[127.02,-53.174],[114.835,-53.174],[114.835,-45.218],[96.204,-54.282],[72.034,-29.306],[72.034,-29.105],[96.204,-4.23],[114.935,-13.998],[114.935,-9.869],[98.117,6.445],[79.184,0.806],[74.652,9.97]],"c":true}},"nm":"g","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[8.459,0],[0,8.661],[0,0],[-8.459,0],[0,-8.661],[0,0]],"o":[[-8.359,0],[0,0],[0,-8.762],[8.459,0],[0,0],[0,8.661]],"v":[[99.426,-14.603],[84.32,-29.205],[84.32,-29.407],[99.426,-44.009],[115.036,-29.407],[115.036,-29.205]],"c":true}},"nm":"g","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"}],"nm":"g","np":5,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":" ","size":30,"style":"Medium","w":30,"data":{},"fFamily":"Gotham"},{"ch":"L","size":30,"style":"Medium","w":61.9,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[9.064,0],[58.511,0],[58.511,-11.279],[21.451,-11.279],[21.451,-70.496],[9.064,-70.496]],"o":[[9.064,0],[58.511,0],[58.511,-11.279],[21.451,-11.279],[21.451,-70.496],[9.064,-70.496]],"v":[[9.064,0],[58.511,0],[58.511,-11.279],[21.451,-11.279],[21.451,-70.496],[9.064,-70.496]],"c":true}},"nm":"L","mn":"ADBE Vector Shape - Group"}],"nm":"L","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"v":[[70.963,0],[120.41,0],[120.41,-11.279],[83.35,-11.279],[83.35,-70.496],[70.963,-70.496]],"c":true}},"nm":"L","mn":"ADBE Vector Shape - Group"}],"nm":"L","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"o","size":30,"style":"Medium","w":65.7,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[16.718,1.208],[61.432,-11.38],[61.432,-26.688],[49.448,-54.282],[4.733,-41.693],[4.733,-26.285]],"o":[[49.347,1.208],[61.432,-26.486],[61.432,-41.895],[16.818,-54.282],[4.733,-26.486],[4.733,-11.179]],"v":[[32.932,1.208],[61.432,-26.486],[61.432,-26.688],[33.133,-54.282],[4.733,-26.486],[4.733,-26.285]],"c":true}},"nm":"o","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[43.002,-9.467],[16.919,-17.221],[16.919,-26.688],[23.163,-43.607],[49.246,-35.852],[49.246,-26.285]],"o":[[23.666,-9.467],[16.919,-26.486],[16.919,-35.953],[42.499,-43.607],[49.246,-26.486],[49.246,-17.121]],"v":[[33.133,-9.467],[16.919,-26.486],[16.919,-26.688],[32.932,-43.607],[49.246,-26.486],[49.246,-26.285]],"c":true}},"nm":"o","mn":"ADBE Vector Shape - Group"}],"nm":"o","np":5,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-16.214,0],[0,15.106],[0,0],[16.315,0],[0,-15.207],[0,0]],"o":[[16.415,0],[0,0],[0,-15.207],[-16.315,0],[0,0],[0,15.106]],"v":[[98.631,1.208],[127.132,-26.486],[127.132,-26.688],[98.833,-54.282],[70.433,-26.486],[70.433,-26.285]],"c":true}},"nm":"o","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[9.869,0],[0,9.265],[0,0],[-9.769,0],[0,-9.366],[0,0]],"o":[[-9.467,0],[0,0],[0,-9.265],[9.567,0],[0,0],[0,9.164]],"v":[[98.833,-9.467],[82.619,-26.486],[82.619,-26.688],[98.631,-43.607],[114.946,-26.486],[114.946,-26.285]],"c":true}},"nm":"o","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"}],"nm":"o","np":5,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"c","size":30,"style":"Medium","w":55.6,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[16.416,1.208],[48.742,-2.921],[46.628,-16.013],[38.571,-9.467],[16.919,-17.019],[16.919,-26.688],[23.465,-43.607],[42.298,-40.888],[53.677,-45.117],[42.398,-54.282],[4.733,-41.592],[4.733,-26.285]],"o":[[42.6,1.208],[53.979,-8.762],[42.801,-12.085],[23.465,-9.467],[16.919,-26.486],[16.919,-35.953],[38.369,-43.607],[46.024,-36.96],[48.642,-50.555],[16.415,-54.282],[4.733,-26.486],[4.733,-11.179]],"v":[[32.227,1.208],[53.979,-8.762],[46.628,-16.013],[32.831,-9.467],[16.919,-26.486],[16.919,-26.688],[32.327,-43.607],[46.024,-36.96],[53.677,-45.117],[32.428,-54.282],[4.733,-26.486],[4.733,-26.285]],"c":true}},"nm":"c","mn":"ADBE Vector Shape - Group"}],"nm":"c","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-15.811,0],[-5.237,5.841],[0,0],[5.74,0],[0,9.467],[0,0],[-8.862,0],[-3.726,-3.928],[0,0],[9.97,0],[0,-15.106],[0,0]],"o":[[10.373,0],[0,0],[-3.827,3.928],[-9.366,0],[0,0],[0,-9.265],[6.042,0],[0,0],[-5.035,-5.438],[-16.013,0],[0,0],[0,15.106]],"v":[[87.827,1.208],[109.579,-8.762],[102.228,-16.013],[88.431,-9.467],[72.519,-26.486],[72.519,-26.688],[87.927,-43.607],[101.624,-36.96],[109.277,-45.117],[88.028,-54.282],[60.333,-26.486],[60.333,-26.285]],"c":true}},"nm":"c","mn":"ADBE Vector Shape - Group"}],"nm":"c","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"a","size":30,"style":"Medium","w":58.7,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[12.991,1.108],[36.658,-2.317],[40.283,0],[52.167,0],[52.167,-31.522],[50.354,-44.11],[36.758,-53.879],[14.603,-52.166],[11.984,-39.981],[21.249,-43.304],[40.384,-39.276],[40.384,-30.414],[32.025,-32.629],[4.129,-26.99],[4.129,-15.308]],"o":[[31.118,1.108],[40.283,-6.647],[40.283,0],[52.167,0],[52.167,-38.471],[42.7,-51.764],[20.343,-53.879],[8.762,-49.548],[16.818,-41.995],[35.751,-43.304],[40.384,-31.723],[36.255,-31.723],[13.092,-32.629],[4.129,-15.509],[4.129,-4.633]],"v":[[22.961,1.108],[40.283,-6.647],[40.283,0],[52.167,0],[52.167,-31.522],[46.426,-47.937],[28.802,-53.879],[8.762,-49.548],[11.984,-39.981],[27.191,-43.304],[40.384,-31.723],[40.384,-30.414],[26.083,-32.629],[4.129,-15.509],[4.129,-15.308]],"c":true}},"nm":"a","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[34.442,-7.755],[16.013,-10.675],[16.013,-16.013],[20.645,-24.875],[37.463,-23.968],[40.585,-19.135]],"o":[[20.544,-7.755],[16.013,-15.811],[16.013,-21.552],[33.334,-24.875],[40.585,-22.76],[40.585,-12.388]],"v":[[26.385,-7.755],[16.013,-15.811],[16.013,-16.013],[28.5,-24.875],[40.585,-22.76],[40.585,-19.135]],"c":true}},"nm":"a","mn":"ADBE Vector Shape - Group"}],"nm":"a","np":5,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-9.97,0],[-3.625,4.33],[0,0],[0,0],[0,0],[3.928,3.827],[7.956,0],[5.841,-2.618],[0,0],[-5.942,0],[0,-7.553],[0,0],[5.942,0],[0,-11.481],[0,0]],"o":[[8.157,0],[0,0],[0,0],[0,0],[0,-6.949],[-3.726,-3.827],[-8.459,0],[0,0],[4.834,-2.014],[8.56,0],[0,0],[-4.129,-1.309],[-12.991,0],[0,0],[0,10.675]],"v":[[81.66,1.108],[98.982,-6.647],[98.982,0],[110.866,0],[110.866,-31.522],[105.125,-47.937],[87.502,-53.879],[67.461,-49.548],[70.683,-39.981],[85.89,-43.304],[99.083,-31.723],[99.083,-30.414],[84.782,-32.629],[62.828,-15.509],[62.828,-15.308]],"c":true}},"nm":"a","mn":"ADBE Vector Shape - Group"},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[8.057,0],[0,5.136],[0,0],[-7.855,0],[-3.122,-1.208],[0,0]],"o":[[-5.841,0],[0,0],[0,-5.539],[4.834,0],[0,0],[0,6.747]],"v":[[85.085,-7.755],[74.712,-15.811],[74.712,-16.013],[87.199,-24.875],[99.284,-22.76],[99.284,-19.135]],"c":true}},"nm":"a","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"}],"nm":"a","np":5,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"t","size":30,"style":"Medium","w":41.1,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[16.516,0.906],[33.435,-0.101],[36.456,-11.783],[31.622,-9.97],[22.357,-11.884],[22.357,-42.7],[36.658,-42.7],[36.658,-53.174],[22.357,-53.174],[22.357,-67.776],[10.172,-67.776],[10.172,-53.174],[3.424,-53.174],[3.424,-42.7],[10.172,-42.7],[10.172,-14.703]],"o":[[30.112,0.906],[36.456,-1.813],[34.039,-10.575],[24.774,-9.97],[22.357,-16.617],[22.357,-42.7],[36.658,-42.7],[36.658,-53.174],[22.357,-53.174],[22.357,-67.776],[10.172,-67.776],[10.172,-53.174],[3.424,-53.174],[3.424,-42.7],[10.172,-42.7],[10.172,-3.021]],"v":[[25.479,0.906],[36.456,-1.813],[36.456,-11.783],[28.903,-9.97],[22.357,-16.617],[22.357,-42.7],[36.658,-42.7],[36.658,-53.174],[22.357,-53.174],[22.357,-67.776],[10.172,-67.776],[10.172,-53.174],[3.424,-53.174],[3.424,-42.7],[10.172,-42.7],[10.172,-14.703]],"c":true}},"nm":"t","mn":"ADBE Vector Shape - Group"}],"nm":"t","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-8.963,0],[-3.021,1.712],[0,0],[2.719,0],[0,4.733],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],"o":[[4.633,0],[0,0],[-2.417,1.208],[-4.129,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,11.682]],"v":[[66.579,0.906],[77.556,-1.813],[77.556,-11.783],[70.003,-9.97],[63.457,-16.617],[63.457,-42.7],[77.757,-42.7],[77.757,-53.174],[63.457,-53.174],[63.457,-67.776],[51.271,-67.776],[51.271,-53.174],[44.524,-53.174],[44.524,-42.7],[51.271,-42.7],[51.271,-14.703]],"c":true}},"nm":"t","mn":"ADBE Vector Shape - Group"}],"nm":"t","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"u","size":30,"style":"Medium","w":62,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[13.999,1.108],[39.175,-3.223],[42.599,0],[54.886,0],[54.886,-53.174],[42.599,-53.174],[42.599,-23.163],[37.665,-10.071],[19.235,-14.703],[19.235,-53.174],[7.05,-53.174],[7.05,-19.336]],"o":[[34.241,1.108],[42.599,-8.258],[42.599,0],[54.886,0],[54.886,-53.174],[42.599,-53.174],[42.599,-14.905],[23.364,-10.071],[19.235,-22.961],[19.235,-53.174],[7.05,-53.174],[7.05,-6.949]],"v":[[25.983,1.108],[42.599,-8.258],[42.599,0],[54.886,0],[54.886,-53.174],[42.599,-53.174],[42.599,-23.163],[30.615,-10.071],[19.235,-22.961],[19.235,-53.174],[7.05,-53.174],[7.05,-19.336]],"c":true}},"nm":"u","mn":"ADBE Vector Shape - Group"}],"nm":"u","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-11.984,0],[-3.424,5.035],[0,0],[0,0],[0,0],[0,0],[0,0],[7.05,0],[0,8.258],[0,0],[0,0],[0,0]],"o":[[8.258,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,8.258],[-7.251,0],[0,0],[0,0],[0,0],[0,12.387]],"v":[[87.982,1.108],[104.599,-8.258],[104.599,0],[116.885,0],[116.885,-53.174],[104.599,-53.174],[104.599,-23.163],[92.615,-10.071],[81.235,-22.961],[81.235,-53.174],[69.049,-53.174],[69.049,-19.336]],"c":true}},"nm":"u","mn":"ADBE Vector Shape - Group"}],"nm":"u","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"},{"ch":"s","size":30,"style":"Medium","w":49.1,"data":{"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[18.329,1.007],[45.621,-4.531],[45.621,-15.912],[36.86,-29.004],[17.12,-35.046],[17.12,-39.175],[19.84,-44.412],[34.442,-42.499],[44.412,-48.038],[31.522,-54.08],[5.942,-47.937],[5.942,-37.665],[14.704,-24.271],[34.442,-18.732],[34.442,-14.401],[31.421,-8.661],[14.603,-10.877],[3.323,-6.949]],"o":[[36.96,1.007],[45.621,-15.71],[45.621,-25.479],[22.861,-33.435],[17.12,-38.974],[17.12,-42.196],[29.004,-44.412],[39.578,-39.377],[38.772,-51.764],[14.301,-54.08],[5.942,-37.866],[5.942,-27.493],[28.803,-20.142],[34.442,-14.603],[34.442,-10.876],[20.746,-8.661],[8.762,-15.207],[9.97,-1.712]],"v":[[25.882,1.007],[45.621,-15.71],[45.621,-15.912],[29.105,-31.421],[17.12,-38.974],[17.12,-39.175],[24.573,-44.412],[39.578,-39.377],[44.412,-48.038],[24.875,-54.08],[5.942,-37.866],[5.942,-37.665],[22.559,-22.055],[34.442,-14.603],[34.442,-14.401],[26.184,-8.661],[8.762,-15.207],[3.323,-6.949]],"c":true}},"nm":"s","mn":"ADBE Vector Shape - Group"}],"nm":"s","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-7.553,0],[0,11.179],[0,0],[7.755,2.417],[0,3.928],[0,0],[-4.733,0],[-5.136,-3.122],[0,0],[6.647,0],[0,-10.071],[0,0],[-7.855,-2.216],[0,-4.129],[0,0],[5.237,0],[5.841,4.33],[0,0]],"o":[[11.078,0],[0,0],[0,-9.567],[-6.244,-2.014],[0,0],[0,-3.021],[4.431,0],[0,0],[-5.64,-3.726],[-10.574,0],[0,0],[0,10.172],[6.244,1.913],[0,0],[0,3.525],[-5.438,0],[0,0],[6.647,5.237]],"v":[[74.982,1.007],[94.72,-15.71],[94.72,-15.912],[78.204,-31.421],[66.22,-38.974],[66.22,-39.175],[73.672,-44.412],[88.678,-39.377],[93.512,-48.038],[73.975,-54.08],[55.042,-37.866],[55.042,-37.665],[71.658,-22.055],[83.542,-14.603],[83.542,-14.401],[75.284,-8.661],[57.861,-15.207],[52.423,-6.949]],"c":true}},"nm":"s","mn":"ADBE Vector Shape - Group"}],"nm":"s","np":3,"cix":2,"ix":2,"mn":"ADBE Vector Group"}]},"fFamily":"Gotham"}]}');function fi(){const[t,i]=(0,e.useState)(!1),[r,n]=(0,e.useState)(!1),a=()=>{i(!0),setTimeout((()=>{i(!1)}),8e3)};return(0,e.useEffect)((()=>{n(!0),a()}),[]),(0,Ze.jsxs)("div",{className:"finding-location-root "+(r?"finding-location-root-shown ":"")+(t?"":"finding-location-root-hide-text "),onClick:a,children:[(0,Ze.jsx)("div",{className:"finding-location-lottie-container",children:(0,Ze.jsx)(We(),{className:"finding-location-lottie",animationData:pi,autoPlay:!0,width:50,height:50})}),(0,Ze.jsx)("h2",{className:"finding-location-text "+(t?"":"finding-location-text-hidden"),children:"Finding your location"})]})}var mi,gi,_i=__webpack_require__(507),yi=__webpack_require__.n(_i);function xi(t){let{set_user:i}=t;const r=[De.medical,De.fire,De.natural,De.security,De.weather],[n,a]=(0,e.useState)(!1),[o,s]=(0,e.useState)("none"),[l,c]=(0,e.useState)({first_names:"-",last_name:"-",student_staff_num:"-",gender:"-",dob:"-",age:"-",allergens:"-",first_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"},second_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"}}),[h,u]=(0,e.useState)(!1),[d,p]=(0,e.useState)(null),[f,m]=(0,e.useState)(null),[g,_]=(0,e.useState)(null),[y,x]=(0,e.useState)(null),[v,b]=(0,e.useState)(null),[w,S]=(0,e.useState)([]),[E,T]=(0,e.useState)(!1),[C,k]=(0,e.useState)(!1),{studentNumber:M}=(0,e.useContext)(li),[A,P]=(0,e.useState)(!1),[I,D]=(0,e.useState)(!1),R=K(),z=async()=>{if(M)try{const e=await async function(e){try{const t=(await fetch(`/users/user-information/${e}`).then((e=>e.json())))[0];return{first_names:t.FirstNames,last_name:t.LastNames,student_staff_num:t.StudentNumber,gender:t.Gender,dob:t.DateOfBirth,age:"-",allergens:t.Allergies,first_emergency_contact:{name:t.firstContactName,relationship:t.firstContactRelationship,cell:t.firstContactCellNumber,work:t.firstContactWorkNumber},second_emergency_contact:{name:t.secondContactName,relationship:t.secondContactRelationship,cell:t.secondContactCellNumber,work:t.secondContactWorkNumber}}}catch(v){return console.error("Error fetching profile:",v.message),{error:"Unable to fetch profile"}}}(M);e.error?(b({message:e.error}),c({first_names:"-",last_name:"-",student_staff_num:"-",gender:"-",dob:"-",age:"-",allergens:"-",first_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"},second_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"}}),u(!1),i(null)):(u(!0),c(e),i(M))}catch(v){console.error("Error fetching profile:",v.message),c({first_names:"-",last_name:"-",student_staff_num:"-",gender:"-",dob:"-",age:"-",allergens:"-",first_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"},second_emergency_contact:{name:"-",relationship:"-",cell:"-",work:"-"}}),u(!1),b({message:"Error fetching user profile."}),i(null)}else R("/")},L=async()=>{if(A){P(!1);(await Re()).then((e=>{S(e||[]),P(!0)})).catch((e=>{S([]),b({message:e}),P(!0)}))}};(0,e.useEffect)((()=>{const e=new EventSource("/alerts/pushalerts"),t=new EventSource("/incidents/pushalerts");return e.onmessage=async e=>{const t=JSON.parse(e.data),i=t.message.type;t.message.lng,t.message.lat;yi()({title:"Campus Safety",message:De[i].header,duration:5e3,icon:De[i].icon,native:!0,header:De[i].header,report:t.message}),_(t.message),L()},t.onmessage=e=>{const t=JSON.parse(e.data),i=t.message.type,r=t.message.description;yi()({title:"Campus Safety",message:De[i].header+": "+r,duration:5e3,icon:De[i].icon,native:!0,header:De[i].header,report:t.message}),_(t.message),L()},()=>{e.close(),t.close()}}),[C]);(0,e.useEffect)((()=>{z();Re().then((e=>{S(e||[]),P(!0)})).catch((e=>{S([]),b({message:e}),P(!0)}))}),[]);const F=()=>{s("none"),a(!1),m(null),p(null),T(!1)},B=()=>{s("none")},O=()=>{p(null),m(null)},N=e=>{p(null),m(e)};return(0,Ze.jsxs)("main",{className:"main-root",children:[null===d&&null===f?(0,Ze.jsx)(Ze.Fragment,{}):d?(0,Ze.jsx)(ri,{set_error:b,set_uploading_report:x,report_type:d,close_all_menus:F,close_menu:O}):f?(0,Ze.jsx)(si,{set_error:b,set_uploading_report:x,report_type:f,close_all_menus:F,close_menu:O}):void 0,I?(0,Ze.jsx)(Ze.Fragment,{}):(0,Ze.jsx)(fi,{}),v?(0,Ze.jsx)(di,{set_error:b,error:v}):(0,Ze.jsx)(Ze.Fragment,{}),y?(0,Ze.jsx)(hi,{report_type:y}):(0,Ze.jsx)(Ze.Fragment,{}),"none"===o?(0,Ze.jsx)(Ze.Fragment,{}):(()=>{switch(o){case"none":return(0,Ze.jsx)(Ze.Fragment,{});case"notifications":return(0,Ze.jsx)(Ft,{set_error:b,reports:w,close_all_menus:F,close_menu:B});case"incident_reports":return(0,Ze.jsx)(Bt,{set_error:b,reports:w,close_all_menus:F,close_menu:B});case"emergency_info":return(0,Ze.jsx)(Gt,{set_error:b,close_menu:B});case"first_aid":return(0,Ze.jsx)(Yt,{close_menu:B});case"medical_profile":return(0,Ze.jsx)(Kt,{set_error:b,get_user_profile:z,close_menu:B,profile:l});case"detailed_report":return(0,Ze.jsx)(ti,{set_error:b,set_detailed_report_menu:N,report_types_data:r,close_menu:B,profile:l});case"walk_home":return(0,Ze.jsxs)(Dt,{set_error:b,isOpen:!0,onClose:B,children:[" ",(0,Ze.jsx)("p",{children:"Walk-home assistance information goes here."})," "]});case"safety_resources":return(0,Ze.jsx)(oi,{set_error:b,close_menu:B})}})(),(0,Ze.jsx)(ft,{uploading_report:y,location_services_enabled:I,show_quickreports:E,set_show_quickreports:T,report_types_data:r,open_detailed_report_menu:()=>s("detailed_report"),set_confirmation_menu:e=>{p(e),m(null)}}),(0,Ze.jsx)(xt,{set_show_side_menu:a}),A?(0,Ze.jsx)(ht,{add_new_report:e=>{const t=w;t.push(e),S(t)},set_location_services_enabled:D,set_error:b,new_notification:g,set_new_notification:_,incident_reports:w}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsx)(Rt,{handle_signout:()=>{i(null),localStorage.removeItem("user"),R("/")},valid_profile:h,show_side_menu:n,set_current_menu:s,profile:l}),n?(0,Ze.jsx)("div",{className:"main-dark-back",onClick:F}):(0,Ze.jsx)(Ze.Fragment,{})]})}function vi(){return vi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},vi.apply(null,arguments)}function bi(t,i){let{title:r,titleId:n,...a}=t;return e.createElement("svg",vi({width:73,height:138,viewBox:"0 0 73 138",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:i,"aria-labelledby":n},a),r?e.createElement("title",{id:n},r):null,mi||(mi=e.createElement("g",{clipPath:"url(#clip0_1_9)"},e.createElement("path",{d:"M6.05368 94.8307C6.45698 95.6323 6.81887 96.3942 7.12197 97.2413C8.18613 98.9266 9.74283 99.7699 11.3951 100.846C13.1114 102.134 13.1114 102.134 13.5317 102.969C13.546 103.677 13.5472 104.385 13.5317 105.092C12.4321 105.717 12.0243 105.8 10.6829 105.8C12.8316 109.439 14.971 112.904 17.8049 116.062C18.0766 116.37 18.3484 116.678 18.6284 116.996C19.4117 117.874 20.2066 118.74 21.0098 119.6C21.2053 119.813 21.4009 120.027 21.6023 120.247C23.5575 122.295 25.8634 123.93 28.1317 125.615C28.4131 125.825 28.6945 126.035 28.9844 126.251C29.1731 126.392 29.3617 126.532 29.5561 126.677C29.3326 127.713 28.9913 128.574 28.4878 129.508C29.0743 129.76 29.6708 129.99 30.2683 130.215C30.5029 130.309 30.7374 130.402 30.9791 130.499C35.3232 132.035 39.6087 131.581 43.8 129.862C44.1526 129.745 44.5051 129.628 44.8683 129.508C44.6847 129.245 44.5011 128.982 44.3119 128.712C43.8 127.738 43.8 127.738 43.8167 127.071C44.3253 125.95 45.2448 125.401 46.2259 124.709C53.2106 119.572 58.2624 113.17 62.6732 105.8C62.2692 105.749 61.8653 105.698 61.4491 105.645C60.1805 105.446 60.1805 105.446 59.8244 105.092C59.6782 103.814 59.6868 103.172 60.4198 102.092C61.294 101.151 62.1215 100.585 63.2296 99.9394C65.1059 98.844 65.993 98.0643 66.657 95.9807C66.8003 95.4115 66.8003 95.4115 66.9464 94.8307C68.0147 95.5384 68.0147 95.5384 68.3708 96.6C68.3952 97.2704 68.401 97.9417 68.393 98.6125C68.3898 98.9642 68.3866 99.3158 68.3833 99.6782C68.3771 100.081 68.3771 100.081 68.3708 100.492C70.5826 99.3671 70.5826 99.3671 71.9317 97.374C72.0492 97.0018 72.1668 96.6296 72.2878 96.2461C73.1131 97.4039 73.0587 98.4045 72.8331 99.7777C72.2281 102.063 70.6076 103.163 68.7269 104.385C68.8995 106.029 68.8995 106.029 69.439 107.569C69.0161 108.455 68.5734 109.287 68.0814 110.135C67.9356 110.388 67.7898 110.641 67.6396 110.902C62.7786 119.198 56.2738 126.077 48.4293 131.631C48.7157 132.014 48.7157 132.014 49.0079 132.405C49.4976 133.4 49.4976 133.4 49.3056 134.337C48.1078 136.253 45.4814 136.928 43.3994 137.58C37.6301 138.87 30.5579 138.645 25.3275 135.7C24.5917 135.232 24.2781 134.947 23.9003 134.163C23.8409 133.077 24.3163 132.504 24.9268 131.631C24.6597 131.438 24.3925 131.245 24.1173 131.046C21.649 129.239 19.319 127.362 17.0927 125.262C16.9238 125.103 16.7549 124.945 16.5808 124.782C12.7901 121.21 9.76937 117.29 6.96618 112.921C6.78509 112.639 6.604 112.357 6.41742 112.067C5.42833 110.494 4.5492 108.964 3.91709 107.215C4.20642 106.441 4.20642 106.441 4.62929 105.8C4.62929 105.333 4.62929 104.866 4.62929 104.385C4.04396 103.8 4.04396 103.8 3.27166 103.323C1.89387 102.405 0.897665 101.629 0.504953 99.9712C0.47787 99.6688 0.450787 99.3664 0.422884 99.0548C0.391211 98.7515 0.359537 98.4481 0.326904 98.1356C0.356115 97.3077 0.356115 97.3077 1.06831 96.2461C1.14221 96.4341 1.21612 96.622 1.29226 96.8156C2.17348 98.8234 2.98727 99.5759 4.98538 100.492C4.97299 100.202 4.9606 99.9121 4.94783 99.6132C4.93819 99.2319 4.92855 98.8506 4.91862 98.4577C4.90622 98.08 4.89383 97.7023 4.88106 97.3132C4.99577 96.1399 5.26011 95.6835 6.05368 94.8307Z",fill:"white"}),e.createElement("path",{d:"M30.9805 39.9846C31.9719 40.4772 32.0413 41.1013 32.4049 42.1077C32.5793 41.7601 32.7538 41.4125 32.9335 41.0544C33.8293 39.9846 33.8293 39.9846 35.2147 39.7773C35.7326 39.7913 36.2503 39.8165 36.7671 39.8519C37.0324 39.8615 37.2977 39.8711 37.5711 39.8809C38.2235 39.9059 38.8753 39.944 39.5269 39.9846C39.9969 40.802 40.467 41.6194 40.9512 42.4615C41.3038 41.6442 41.6563 40.8268 42.0195 39.9846C42.3721 40.1598 42.3721 40.1598 42.7317 40.3385C42.9377 41.2007 42.9377 41.2007 43.1004 42.3358C43.1607 42.7433 43.2211 43.1509 43.2833 43.5708C43.3738 44.2149 43.3738 44.2149 43.4662 44.8721C43.5885 45.7149 43.7114 46.5576 43.8348 47.4002C43.9147 47.9638 43.9147 47.9638 43.9962 48.5389C44.128 49.3625 44.2911 50.1503 44.5122 50.9538C44.895 50.9644 44.895 50.9644 45.2854 50.9751C46.4374 51.0087 47.5891 51.0476 48.7409 51.0865C49.3434 51.103 49.3434 51.103 49.958 51.1197C50.5329 51.1402 50.5329 51.1402 51.1195 51.1612C51.4738 51.1723 51.8281 51.1834 52.1932 51.1949C53.0586 51.3077 53.0586 51.3077 53.7708 52.0154C53.7708 52.3657 53.7708 52.716 53.7708 53.0769C57.5312 53.0769 61.2915 53.0769 65.1659 53.0769C67.2483 63.811 67.6928 75.2797 65.1659 85.9846C65.0896 86.3177 65.0133 86.6508 64.9346 86.994C62.3275 98.0917 57.1044 108.212 49.1415 116.415C48.8385 116.743 48.5356 117.07 48.2234 117.408C45.812 119.94 43.1521 121.914 40.1952 123.778C39.7491 124.06 39.3089 124.351 38.8752 124.651C37.817 125.341 37.2398 125.647 35.9701 125.45C34.7008 124.808 33.5166 124.108 32.3381 123.315C32.1057 123.16 31.8733 123.005 31.6338 122.845C29.0893 121.108 26.8897 119.075 24.7099 116.906C24.2404 116.44 23.7668 115.978 23.2771 115.534C11.8314 104.994 7.18258 87.5713 6.47655 72.6269C6.23966 66.0201 6.89884 59.5516 8.19027 53.0769C11.9507 53.0769 15.7111 53.0769 19.5854 53.0769C19.7029 52.6098 19.8204 52.1428 19.9415 51.6615C20.552 51.0549 21.3675 51.2261 22.2019 51.1957C22.5863 51.1809 22.9708 51.1661 23.3668 51.1508C23.7715 51.1369 24.1761 51.123 24.593 51.1087C25.202 51.0857 25.202 51.0857 25.8234 51.0623C26.8302 51.0247 27.837 50.9886 28.8439 50.9538C29.6627 47.313 30.3489 43.6613 30.9805 39.9846ZM32.761 43.5231C33.1171 44.2308 33.1171 44.2308 33.1171 44.2308L32.761 43.5231ZM37.0342 48.4769C37.6217 48.4769 38.2093 48.4769 38.8147 48.4769C38.9322 48.0098 39.0497 47.5428 39.1708 47.0615C38.3798 47.0615 37.6186 48.0004 37.0342 48.4769ZM34.5415 47.4154C34.659 47.7657 34.7765 48.116 34.8976 48.4769C35.3676 48.3602 35.8377 48.2434 36.322 48.1231C35.4406 47.7728 35.4406 47.7728 34.5415 47.4154ZM35.2537 49.1846C35.3712 49.4182 35.4887 49.6517 35.6098 49.8923C36.3149 49.8923 37.0199 49.8923 37.7464 49.8923C37.8639 49.6588 37.9814 49.4252 38.1025 49.1846C37.1624 49.1846 36.2223 49.1846 35.2537 49.1846ZM36.322 50.6C36.322 50.8335 36.322 51.0671 36.322 51.3077C36.557 51.3077 36.792 51.3077 37.0342 51.3077C37.0342 51.0742 37.0342 50.8406 37.0342 50.6C36.7992 50.6 36.5641 50.6 36.322 50.6ZM21.0098 52.3692C21.0098 52.7195 21.0098 53.0698 21.0098 53.4308C22.4199 53.4308 23.8301 53.4308 25.283 53.4308C25.1654 53.0805 25.0479 52.7302 24.9269 52.3692C23.6342 52.3692 22.3416 52.3692 21.0098 52.3692ZM32.0488 52.3692C32.0488 52.7195 32.0488 53.0698 32.0488 53.4308C33.3414 53.4308 34.6341 53.4308 35.9659 53.4308C35.8484 53.0805 35.7309 52.7302 35.6098 52.3692C34.4347 52.3692 33.2595 52.3692 32.0488 52.3692ZM42.7317 52.3692C42.7317 52.7195 42.7317 53.0698 42.7317 53.4308C44.0244 53.4308 45.317 53.4308 46.6488 53.4308C46.5313 53.0805 46.4138 52.7302 46.2927 52.3692C45.1176 52.3692 43.9425 52.3692 42.7317 52.3692ZM9.61466 54.4923C8.69477 59.6721 8.10579 64.2287 8.10125 69.4202C8.10101 69.6687 8.10077 69.9172 8.10052 70.1732C8.12615 86.973 13.8154 102.906 25.283 115.354C25.5005 115.595 25.7181 115.836 25.9423 116.085C28.5015 118.785 32.4409 122.187 35.9659 123.492C40.8648 123.247 46.1296 117.42 49.3641 114.049C61.5959 100.549 66.0808 82.1941 65.1659 64.4C64.8862 61.0667 64.4014 57.7711 63.7415 54.4923C45.8796 54.4923 28.0178 54.4923 9.61466 54.4923Z",fill:"white"}),e.createElement("path",{d:"M9.61462 79.2615C27.4765 79.2615 45.3383 79.2615 63.7415 79.2615C63.7415 81.1366 63.6772 82.2848 63.2073 84.0163C63.0586 84.574 63.0586 84.574 62.9068 85.1428C62.8297 85.4206 62.7526 85.6984 62.6732 85.9846C62.44 86.0152 62.2068 86.0457 61.9665 86.0772C59.0072 86.5299 56.4576 87.537 53.7596 88.8002C51.0901 90.024 48.6754 90.1455 45.9366 89.1692C45.1056 88.7665 44.2849 88.3564 43.4661 87.9308C39.915 86.0925 36.7566 85.4954 32.8597 86.6177C31.1869 87.1928 29.6292 87.8836 28.0649 88.7048C25.7506 89.8801 23.7487 90.1125 21.2101 89.4775C19.6758 88.9592 18.2315 88.2607 16.7769 87.5548C14.7377 86.6192 12.8955 86.2121 10.6829 85.9846C9.97072 83.8615 9.97072 83.8615 9.61462 79.2615Z",fill:"white"}),e.createElement("path",{d:"M16.3805 0C16.7366 1.06154 16.7366 1.06154 16.5808 1.92404C16.3977 3.07625 16.3066 4.16522 16.2692 5.32981C16.2559 5.68422 16.2426 6.03863 16.2288 6.40379C16.4277 7.75108 16.8346 8.24053 17.8048 9.2C18.9012 10.005 20.0621 10.7036 21.2232 11.4115C22.5956 12.2782 23.6125 12.9456 24.2146 14.5077C24.3602 15.8611 24.336 17.2155 24.3085 18.5749C24.3214 19.3882 24.3579 20.0909 24.5707 20.8769C25.8138 22.0035 26.9953 22.4574 28.6213 22.801C31.6521 23.5651 33.8295 25.0259 35.6097 27.6C35.8538 28.1871 36.0936 28.7759 36.3219 29.3692C36.6745 29.486 37.027 29.6028 37.3902 29.7231C37.3976 29.4312 37.4049 29.1392 37.4125 28.8385C37.9688 26.7745 39.2748 25.4004 41.0583 24.2329C43.184 23.1145 45.3924 22.5073 47.717 21.9385C48.0696 21.8217 48.4221 21.7049 48.7853 21.5846C48.9144 20.6635 49.04 19.7421 49.1637 18.8202C49.2006 18.5591 49.2376 18.2979 49.2757 18.0289C49.4337 16.8318 49.5307 16.022 49.1414 14.8615C50.2598 12.2917 52.8998 10.7835 55.1895 9.3396C56.192 8.67328 56.192 8.67328 56.9756 7.78462C57.1192 6.57394 57.1192 6.57394 57.0646 5.21923C57.0563 4.53777 57.0563 4.53777 57.0479 3.84255C56.9786 2.53358 56.8284 1.29219 56.6195 0C58.562 1.77782 59.2493 3.27242 59.4738 5.8509C59.4614 7.79076 59.0537 9.51373 57.7559 10.9983C56.7363 11.908 55.7091 12.6463 54.5274 13.3356C53.6031 13.9029 53.4423 14.2105 53.0585 15.2154C52.9713 16.0608 52.9153 16.9096 52.8805 17.7587C52.704 20.9043 52.704 20.9043 52.4576 22.3587C52.4195 22.5899 52.3814 22.8212 52.3421 23.0594C51.2213 25.124 48.3339 25.7249 46.2335 26.4051C44.5783 26.9783 43.4882 27.6038 42.3756 29.0154C42.3756 29.4825 42.3756 29.9495 42.3756 30.4308C42.5812 30.117 42.7869 29.8031 42.9987 29.4798C44.791 27.3213 47.9847 26.6717 50.5658 25.8308C50.9219 26.1846 50.9219 26.1846 51.0109 27.401C50.9811 29.7527 50.3012 32.482 48.7853 34.3231C46.9362 35.6093 44.9182 35.6263 42.7317 35.7385C42.8492 35.8552 42.9667 35.972 43.0878 36.0923C43.1545 36.9548 43.1545 36.9548 43.0878 37.8615C42.3756 38.5692 42.3756 38.5692 41.6829 38.6383C40.9642 38.6153 40.2455 38.5923 39.5268 38.5692C39.5268 37.8615 39.5268 37.8615 40.0609 37.2865C40.2372 37.126 40.4135 36.9654 40.5951 36.8C40.3233 37.0189 40.0516 37.2379 39.7716 37.4635C37.9742 38.8757 37.9742 38.8757 36.7893 39.1221C35.0053 38.8211 34.0147 37.6857 32.7609 36.4462C32.9372 36.6651 33.1135 36.884 33.2951 37.1096C33.8292 37.8615 33.8292 37.8615 33.8292 38.5692C31.6732 38.6383 31.6732 38.6383 30.9805 38.5692C30.2683 37.8615 30.2683 37.8615 30.2237 36.9769C30.2384 36.685 30.2531 36.3931 30.2683 36.0923C30.2683 35.8588 30.2683 35.6252 30.2683 35.3846C29.9137 35.4031 29.9137 35.4031 29.5519 35.4219C26.3388 35.5198 26.3388 35.5198 24.9268 34.3231C23.2136 32.4748 22.7191 30.8572 22.5677 28.374C22.541 27.9631 22.5144 27.5521 22.487 27.1287C22.4695 26.8171 22.4521 26.5056 22.4341 26.1846C23.0726 25.9676 23.0726 25.9676 23.8585 25.8308C24.4772 26.1672 25.0946 26.5077 25.6905 26.8826C26.414 27.3222 26.414 27.3222 27.5975 27.5115C29.3652 28.1388 30.2181 29.332 31.3366 30.7846C31.2369 29.6288 31.0013 29.0429 30.2933 28.1073C28.5939 26.7688 26.652 26.2109 24.6166 25.5218C22.2507 24.6598 22.2507 24.6598 21.338 23.3677C21.0498 22.4234 20.8509 21.6146 20.7872 20.6337C20.7624 20.3317 20.7376 20.0297 20.7121 19.7186C20.6718 19.0538 20.6408 18.3884 20.6175 17.7227C20.5274 15.6537 20.5274 15.6537 19.5631 13.8663C18.9856 13.439 18.4057 13.0148 17.816 12.6044C16.2176 11.4695 14.8124 10.4433 14.2439 8.49231C13.8117 5.36743 14.2932 2.99336 16.0244 0.353846C16.1419 0.237077 16.2594 0.120308 16.3805 0Z",fill:"white"}),e.createElement("path",{d:"M44.5635 94.5364C47.2374 95.7275 50.8547 95.5839 53.6372 94.8391C54.7741 94.4048 55.8743 93.9319 56.9756 93.4154C57.5911 93.1419 58.2068 92.8691 58.8229 92.5971C59.0703 92.4817 59.3177 92.3663 59.5726 92.2474C60.1805 92 60.1805 92 60.8927 92C60.6819 93.9509 59.9866 95.5424 59.179 97.3077C58.9955 97.7223 58.9955 97.7223 58.8083 98.1453C56.8002 102.593 56.8002 102.593 54.2826 103.611C53.9443 103.752 53.606 103.892 53.2575 104.038C50.3093 105.16 47.8812 104.991 45.0032 103.729C44.2184 103.353 43.4405 102.966 42.665 102.571C39.3227 100.894 35.9287 100.67 32.3604 101.797C30.6578 102.42 29.0424 103.168 27.4404 104.013C25.6748 104.908 24.0191 104.977 22.0781 104.738C20.5992 104.255 19.2052 103.643 17.8049 102.969C17.5671 102.874 17.3293 102.779 17.0844 102.681C16.1939 102.15 15.9855 101.693 15.5654 100.756C15.4286 100.454 15.2918 100.151 15.1509 99.8392C15.0132 99.522 14.8754 99.2047 14.7336 98.8779C14.5931 98.5702 14.4526 98.2626 14.3079 97.9456C13.4354 95.9816 12.8643 94.1095 12.4634 92C14.6302 92.6706 16.6529 93.4769 18.7021 94.4465C21.916 95.8446 25.9756 95.6101 29.2 94.3885C30.8933 93.6545 32.5395 92.8326 34.1854 92C37.9611 90.8369 41.2913 92.8601 44.5635 94.5364Z",fill:"white"}),e.createElement("path",{d:"M40.3322 107.474C41.3764 107.955 42.3961 108.474 43.4161 109.004C45.3459 109.976 47.3432 110.42 49.4976 110.621C49.9052 110.661 49.9052 110.661 50.321 110.701C50.5193 110.719 50.7176 110.736 50.9219 110.754C48.5918 114.902 44.764 117.921 40.9512 120.662C40.5799 120.932 40.2085 121.202 39.8259 121.48C37.9001 122.798 37.9001 122.798 37.0341 123.138C32.0976 121.858 27.4575 116.995 24.0811 113.363C23.9135 113.183 23.746 113.003 23.5734 112.818C22.4341 111.554 22.4341 111.554 22.4341 110.754C22.7527 110.719 23.0713 110.685 23.3995 110.649C26.4898 110.269 29.1229 109.679 31.8401 108.146C34.7246 106.54 37.2331 106.135 40.3322 107.474Z",fill:"white"}),e.createElement("path",{d:"M35.6098 55.9077C36.3148 55.9077 37.0199 55.9077 37.7464 55.9077C37.7464 56.258 37.7464 56.6083 37.7464 56.9692C38.2164 56.9692 38.6865 56.9692 39.1707 56.9692C39.1707 56.7357 39.1707 56.5021 39.1707 56.2615C40.2168 56.3942 40.2168 56.3942 41.3073 56.6154C41.4836 56.9657 41.4836 56.9657 41.6634 57.3231C41.5459 57.5566 41.4284 57.7901 41.3073 58.0308C41.7039 57.9103 41.7039 57.9103 42.1085 57.7875C43.0878 57.6769 43.0878 57.6769 43.9113 58.1856C44.1096 58.368 44.3079 58.5505 44.5122 58.7385C44.3947 59.3223 44.2772 59.9061 44.1561 60.5077C44.3397 60.4347 44.5233 60.3617 44.7125 60.2865C45.9424 60.0985 46.897 60.5042 48.0732 60.8615C48.082 62.6188 48.0884 64.3761 48.0927 66.1334C48.0945 66.7316 48.097 67.3299 48.1 67.9282C48.1043 68.7863 48.1064 69.6443 48.108 70.5025C48.1098 70.7715 48.1116 71.0406 48.1135 71.3178C48.1136 71.9607 48.0953 72.6036 48.0732 73.2461C47.4059 73.9093 46.2772 73.6936 45.3844 73.7244C45.1429 73.7327 44.9013 73.7411 44.6525 73.7497C43.8565 73.7759 43.0605 73.7988 42.2643 73.8211C41.9946 73.8292 41.7249 73.8373 41.4471 73.8456C36.1567 73.9989 30.9284 73.849 25.639 73.6C25.639 69.3963 25.639 65.1926 25.639 60.8615C28.4878 60.1538 28.4878 60.1538 29.2 60.5077C29.0825 59.9238 28.965 59.34 28.8439 58.7385C29.6674 58.1856 29.6674 58.1856 30.6244 57.6769C30.9769 57.7937 31.3295 57.9105 31.6927 58.0308C31.8102 57.5637 31.9277 57.0966 32.0488 56.6154C32.7539 56.4986 33.4589 56.3818 34.1854 56.2615C34.1854 56.4951 34.1854 56.7286 34.1854 56.9692C34.6554 56.9692 35.1255 56.9692 35.6098 56.9692C35.6098 56.6189 35.6098 56.2686 35.6098 55.9077ZM33.1171 59.8C33.1171 59.9168 33.1171 60.0335 33.1171 60.1538C35.4673 60.1538 37.8176 60.1538 40.239 60.1538C39.155 59.0767 38.1906 59.037 36.7226 59.026C35.3676 59.0358 34.3344 59.1548 33.1171 59.8ZM31.804 61.0385C30.6804 61.1522 29.6212 61.2154 28.4878 61.2154C28.4878 64.2514 28.4878 67.2874 28.4878 70.4154C32.9111 70.5817 32.9111 70.5817 36.322 69.7077C36.322 66.7885 36.322 63.8692 36.322 60.8615C34.7593 60.8615 33.3385 60.8818 31.804 61.0385ZM37.0342 61.2154C37.0031 61.8455 36.9961 62.4768 36.9994 63.1076C37.0005 63.4896 37.0017 63.8716 37.0029 64.2652C37.0058 64.6673 37.0088 65.0694 37.0119 65.4836C37.0135 65.8871 37.0151 66.2905 37.0168 66.7062C37.021 67.7067 37.0269 68.7072 37.0342 69.7077C39.844 70.4649 41.7668 70.4154 44.8683 70.4154C44.8683 67.3794 44.8683 64.3434 44.8683 61.2154C43.8107 61.2154 42.7531 61.2154 41.6634 61.2154C41.0689 61.1028 40.4752 60.9854 39.8829 60.8615C38.348 60.6737 38.348 60.6737 37.0342 61.2154ZM27.4195 61.5692C26.9662 61.9403 26.9662 61.9403 27.023 62.7753C27.0249 63.144 27.0267 63.5128 27.0287 63.8927C27.0298 64.2907 27.0309 64.6887 27.0321 65.0987C27.0351 65.5177 27.0381 65.9366 27.0412 66.3683C27.0428 66.7886 27.0444 67.2089 27.046 67.642C27.0503 68.6844 27.0561 69.7268 27.0634 70.7692C27.2985 70.6525 27.5335 70.5357 27.7756 70.4154C27.7756 67.4961 27.7756 64.5769 27.7756 61.5692C27.6581 61.5692 27.5406 61.5692 27.4195 61.5692ZM45.5805 61.5692C45.5496 63.0288 45.5305 64.4883 45.5137 65.9481C45.5048 66.3641 45.4958 66.7801 45.4866 67.2086C45.4832 67.6055 45.4797 68.0023 45.4762 68.4112C45.4706 68.7781 45.465 69.145 45.4592 69.523C45.4992 69.8175 45.5393 70.112 45.5805 70.4154C46.1093 70.7657 46.1093 70.7657 46.6488 71.1231C46.6797 69.6635 46.6988 68.204 46.7156 66.7442C46.7245 66.3282 46.7335 65.9122 46.7427 65.4836C46.7461 65.0868 46.7496 64.69 46.7531 64.2811C46.7587 63.9142 46.7643 63.5473 46.7701 63.1693C46.73 62.8748 46.69 62.5803 46.6488 62.2769C46.2963 62.0434 45.9437 61.8098 45.5805 61.5692ZM30.8678 71.0457C29.9122 71.1231 29.9122 71.1231 28.9455 71.0678C28.6769 71.086 28.4084 71.1043 28.1317 71.1231C27.7792 71.6485 27.7792 71.6485 27.4195 72.1846C29.4799 72.5143 31.2369 72.5116 33.2951 72.2067C33.6835 72.1537 33.6835 72.1537 34.0797 72.0996C34.7089 72.0132 35.3374 71.9225 35.9659 71.8308C35.9659 71.4805 35.9659 71.1301 35.9659 70.7692C34.248 70.7231 32.5742 70.8725 30.8678 71.0457ZM37.3903 70.7692C37.5078 71.1195 37.6253 71.4698 37.7464 71.8308C38.8435 71.9704 39.9417 72.1005 41.0403 72.2288C41.5064 72.2884 41.5064 72.2884 41.982 72.3491C42.2826 72.3833 42.5833 72.4175 42.8931 72.4528C43.1691 72.4861 43.4451 72.5195 43.7294 72.5538C44.6388 72.536 45.1611 72.2866 45.9366 71.8308C45.299 71.0429 45.299 71.0429 44.4385 71.0664C44.1323 71.0778 43.8261 71.0892 43.5107 71.101C42.2299 71.1283 41.1363 71.0385 39.8829 70.7692C39.0522 70.7557 38.221 70.753 37.3903 70.7692Z",fill:"white"}),e.createElement("path",{d:"M28.8439 73.9538C34.31 73.8887 34.31 73.8887 37.016 74.2648C37.7377 74.3449 37.7377 74.3449 38.382 74.1418C39.557 73.8618 40.7299 73.9171 41.9305 73.9317C42.1788 73.9333 42.4271 73.9349 42.683 73.9366C43.2927 73.9407 43.9025 73.9471 44.5122 73.9538C44.5122 74.3041 44.5122 74.6545 44.5122 75.0154C43.3627 75.7768 42.9866 75.7941 41.6634 75.7231C41.6634 76.0734 41.6634 76.4237 41.6634 76.7846C40.8408 77.0181 40.0182 77.2517 39.1707 77.4923C39.0532 77.2588 38.9357 77.0252 38.8146 76.7846C38.4621 76.7846 38.1095 76.7846 37.7463 76.7846C37.7463 77.1349 37.7463 77.4852 37.7463 77.8461C37.0412 77.8461 36.3362 77.8461 35.6097 77.8461C35.6097 77.4958 35.6097 77.1455 35.6097 76.7846C35.2572 76.7846 34.9047 76.7846 34.5414 76.7846C34.4239 77.0181 34.3064 77.2517 34.1853 77.4923C33.1393 77.2048 33.1393 77.2048 32.0487 76.7846C31.9312 76.4343 31.8137 76.084 31.6927 75.7231C31.4209 75.745 31.1492 75.7669 30.8692 75.7894C29.9122 75.7231 29.9122 75.7231 29.2667 75.2365C28.8439 74.6615 28.8439 74.6615 28.8439 73.9538Z",fill:"white"}))),gi||(gi=e.createElement("defs",null,e.createElement("clipPath",{id:"clip0_1_9"},e.createElement("rect",{width:73,height:138,fill:"white"})))))}const wi=e.forwardRef(bi);__webpack_require__.p;const Si=t=>{let{set_user:i}=t;const[r,n]=(0,e.useState)(!1),[a,o]=(0,e.useState)(""),[s,l]=(0,e.useState)(""),[c,h]=(0,e.useState)(!1),{setStudentNumber:u}=(0,e.useContext)(li),[d,p]=(0,e.useState)(null),[f,m]=(0,e.useState)(!1),[g,_]=(0,e.useState)(!1),y=K(),x=async(e,t)=>{m(!0);try{const r=await async function(e,t){return await fetch("/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})})}(e,t);200===r.status?(u(e),i(e),m(!1),g&&localStorage.setItem("user",JSON.stringify({username:e,password:t})),y("/main")):401===r.status?(i(null),p("Invalid credentials"),m(!1)):(i(null),p("Unexpected error. Please try again"),m(!1))}catch(d){p("Erorr during login. Please make sure you are connected to the internet and try again"),i(null),m(!1)}};return(0,e.useEffect)((()=>{h(!0),(async()=>{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);o(t.username),l(t.password),x(t.username,t.password)}})()}),[]),(0,Ze.jsxs)("div",{className:"login-container",children:[(0,Ze.jsxs)("div",{className:"header",children:[(0,Ze.jsx)(wi,{className:"logo"}),(0,Ze.jsx)("h1",{className:"signInText",children:"Sign In"})]}),(0,Ze.jsx)("div",{className:"formContainer "+(c?"formContainer-show":""),children:(0,Ze.jsxs)("div",{className:"formSubContainer "+(f?"formSubContainer-hidden":""),children:[(0,Ze.jsx)("h2",{className:"title",children:"Welcome to Campus Safety App"}),(0,Ze.jsx)("p",{className:"subtitle",children:"To login, use your Wits student number and your student password"}),(0,Ze.jsx)("input",{type:"text",placeholder:"Student Number",className:"inputField",value:a,onChange:e=>o(e.target.value)}),(0,Ze.jsxs)("div",{className:"passwordContainer",children:[(0,Ze.jsx)("input",{type:r?"text":"password",placeholder:"Password",className:"inputField",value:s,onChange:e=>l(e.target.value)}),(0,Ze.jsx)("span",{onClick:()=>{n(!r)},className:"eyeIcon",children:r?"\ud83d\ude48":"\ud83d\udc41\ufe0f"})]}),(0,Ze.jsx)("div",{className:"optionsContainer",children:(0,Ze.jsxs)("label",{children:[(0,Ze.jsx)("input",{type:"checkbox",onChange:e=>_(!g)}),"Remember me?"]})}),d?(0,Ze.jsx)("div",{className:"login-errorContainer",children:(0,Ze.jsx)("h3",{className:"login-error-message",children:`An error has occurred: ${d}`})}):(0,Ze.jsx)(Ze.Fragment,{}),(0,Ze.jsx)("button",{className:"signInButton",onClick:()=>x(a,s),children:f?(0,Ze.jsx)(Qe,{size:40}):"Sign In"}),(0,Ze.jsx)("div",{className:"login-scroll-base",children:" ."})]})})]})},Ei=()=>{const[t,i]=(0,e.useState)(null);return(0,Ze.jsx)("div",{className:"App",children:(0,Ze.jsx)(ci,{children:(0,Ze.jsx)(_e,{children:(0,Ze.jsxs)(fe,{children:[(0,Ze.jsx)(de,{path:"/main",element:(0,Ze.jsx)(xi,{user:t,set_user:i})}),(0,Ze.jsx)(de,{path:"/",element:(0,Ze.jsx)(Si,{set_user:i})})]})})})})},Ti=e=>{e&&e instanceof Function&&__webpack_require__.e(453).then(__webpack_require__.bind(__webpack_require__,453)).then((t=>{let{getCLS:i,getFID:r,getFCP:n,getLCP:a,getTTFB:o}=t;i(e),r(e),n(e),a(e),o(e)}))};i.createRoot(document.getElementById("root")).render((0,Ze.jsx)(e.StrictMode,{children:(0,Ze.jsx)(Ei,{})})),Ti()})()})();
//# sourceMappingURL=main.06b07f54.js.map